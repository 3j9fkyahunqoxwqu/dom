<!DOCTYPE html><html lang="en-US"><meta charset="utf-8">
<title>DOM Standard</title>
<link rel="stylesheet" href="//whatwg.org/style/specification">
<link rel="icon" href="//resources.whatwg.org/logo-dom.svg">

<div class="head">

<p><a class="logo" href="//whatwg.org/"><img height="100" src="//resources.whatwg.org/logo-dom.svg" width="100" alt="WHATWG"></a></p>

<hgroup>
 <h1 class="allcaps">DOM</h1>
 <h2>Living Standard — Last Updated 14 January 2015</h2>
</hgroup>

<dl>
 <dt>Participate:</dt>
 <dd class="dontpublish">Send feedback to
 <a href="mailto:www-dom@w3.org?subject=DOM%3A%20">www-dom@w3.org</a> (<a href="http://lists.w3.org/Archives/Public/www-dom/">archives</a>) or
 <a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WebAppsWG&amp;component=DOM">file a bug</a>
 (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WebAppsWG&amp;component=DOM&amp;resolution=---">open bugs</a>)
 <dd class="dontpublish"><a href="//wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Version History:
 <dd><a href="https://github.com/whatwg/dom/commits">https://github.com/whatwg/dom/commits</a>
 <dd><a href="https://twitter.com/thedomstandard">@thedomstandard</a>
</dl>

<script async="" src="//resources.whatwg.org/file-bug.js"></script>

</div>


<h2 class="no-num no-toc" id="abstract">Abstract</h2>
<p>DOM defines a platform-neutral model for events and node trees.


<h2 class="no-num no-toc" id="table-of-contents">Table of Contents</h2>

<!--begin-toc-->
<ol class="toc">
 <li><a class="no-num" href="#goals">Goals</a></li>
 <li><a href="#conformance"><span class="secno">1 </span>Conformance</a>
  <ol>
   <li><a href="#dependencies"><span class="secno">1.1 </span>Dependencies</a></li>
   <li><a href="#extensibility"><span class="secno">1.2 </span>Extensibility</a></ol></li>
 <li><a href="#terminology"><span class="secno">2 </span>Terminology</a>
  <ol>
   <li><a href="#trees"><span class="secno">2.1 </span>Trees</a></li>
   <li><a href="#strings"><span class="secno">2.2 </span>Strings</a></li>
   <li><a href="#ordered-sets"><span class="secno">2.3 </span>Ordered sets</a></li>
   <li><a href="#namespaces"><span class="secno">2.4 </span>Namespaces</a></ol></li>
 <li><a href="#events"><span class="secno">3 </span>Events</a>
  <ol>
   <li><a href="#introduction-to-dom-events"><span class="secno">3.1 </span>Introduction to "DOM Events"</a></li>
   <li><a href="#interface-event"><span class="secno">3.2 </span>Interface <code>Event</code></a></li>
   <li><a href="#interface-customevent"><span class="secno">3.3 </span>Interface <code>CustomEvent</code></a></li>
   <li><a href="#constructing-events"><span class="secno">3.4 </span>Constructing events</a></li>
   <li><a href="#defining-event-interfaces"><span class="secno">3.5 </span>Defining event interfaces</a></li>
   <li><a href="#interface-eventtarget"><span class="secno">3.6 </span>Interface <code>EventTarget</code></a></li>
   <li><a href="#dispatching-events"><span class="secno">3.7 </span>Dispatching events</a></li>
   <li><a href="#firing-events"><span class="secno">3.8 </span>Firing events</a></ol></li>
 <li><a href="#nodes"><span class="secno">4 </span>Nodes</a>
  <ol>
   <li><a href="#introduction-to-the-dom"><span class="secno">4.1 </span>Introduction to "The DOM"</a></li>
   <li><a href="#node-tree"><span class="secno">4.2 </span>Node tree</a>
    <ol>
     <li><a href="#mutation-algorithms"><span class="secno">4.2.1 </span>Mutation algorithms</a></li>
     <li><a href="#interface-nonelementparentnode"><span class="secno">4.2.2 </span>Interface <code>NonElementParentNode</code></a></li>
     <li><a href="#interface-parentnode"><span class="secno">4.2.3 </span>Interface <code>ParentNode</code></a></li>
     <li><a href="#interface-nondocumenttypechildnode"><span class="secno">4.2.4 </span>Interface <code>NonDocumentTypeChildNode</code></a></li>
     <li><a href="#interface-childnode"><span class="secno">4.2.5 </span>Interface <code>ChildNode</code></a></li>
     <li><a href="#collections:-elements"><span class="secno">4.2.6 </span>Collections: <code>Elements</code></a></li>
     <li><a href="#old-style-collections:-nodelist-and-htmlcollection"><span class="secno">4.2.7 </span>Old-style collections: <code>NodeList</code> and <code>HTMLCollection</code></a>
      <ol>
       <li><a href="#interface-nodelist"><span class="secno">4.2.7.1 </span>Interface <code>NodeList</code></a></li>
       <li><a href="#interface-htmlcollection"><span class="secno">4.2.7.2 </span>Interface <code>HTMLCollection</code></a></ol></ol></li>
   <li><a href="#mutation-observers"><span class="secno">4.3 </span>Mutation observers</a>
    <ol>
     <li><a href="#interface-mutationobserver"><span class="secno">4.3.1 </span>Interface <code>MutationObserver</code></a></li>
     <li><a href="#queuing-a-mutation-record"><span class="secno">4.3.2 </span>Queuing a mutation record</a></li>
     <li><a href="#interface-mutationrecord"><span class="secno">4.3.3 </span>Interface <code>MutationRecord</code></a></li>
     <li><a href="#garbage-collection"><span class="secno">4.3.4 </span>Garbage collection</a></ol></li>
   <li><a href="#interface-node"><span class="secno">4.4 </span>Interface <code>Node</code></a></li>
   <li><a href="#interface-document"><span class="secno">4.5 </span>Interface <code>Document</code></a>
    <ol>
     <li><a href="#interface-domimplementation"><span class="secno">4.5.1 </span>Interface <code>DOMImplementation</code></a></ol></li>
   <li><a href="#interface-documentfragment"><span class="secno">4.6 </span>Interface <code>DocumentFragment</code></a></li>
   <li><a href="#interface-documenttype"><span class="secno">4.7 </span>Interface <code>DocumentType</code></a></li>
   <li><a href="#interface-element"><span class="secno">4.8 </span>Interface <code>Element</code></a>
    <ol>
     <li><a href="#interface-namednodemap"><span class="secno">4.8.1 </span>Interface <code>NamedNodeMap</code></a></li>
     <li><a href="#interface-attr"><span class="secno">4.8.2 </span>Interface <code>Attr</code></a></ol></li>
   <li><a href="#interface-characterdata"><span class="secno">4.9 </span>Interface <code>CharacterData</code></a></li>
   <li><a href="#interface-text"><span class="secno">4.10 </span>Interface <code>Text</code></a></li>
   <li><a href="#interface-processinginstruction"><span class="secno">4.11 </span>Interface <code>ProcessingInstruction</code></a></li>
   <li><a href="#interface-comment"><span class="secno">4.12 </span>Interface <code>Comment</code></a></ol></li>
 <li><a href="#ranges"><span class="secno">5 </span>Ranges</a>
  <ol>
   <li><a href="#introduction-to-dom-ranges"><span class="secno">5.1 </span>Introduction to "DOM Ranges"</a></li>
   <li><a href="#interface-range"><span class="secno">5.2 </span>Interface <code>Range</code></a></ol></li>
 <li><a href="#traversal"><span class="secno">6 </span>Traversal</a>
  <ol>
   <li><a href="#interface-nodeiterator"><span class="secno">6.1 </span>Interface <code>NodeIterator</code></a></li>
   <li><a href="#interface-treewalker"><span class="secno">6.2 </span>Interface <code>TreeWalker</code></a></li>
   <li><a href="#interface-nodefilter"><span class="secno">6.3 </span>Interface <code>NodeFilter</code></a></ol></li>
 <li><a href="#sets"><span class="secno">7 </span>Sets</a>
  <ol>
   <li><a href="#interface-domtokenlist"><span class="secno">7.1 </span>Interface <code>DOMTokenList</code></a></li>
   <li><a href="#interface-domsettabletokenlist"><span class="secno">7.2 </span>Interface <code>DOMSettableTokenList</code></a></ol></li>
 <li><a href="#historical"><span class="secno">8 </span>Historical</a>
  <ol>
   <li><a href="#dom-events"><span class="secno">8.1 </span>DOM Events</a></li>
   <li><a href="#dom-core"><span class="secno">8.2 </span>DOM Core</a></li>
   <li><a href="#dom-ranges"><span class="secno">8.3 </span>DOM Ranges</a></li>
   <li><a href="#dom-traversal"><span class="secno">8.4 </span>DOM Traversal</a></ol></li>
 <li><a class="no-num" href="#references">References</a></li>
 <li><a class="no-num" href="#acknowledgments">Acknowledgments</a></ol>
<!--end-toc-->



<h2 class="no-num" id="goals">Goals</h2>

<p>This specification standardizes the DOM. It does so as follows:</p>

<ol>
 <li>
  <p>By consolidating <cite>DOM Level 3 Core</cite>
  <a class="informative" href="#refsDOM3CORE">[DOM3CORE]</a>,
  <cite>Element Traversal</cite>
  <a class="informative" href="#refsELEMENTTRAVERSAL">[ELEMENTTRAVERSAL]</a>,
  <cite>Selectors API Level 2</cite>
  <a class="informative" href="#refsSELECTORSAPI">[SELECTORSAPI]</a>, the
  "DOM Event Architecture" and "Basic Event Interfaces" chapters of
  <cite>DOM Level 3 Events</cite>
  <a class="informative" href="#refsDOM3EVENTS">[DOM3EVENTS]</a> (specific type
  of events do not belong in the base specification), and
  <cite>DOM Level 2 Traversal and Range</cite>
  <a class="informative" href="#refsDOM2TR">[DOM2TR]</a>, and:

  <ul>
   <li>Aligning them with the needs of JavaScript where possible.
   <li>Aligning them with existing implementations.
   <li>Simplifying them as much as possible.
  </ul>

 <li><p>By moving features from the HTML standard that ought to be part of the DOM
 platform here. <a href="#refsHTML">[HTML]</a>

 <li>
  <p>By defining a replacement for the "Mutation Events" and
  "Mutation Name Event Types" chapters of <cite>DOM Level 3 Events</cite>
  <a class="informative" href="#refsDOM3EVENTS">[DOM3EVENTS]</a> as the old model
  was problematic.

  <p class="note">The old model is expected to be removed from implementations
  in due course.

 <li><p>By defining new features that simplify common DOM operations.
</ol>



<h2 id="conformance"><span class="secno">1 </span>Conformance</h2>
<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
"OPTIONAL" in this document are to be interpreted as described in RFC 2119.
For readability, these words do not appear in all uppercase letters in this
specification. <a href="#refsRFC2119">[RFC2119]</a>

<p>Requirements phrased in the imperative as part of algorithms
(such as "strip any leading space characters" or "return false and
terminate these steps") are to be interpreted with the meaning of the
key word ("must", "should", "may", etc) used in introducing the
algorithm.

<p>Conformance requirements phrased as algorithms or specific steps
may be implemented in any manner, so long as the end result is
equivalent. (In particular, the algorithms defined in this
specification are intended to be easy to follow, and not intended to
be performant.)

<p id="hardwareLimitations">User agents may impose
implementation-specific limits on otherwise unconstrained inputs,
e.g. to prevent denial of service attacks, to guard against running
out of memory, or to work around platform-specific limitations.

<p>When a method or an attribute is said to call another method or attribute, the user agent must invoke its internal API for that attribute or method so that e.g. the author can't change the behavior by overriding attributes or methods with custom properties or functions in JavaScript.

<p>Unless otherwise stated, string comparisons are done in a <a href="#case-sensitive">case-sensitive</a> manner.

<h3 id="dependencies"><span class="secno">1.1 </span>Dependencies</h3>

<p>The IDL fragments in this specification must be interpreted as
required for conforming IDL fragments, as described in the Web IDL
specification. <a href="#refsWEBIDL">[WEBIDL]</a>

<p>Some of the terms used in this specification are defined in
<cite>Encoding</cite>, <cite>Selectors</cite>, <cite>Web IDL</cite>, <cite>XML</cite>, and
<cite>Namespaces in XML</cite>.
<a href="#refsENCODING">[ENCODING]</a>
<a href="#refsSELECTORS">[SELECTORS]</a>
<a href="#refsWEBIDL">[WEBIDL]</a>
<a href="#refsXML">[XML]</a>
<a href="#refsXMLNS">[XMLNS]</a>

<h3 id="extensibility"><span class="secno">1.2 </span>Extensibility</h3>

<p>Vendor-specific proprietary extensions to this specification are
strongly discouraged. Authors must not use such extensions, as
doing so reduces interoperability and fragments the user base,
allowing only users of specific user agents to access the content in
question.

<p>If vendor-specific extensions are needed, the members should be
prefixed by vendor-specific strings to prevent clashes with future
versions of this specification. Extensions must be defined so that
the use of extensions neither contradicts nor causes the
non-conformance of functionality defined in the specification.
<!-- thanks to QA Framework -->

<p>When vendor-neutral extensions to this specification are needed,
either this specification can be updated accordingly, or an
extension specification can be written that overrides the
requirements in this specification. When someone applying this
specification to their activities decides that they will recognize
the requirements of such an extension specification, it becomes an
<dfn title="other applicable specifications" id="other-applicable-specifications">applicable
specification</dfn> for the purposes of conformance requirements in
this specification.
<!-- http://www.w3.org/mid/17E341CD-E790-422C-9F9A-69347EE01CEB@iki.fi -->


<h2 id="terminology"><span class="secno">2 </span>Terminology</h2>

<p>The term <dfn id="context-object">context object</dfn> means the object on which the algorithm,
attribute getter, attribute setter, or method being discussed was called. When the
<a href="#context-object">context object</a> is unambiguous, the term can be omitted.

<!-- XXX we should prolly explain that "set attribute X to Y" works even for
readonly attributes when it is language for implementors -->

<h3 id="trees"><span class="secno">2.1 </span>Trees</h3> <!-- Sorry reddit, this is not /r/trees -->

<p>A <dfn title="concept-tree" id="concept-tree">tree</dfn> is a finite hierarchical tree structure. In
<dfn title="concept-tree-order" id="concept-tree-order">tree order</dfn> is preorder, depth-first
traversal of a <a title="concept-tree" href="#concept-tree">tree</a>.
<!-- http://en.wikipedia.org/wiki/Tree_traversal#Depth-first_Traversal -->

<p>An object that <dfn title="concept-tree-participate" id="concept-tree-participate">participates</dfn> in
a <a title="concept-tree" href="#concept-tree">tree</a> has a
<dfn title="concept-tree-parent" id="concept-tree-parent">parent</dfn>, which is either another object
or null, and an ordered list of zero or more
<dfn title="concept-tree-child" id="concept-tree-child">child</dfn> objects. An object <var title="">A</var> whose
<a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is object <var title="">B</var> is a
<a title="concept-tree-child" href="#concept-tree-child">child</a> of <var title="">B</var>.

<p>The <dfn title="concept-tree-root" id="concept-tree-root">root</dfn> of an object is itself, if its
<a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is null, or else it is the
<a title="concept-tree-root" href="#concept-tree-root">root</a> of its
<a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

<p>An object <var title="">A</var> is called a
<dfn title="concept-tree-descendant" id="concept-tree-descendant">descendant</dfn> of an object
<var title="">B</var>, if either <var title="">A</var> is a
<a title="concept-tree-child" href="#concept-tree-child">child</a> of <var title="">B</var> or
<var title="">A</var> is a <a title="concept-tree-child" href="#concept-tree-child">child</a> of an
object <var title="">C</var> that is a
<a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a> of <var title="">B</var>.

<p>An
<dfn title="concept-tree-inclusive-descendant" id="concept-tree-inclusive-descendant">inclusive descendant</dfn> is
an object or one of its
<a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a>.

<p>An object <var title="">A</var> is called an
<dfn title="concept-tree-ancestor" id="concept-tree-ancestor">ancestor</dfn> of an object
<var title="">B</var> if and only if <var title="">B</var> is a
<a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a> of
<var title="">A</var>.

<p>An <dfn title="concept-tree-inclusive-ancestor" id="concept-tree-inclusive-ancestor">inclusive ancestor</dfn> is
an object or one of its <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestors</a>.

<p>An object <var title="">A</var> is called a
<dfn title="concept-tree-sibling" id="concept-tree-sibling">sibling</dfn> of an object
<var title="">B</var>, if and only if <var title="">B</var> and <var title="">A</var>
share the same non-null <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

<p>An object <var title="">A</var> is
<dfn title="concept-tree-preceding" id="concept-tree-preceding">preceding</dfn> an object
<var title="">B</var> if <var title="">A</var> and <var title="">B</var> are in the
same <a title="concept-tree" href="#concept-tree">tree</a> and <var title="">A</var> comes
before <var title="">B</var> in
<a title="concept-tree-order" href="#concept-tree-order">tree order</a>.

<p>An object <var title="">A</var> is
<dfn title="concept-tree-following" id="concept-tree-following">following</dfn> an object
<var title="">B</var> if <var title="">A</var> and <var title="">B</var> are in the
same <a title="concept-tree" href="#concept-tree">tree</a> and <var title="">A</var> comes
after <var title="">B</var> in
<a title="concept-tree-order" href="#concept-tree-order">tree order</a>.

<p>The <dfn title="concept-tree-first-child" id="concept-tree-first-child">first child</dfn> of an object is
its first <a title="concept-tree-child" href="#concept-tree-child">child</a> or null if it has no
<a title="concept-tree-child" href="#concept-tree-child">child</a>.

<p>The <dfn title="concept-tree-last-child" id="concept-tree-last-child">last child</dfn> of an object is
its last <a title="concept-tree-child" href="#concept-tree-child">child</a> or null if it has no
<a title="concept-tree-child" href="#concept-tree-child">child</a>.

<p>The <dfn title="concept-tree-previous-sibling" id="concept-tree-previous-sibling">previous sibling</dfn> of an
object is its first <a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a>
<a title="concept-tree-sibling" href="#concept-tree-sibling">sibling</a> or null if it has no
<a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a>
<a title="concept-tree-sibling" href="#concept-tree-sibling">sibling</a>.

<p>The <dfn title="concept-tree-next-sibling" id="concept-tree-next-sibling">next sibling</dfn> of an
object is its first <a title="concept-tree-following" href="#concept-tree-following">following</a>
<a title="concept-tree-sibling" href="#concept-tree-sibling">sibling</a> or null if it has no
<a title="concept-tree-following" href="#concept-tree-following">following</a>
<a title="concept-tree-sibling" href="#concept-tree-sibling">sibling</a>.

<p>The <dfn title="concept-tree-index" id="concept-tree-index">index</dfn> of an object is its number
of <a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a>
<a title="concept-tree-sibling" href="#concept-tree-sibling">siblings</a>.


<h3 id="strings"><span class="secno">2.2 </span>Strings</h3>
<p>Comparing two strings in a <dfn id="case-sensitive">case-sensitive</dfn> manner means comparing them exactly, code point for code point.

<p>Comparing two strings in a <dfn id="ascii-case-insensitive">ASCII case-insensitive</dfn> manner means comparing them exactly, code point for code point, except that the characters in the range U+0041 .. U+005A (i.e. LATIN CAPITAL LETTER A to LATIN CAPITAL LETTER Z) and the corresponding characters in the range U+0061 .. U+007A (i.e. LATIN SMALL LETTER A to LATIN SMALL LETTER Z) are considered to also match.

<p><dfn title="converted to ascii uppercase" id="converted-to-ascii-uppercase">Converting a string to ASCII uppercase</dfn> means replacing all characters in the range U+0061 to U+007A (i.e. LATIN SMALL LETTER A to LATIN SMALL LETTER Z) with the corresponding characters in the range U+0041 to U+005A (i.e. LATIN CAPITAL LETTER A to LATIN CAPITAL LETTER Z).

<p><dfn title="converted to ascii lowercase" id="converted-to-ascii-lowercase">Converting a string to ASCII lowercase</dfn> means replacing all characters in the range U+0041 to U+005A (i.e. LATIN CAPITAL LETTER A to LATIN CAPITAL LETTER Z) with the corresponding characters in the range U+0061 to U+007A (i.e. LATIN SMALL LETTER A to LATIN SMALL LETTER Z).

<p>A string <var title="">pattern</var> is a <dfn id="prefix-match">prefix match</dfn> for a string
<var title="">s</var> when <var title="">pattern</var> is not longer than
<var title="">s</var> and truncating <var title="">s</var> to
<var title="">pattern</var>'s length leaves the two strings as matches of each
other.


<h3 id="ordered-sets"><span class="secno">2.3 </span>Ordered sets</h3>

<p>The <dfn title="concept-ordered-set-parser" id="concept-ordered-set-parser">ordered set parser</dfn> takes a string
<var title="">input</var> and then runs these steps:

<ol>
 <li><p>Let <var title="">position</var> be a pointer into <var title="">input</var>,
 initially pointing at the start of the string.

 <li><p>Let <var title="">tokens</var> be an ordered set of tokens, initially empty.

 <li><p><a href="#skip-ascii-whitespace">Skip ASCII whitespace</a>.

 <li><p>While <var title="">position</var> is not past the end of
 <var title="">input</var>:

  <ol>
   <li><p><a href="#collect-a-code-point-sequence">Collect a code point sequence</a> of code points that are
   not <a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a>.

   <li><p>If the collected string is not in <var title="">tokens</var>, append the
   collected string to <var title="">tokens</var>.

   <li><p><a href="#skip-ascii-whitespace">Skip ASCII whitespace</a>.
  </ol>

 <li><p>Return <var title="">tokens</var>.
</ol>

<p>To <dfn id="collect-a-code-point-sequence">collect a code point sequence</dfn> of
<var title="">code points</var>, run these steps:

<ol>
 <li><p>Let <var title="">input</var> and <var title="">position</var> be the same
 variables as those of the same name in the algorithm that invoked these
 steps.

 <li><p>Let <var title="">result</var> be the empty string.

 <li><p>While <var title="">position</var> does not point past the end of
 <var title="">input</var> and the code point at <var title="">position</var> is
 one of <var title="">code points</var>, append that code point to the end
 of <var title="">result</var> and advance <var title="">position</var> to the
 next code point in <var title="">input</var>.

 <li><p>Return <var title="">result</var>.
</ol>

<p>To <dfn id="skip-ascii-whitespace">skip ASCII whitespace</dfn> means to
<a href="#collect-a-code-point-sequence">collect a code point sequence</a> of
<a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a> and discard the
return value.

<p>The <dfn title="concept-ordered-set-serializer" id="concept-ordered-set-serializer">ordered set serializer</dfn> takes a
<var title="">set</var> and returns the concatenation of the strings in
<var title="">set</var>, separated from each other by U+0020.


<h3 id="namespaces"><span class="secno">2.4 </span>Namespaces</h3>
<p>The <dfn id="html-namespace">HTML namespace</dfn> is
<code title="">http://www.w3.org/1999/xhtml</code>.

<p>The <dfn id="xml-namespace">XML namespace</dfn> is
<code title="">http://www.w3.org/XML/1998/namespace</code>.

<p>The <dfn id="xmlns-namespace">XMLNS namespace</dfn> is
<code title="">http://www.w3.org/2000/xmlns/</code>.

<p>To <dfn id="validate">validate</dfn> a <var>qualifiedName</var>, run these steps:

<ol>
 <li><p>If <var title="">qualifiedName</var> does not match the
 <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Name">Name</a></code> production, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a>
 an <code title="">InvalidCharacterError</code> exception.

 <li><p>If <var title="">qualifiedName</var> does not match the
 <code data-anolis-spec="xmlns" class="external"><a href="http://www.w3.org/TR/xml-names/#NT-QName">QName</a></code> production,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">NamespaceError</code> exception.
</ol>

<p>To <dfn id="validate-and-extract">validate and extract</dfn> a <var>namespace</var> and <var>qualifiedName</var>,
run these steps:

<ol>
 <li><p>If <var>namespace</var> is the empty string, set it to null.

 <li><p><a href="#validate">Validate</a> <var>qualifiedName</var>. Rethrow any exceptions.

 <li><p>Let <var>prefix</var> be null.

 <li><p>Let <var>localName</var> be <var>qualifiedName</var>.

 <li><p>If <var>qualifiedName</var> contains a "<code>:</code>" (U+003E), then split the
 string on it and set <var>prefix</var> to the part before and <var>localName</var> to
 the part after.

 <li><p>If <var title="">prefix</var> is non-null and <var>namespace</var> is null,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">NamespaceError</code> exception.

 <li><p>If <var title="">prefix</var> is "<code title="">xml</code>" and <var>namespace</var> is
 not the <a href="#xml-namespace">XML namespace</a>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NamespaceError</code> exception.

 <li><p>If either <var>qualifiedName</var> or <var title="">prefix</var> is
 "<code title="">xmlns</code>" and <var>namespace</var> is not the
 <a href="#xmlns-namespace">XMLNS namespace</a>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NamespaceError</code> exception.

 <li><p>If <var>namespace</var> is the <a href="#xmlns-namespace">XMLNS namespace</a> and neither
 <var>qualifiedName</var> nor <var title="">prefix</var> is "<code title="">xmlns</code>",
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">NamespaceError</code> exception.

 <li><p>Return <var>namespace</var>, <var>prefix</var>, <var>localName</var>, and
 <var>qualifiedName</var>.
</ol>



<h2 id="events"><span class="secno">3 </span>Events</h2>

<h3 id="introduction-to-dom-events"><span class="secno">3.1 </span>Introduction to "DOM Events"</h3>

<p>Throughout the web platform <a title="concept-event" href="#concept-event">events</a> are
<a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> to objects to signal an
occurrence, such as network activity or user interaction. These objects
implement the <code><a href="#eventtarget">EventTarget</a></code> interface and can therefore add
<a title="concept-event-listener" href="#concept-event-listener">event listeners</a> to observe
<a title="concept-event" href="#concept-event">events</a>:

<pre><code>obj.addEventListener("load", imgFetched)

function imgFetched(ev) {
  // great success
  …
}</code></pre>

<p><a title="concept-event-listener" href="#concept-event-listener">Event listeners</a> can be removed
by utilizing the
<code title="dom-EventTarget-removeEventListener"><a href="#dom-eventtarget-removeeventlistener">removeEventListener()</a></code>
method, passing the same arguments.

<p><a title="concept-event" href="#concept-event">Events</a> are objects too and implement the
<code><a href="#event">Event</a></code> interface (or a derived interface). In the example above
<var title="">ev</var> is the <a title="concept-event" href="#concept-event">event</a>. It is
passed as argument to
<a title="concept-event-listener" href="#concept-event-listener">event listener</a>'s <b>callback</b>
(typically a JavaScript Function as shown above).
<a title="concept-event-listener" href="#concept-event-listener">Event listeners</a> key off the
<a title="concept-event" href="#concept-event">event</a>'s
<code title="dom-Event-type"><a href="#dom-event-type">type</a></code> attribute value
("<code title="">load</code>" in the above example). The
<a title="concept-event" href="#concept-event">event</a>'s
<code title="dom-Event-target"><a href="#dom-event-target">target</a></code> attribute value returns the
object to which the <a title="concept-event" href="#concept-event">event</a> was
<a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> (<var title="">obj</var>
above).

<p>Now while typically <a title="concept-event" href="#concept-event">events</a> are
<a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> by the user agent as
the result of user interaction or the completion of some task, applications
can <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatch</a>
<a title="concept-event" href="#concept-event">events</a> themselves, commonly known as
synthetic events:

<pre><code>// add an appropriate event listener
obj.addEventListener("cat", function(e) { process(e.detail) })

// create and dispatch the event
var event = new CustomEvent("cat", {"detail":{"hazcheeseburger":true}})
obj.dispatchEvent(event)</code></pre>

<p>Apart from signaling, <a title="concept-event" href="#concept-event">events</a> are
sometimes also used to let an application control what happens next in an
operation. For instance as part of form submission an
<a title="concept-event" href="#concept-event">event</a> whose
<code title="dom-Event-type"><a href="#dom-event-type">type</a></code> attribute value is
"<code title="">submit</code>" is
<a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a>. If this
<a title="concept-event" href="#concept-event">event</a>'s
<code title="dom-Event-preventDefault"><a href="#dom-event-preventdefault">preventDefault()</a></code> method is
invoked, form submission will be terminated. Applications who wish to make
use of this functionality through <a title="concept-event" href="#concept-event">events</a>
<a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> by the application
(synthetic events) can make use of the return value of the
<code title="dom-EventTarget-dispatchEvent"><a href="#dom-eventtarget-dispatchevent">dispatchEvent()</a></code> method:

<pre><code>if(obj.dispatchEvent(event)) {
  // event was not canceled, time for some magic
  …
}</code></pre>

<p>When an <a title="concept-event" href="#concept-event">event</a> is
<a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> to an object that
<a title="concept-tree-participate" href="#concept-tree-participate">participates</a> in a
<a title="concept-tree" href="#concept-tree">tree</a> (e.g. an
<a title="concept-element" href="#concept-element">element</a>), it can reach
<a title="concept-event-listener" href="#concept-event-listener">event listeners</a> on that object's
<a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestors</a> too. First all object's
<a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestor</a>
<a title="concept-event-listener" href="#concept-event-listener">event listeners</a> whose
<b>capture</b> variable is set to true are invoked, in
<a title="concept-tree-order" href="#concept-tree-order">tree order</a>. Second, object's own
<a title="concept-event-listener" href="#concept-event-listener">event listeners</a> are invoked. And
finally, and only if <a title="concept-event" href="#concept-event">event</a>'s
<a title="dom-Event-bubbles" href="#dom-event-bubbles">bubbles</a> attribute value is true,
object's  <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestor</a>
<a title="concept-event-listener" href="#concept-event-listener">event listeners</a> are invoked again,
but now in reverse <a title="concept-tree-order" href="#concept-tree-order">tree order</a>.

<p>Lets look at an example on how <a title="concept-event" href="#concept-event">events</a>
work in a <a title="concept-tree" href="#concept-tree">tree</a>:

<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Boring example&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;p&gt;Hello &lt;span id=x&gt;world&lt;/span&gt;!&lt;/p&gt;
  &lt;script&gt;
   function test(e) {
     debug(e.target, e.currentTarget, e.eventPhase)
   }
   document.addEventListener("hey", test, true)
   document.body.addEventListener("hey", test)
   var ev = new Event("hey", {bubbles:true})
   document.getElementById("x").dispatchEvent(ev)
  &lt;/script&gt;
 &lt;/body&gt;
&lt;/html&gt;</code></pre>

<p>The <code title="">debug</code> function will be invoked twice. Each time
the <a title="concept-event" href="#concept-event">events</a>'s
<code title="dom-Event-target"><a href="#dom-event-target">target</a></code> attribute value will be the
<code title="">span</code> <a title="concept-element" href="#concept-element">element</a>. The
first time <code title="dom-Event-target"><a href="#dom-event-target">currentTarget</a></code> attribute's
value will be the <a title="concept-document" href="#concept-document">document</a>, the second
time the <code title="">body</code> <a title="concept-element" href="#concept-element">element</a>.
<code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute's value
switches from <code title="dom-Event-CAPTURING_PHASE"><a href="#dom-event-capturing_phase">CAPTURING_PHASE</a></code>
to <code title="dom-Event-BUBBLING_PHASE"><a href="#dom-event-bubbling_phase">BUBBLING_PHASE</a></code>. If an
<a title="concept-event-listener" href="#concept-event-listener">event listener</a> was registered for
the <code title="">span</code> <a title="concept-element" href="#concept-element">element</a>,
<code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute's value
would have been <code title="dom-Event-AT_TARGET"><a href="#dom-event-at_target">AT_TARGET</a></code>.


<h3 id="interface-event"><span class="secno">3.2 </span>Interface <code><a href="#event">Event</a></code></h3>

<pre class="idl">[<a title="concept-event-constructor" href="#concept-event-constructor">Constructor</a>(DOMString <var title="">type</var>, optional <a href="#eventinit">EventInit</a> <var title="">eventInitDict</var>),
 Exposed=(Window,Worker)]
interface <dfn id="event">Event</dfn> {
  readonly attribute DOMString <a title="dom-Event-type" href="#dom-event-type">type</a>;
  readonly attribute <a href="#eventtarget">EventTarget</a>? <a title="dom-Event-target" href="#dom-event-target">target</a>;
  readonly attribute <a href="#eventtarget">EventTarget</a>? <a title="dom-Event-currentTarget" href="#dom-event-currenttarget">currentTarget</a>;

  const unsigned short <a title="dom-Event-NONE" href="#dom-event-none">NONE</a> = 0;
  const unsigned short <a title="dom-Event-CAPTURING_PHASE" href="#dom-event-capturing_phase">CAPTURING_PHASE</a> = 1;
  const unsigned short <a title="dom-Event-AT_TARGET" href="#dom-event-at_target">AT_TARGET</a> = 2;
  const unsigned short <a title="dom-Event-BUBBLING_PHASE" href="#dom-event-bubbling_phase">BUBBLING_PHASE</a> = 3;
  readonly attribute unsigned short <a title="dom-Event-eventPhase" href="#dom-event-eventphase">eventPhase</a>;

  void <a title="dom-Event-stopPropagation" href="#dom-event-stoppropagation">stopPropagation</a>();
  void <a title="dom-Event-stopImmediatePropagation" href="#dom-event-stopimmediatepropagation">stopImmediatePropagation</a>();

  readonly attribute boolean <a title="dom-Event-bubbles" href="#dom-event-bubbles">bubbles</a>;
  readonly attribute boolean <a title="dom-Event-cancelable" href="#dom-event-cancelable">cancelable</a>;
  void <a title="dom-Event-preventDefault" href="#dom-event-preventdefault">preventDefault</a>();
  readonly attribute boolean <a title="dom-Event-defaultPrevented" href="#dom-event-defaultprevented">defaultPrevented</a>;

  [Unforgeable] readonly attribute boolean <a title="dom-Event-isTrusted" href="#dom-event-istrusted">isTrusted</a>;
  readonly attribute DOMTimeStamp <a title="dom-Event-timeStamp" href="#dom-event-timestamp">timeStamp</a>;

  void <a title="dom-Event-initEvent" href="#dom-event-initevent">initEvent</a>(DOMString <var title="">type</var>, boolean <var title="">bubbles</var>, boolean <var title="">cancelable</var>);
};

dictionary <dfn id="eventinit">EventInit</dfn> {
  boolean <span title="dom-EventInit-bubbles">bubbles</span> = false;
  boolean <span title="dom-EventInit-cancelable">cancelable</span> = false;
};</pre>

<p>An <dfn title="concept-event" id="concept-event">event</dfn> allows for signaling that
something has occurred. E.g. that an image has completed downloading. It is
represented by the <code><a href="#event">Event</a></code> interface or an interface that
inherits from the <code><a href="#event">Event</a></code> interface.</p>

<dl class="domintro">
 <dt><code><var title="">event</var> = new <a title="concept-event-constructor" href="#concept-event-constructor">Event</a>(<var title="">type</var> [, <var title="">eventInitDict</var>])</code>
 <dd><p>Returns a new <var title="">event</var> whose
 <code title="dom-Event-type"><a href="#dom-event-type">type</a></code> attribute value is set to
 <var title="">type</var>. The optional <var title="">eventInitDict</var> argument
 allows for setting the <code title="dom-Event-bubbles"><a href="#dom-event-bubbles">bubbles</a></code> and
 <code title="dom-Event-cancelable"><a href="#dom-event-cancelable">cancelable</a></code> attributes via object
 members of the same name.

 <dt><code><var title="">event</var> . <a title="dom-Event-type" href="#dom-event-type">type</a></code>
 <dd><p>Returns the type of <var title="">event</var>, e.g.
 "<code title="">click</code>", "<code title="">hashchange</code>", or
 "<code title="">submit</code>".

 <dt><code><var title="">event</var> . <a title="dom-Event-target" href="#dom-event-target">target</a></code>
 <dd><p>Returns the object <var title="">event</var> is
 <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> to.

 <dt><code><var title="">event</var> . <a title="dom-Event-currentTarget" href="#dom-event-currenttarget">currentTarget</a></code>
 <dd><p>Returns the object whose
 <a title="concept-event-listener" href="#concept-event-listener">event listener</a>'s <b>callback</b>
 is invoked.

 <dt><code><var title="">event</var> . <a title="dom-Event-eventPhase" href="#dom-event-eventphase">eventPhase</a></code>
 <dd><p>Returns the <a title="concept-event" href="#concept-event">event</a>'s phase, which is
 one of <code title="dom-Event-NONE"><a href="#dom-event-none">NONE</a></code>,
 <code title="dom-Event-CAPTURING_PHASE"><a href="#dom-event-capturing_phase">CAPTURING_PHASE</a></code>,
 <code title="dom-Event-AT_TARGET"><a href="#dom-event-at_target">AT_TARGET</a></code>, and
 <code title="dom-Event-BUBBLING_PHASE"><a href="#dom-event-bubbling_phase">BUBBLING_PHASE</a></code>.

 <dt><code><var title="">event</var> . <a title="dom-Event-stopPropagation" href="#dom-event-stoppropagation">stopPropagation</a>()</code>
 <dd><p>When <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> in a
 <a title="concept-tree" href="#concept-tree">tree</a>, invoking this method prevents
 <var title="">event</var> from reaching any other objects than the current.

 <dt><code><var title="">event</var> . <a title="dom-Event-stopImmediatePropagation" href="#dom-event-stopimmediatepropagation">stopImmediatePropagation</a>()</code>
 <dd><p>Invoking this method prevents <var title="">event</var> from reaching
 any <a title="concept-event-listener" href="#concept-event-listener">event listeners</a> registered
 after the current one and when
 <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> in a
 <a title="concept-tree" href="#concept-tree">tree</a> also prevents
 <var title="">event</var> from reaching any other objects.

 <dt><code><var title="">event</var> . <a title="dom-Event-bubbles" href="#dom-event-bubbles">bubbles</a></code>
 <dd><p>Returns true if <var title="">event</var>'s goes through its <code title="dom-Event-target"><a href="#dom-event-target">target</a></code> attribute value's <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestors</a> in reverse <a title="concept-tree-order" href="#concept-tree-order">tree order</a>, and false otherwise.

 <dt><code><var title="">event</var> . <a title="dom-Event-cancelable" href="#dom-event-cancelable">cancelable</a></code>
 <dd><p>Returns true or false depending on how <var title="">event</var> was
 initialized. Its return value does not always carry meaning, but true can
 indicate that part of the operation during which <var title="">event</var> was
 <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a>, can be canceled by
 invoking the <code title="dom-Event-preventDefault"><a href="#dom-event-preventdefault">preventDefault()</a></code>
 method.

 <dt><code><var title="">event</var> . <a title="dom-Event-preventDefault" href="#dom-event-preventdefault">preventDefault</a>()</code>
 <dd><p>If invoked when the
 <code title="dom-Event-cancelable"><a href="#dom-event-cancelable">cancelable</a></code> attribute value is true,
 signals to the operation that caused <var title="">event</var> to be
 <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> that it needs to be
 canceled.

 <dt><code><var title="">event</var> . <a title="dom-Event-defaultPrevented" href="#dom-event-defaultprevented">defaultPrevented</a></code>
 <dd><p>Returns true if
 <code title="dom-Event-preventDefault"><a href="#dom-event-preventdefault">preventDefault()</a></code> was invoked
 while the <code title="dom-Event-cancelable"><a href="#dom-event-cancelable">cancelable</a></code> attribute
 value is true, and false otherwise.

 <dt><code><var title="">event</var> . <a title="dom-Event-isTrusted" href="#dom-event-istrusted">isTrusted</a></code>
 <dd><p>Returns true if <var title="">event</var> was
 <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> by the user agent, and
 false otherwise.

 <dt><code><var title="">event</var> . <a title="dom-Event-timeStamp" href="#dom-event-timestamp">timeStamp</a></code>
 <dd><p>Returns the creation time of <var title="">event</var> in the number of
 milliseconds that passed since 00:00:00 UTC on 1 January 1970.

 <!-- initEvent is dead -->
</dl>

<p>The <dfn title="dom-Event-type" id="dom-event-type"><code>type</code></dfn> attribute must
return the value it was initialized to. When an
<a title="concept-event" href="#concept-event">event</a> is created the attribute must be
initialized to the empty string.

<p>The <dfn title="dom-Event-target" id="dom-event-target"><code>target</code></dfn> and
<dfn title="dom-Event-currentTarget" id="dom-event-currenttarget"><code>currentTarget</code></dfn>
attributes must return the values they were initialized to. When an
<a title="concept-event" href="#concept-event">event</a> is created the attributes must be
initialized to null.

<p>The <dfn title="dom-Event-eventPhase" id="dom-event-eventphase"><code>eventPhase</code></dfn>
attribute must return the value it was initialized to, which must be one of
the following:</p>
<dl>
 <dt><dfn title="dom-Event-NONE" id="dom-event-none"><code>NONE</code></dfn> (numeric value 0)
 <dd><p><a title="concept-event" href="#concept-event">Events</a> not currently
 <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> are in this phase.
 <dt><dfn title="dom-Event-CAPTURING_PHASE" id="dom-event-capturing_phase"><code>CAPTURING_PHASE</code></dfn> (numeric value 1)</dt>
 <dd><p>When an <a title="concept-event" href="#concept-event">event</a> is
 <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> to an object that
 <a title="concept-tree-participate" href="#concept-tree-participate">participates</a> in a
 <a title="concept-tree" href="#concept-tree">tree</a> it will be in this phase before it
 reaches its <code title="dom-Event-target"><a href="#dom-event-target">target</a></code> attribute value.
 <dt><dfn title="dom-Event-AT_TARGET" id="dom-event-at_target"><code>AT_TARGET</code></dfn> (numeric value 2)
 <dd><p>When an <a title="concept-event" href="#concept-event">event</a> is
 <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> it will be in this
 phase on its <code title="dom-Event-target"><a href="#dom-event-target">target</a></code> attribute value.
 <dt><dfn title="dom-Event-BUBBLING_PHASE" id="dom-event-bubbling_phase"><code>BUBBLING_PHASE</code></dfn> (numeric value 3)
 <dd><p>When an <a title="concept-event" href="#concept-event">event</a> is
 <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> to an object that
 <a title="concept-tree-participate" href="#concept-tree-participate">participates</a> in a
 <a title="concept-tree" href="#concept-tree">tree</a> it will be in this phase after it
 reaches its <code title="dom-Event-target"><a href="#dom-event-target">target</a></code> attribute value.
</dl>
<p>Initially the attribute must be initialized to
<code title="dom-Event-NONE"><a href="#dom-event-none">NONE</a></code>.

<hr>

<p>Each <a title="concept-event" href="#concept-event">event</a> has the following associated
flags that are all initially unset:</p>
<ul>
 <li><dfn id="stop-propagation-flag">stop propagation flag</dfn>
 <li><dfn id="stop-immediate-propagation-flag">stop immediate propagation flag</dfn>
 <li><dfn id="canceled-flag">canceled flag</dfn>
 <li><dfn id="initialized-flag">initialized flag</dfn>
 <li><dfn id="dispatch-flag">dispatch flag</dfn>
</ul>

<p>The
<dfn title="dom-Event-stopPropagation" id="dom-event-stoppropagation"><code>stopPropagation()</code></dfn>
method must set the <a href="#stop-propagation-flag">stop propagation flag</a>.

<p>The
<dfn title="dom-Event-stopImmediatePropagation" id="dom-event-stopimmediatepropagation"><code>stopImmediatePropagation()</code></dfn>
method must set both the <a href="#stop-propagation-flag">stop propagation flag</a> and
<a href="#stop-immediate-propagation-flag">stop immediate propagation flag</a>.

<p>The <dfn title="dom-Event-bubbles" id="dom-event-bubbles"><code>bubbles</code></dfn> and
<dfn title="dom-Event-cancelable" id="dom-event-cancelable"><code>cancelable</code></dfn> attributes
must return the values they were initialized to.

<p>The
<dfn title="dom-Event-preventDefault" id="dom-event-preventdefault"><code>preventDefault()</code></dfn>
method must set the <a href="#canceled-flag">canceled flag</a> if the
<code title="dom-Event-cancelable"><a href="#dom-event-cancelable">cancelable</a></code> attribute value is true.

<p>The
<dfn title="dom-Event-defaultPrevented" id="dom-event-defaultprevented"><code>defaultPrevented</code></dfn>
attribute must return true if the <a href="#canceled-flag">canceled flag</a> is set and
false otherwise.

<hr>

<p>The <dfn title="dom-Event-isTrusted" id="dom-event-istrusted"><code>isTrusted</code></dfn> attribute
must return the value it was initialized to. When an
<a title="concept-event" href="#concept-event">event</a> is created the attribute must be
initialized to false.

<p>The <dfn title="dom-Event-timeStamp" id="dom-event-timestamp"><code>timeStamp</code></dfn> attribute
must return the value it was initialized to. When an
<a title="concept-event" href="#concept-event">event</a> is created the attribute must be
initialized to the number of milliseconds that have passed since
00:00:00 UTC on 1 January 1970, ignoring leap seconds.
<!-- leap seconds are ignored by JavaScript too -->

<hr>

<p>To <dfn title="concept-event-initialize" id="concept-event-initialize">initialize</dfn> an
<var title="">event</var>, with <var title="">type</var>,
<var title="">bubbles</var>, and <var title="">cancelable</var>, run these steps:

<ol>
 <li><p>Set the <a href="#initialized-flag">initialized flag</a>.
 <li><p>Unset the <a href="#stop-propagation-flag">stop propagation flag</a>,
 <a href="#stop-immediate-propagation-flag">stop immediate propagation flag</a>, and
 <a href="#canceled-flag">canceled flag</a>.
 <li><p>Set the <code title="dom-Event-isTrusted"><a href="#dom-event-istrusted">isTrusted</a></code> attribute
 to false.
 <li><p>Set the <code title="dom-Event-target"><a href="#dom-event-target">target</a></code> attribute to
 null.
 <li><p>Set the <code title="dom-Event-type"><a href="#dom-event-type">type</a></code> attribute to
 <var title="">type</var>.
 <li><p>Set the <code title="dom-Event-bubbles"><a href="#dom-event-bubbles">bubbles</a></code> attribute to
 <var title="">bubbles</var>.
 <li><p>Set the <code title="dom-Event-cancelable"><a href="#dom-event-cancelable">cancelable</a></code> attribute
 to <var title="">cancelable</var>.
</ol>

<p>The
<dfn title="dom-Event-initEvent" id="dom-event-initevent"><code>initEvent(<var title="">type</var>, <var title="">bubbles</var>, <var title="">cancelable</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>If <a href="#context-object">context object</a>'s <a href="#dispatch-flag">dispatch flag</a> is set, terminate
 these steps.

 <li><p><a title="concept-event-initialize" href="#concept-event-initialize">Initialize</a> the
 <a href="#context-object">context object</a> with <var title="">type</var>, <var title="">bubbles</var>, and
 <var title="">cancelable</var>.
</ol>

<p class="note">As <a title="concept-event" href="#concept-event">events</a> have constructors
<code title="dom-Event-initEvent"><a href="#dom-event-initevent">initEvent()</a></code> is superfluous. However,
it has to be supported for legacy content.


<h3 id="interface-customevent"><span class="secno">3.3 </span>Interface <code><a href="#customevent">CustomEvent</a></code></h3>

<pre class="idl">[<a title="concept-event-constructor" href="#concept-event-constructor">Constructor</a>(DOMString <var title="">type</var>, optional <a href="#customeventinit">CustomEventInit</a> <var title="">eventInitDict</var>),
 Exposed=(Window,Worker)]
interface <dfn id="customevent">CustomEvent</dfn> : <a href="#event">Event</a> {
  readonly attribute any <a title="dom-CustomEvent-detail" href="#dom-customevent-detail">detail</a>;

  void <a title="dom-CustomEvent-initCustomEvent" href="#dom-customevent-initcustomevent">initCustomEvent</a>(DOMString <var title="">type</var>, boolean <var title="">bubbles</var>, boolean <var title="">cancelable</var>, any <var title="">detail</var>);
};

dictionary <dfn id="customeventinit">CustomEventInit</dfn> : <a href="#eventinit">EventInit</a> {
  any <span title="dom-CustomEventInit-detail">detail</span> = null;
};</pre>

<p><a title="concept-event" href="#concept-event">Events</a> using the
<code><a href="#customevent">CustomEvent</a></code> interface can be used to carry custom data.</p>

<dl class="domintro">
 <dt><code><var title="">event</var> = new <a title="concept-event-constructor" href="#concept-event-constructor">CustomEvent</a>(<var title="">type</var> [, <var title="">eventInitDict</var>])</code>
 <dd><p>Works analogously to the constructor for <code><a href="#event">Event</a></code> except
 that the optional <var title="">eventInitDict</var> argument now
 allows for setting the <code title="dom-Event-detail">detail</code> attribute
 too.

 <dt><code><var title="">event</var> . <a title="dom-CustomEvent-detail" href="#dom-customevent-detail">detail</a></code>
 <dd><p>Returns any custom data <var title="">event</var> was created with.
 Typically used for synthetic events.

 <!-- initCustomEvent is dead -->
</dl>

<p>The <dfn title="dom-CustomEvent-detail" id="dom-customevent-detail"><code>detail</code></dfn> attribute
must return the value it was initialized to.

<p>The
<dfn title="dom-CustomEvent-initCustomEvent" id="dom-customevent-initcustomevent"><code>initCustomEvent(<var title="">type</var>, <var title="">bubbles</var>, <var title="">cancelable</var>, <var title="">detail</var>)</code></dfn>
method must, when invoked, run these steps:

<ol>
 <li><p>If <a href="#context-object">context object</a>'s <a href="#dispatch-flag">dispatch flag</a> is set, terminate
 these steps.

 <li><p><a title="concept-event-initialize" href="#concept-event-initialize">Initialize</a> the
 <a href="#context-object">context object</a> with <var title="">type</var>, <var title="">bubbles</var>, and
 <var title="">cancelable</var>.

 <li><p>Set <a href="#context-object">context object</a>'s <code title="dom-CustomEvent-detail"><a href="#dom-customevent-detail">detail</a></code>
 attribute to <var title="">detail</var>.
</ol>


<h3 id="constructing-events"><span class="secno">3.4 </span>Constructing events</h3>

<p>When a <dfn title="concept-event-constructor" id="concept-event-constructor">constructor</dfn> of the <code><a href="#event">Event</a></code>
interface, or of an interface that inherits from the <code><a href="#event">Event</a></code> interface, is
invoked, these steps must be run:

<ol>
 <li><p>Create an <a title="concept-event" href="#concept-event">event</a> that uses the
 interface the constructor was invoked upon.

 <li><p>Set its <a href="#initialized-flag">initialized flag</a>.

 <li><p>Initialize the <code title="dom-Event-type"><a href="#dom-event-type">type</a></code> attribute to
 the <var title="">type</var> argument.

 <li><p>If there is an <var title="">eventInitDict</var> argument then for each
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-dictionary-member">dictionary member</a> defined therein find
 the attribute on <a title="concept-event" href="#concept-event">event</a> whose
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-identifier">identifier</a> matches the key of
 the <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-dictionary-member">dictionary member</a> and then
 set the attribute to the value of that
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-dictionary-member">dictionary member</a>.

 <li><p>Return the <a title="concept-event" href="#concept-event">event</a>.
</ol>


<h3 id="defining-event-interfaces"><span class="secno">3.5 </span>Defining event interfaces</h3>

<p>In general, when defining a new interface that inherits from
<code><a href="#event">Event</a></code> please always ask feedback from the WHATWG or the
W3C WebApps WG community.

<p>The <code><a href="#customevent">CustomEvent</a></code> interface can be used as starting point.
However, do not introduce any <code title="">init<var>*</var>Event()</code>
methods as they are redundant with constructors. Interfaces that inherit
from the <code><a href="#event">Event</a></code> interface that have such a method only have it
for historical reasons.


<h3 id="interface-eventtarget"><span class="secno">3.6 </span>Interface <code><a href="#eventtarget">EventTarget</a></code></h3>

<pre class="idl">[Exposed=(Window,Worker)]
interface <dfn id="eventtarget">EventTarget</dfn> {
  void <a title="dom-EventTarget-addEventListener" href="#dom-eventtarget-addeventlistener">addEventListener</a>(DOMString <var title="">type</var>, <a href="#eventlistener">EventListener</a>? <var title="">callback</var>, optional boolean <var title="">capture</var> = false);
  void <a title="dom-EventTarget-removeEventListener" href="#dom-eventtarget-removeeventlistener">removeEventListener</a>(DOMString <var title="">type</var>, <a href="#eventlistener">EventListener</a>? <var title="">callback</var>, optional boolean <var title="">capture</var> = false);
  boolean <a title="dom-EventTarget-dispatchEvent" href="#dom-eventtarget-dispatchevent">dispatchEvent</a>(<a href="#event">Event</a> <var title="">event</var>);
};

callback interface <dfn id="eventlistener">EventListener</dfn> {
  void <span title="dom-EventListener-handleEvent">handleEvent</span>(<a href="#event">Event</a> <var title="">event</var>);
};</pre>

<p><code><a href="#eventtarget">EventTarget</a></code> is an object to which an
<a title="concept-event" href="#concept-event">event</a> is
<a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> when something has
occurred. Each <code><a href="#eventtarget">EventTarget</a></code> has an associated list of
<a title="concept-event-listener" href="#concept-event-listener">event listeners</a>.

<p>An <dfn title="concept-event-listener" id="concept-event-listener">event listener</dfn> associates a
callback with a specific <a title="concept-event" href="#concept-event">event</a>. Each
<a title="concept-event-listener" href="#concept-event-listener">event listener</a> consists of a
<b>type</b> (of the <a title="concept-event" href="#concept-event">event</a>),
<b>callback</b>, and <b>capture</b> variable.

<p class="note">The <b>callback</b> is named <code><a href="#eventlistener">EventListener</a></code> for
historical reasons. As can be seen from the definition above, an
<a title="concept-event-listener" href="#concept-event-listener">event listener</a> is a more broad
concept.

<dl class="domintro">
 <dt><code><var title="">target</var> . <a title="dom-EventTarget-addEventListener" href="#dom-eventtarget-addeventlistener">addEventListener</a>(<var title="">type</var>, <var title="">callback</var> [, <var title="">capture</var> = false])</code>
 <dd>
  <p>Appends an <a title="concept-event-listener" href="#concept-event-listener">event listener</a>
  for <a title="concept-event" href="#concept-event">events</a> whose
  <code title="dom-Event-type"><a href="#dom-event-type">type</a></code> attribute value is
  <var title="">type</var>. The <var title="">callback</var> argument sets the
  <b>callback</b> that will be invoked when the
  <a title="concept-event" href="#concept-event">event</a> is
  <a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a>. When set to true,
  the <var title="">capture</var> argument prevents <b>callback</b> from being invoked when
  the <a title="concept-event" href="#concept-event">event</a>'s
  <code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute value is
  <code title="dom-Event-BUBBLING_PHASE"><a href="#dom-event-bubbling_phase">BUBBLING_PHASE</a></code>. When false, <b>callback</b>
  will not be invoked when <a title="concept-event" href="#concept-event">event</a>'s
  <code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute value is
  <code title="dom-Event-CAPTURING_PHASE"><a href="#dom-event-capturing_phase">CAPTURING_PHASE</a></code>. Either way,
  <b>callback</b> will be invoked when <a title="concept-event" href="#concept-event">event</a>'s
  <code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute value is
  <code title="dom-Event-AT_TARGET"><a href="#dom-event-at_target">AT_TARGET</a></code>.

  <p>The <a title="concept-event-listener" href="#concept-event-listener">event listener</a> is
  appended to <var title="">target</var>'s list of
  <a title="concept-event-listener" href="#concept-event-listener">event listeners</a> and is not
  appended if it is a duplicate (the
  <a title="concept-event-listener" href="#concept-event-listener">event listeners</a> in the list are
  unique).

 <dt><code><var title="">target</var> . <a title="dom-EventTarget-removeEventListener" href="#dom-eventtarget-removeeventlistener">removeEventListener</a>(<var title="">type</var>, <var title="">callback</var> [, <var title="">capture</var> = false])</code>
 <dd><p>Remove the <a title="concept-event-listener" href="#concept-event-listener">event listener</a>
 in <var title="">target</var>'s list of
 <a title="concept-event-listener" href="#concept-event-listener">event listeners</a> with the same
 <var title="">type</var>, <var title="">callback</var>, and
 <var title="">capture</var>.

 <dt><code><var title="">target</var> . <a title="dom-EventTarget-dispatchEvent" href="#dom-eventtarget-dispatchevent">dispatchEvent</a>(<var title="">event</var>)</code>
 <dd><p><a title="concept-event-dispatch" href="#concept-event-dispatch">Dispatches</a> a synthetic
 event <var title="">event</var> to <var title="">target</var> and returns true
 if either <var title="">event</var>'s
 <code title="dom-Event-cancelable"><a href="#dom-event-cancelable">cancelable</a></code> attribute value is false
 or it's <code title="dom-Event-preventDefault"><a href="#dom-event-preventdefault">preventDefault()</a></code> method
 was not invoked, and false otherwise.
</dl>

<p>The
<dfn title="dom-EventTarget-addEventListener" id="dom-eventtarget-addeventlistener"><code>addEventListener(<var title="">type</var>, <var title="">callback</var>, <var title="">capture</var>)</code></dfn>
method must run these steps:
<ol>
 <li><p>If <var title="">callback</var> is null, terminate these steps.
 <li><p>Append an <a title="concept-event-listener" href="#concept-event-listener">event listener</a>
 to the associated list of
 <a title="concept-event-listener" href="#concept-event-listener">event listeners</a> with <b>type</b>
 set to <var title="">type</var>, <b>callback</b> set to <var title="">callback</var>, and
 <b>capture</b> set to <var title="">capture</var>, unless there
 already is an <a title="concept-event-listener" href="#concept-event-listener">event listener</a> in
 that list with the same <b>type</b>, <b>callback</b>, and <b>capture</b>.
</ol>

<p>The
<dfn title="dom-EventTarget-removeEventListener" id="dom-eventtarget-removeeventlistener"><code>removeEventListener(<var title="">type</var>, <var title="">callback</var>, <var title="">capture</var>)</code></dfn>
method must run these steps:
<ol>
 <li><p>Remove an <a title="concept-event-listener" href="#concept-event-listener">event listener</a>
 from the associated list of
 <a title="concept-event-listener" href="#concept-event-listener">event listeners</a>, whose
 <b>type</b> is <var>name</var>, <b>callback</b> is <var title="">callback</var>, and
 <b>capture</b> is <var title="">capture</var>.</p>
</ol>

<p>The
<dfn title="dom-EventTarget-dispatchEvent" id="dom-eventtarget-dispatchevent"><code>dispatchEvent(<var title="">event</var>)</code></dfn>
method must run these steps:
<ol>
 <li><p>If <var title="">event</var>'s <a href="#dispatch-flag">dispatch flag</a> is set, or if
 its <a href="#initialized-flag">initialized flag</a> is not set,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidStateError</code> exception.
 <li><p>Initialize <var title="">event</var>'s
 <code title="dom-Event-isTrusted"><a href="#dom-event-istrusted">isTrusted</a></code> attribute to false.
 <li><p><a title="concept-event-dispatch" href="#concept-event-dispatch">Dispatch</a> the
 <var title="">event</var> and return the value that returns.
</ol>


<h3 id="dispatching-events"><span class="secno">3.7 </span>Dispatching events</h3>

<p>To <dfn title="concept-event-dispatch" id="concept-event-dispatch">dispatch</dfn> an
<a title="concept-event" href="#concept-event">event</a> to a given object, optionally with
a <var title="">target override</var>, run these steps:

<ol>
 <li><p>Let <var title="">event</var> be the
 <a title="concept-event" href="#concept-event">event</a> that is dispatched.

 <li><p>Set <var title="">event</var>'s <a href="#dispatch-flag">dispatch flag</a>.

 <li><p>Initialize <var title="">event</var>'s
 <code title="dom-Event-target"><a href="#dom-event-target">target</a></code> attribute to
 <var title="">target override</var>, if it is given, or the object to which
 <var title="">event</var> is dispatched otherwise.

 <li><p>If <var title="">event</var>'s
 <code title="dom-Event-target"><a href="#dom-event-target">target</a></code> attribute value is
 <a title="concept-tree-participate" href="#concept-tree-participate">participating</a> in a
 <a title="concept-tree" href="#concept-tree">tree</a>, let <var title="">event path</var> be a
 static ordered list of all its
 <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestors</a> in
 <a title="concept-tree-order" href="#concept-tree-order">tree order</a>, and let
 <var title="">event path</var> be the empty list otherwise.

 <li><p>Initialize <var title="">event</var>'s
 <code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute to
 <code title="dom-Event-CAPTURING_PHASE"><a href="#dom-event-capturing_phase">CAPTURING_PHASE</a></code>.

 <li><p>For each object in <var title="">event path</var>,
 <a title="concept-event-listener-invoke" href="#concept-event-listener-invoke">invoke</a> its
 <a title="concept-event-listener" href="#concept-event-listener">event listeners</a> with event
 <var title="">event</var>, as long as <var title="">event</var>'s
 <a href="#stop-propagation-flag">stop propagation flag</a> is unset.

 <li><p>Initialize <var title="">event</var>'s
 <code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute to
 <code title="dom-Event-AT_TARGET"><a href="#dom-event-at_target">AT_TARGET</a></code>.

 <li><p><a title="concept-event-listener-invoke" href="#concept-event-listener-invoke">Invoke</a> the
 <a title="concept-event-listener" href="#concept-event-listener">event listeners</a> of
 <var title="">event</var>'s <code title="dom-Event-target"><a href="#dom-event-target">target</a></code>
 attribute value with <var title="">event</var>, if <var title="">event</var>'s
 <a href="#stop-propagation-flag">stop propagation flag</a> is unset.

 <li>
  <p>If <var title="">event</var>'s
  <code title="dom-Event-bubbles"><a href="#dom-event-bubbles">bubbles</a></code> attribute value is true, run
  these substeps:

  <ol>
   <li><p>Reverse the order of <var title="">event path</var>.

   <li><p>Initialize <var title="">event</var>'s
   <code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute to
   <code title="dom-Event-BUBBLING_PHASE"><a href="#dom-event-bubbling_phase">BUBBLING_PHASE</a></code>.

   <li><p>For each object in <var title="">event path</var>,
   <a title="concept-event-listener-invoke" href="#concept-event-listener-invoke">invoke</a> its
   <a title="concept-event-listener" href="#concept-event-listener">event listeners</a>, with event
   <var title="">event</var> as long as <var title="">event</var>'s
   <a href="#stop-propagation-flag">stop propagation flag</a> is unset.
  </ol>

 <li><p>Unset <var title="">event</var>'s <a href="#dispatch-flag">dispatch flag</a>.

 <li><p>Initialize <var title="">event</var>'s
 <code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute to
 <code title="dom-Event-NONE"><a href="#dom-event-none">NONE</a></code>.

 <li><p>Initialize <var title="">event</var>'s
 <code title="dom-Event-currentTarget"><a href="#dom-event-currenttarget">currentTarget</a></code> attribute to null.

 <li><p>Return false if <var title="">event</var>'s <a href="#canceled-flag">canceled flag</a>
 is set, and true otherwise.
</ol>


<p>To <dfn title="concept-event-listener-invoke" id="concept-event-listener-invoke">invoke</dfn> the
<a title="concept-event-listener" href="#concept-event-listener">event listeners</a> for an object with an
event run these steps:</p>
<ol>
 <li><p>Let <var title="">event</var> be the
 <a title="concept-event" href="#concept-event">event</a> for which the
 <a title="concept-event-listener" href="#concept-event-listener">event listeners</a> are invoked.
 <li><p>Let <var title="">listeners</var> be a copy of the
 <a title="concept-event-listener" href="#concept-event-listener">event listeners</a> associated with
 the object for which these steps are run.
 <li><p>Initialize <var title="">event</var>'s
 <code title="dom-Event-currentTarget"><a href="#dom-event-currenttarget">currentTarget</a></code> attribute to the
 object for which these steps are run.
 <li>
  <p>Then run these substeps for each
  <a title="concept-event-listener" href="#concept-event-listener">event listener</a> in
  <var title="">listeners</var>:</p>
  <ol>
   <li><p>If <var title="">event</var>'s
   <a href="#stop-immediate-propagation-flag">stop immediate propagation flag</a> is set, terminate the
   <a title="concept-event-listener-invoke" href="#concept-event-listener-invoke">invoke</a> algorithm.
   <li><p>Let <var title="">listener</var> be the
   <a title="concept-event-listener" href="#concept-event-listener">event listener</a>.
   <li><p>If <var title="">event</var>'s <code title="dom-Event-type"><a href="#dom-event-type">type</a></code>
   attribute value is not <var title="">listener</var>'s <b>type</b>, terminate
   these substeps (and run them for the next
   <a title="concept-event-listener" href="#concept-event-listener">event listener</a>).
   <li><p>If <var title="">event</var>'s
   <code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute value is
   <code title="dom-Event-CAPTURING_PHASE"><a href="#dom-event-capturing_phase">CAPTURING_PHASE</a></code> and
   <var title="">listener</var>'s <b>capture</b> is false, terminate these
   substeps (and run them for the next
   <a title="concept-event-listener" href="#concept-event-listener">event listener</a>).
   <li><p>If <var title="">event</var>'s
   <code title="dom-Event-eventPhase"><a href="#dom-event-eventphase">eventPhase</a></code> attribute value is
   <code title="dom-Event-BUBBLING_PHASE"><a href="#dom-event-bubbling_phase">BUBBLING_PHASE</a></code> and
   <var title="">listener</var>'s <b>capture</b> is true, terminate these
   substeps (and run them for the next
   <a title="concept-event-listener" href="#concept-event-listener">event listener</a>).
   <li><p>Call <var title="">listener</var>'s <b>callback</b>'s
   <code title="dom-EventListener-handleEvent">handleEvent</code>, with the event passed to
   this algorithm as the first argument and <var title="">event</var>'s
   <code title="dom-Event-currentTarget"><a href="#dom-event-currenttarget">currentTarget</a></code> attribute value as
   <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-callback-this-value">callback this value</a>. If this throws any exception,
   <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#report-the-exception">report the exception</a>.
  </ol>
 </li>
</ol>


<h3 id="firing-events"><span class="secno">3.8 </span>Firing events</h3>

<p>To
<dfn title="concept-event-fire" id="concept-event-fire">fire an event named <var title="">e</var></dfn>
means that a new <a title="concept-event" href="#concept-event">event</a> using the
<code><a href="#event">Event</a></code> interface, with its
<code title="dom-Event-type"><a href="#dom-event-type">type</a></code> attribute initialized to
<var title="">e</var>, and its <code title="dom-Event-isTrusted"><a href="#dom-event-istrusted">isTrusted</a></code>
attribute initialized to true, is to be
<a title="concept-event-dispatch" href="#concept-event-dispatch">dispatched</a> to the given object.

<p class="note">Fire in the context of DOM is short for creating, initializing, and
<a title="concept-event-dispatch" href="#concept-event-dispatch">dispatching</a> an
<a title="concept-event" href="#concept-event">event</a>.
<a title="concept-event-fire" href="#concept-event-fire">Fire an event</a> makes that process easier to write
down. If the <a title="concept-event" href="#concept-event">event</a> needs its <code>bubbles</code> or
<code>cancelable</code> attribute initialized, one could write
"<a title="concept-event-fire" href="#concept-event-fire">fire an event</a> named
<code title="">submit</code> with its <code>cancelable</code> attribute
initialized to true".



<h2 id="nodes"><span class="secno">4 </span>Nodes</h2>

<h3 id="introduction-to-the-dom"><span class="secno">4.1 </span>Introduction to "The DOM"</h3>

<p>In its original sense, "The DOM" is an API for
accessing and manipulating documents (in particular, HTML and XML
documents). In this specification, the term "document" is used for any
markup-based resource, ranging from short static documents to long essays or
reports with rich multimedia, as well as to fully-fledged interactive
applications.

<p>These documents are presented as a
<a title="concept-node-tree" href="#concept-node-tree">node tree</a>. Some of the
<a title="concept-node" href="#concept-node">nodes</a> in the
<a title="concept-tree" href="#concept-tree">tree</a> can have
<a title="concept-tree-child" href="#concept-tree-child">children</a>, while others are leaves.

<p>To illustrate, consider this HTML document:

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html class=e&gt;
 &lt;head&gt;&lt;title&gt;Aliens?&lt;/title&gt;&lt;/head&gt;
 &lt;body&gt;Why yes.&lt;/body&gt;
&lt;/html&gt;</code></pre>

<p>It is represented as follows:

<ul class="domTree">
 <li>
  <a title="concept-document" href="#concept-document">Document</a>
  <ul>
   <li class="t10"><a title="concept-doctype" href="#concept-doctype">Doctype</a>: <code>html</code></li>
   <li class="t1"><a title="concept-element" href="#concept-element">Element</a>: <code>html</code> <span title="" class="t2"><code class="attribute name">class</code>="<code class="attribute value">e</code>"</span>
    <ul>
     <li class="t1">
      <a title="concept-element" href="#concept-element">Element</a>: <code>head</code>
      <ul>
       <li class="t1">
        <a title="concept-element" href="#concept-element">Element</a>: <code>title</code>
        <ul>
         <li class="t3"><code><a href="#text">Text</a></code>: <span title="">Aliens?</span></li>
        </ul>
       </li>
      </ul>
     </li>
     <li class="t3"><code><a href="#text">Text</a></code>: <span title="">⏎␣</span></li>
     <li class="t1">
      <a title="concept-element" href="#concept-element">Element</a>: <code title="">body</code>
      <ul>
       <li class="t3"><code><a href="#text">Text</a></code>: <span title="">Why yes.⏎</span></li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

<!--
http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C!DOCTYPE%20html%3E%0D%0A%3Chtml%20class%3De%3E%0D%0A%20%3Chead%3E%3Ctitle%3EAliens%3F%3C%2Ftitle%3E%3C%2Fhead%3E%0D%0A%20%3Cbody%3EWhy%20yes.%3C%2Fbody%3E%0D%0A%3C%2Fhtml%3E
-->

<p>Note that, due to the magic that is
<a data-anolis-spec="html" title="HTML parser" class="external" href="https://html.spec.whatwg.org/multipage/syntax.html#html-parser">HTML parsing</a>, not all
<a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a> were turned into
<code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">nodes</a>, but the general
concept is clear. Markup goes in, a <a title="concept-tree" href="#concept-tree">tree</a> of
<a title="concept-node" href="#concept-node">nodes</a> comes out.
<!-- You /can/ explain that! harharhar -->

<p class="note">The most excellent
<a href="http://software.hixie.ch/utilities/js/live-dom-viewer/">Live DOM Viewer</a>
can be used to explore this matter in more detail.


<h3 id="node-tree"><span class="secno">4.2 </span>Node tree</h3>

<p>Objects implementing the <code><a href="#document">Document</a></code>,
<code><a href="#documentfragment">DocumentFragment</a></code>, <code><a href="#documenttype">DocumentType</a></code>,
<code><a href="#element">Element</a></code>, <code><a href="#text">Text</a></code>, <code><a href="#processinginstruction">ProcessingInstruction</a></code>,
or <code><a href="#comment">Comment</a></code> interface (simply called
<dfn title="concept-node" id="concept-node">nodes</dfn>)
<a title="concept-tree-participate" href="#concept-tree-participate">participate</a> in a
<a title="concept-tree" href="#concept-tree">tree</a>, simply named the
<dfn title="concept-node-tree" id="concept-node-tree">node tree</dfn>.

<p>A <a title="concept-node-tree" href="#concept-node-tree">node tree</a> is constrained as
follows, expressed as a relationship between the type of
<a title="concept-node" href="#concept-node">node</a> and its allowed
<a title="concept-tree-child" href="#concept-tree-child">children</a>:
<dl>
 <dt><code><a href="#document">Document</a></code>
 <dd>
  <p>In <a title="concept-tree-order" href="#concept-tree-order">tree order</a>:
  <ol>
   <li><p>Zero or more nodes each of which is either
   <code><a href="#processinginstruction">ProcessingInstruction</a></code> or <code><a href="#comment">Comment</a></code>.
   <li><p>Optionally one <code><a href="#documenttype">DocumentType</a></code> node.
   <li><p>Zero or more nodes each of which is either
   <code><a href="#processinginstruction">ProcessingInstruction</a></code> or <code><a href="#comment">Comment</a></code>.
   <li><p>Optionally one <code><a href="#element">Element</a></code> node.
   <li><p>Zero or more nodes each of which is either
   <code><a href="#processinginstruction">ProcessingInstruction</a></code> or <code><a href="#comment">Comment</a></code>.
  </ol>
 <dt><code><a href="#documentfragment">DocumentFragment</a></code>
 <dt><code><a href="#element">Element</a></code>
 <dd><p>Zero or more nodes each of which is one of <code><a href="#element">Element</a></code>,
 <code><a href="#processinginstruction">ProcessingInstruction</a></code>, <code><a href="#comment">Comment</a></code>, or
 <code><a href="#text">Text</a></code>.
 <dt><code><a href="#documenttype">DocumentType</a></code>
 <dt><code><a href="#text">Text</a></code>
 <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
 <dt><code><a href="#comment">Comment</a></code>
 <dd><p>None.
</dl>
<!--AttrExodus -->

<p>The <dfn title="concept-node-length" id="concept-node-length">length</dfn> of a
<a title="concept-node" href="#concept-node">node</a> <var title="">node</var> depends on
<var title="">node</var>:
<dl class="switch">
 <dt><code><a href="#documenttype">DocumentType</a></code>
 <dd><p>Zero.

 <dt><code><a href="#text">Text</a></code>
 <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
 <dt><code><a href="#comment">Comment</a></code>
 <dd><p>Its <code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute
 value.

 <dt>Any other node
 <dd><p>Its number of <a title="concept-tree-child" href="#concept-tree-child">children</a>.
</dl>

<p>A <a title="concept-node" href="#concept-node">node</a> is considered
<dfn title="concept-node-empty" id="concept-node-empty">empty</dfn> if its
<a title="concept-node-length" href="#concept-node-length">length</a> is zero.


<h4 id="mutation-algorithms"><span class="secno">4.2.1 </span>Mutation algorithms</h4>

<p>To <dfn title="concept-node-ensure-pre-insertion-validity" id="concept-node-ensure-pre-insertion-validity">ensure pre-insertion validity</dfn>
of a <var title="">node</var> into a <var title="">parent</var> before a
<var title="">child</var>, run these steps:

<ol>
 <li><p>If <var title="">parent</var> is not a <code><a href="#document">Document</a></code>,
 <code><a href="#documentfragment">DocumentFragment</a></code>, or <code><a href="#element">Element</a></code>
 <a title="concept-node" href="#concept-node">node</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">HierarchyRequestError</code>.

 <li><p>If <var title="">node</var> is a
 <a title="concept-tree-host-including-inclusive-ancestor" href="#concept-tree-host-including-inclusive-ancestor">host-including inclusive ancestor</a>
 of <var title="">parent</var>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">HierarchyRequestError</code>.

 <li><p>If <var title="">child</var> is not null and its
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is not
 <var title="">parent</var>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NotFoundError</code> exception.

 <li><p>If <var title="">node</var> is not a
 <code><a href="#documentfragment">DocumentFragment</a></code>, <code><a href="#documenttype">DocumentType</a></code>,
 <code><a href="#element">Element</a></code>, <code><a href="#text">Text</a></code>,
 <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or <code><a href="#comment">Comment</a></code>
 <a title="concept-node" href="#concept-node">node</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">HierarchyRequestError</code>.

 <li><p>If either <var title="">node</var> is a <code><a href="#text">Text</a></code>
 <a title="concept-node" href="#concept-node">node</a> and <var title="">parent</var> is a
 <a title="concept-document" href="#concept-document">document</a>, or <var title="">node</var> is a
 <a title="concept-doctype" href="#concept-doctype">doctype</a> and <var title="">parent</var> is
 not a <a title="concept-document" href="#concept-document">document</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">HierarchyRequestError</code>.

 <li>
  <p>If <var title="">parent</var> is a
  <a title="concept-document" href="#concept-document">document</a>, and any of the statements below, switched
  on <var title="">node</var>, are true, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
  <code title="">HierarchyRequestError</code>.

  <dl class="switch">
   <dt><code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a>
   <dd>
    <p>If <var title="">node</var> has more than one
    <a title="concept-element" href="#concept-element">element</a> <a title="concept-tree-child" href="#concept-tree-child">child</a>
    or has a <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>
    <a title="concept-tree-child" href="#concept-tree-child">child</a>.

    <p>Otherwise, if <var title="">node</var> has one
    <a title="concept-element" href="#concept-element">element</a>
    <a title="concept-tree-child" href="#concept-tree-child">child</a> and either <var title="">parent</var> has an
    <a title="concept-element" href="#concept-element">element</a>
    <a title="concept-tree-child" href="#concept-tree-child">child</a>, <var title="">child</var> is a
    <a title="concept-doctype" href="#concept-doctype">doctype</a>, or <var title="">child</var> is not null and
    a <a title="concept-doctype" href="#concept-doctype">doctype</a> is
    <a title="concept-tree-following" href="#concept-tree-following">following</a> <var title="">child</var>.
    <!--"inclusively following"-->

   <dt><a title="concept-element" href="#concept-element">element</a>
   <dd><p><var title="">parent</var> has an <a title="concept-element" href="#concept-element">element</a>
   <a title="concept-tree-child" href="#concept-tree-child">child</a>, <var title="">child</var> is a
   <a title="concept-doctype" href="#concept-doctype">doctype</a>, or <var title="">child</var> is not null and a
   <a title="concept-doctype" href="#concept-doctype">doctype</a> is
   <a title="concept-tree-following" href="#concept-tree-following">following</a> <var title="">child</var>.
   <!--"inclusively following"-->

   <dt><a title="concept-doctype" href="#concept-doctype">doctype</a>
   <dd><p><var title="">parent</var> has a <a title="concept-doctype" href="#concept-doctype">doctype</a>
   <a title="concept-tree-child" href="#concept-tree-child">child</a>, an
   <a title="concept-element" href="#concept-element">element</a> is
   <a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a> <var title="">child</var>, or
   <var title="">child</var> is null and <var title="">parent</var> has an
   <a title="concept-element" href="#concept-element">element</a> <a title="concept-tree-child" href="#concept-tree-child">child</a>.
  </dl>
</ol>

<p>To <dfn title="concept-node-pre-insert" id="concept-node-pre-insert">pre-insert</dfn> a
<var title="">node</var> into a <var title="">parent</var> before a
<var title="">child</var>, run these steps:

<ol>
 <li><p><a title="concept-node-ensure-pre-insertion-validity" href="#concept-node-ensure-pre-insertion-validity">Ensure pre-insertion validity</a>
 of <var title="">node</var> into <var title="">parent</var> before
 <var title="">child</var>.

 <li><p>Let <var title="">reference child</var> be <var title="">child</var>.

 <li><p>If <var title="">reference child</var> is <var title="">node</var>, set it
 to <var title="">node</var>'s
 <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>.

 <li><p><a title="concept-node-adopt" href="#concept-node-adopt">Adopt</a>
 <var title="">node</var> into <var title="">parent</var>'s
 <a title="concept-node-document" href="#concept-node-document">node document</a>.

 <li><p><a title="concept-node-insert" href="#concept-node-insert">Insert</a> <var title="">node</var>
 into <var title="">parent</var> before <var title="">reference child</var>.

 <li><p>Return <var title="">node</var>.
 <!-- technically this is post-insert -->
</ol>

<p><a title="Other applicable specifications" href="#other-applicable-specifications">Specifications</a> may define
<dfn title="concept-node-insert-ext" id="concept-node-insert-ext">insertion steps</dfn> for all or some
<a title="concept-node" href="#concept-node">nodes</a>. The algorithm is passed <var>newNode</var> as
indicated in the <a title="concept-node-insert" href="#concept-node-insert">insert</a> algorithm below.

<p>To <dfn title="concept-node-insert" id="concept-node-insert">insert</dfn> a <var title="">node</var>
into a <var title="">parent</var> before a <var title="">child</var>, optionally
with a <i title="">suppress observers flag</i>, run these steps:

<ol>
 <li><p>Let <var title="">count</var> be the number of
 <a title="concept-tree-child" href="#concept-tree-child">children</a> of <var title="">node</var> if
 it is a <code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a>,
 and one otherwise.

 <li>
  <p>If <var title="">child</var> is non-null, run these substeps:

  <ol>
   <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
   <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
   <var title="">parent</var> and
   <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> is greater than
   <var title="">child</var>'s <a title="concept-tree-index" href="#concept-tree-index">index</a>,
   increase its <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> by
   <var title="">count</var>.

   <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
   <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is
   <var title="">parent</var> and
   <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> is greater than
   <var title="">child</var>'s <a title="concept-tree-index" href="#concept-tree-index">index</a>,
   increase its <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> by
   <var title="">count</var>.
  </ol>

 <li><p>Let <var title="">nodes</var> be <var title="">node</var>'s
 <a title="concept-tree-child" href="#concept-tree-child">children</a> if <var title="">node</var> is
 a <code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a>, and a
 list containing solely <var title="">node</var> otherwise.

 <li>
  <p>If <var title="">node</var> is a <code><a href="#documentfragment">DocumentFragment</a></code>
  <a title="concept-node" href="#concept-node">node</a>, <a href="#queue-a-mutation-record">queue a mutation record</a>
  of "<code>childList</code>" for <var title="">node</var> with removedNodes
  <var title="">nodes</var>.

  <p class="note">This step does intentionally not pay attention to the
  <i title="">suppress observers flag</i>.

 <li><p>If <var title="">node</var> is a <code><a href="#documentfragment">DocumentFragment</a></code>
 <a title="concept-node" href="#concept-node">node</a>,
 <a title="concept-node-remove" href="#concept-node-remove">remove</a> its
 <a title="concept-tree-child" href="#concept-tree-child">children</a> with the
 <i title="">suppress observers flag</i> set.

 <li><p>If <i title="">suppress observers flag</i> is unset,
 <a href="#queue-a-mutation-record">queue a mutation record</a> of "<code>childList</code>" for
 <var title="">parent</var> with addedNodes <var title="">nodes</var>,
 nextSibling <var title="">child</var>, and previousSibling
 <var title="">child</var>'s
 <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a>
 or <var title="">parent</var>'s
 <a title="concept-tree-last-child" href="#concept-tree-last-child">last child</a> if
 <var title="">child</var> is null.

 <li>
  <p>For each <var>newNode</var> in <var title="">nodes</var>, in
  <a title="concept-tree-order" href="#concept-tree-order">tree order</a>, run these substeps:

  <ol>
   <li><p>Insert <var>newNode</var> into <var title="">parent</var> before
   <var title="">child</var> or at the end of <var title="">parent</var> if
   <var title="">child</var> is null.

   <li><p>Run the <a title="concept-node-insert-ext" href="#concept-node-insert-ext">insertion steps</a> with
   <var>newNode</var>.
  </ol>
</ol>


<p>To <dfn title="concept-node-append" id="concept-node-append">append</dfn> a <var title="">node</var>
to a <var title="">parent</var>,
<a title="concept-node-pre-insert" href="#concept-node-pre-insert">pre-insert</a> <var title="">node</var>
into <var title="">parent</var> before null.


<p>To <dfn title="concept-node-replace" id="concept-node-replace">replace</dfn> a <var title="">child</var>
with <var title="">node</var> within a <var title="">parent</var>, run these
steps:

<!-- Step 1-5 could be shared with concept-node-pre-insert, although step 3
     in pre-insert is a superset (which is fine). Step 6.1.1 could also be
     shared. -->

<ol>
 <li><p>If <var title="">parent</var> is not a <code><a href="#document">Document</a></code>,
 <code><a href="#documentfragment">DocumentFragment</a></code>, or <code><a href="#element">Element</a></code>
 <a title="concept-node" href="#concept-node">node</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">HierarchyRequestError</code>.

 <li><p>If <var title="">node</var> is a
 <a title="concept-tree-host-including-inclusive-ancestor" href="#concept-tree-host-including-inclusive-ancestor">host-including inclusive ancestor</a>
 of <var title="">parent</var>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">HierarchyRequestError</code>.

 <li><p>If <var title="">child</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is not
 <var title="">parent</var>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NotFoundError</code> exception.

 <li><p>If <var title="">node</var> is not a
 <code><a href="#documentfragment">DocumentFragment</a></code>, <code><a href="#documenttype">DocumentType</a></code>,
 <code><a href="#element">Element</a></code>, <code><a href="#text">Text</a></code>,
 <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or <code><a href="#comment">Comment</a></code>
 <a title="concept-node" href="#concept-node">node</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">HierarchyRequestError</code>.

 <li><p>If either <var title="">node</var> is a <code><a href="#text">Text</a></code>
 <a title="concept-node" href="#concept-node">node</a> and <var title="">parent</var> is a
 <a title="concept-document" href="#concept-document">document</a>, or <var title="">node</var> is a
 <a title="concept-doctype" href="#concept-doctype">doctype</a> and <var title="">parent</var> is
 not a <a title="concept-document" href="#concept-document">document</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">HierarchyRequestError</code>.

 <li>
  <p>If <var title="">parent</var> is a
  <a title="concept-document" href="#concept-document">document</a>, and any of the statements below, switched
  on <var title="">node</var>, are true, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
  <code title="">HierarchyRequestError</code>.

  <dl class="switch">
   <dt><code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a>
   <dd>
    <p>If <var title="">node</var> has more than one
    <a title="concept-element" href="#concept-element">element</a> <a title="concept-tree-child" href="#concept-tree-child">child</a>
    or has a <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>
    <a title="concept-tree-child" href="#concept-tree-child">child</a>.

    <p>Otherwise, if <var title="">node</var> has one
    <a title="concept-element" href="#concept-element">element</a> <a title="concept-tree-child" href="#concept-tree-child">child</a>
    and either <var title="">parent</var> has an <a title="concept-element" href="#concept-element">element</a>
    <a title="concept-tree-child" href="#concept-tree-child">child</a> that is not <var title="">child</var> or a
    <a title="concept-doctype" href="#concept-doctype">doctype</a> is
    <a title="concept-tree-following" href="#concept-tree-following">following</a> <var title="">child</var>.

   <dt><a title="concept-element" href="#concept-element">element</a>
   <dd><p><var title="">parent</var> has an <a title="concept-element" href="#concept-element">element</a>
   <a title="concept-tree-child" href="#concept-tree-child">child</a> that is not <var title="">child</var> or a
   <a title="concept-doctype" href="#concept-doctype">doctype</a> is
   <a title="concept-tree-following" href="#concept-tree-following">following</a> <var title="">child</var>.

   <dt><a title="concept-doctype" href="#concept-doctype">doctype</a>
   <dd><var title="">parent</var> has a <a title="concept-doctype" href="#concept-doctype">doctype</a>
   <a title="concept-tree-child" href="#concept-tree-child">child</a> that is not <var title="">child</var>, or an
   <a title="concept-element" href="#concept-element">element</a> is
   <a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a> <var title="">child</var>.
  </dl>

  <p class="note">The above statements differ from the
  <a title="concept-node-pre-insert" href="#concept-node-pre-insert">pre-insert</a> algorithm.

 <li><p>Let <var title="">reference child</var> be <var title="">child</var>'s
 <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>.

 <li><p>If <var title="">reference child</var> is <var title="">node</var>, set it
 to <var title="">node</var>'s
 <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>.

 <li><p><a title="concept-node-adopt" href="#concept-node-adopt">Adopt</a>
 <var title="">node</var> into <var title="">parent</var>'s
 <a title="concept-node-document" href="#concept-node-document">node document</a>.

 <li><p><a title="concept-node-remove" href="#concept-node-remove">Remove</a> <var title="">child</var>
 from its <var title="">parent</var> with the
 <i title="">suppress observers flag</i> set.

 <li><p><a title="concept-node-insert" href="#concept-node-insert">Insert</a> <var title="">node</var>
 into <var title="">parent</var> before <var title="">reference child</var> with
 the <i title="">suppress observers flag</i> set.

 <li><p>Let <var title="">nodes</var> be <var title="">node</var>'s
 <a title="concept-tree-child" href="#concept-tree-child">children</a> if <var title="">node</var> is
 a <code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a>, and a
 list containing solely <var title="">node</var> otherwise.

 <li><p><a href="#queue-a-mutation-record">Queue a mutation record</a> of "<code>childList</code>" for
 target <var title="">parent</var> with addedNodes
 <var title="">nodes</var>, removedNodes a list solely containing
 <var title="">child</var>, nextSibling <var title="">reference child</var>, and
 previousSibling <var title="">child</var>'s
 <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a>.

 <li><p>Return <var title="">child</var>.
</ol>


<p>To <dfn title="concept-node-replace-all" id="concept-node-replace-all">replace all</dfn> with a
<var title="">node</var> within a <var title="">parent</var>, run these steps:

<ol>
 <li><p>If <var title="">node</var> is not null,
 <a title="concept-node-adopt" href="#concept-node-adopt">adopt</a> <var title="">node</var> into
 <var title="">parent</var>'s
 <a title="concept-node-document" href="#concept-node-document">node document</a>.

 <li><p>Let <var title="">removedNodes</var> be <var title="">parent</var>'s
 <a title="concept-tree-child" href="#concept-tree-child">children</a>.

 <li><p>Let <var title="">addedNodes</var> be the empty list if <var title="">node</var> is
 null, <var title="">node</var>'s <a title="concept-tree-child" href="#concept-tree-child">children</a> if
 <var title="">node</var> is a <code><a href="#documentfragment">DocumentFragment</a></code>
 <a title="concept-node" href="#concept-node">node</a>, and a list containing <var title="">node</var>
 otherwise.

 <li><p><a title="concept-node-remove" href="#concept-node-remove">Remove</a> all
 <var title="">parent</var>'s <a title="concept-tree-child" href="#concept-tree-child">children</a>, in
 <a title="concept-tree-order" href="#concept-tree-order">tree order</a>, with the
 <i title="">suppress observers flag</i> set.

 <li><p>If <var title="">node</var> is not null,
 <a title="concept-node-insert" href="#concept-node-insert">insert</a> <var title="">node</var> into
 <var title="">parent</var> before null with the <i title="">suppress observers flag</i> set.

 <li><p><a href="#queue-a-mutation-record">Queue a mutation record</a> of "<code>childList</code>" for
 <var title="">parent</var> with addedNodes <var title="">addedNodes</var> and
 removedNodes <var title="">removedNodes</var>.
</ol>

<p class="note">This algorithm does not make any checks with regards to the
<a title="concept-node-tree" href="#concept-node-tree">node tree</a> constraints. Use it wisely.


<p>To <dfn title="concept-node-pre-remove" id="concept-node-pre-remove">pre-remove</dfn> a
<var title="">child</var> from a <var title="">parent</var>, run these steps:</p>

<ol>
 <li><p>If <var title="">child</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is not
 <var title="">parent</var>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NotFoundError</code> exception.

 <li><p><a title="concept-node-remove" href="#concept-node-remove">Remove</a> <var title="">child</var>
 from <var title="">parent</var>.

 <li><p>Return <var title="">child</var>.
 <!-- technically this is post-remove -->
</ol>


<p><a title="Other applicable specifications" href="#other-applicable-specifications">Specifications</a> may define
<dfn title="concept-node-remove-ext" id="concept-node-remove-ext">removing steps</dfn> for all or some
<a title="concept-node" href="#concept-node">nodes</a>. The algorithm is passed <var>removedNode</var>,
<var>oldParent</var>, and <var>oldPreviousSibling</var>, as indicated in the
<a title="concept-node-remove" href="#concept-node-remove">remove</a> algorithm below.

<p>To <dfn title="concept-node-remove" id="concept-node-remove">remove</dfn> a <var title="">node</var>
from a <var title="">parent</var>, optionally with
<i title="">suppress observers flag</i> set, run these steps:

<ol>
 <li><p>Let <var title="">index</var> be <var title="">node</var>'s
 <a title="concept-tree-index" href="#concept-tree-index">index</a>.

 <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is an
 <a title="concept-tree-inclusive-descendant" href="#concept-tree-inclusive-descendant">inclusive descendant</a> of
 <var title="">node</var>, set its
 <a title="concept-range-start" href="#concept-range-start">start</a> to
 (<var title="">parent</var>, <var title="">index</var>).

 <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is an
 <a title="concept-tree-inclusive-descendant" href="#concept-tree-inclusive-descendant">inclusive descendant</a> of
 <var title="">node</var>, set its
 <a title="concept-range-end" href="#concept-range-end">end</a> to
 (<var title="">parent</var>, <var title="">index</var>).

 <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
 <var title="">parent</var> and
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> is greater than
 <var title="">index</var>, decrease its
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> by one.

 <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is
 <var title="">parent</var> and
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> is greater than
 <var title="">index</var>, decrease its
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> by one.

 <li><p>Let <var>oldPreviousSibling</var> be <var title="">node</var>'s
 <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a>

 <li><p>If <i title="">suppress observers flag</i> is unset,
 <a href="#queue-a-mutation-record">queue a mutation record</a> of "<code>childList</code>" for
 <var title="">parent</var> with removedNodes a list solely containing
 <var title="">node</var>, nextSibling <var title="">node</var>'s
 <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>,
 and previousSibling <var>oldPreviousSibling</var>.

 <li><p>For each <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestor</a>
 <var title="">ancestor</var> of <var title="">node</var>, if
 <var title="">ancestor</var> has any
 <a title="registered observer" href="#registered-observer">registered observers</a> whose
 <b>options</b>'s
 <code title="dom-MutationObserverInit-subtree">subtree</code> is true, then
 for each such <a href="#registered-observer">registered observer</a> <var title="">registered</var>, append a
 <a href="#transient-registered-observer">transient registered observer</a> whose <b>observer</b> and
 <b>options</b> are identical to those of <var title="">registered</var> and <b>source</b>
 which is <var title="">registered</var> to <var title="">node</var>'s list of
 <a title="registered observer" href="#registered-observer">registered observers</a>.

 <li><p>Remove <var title="">node</var> from its <var title="">parent</var>.

 <li><p>Run the <a title="concept-node-remove-ext" href="#concept-node-remove-ext">removing steps</a> with
 <var title="">node</var>, <var title="">parent</var>, and <var>oldPreviousSibling</var>.
</ol>


<h4 id="interface-nonelementparentnode"><span class="secno">4.2.2 </span>Interface <code><a href="#nonelementparentnode">NonElementParentNode</a></code></h4>

<p class="note no-backref">The
<code title="dom-NonElementParentNode-getElementById"><a href="#dom-nonelementparentnode-getelementbyid">getElementById()</a></code> method is not
on <a title="concept-element" href="#concept-element">elements</a> for compatibility with older versions of
jQuery. If a time comes where that version of jQuery has disappeared, we might be able to
support it.

<pre class="idl">[NoInterfaceObject]
interface <dfn id="nonelementparentnode">NonElementParentNode</dfn> {
  <a href="#element">Element</a>? <a title="dom-NonElementParentNode-getElementById" href="#dom-nonelementparentnode-getelementbyid">getElementById</a>(DOMString <var title="">elementId</var>);
};
<a href="#document">Document</a> implements <a href="#nonelementparentnode">NonElementParentNode</a>;
<a href="#documentfragment">DocumentFragment</a> implements <a href="#nonelementparentnode">NonElementParentNode</a>;</pre>

<dl class="domintro">
 <dt><code><var title="">node</var> . <a title="dom-NonElementParentNode-getElementById" href="#dom-nonelementparentnode-getelementbyid">getElementById</a>(<var title="">elementId</var>)</code>
 <dd><p>Returns the first <a title="concept-element" href="#concept-element">element</a> within
 <var title="">node</var>'s <a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a> whose
 <a title="concept-id" href="#concept-id">ID</a> is <var title="">elementId</var>.
</dl>

<p>The
<dfn title="dom-NonElementParentNode-getElementById" id="dom-nonelementparentnode-getelementbyid"><code>getElementById(<var>elementId</var>)</code></dfn>
method must return the first <a title="concept-element" href="#concept-element">element</a>, in
<a title="concept-tree-order" href="#concept-tree-order">tree order</a>, within <a href="#context-object">context object</a>'s
<a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a>, whose
<a title="concept-id" href="#concept-id">ID</a> is <var title="">elementId</var>, and null if there is no
such <a title="concept-element" href="#concept-element">element</a> otherwise.


<h4 id="interface-parentnode"><span class="secno">4.2.3 </span>Interface <code><a href="#parentnode">ParentNode</a></code></h4>

<p>The <dfn id="mutation-method-macro">mutation method macro</dfn>:

<ol>
 <li><p>Let <var title="">node</var> be null.

 <li><p>Replace each string in <var title="">nodes</var> with a
 <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a> whose
 <a title="concept-CD-data" href="#concept-cd-data">data</a> is the string value.

 <li>
  <p>If <var title="">nodes</var> contains more than one
  <a title="concept-node" href="#concept-node">node</a>, set <var title="">node</var> to a new
  <code><a href="#documentfragment">DocumentFragment</a></code> and
  <a title="concept-node-append" href="#concept-node-append">append</a> each
  <a title="concept-node" href="#concept-node">node</a> in <var title="">nodes</var> to it. Rethrow any
  exceptions.

  <p>Otherwise, set <var title="">node</var> to the single
  <a title="concept-node" href="#concept-node">node</a> <var title="">nodes</var> contains.
</ol>

<pre class="idl">[NoInterfaceObject]
interface <dfn id="parentnode">ParentNode</dfn> {
  [SameObject] readonly attribute <a href="#htmlcollection">HTMLCollection</a> <a title="dom-ParentNode-children" href="#dom-parentnode-children">children</a>;
  readonly attribute <a href="#element">Element</a>? <a title="dom-ParentNode-firstElementChild" href="#dom-parentnode-firstelementchild">firstElementChild</a>;
  readonly attribute <a href="#element">Element</a>? <a title="dom-ParentNode-lastElementChild" href="#dom-parentnode-lastelementchild">lastElementChild</a>;
  readonly attribute unsigned long <a title="dom-ParentNode-childElementCount" href="#dom-parentnode-childelementcount">childElementCount</a>;

  [Unscopeable] void <a title="dom-ParentNode-prepend" href="#dom-parentnode-prepend">prepend</a>((<a href="#node">Node</a> or DOMString)... <var title="">nodes</var>);
  [Unscopeable] void <a title="dom-ParentNode-append" href="#dom-parentnode-append">append</a>((<a href="#node">Node</a> or DOMString)... <var title="">nodes</var>);

  [Unscopeable] <a href="#element">Element</a>? <a title="dom-ParentNode-query" href="#dom-parentnode-query">query</a>(DOMString <var title="">relativeSelectors</var>);
  [NewObject, Unscopeable] <a href="#elements">Elements</a> <a title="dom-ParentNode-queryAll" href="#dom-parentnode-queryall">queryAll</a>(DOMString <var title="">relativeSelectors</var>);
  <a href="#element">Element</a>? <a title="dom-ParentNode-querySelector" href="#dom-parentnode-queryselector">querySelector</a>(DOMString <var title="">selectors</var>);
  [NewObject] <a href="#nodelist">NodeList</a> <a title="dom-ParentNode-querySelectorAll" href="#dom-parentnode-queryselectorall">querySelectorAll</a>(DOMString <var title="">selectors</var>);
};
<a href="#document">Document</a> implements <a href="#parentnode">ParentNode</a>;
<a href="#documentfragment">DocumentFragment</a> implements <a href="#parentnode">ParentNode</a>;
<a href="#element">Element</a> implements <a href="#parentnode">ParentNode</a>;</pre>

<dl class="domintro">
 <dt><code><var title="">collection</var> = <var title="">node</var> . <a title="dom-ParentNode-children" href="#dom-parentnode-children">children</a></code>
 <dd><p>Returns the <a title="concept-tree-child" href="#concept-tree-child">child</a>
 <a title="concept-element" href="#concept-element">elements</a>.

 <dt><code><var title="">element</var> = <var title="">node</var> . <a title="dom-ParentNode-firstElementChild" href="#dom-parentnode-firstelementchild">firstElementChild</a></code>
 <dd><p>Returns the first <a title="concept-tree-child" href="#concept-tree-child">child</a> that
 is an <a title="concept-element" href="#concept-element">element</a>, and null otherwise.

 <dt><code><var title="">element</var> = <var title="">node</var> . <a title="dom-ParentNode-lastElementChild" href="#dom-parentnode-lastelementchild">lastElementChild</a></code>
 <dd><p>Returns the last <a title="concept-tree-child" href="#concept-tree-child">child</a> that
 is an <a title="concept-element" href="#concept-element">element</a>, and null otherwise.

 <!-- childElementCount is redundant -->

 <dt><code><var title="">node</var> . <a title="dom-ParentNode-prepend" href="#dom-parentnode-prepend">prepend</a>(<var title="">nodes</var>)</code>
 <dd>
  <p>Inserts <var title="">nodes</var> before the
  <a title="concept-tree-first-child" href="#concept-tree-first-child">first child</a> of
  <var title="">node</var>, while replacing strings in <var title="">nodes</var>
  with equivalent <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">nodes</a>.

  <p><a title="throw" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">Throws</a> a
  <code title="">HierarchyRequestError</code> if the constraints of the
  <a title="concept-node-tree" href="#concept-node-tree">node tree</a> are violated.
  <!-- "NotFoundError" is impossible -->

 <dt><code><var title="">node</var> . <a title="dom-ParentNode-append" href="#dom-parentnode-append">append</a>(<var title="">nodes</var>)</code>
 <dd>
  <p>Inserts <var title="">nodes</var> after the
  <a title="concept-tree-last-child" href="#concept-tree-last-child">last child</a> of
  <var title="">node</var>, while replacing strings in <var title="">nodes</var>
  with equivalent <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">nodes</a>.

  <p><a title="throw" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">Throws</a> a
  <code title="">HierarchyRequestError</code> if the constraints of the
  <a title="concept-node-tree" href="#concept-node-tree">node tree</a> are violated.
  <!-- "NotFoundError" is impossible -->

 <dt><code><var title="">node</var> . <a title="dom-ParentNode-query" href="#dom-parentnode-query">query</a>(<var title="">relativeSelectors</var>)</code>
 <dd>
  <p>Returns the first <a title="concept-element" href="#concept-element">element</a> that is a
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a> of <var title="">node</var> that
  matches <var title="">relativeSelectors</var>.

 <dt><code><var title="">node</var> . <a title="dom-ParentNode-queryAll" href="#dom-parentnode-queryall">queryAll</a>(<var title="">relativeSelectors</var>)</code>
 <dd>
  <p>Returns all <a title="concept-element" href="#concept-element">element</a>
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a> of <var title="">node</var> that
  match <var title="">relativeSelectors</var>.

 <dt><code><var title="">node</var> . <a title="dom-ParentNode-querySelector" href="#dom-parentnode-queryselector">querySelector</a>(<var title="">selectors</var>)</code>
 <dd>
  <p>Returns the first <a title="concept-element" href="#concept-element">element</a> that is a
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a> of <var title="">node</var> that
  matches <var title="">selectors</var>.

 <dt><code><var title="">node</var> . <a title="dom-ParentNode-querySelectorAll" href="#dom-parentnode-queryselectorall">querySelectorAll</a>(<var title="">selectors</var>)</code>
 <dd>
  <p>Returns all <a title="concept-element" href="#concept-element">element</a>
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a> of <var title="">node</var> that
  match <var title="">selectors</var>.
</dl>

<p>The <dfn title="dom-ParentNode-children" id="dom-parentnode-children"><code>children</code></dfn>
attribute must return an <code><a href="#htmlcollection">HTMLCollection</a></code>
<a title="concept-collection" href="#concept-collection">collection</a> rooted at the
<a href="#context-object">context object</a> matching only
<a title="concept-element" href="#concept-element">element</a>
<a title="concept-tree-child" href="#concept-tree-child">children</a>.

<p>The
<dfn title="dom-ParentNode-firstElementChild" id="dom-parentnode-firstelementchild"><code>firstElementChild</code></dfn>
attribute must return the first <a title="concept-tree-child" href="#concept-tree-child">child</a>
that is an <a title="concept-element" href="#concept-element">element</a>, and null otherwise.

<p>The
<dfn title="dom-ParentNode-lastElementChild" id="dom-parentnode-lastelementchild"><code>lastElementChild</code></dfn>
attribute must return the last <a title="concept-tree-child" href="#concept-tree-child">child</a>
that is an <a title="concept-element" href="#concept-element">element</a>, and null otherwise.

<p>The
<dfn title="dom-ParentNode-childElementCount" id="dom-parentnode-childelementcount"><code>childElementCount</code></dfn>
attribute must return the number of
<a title="concept-tree-child" href="#concept-tree-child">children</a> of the
<a href="#context-object">context object</a> that are
<a title="concept-element" href="#concept-element">elements</a>.

<p>The
<dfn title="dom-ParentNode-prepend" id="dom-parentnode-prepend"><code>prepend(<var>nodes</var>)</code></dfn>
method must run these steps:

<ol>
 <li>Run the <a href="#mutation-method-macro">mutation method macro</a>.

 <li><p><a title="concept-node-pre-insert" href="#concept-node-pre-insert">Pre-insert</a>
 <var title="">node</var> into the <a href="#context-object">context object</a> before the
 <a href="#context-object">context object</a>'s
 <a title="concept-tree-first-child" href="#concept-tree-first-child">first child</a>.
</ol>

<p>The
<dfn title="dom-ParentNode-append" id="dom-parentnode-append"><code>append(<var>nodes</var>)</code></dfn>
method must run these steps:

<ol>
 <li>Run the <a href="#mutation-method-macro">mutation method macro</a>.

 <li><p><a title="concept-node-append" href="#concept-node-append">Append</a>
 <var title="">node</var> to the <a href="#context-object">context object</a>.
</ol>

<p>To <dfn id="match-a-relative-selectors-string">match a relative selectors string</dfn> <var title="">relativeSelectors</var>
against a <var title="">set</var>, run these steps:

<ol>
 <li><p>Let <var title="">s</var> be the result of
 <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#parse-a-relative-selector">parse a relative selector</a> from
 <var title="">relativeSelectors</var> against <var title="">set</var>.
 <a href="#refsSELECTORS">[SELECTORS]</a>

 <li><p>If <var title="">s</var> is failure, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">SyntaxError</code>.

 <li><p>Return the result of <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#evaluate-a-selector">evaluate a selector</a>
 <var title="">s</var> using
 <a title=":scope element" data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#scope-element">:scope elements</a>
 <var title="">set</var>. <a href="#refsSELECTORS">[SELECTORS]</a>
</ol>

<p>The
<dfn title="dom-ParentNode-query" id="dom-parentnode-query"><code>query(<var>relativeSelectors</var>)</code></dfn>
method must return the first result of running
<a href="#match-a-relative-selectors-string">match a relative selectors string</a> <var title="">relativeSelectors</var> against
a set consisting of <a href="#context-object">context object</a>, and null if the result is an empty list.

<p>The
<dfn title="dom-ParentNode-queryAll" id="dom-parentnode-queryall"><code>queryAll(<var>relativeSelectors</var>)</code></dfn>
method must return an <code><a href="#elements">Elements</a></code> array initialized with the result of running
<a href="#match-a-relative-selectors-string">match a relative selectors string</a> <var title="">relativeSelectors</var> against
a set consisting of <a href="#context-object">context object</a>.

<p>To <dfn id="scope-match-a-selectors-string">scope-match a selectors string</dfn> <var title="">selectors</var> against a
<var title="">node</var>, run these steps:

<ol>
 <li><p>Let <var title="">s</var> be the result of
 <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#parse-a-selector">parse a selector</a> <var title="">selectors</var>.
 <a href="#refsSELECTORS">[SELECTORS]</a>

 <li><p>If <var title="">s</var> is failure, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">SyntaxError</code>.

 <li><p>Return the result of <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#evaluate-a-selector">evaluate a selector</a>
 <var title="">s</var> against
 <var title="">node</var>'s <a title="concept-tree-root" href="#concept-tree-root">root</a> using
 <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#scoping-root">scoping root</a> <var title="">node</var> and
 scoping method
 <a title="scope-filtered" data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#scope-filtered">scope-filtered</a>.
 <a href="#refsSELECTORS">[SELECTORS]</a>.
</ol>

<p>The
<dfn title="dom-ParentNode-querySelector" id="dom-parentnode-queryselector"><code>querySelector(<var>selectors</var>)</code></dfn>
method must return the first result of running <a href="#scope-match-a-selectors-string">scope-match a selectors string</a>
<var title="">selectors</var> against the <a href="#context-object">context object</a>, and null if the result
is an empty list otherwise.

<p>The
<dfn title="dom-ParentNode-querySelectorAll" id="dom-parentnode-queryselectorall"><code>querySelectorAll(<var>selectors</var>)</code></dfn>
method must return the <a title="concept-collection-static" href="#concept-collection-static">static</a> result of
running <a href="#scope-match-a-selectors-string">scope-match a selectors string</a> <var title="">selectors</var> against the
<a href="#context-object">context object</a>.


<h4 id="interface-nondocumenttypechildnode"><span class="secno">4.2.4 </span>Interface <code><a href="#nondocumenttypechildnode">NonDocumentTypeChildNode</a></code></h4>

<p class="note no-backref">The
<code title="dom-NonDocumentTypeChildNode-previousElementSibling"><a href="#dom-nondocumenttypechildnode-previouselementsibling">previousElementSibling</a></code>
and <code title="dom-NonDocumentTypeChildNode-nextElementSibling"><a href="#dom-nondocumenttypechildnode-nextelementsibling">nextElementSibling</a></code>
attributes have been removed from <code><a href="#documenttype">DocumentType</a></code> nodes for compatibility
reasons. If these additions are deemed compatible enough in the future, they could be
reinstated.

<pre class="idl">[NoInterfaceObject]
interface <dfn id="nondocumenttypechildnode">NonDocumentTypeChildNode</dfn> {
  readonly attribute <a href="#element">Element</a>? <a title="dom-NonDocumentTypeChildNode-previousElementSibling" href="#dom-nondocumenttypechildnode-previouselementsibling">previousElementSibling</a>;
  readonly attribute <a href="#element">Element</a>? <a title="dom-NonDocumentTypeChildNode-nextElementSibling" href="#dom-nondocumenttypechildnode-nextelementsibling">nextElementSibling</a>;
};
<a href="#element">Element</a> implements <a href="#nondocumenttypechildnode">NonDocumentTypeChildNode</a>;
<a href="#characterdata">CharacterData</a> implements <a href="#nondocumenttypechildnode">NonDocumentTypeChildNode</a>;</pre>

<dl class="domintro">
 <dt><code><var title="">element</var> = <var title="">node</var> . <a title="dom-NonDocumentTypeChildNode-previousElementSibling" href="#dom-nondocumenttypechildnode-previouselementsibling">previousElementSibling</a></code>
 <dd><p>Returns the first
 <a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a>
 <a title="concept-tree-sibling" href="#concept-tree-sibling">sibling</a> that
 is an <a title="concept-element" href="#concept-element">element</a>, and null otherwise.

 <dt><code><var title="">element</var> = <var title="">node</var> . <a title="dom-NonDocumentTypeChildNode-nextElementSibling" href="#dom-nondocumenttypechildnode-nextelementsibling">nextElementSibling</a></code>
 <dd><p>Returns the first
 <a title="concept-tree-following" href="#concept-tree-following">following</a>
 <a title="concept-tree-sibling" href="#concept-tree-sibling">sibling</a> that
 is an <a title="concept-element" href="#concept-element">element</a>, and null otherwise.
</dl>

<p>The
<dfn title="dom-NonDocumentTypeChildNode-previousElementSibling" id="dom-nondocumenttypechildnode-previouselementsibling"><code>previousElementSibling</code></dfn>
attribute must return the first
<a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a>
<a title="concept-tree-sibling" href="#concept-tree-sibling">sibling</a> that is an
<a title="concept-element" href="#concept-element">element</a>, and null otherwise.

<p>The
<dfn title="dom-NonDocumentTypeChildNode-nextElementSibling" id="dom-nondocumenttypechildnode-nextelementsibling"><code>nextElementSibling</code></dfn>
attribute must return the first
<a title="concept-tree-following" href="#concept-tree-following">following</a>
<a title="concept-tree-sibling" href="#concept-tree-sibling">sibling</a> that is an
<a title="concept-element" href="#concept-element">element</a>, and null otherwise.


<h4 id="interface-childnode"><span class="secno">4.2.5 </span>Interface <code><a href="#childnode">ChildNode</a></code></h4>

<pre class="idl">[NoInterfaceObject]
interface <dfn id="childnode">ChildNode</dfn> {
  [Unscopeable] void <a title="dom-ChildNode-before" href="#dom-childnode-before">before</a>((<a href="#node">Node</a> or DOMString)... <var title="">nodes</var>);
  [Unscopeable] void <a title="dom-ChildNode-after" href="#dom-childnode-after">after</a>((<a href="#node">Node</a> or DOMString)... <var title="">nodes</var>);
  [Unscopeable] void <a title="dom-ChildNode-replaceWith" href="#dom-childnode-replacewith">replaceWith</a>((<a href="#node">Node</a> or DOMString)... <var title="">nodes</var>);
  [Unscopeable] void <a title="dom-ChildNode-remove" href="#dom-childnode-remove">remove</a>();
};
<a href="#documenttype">DocumentType</a> implements <a href="#childnode">ChildNode</a>;
<a href="#element">Element</a> implements <a href="#childnode">ChildNode</a>;
<a href="#characterdata">CharacterData</a> implements <a href="#childnode">ChildNode</a>;</pre>

<dl class="domintro">
 <dt><code><var title="">node</var> . <a title="dom-ChildNode-before" href="#dom-childnode-before">before</a>(<var title="">nodes</var>)</code>
 <dd>
  <p>Inserts <var title="">nodes</var> just before <var title="">node</var>,
  while replacing strings in <var title="">nodes</var> with equivalent
  <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">nodes</a>.

  <p><a title="throw" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">Throws</a> a
  <code title="">HierarchyRequestError</code> if the constraints of the
  <a title="concept-node-tree" href="#concept-node-tree">node tree</a> are violated.

 <dt><code><var title="">node</var> . <a title="dom-ChildNode-after" href="#dom-childnode-after">after</a>(<var title="">nodes</var>)</code>
 <dd>
  <p>Inserts <var title="">nodes</var> just after <var title="">node</var>,
  while replacing strings in <var title="">nodes</var> with equivalent
  <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">nodes</a>.

  <p><a title="throw" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">Throws</a> a
  <code title="">HierarchyRequestError</code> if the constraints of the
  <a title="concept-node-tree" href="#concept-node-tree">node tree</a> are violated.

 <dt><code><var title="">node</var> . <a title="dom-ChildNode-replaceWith" href="#dom-childnode-replacewith">replaceWith</a>(<var title="">nodes</var>)</code>
 <dd>
  <p>Replaces <var title="">node</var> with <var title="">nodes</var>, while
  replacing strings in <var title="">nodes</var> with equivalent
  <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">nodes</a>.

  <p><a title="throw" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">Throws</a> a
  <code title="">HierarchyRequestError</code> if the constraints of the
  <a title="concept-node-tree" href="#concept-node-tree">node tree</a> are violated.

 <dt><code><var title="">node</var> . <a title="dom-ChildNode-remove" href="#dom-childnode-remove">remove</a>()</code>
 <dd><p>Removes <var title="">node</var>.
</dl>

<p>The
<dfn title="dom-ChildNode-before" id="dom-childnode-before"><code>before(<var>nodes</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If the <a href="#context-object">context object</a> does not have a
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>, terminate these steps.

 <li>Run the <a href="#mutation-method-macro">mutation method macro</a>.

 <li><p><a title="concept-node-pre-insert" href="#concept-node-pre-insert">Pre-insert</a>
 <var title="">node</var> into the <a href="#context-object">context object</a>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> before the
 <a href="#context-object">context object</a>.
</ol>

<p>The
<dfn title="dom-ChildNode-after" id="dom-childnode-after"><code>after(<var>nodes</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If the <a href="#context-object">context object</a> does not have a
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>, terminate these steps.

 <li>Run the <a href="#mutation-method-macro">mutation method macro</a>.

 <li><p><a title="concept-node-pre-insert" href="#concept-node-pre-insert">Pre-insert</a>
 <var title="">node</var> into the <a href="#context-object">context object</a>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> before the
 <a href="#context-object">context object</a>'s
 <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>.
</ol>

<p>The
<dfn title="dom-ChildNode-replaceWith" id="dom-childnode-replacewith"><code>replaceWith(<var>nodes</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If the <a href="#context-object">context object</a> does not have a
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>, terminate these steps.

 <li>Run the <a href="#mutation-method-macro">mutation method macro</a>.

 <li><p><a title="concept-node-replace" href="#concept-node-replace">Replace</a> the
 <a href="#context-object">context object</a> with <var title="">node</var> within the
 <a href="#context-object">context object</a>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.
</ol>

<p>The
<dfn title="dom-ChildNode-remove" id="dom-childnode-remove"><code>remove()</code></dfn>
method must run these steps:

<ol>
 <li><p>If the <a href="#context-object">context object</a> does not have a
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>, terminate these steps.

 <li><p><a title="concept-node-remove" href="#concept-node-remove">Remove</a> the
 <a href="#context-object">context object</a> from the
 <a href="#context-object">context object</a>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.
</ol>


<h4 id="collections:-elements"><span class="secno">4.2.6 </span>Collections: <code><a href="#elements">Elements</a></code></h4>

<pre class="idl">class <dfn id="elements">Elements</dfn> extends <span>Array</span> {
  <a href="#element">Element</a>? <a title="dom-Elements-query" href="#dom-elements-query">query</a>(DOMString <var title="">relativeSelectors</var>);
  <a href="#elements">Elements</a> <a title="dom-Elements-queryAll" href="#dom-elements-queryall">queryAll</a>(DOMString <var title="">relativeSelectors</var>);
};</pre>

<div class="XXX">
<p>IDL bugs: <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=20020"><code>Array</code> subclassing</a> and <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=23225">class, not interface</a>.

<p><code><a href="#elements">Elements</a></code> is an ES6-style subclass of <code>Array</code> with two
additional methods. It's the new <code><a href="#nodelist">NodeList</a></code> / <code><a href="#htmlcollection">HTMLCollection</a></code>.
</div>

<dl class="domintro">
 <dt><code><var title="">elements</var> . <a title="dom-Elements-query" href="#dom-elements-query">query</a>(<var title="">relativeSelectors</var>)</code>
 <dd>
  <p>Returns the first <a title="concept-element" href="#concept-element">element</a> that is a
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a> of <var title="">elements</var> that
  matches <var title="">relativeSelectors</var>.

 <dt><code><var title="">elements</var> . <a title="dom-Elements-queryAll" href="#dom-elements-queryall">queryAll</a>(<var title="">relativeSelectors</var>)</code>
 <dd>
  <p>Returns all <a title="concept-element" href="#concept-element">element</a>
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a> of <var title="">elements</var> that
  match <var title="">relativeSelectors</var>.
</dl>

<p>The
<dfn title="dom-Elements-query" id="dom-elements-query"><code>query(<var>relativeSelectors</var>)</code></dfn>
method must return the first result of running
<a href="#match-a-relative-selectors-string">match a relative selectors string</a> <var title="">relativeSelectors</var>
against the <a href="#context-object">context object</a>, and null if the result is an empty list.

<p>The
<dfn title="dom-Elements-queryAll" id="dom-elements-queryall"><code>queryAll(<var>relativeSelectors</var>)</code></dfn>
method must return the result of running <code title="">this.constructor</code> with the
result of running <a href="#match-a-relative-selectors-string">match a relative selectors string</a>
<var title="">relativeSelectors</var> against the <a href="#context-object">context object</a>.


<h4 id="old-style-collections:-nodelist-and-htmlcollection"><span class="secno">4.2.7 </span>Old-style collections: <code><a href="#nodelist">NodeList</a></code> and <code><a href="#htmlcollection">HTMLCollection</a></code></h4>

<p>A <dfn title="concept-collection" id="concept-collection">collection</dfn> is an object that
represents a lists of DOM nodes. A
<a title="concept-collection" href="#concept-collection">collection</a> can be either
<dfn title="concept-collection-live" id="concept-collection-live">live</dfn> or
<dfn title="concept-collection-static" id="concept-collection-static">static</dfn>. Unless otherwise stated,
a <a title="concept-collection" href="#concept-collection">collection</a> must be
<a title="concept-collection-live" href="#concept-collection-live">live</a>.

<p>If a <a title="concept-collection" href="#concept-collection">collection</a> is <a title="concept-collection-live" href="#concept-collection-live">live</a>, then the attributes and methods
on that object must operate on the actual underlying data, not a snapshot of
the data.

<p>When a <a title="concept-collection" href="#concept-collection">collection</a> is created, a
filter and a root are associated with it.

<p>The <a title="concept-collection" href="#concept-collection">collection</a> then
<dfn title="represented by the collection" id="represented-by-the-collection">represents</dfn> a view of the
subtree rooted at the <a title="concept-collection" href="#concept-collection">collection's</a>
root, containing only nodes that match the given filter. The view is linear.
In the absence of specific requirements to the contrary, the nodes within
the <a title="concept-collection" href="#concept-collection">collection</a> must be sorted in
<a title="concept-tree-order" href="#concept-tree-order">tree order</a>.


<h5 id="interface-nodelist"><span class="secno">4.2.7.1 </span>Interface <code><a href="#nodelist">NodeList</a></code></h5>

<p>A <code><a href="#nodelist">NodeList</a></code> object is a
<a title="concept-collection" href="#concept-collection">collection</a> of
<a title="concept-node" href="#concept-node">nodes</a>.

<pre class="idl">interface <dfn id="nodelist">NodeList</dfn> {
  getter <a href="#node">Node</a>? <a title="dom-NodeList-item" href="#dom-nodelist-item">item</a>(unsigned long <var title="">index</var>);
  readonly attribute unsigned long <a title="dom-NodeList-length" href="#dom-nodelist-length">length</a>;
  iterable&lt;<a href="#node">Node</a>&gt;;
};</pre>

<dl class="domintro">
 <dt><var title="">collection</var> . <code title="dom-NodeList-length"><a href="#dom-nodelist-length">length</a></code>
 <dd>
  <p>Returns the number of <a title="concept-node" href="#concept-node">nodes</a> in the
  <a title="concept-collection" href="#concept-collection">collection</a>.

 <dt><var title="">element</var> = <var title="">collection</var> . <code title="dom-NodeList-item"><a href="#dom-nodelist-item">item</a></code>(<var title="">index</var>)
 <dt><var title="">element</var> = <var title="">collection</var>[<var title="">index</var>]
 <dd>
  <p>Returns the <a title="concept-node" href="#concept-node">node</a> with index
  <var title="">index</var> from the
  <a title="concept-collection" href="#concept-collection">collection</a>. The
  <a title="concept-node" href="#concept-node">nodes</a> are sorted in
  <a title="concept-tree-order" href="#concept-tree-order">tree order</a>.
</dl>

<div class="impl">

<p>The object's <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-indices">supported property indices</a>
are the numbers in the range zero to one less than the number of nodes
<a href="#represented-by-the-collection">represented by the collection</a>. If there are no such elements, then
there are no <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-indices">supported property indices</a>.

<p>The <dfn title="dom-NodeList-length" id="dom-nodelist-length"><code>length</code></dfn> attribute must
return the number of nodes <a href="#represented-by-the-collection">represented by the collection</a>.

<p>The
<dfn title="dom-NodeList-item" id="dom-nodelist-item"><code>item(<var title="">index</var>)</code></dfn>
method must return the <var title="">index</var>th
node in the <a title="concept-collection" href="#concept-collection">collection</a>. If there is no
<var title="">index</var>th node in the <a title="concept-collection" href="#concept-collection">collection</a>, then the method must return null.

</div>


<h5 id="interface-htmlcollection"><span class="secno">4.2.7.2 </span>Interface <code><a href="#htmlcollection">HTMLCollection</a></code></h5>

<pre class="idl">interface <dfn id="htmlcollection">HTMLCollection</dfn> {
  readonly attribute unsigned long <a title="dom-HTMLCollection-length" href="#dom-htmlcollection-length">length</a>;
  getter <a href="#element">Element</a>? <a title="dom-HTMLCollection-item" href="#dom-htmlcollection-item">item</a>(unsigned long <var title="">index</var>);
  getter <a href="#element">Element</a>? <a title="dom-HTMLCollection-namedItem" href="#dom-htmlcollection-nameditem">namedItem</a>(DOMString <var>name</var>);
};</pre>

<p>An <code><a href="#htmlcollection">HTMLCollection</a></code> object is a
<a title="concept-collection" href="#concept-collection">collection</a> of
<a title="concept-element" href="#concept-element">elements</a>.

<p class="note"><code><a href="#elements">Elements</a></code> is the better solution for representing a
<a title="concept-collection" href="#concept-collection">collection</a> of
<a title="concept-element" href="#concept-element">elements</a>. <code><a href="#htmlcollection">HTMLCollection</a></code> is an historical
artifact we cannot rid the web of.

<dl class="domintro">
 <dt><var title="">collection</var> . <code title="dom-HTMLCollection-length"><a href="#dom-htmlcollection-length">length</a></code>
 <dd>
  <p>Returns the number of <a title="concept-element" href="#concept-element">elements</a> in
  the <a title="concept-collection" href="#concept-collection">collection</a>.

 <dt><var title="">element</var> = <var title="">collection</var> . <code title="dom-HTMLCollection-item"><a href="#dom-htmlcollection-item">item</a></code>(<var title="">index</var>)
 <dt><var title="">element</var> = <var title="">collection</var>[<var title="">index</var>]
 <dd>
  <p>Returns the <a title="concept-element" href="#concept-element">element</a> with index
  <var title="">index</var> from the <a title="concept-collection" href="#concept-collection">collection</a>.
  The <a title="concept-element" href="#concept-element">elements</a> are sorted in <a title="concept-tree-order" href="#concept-tree-order">tree order</a>.

 <dt><var title="">element</var> = <var title="">collection</var> . <code title="dom-HTMLCollection-namedItem"><a href="#dom-htmlcollection-nameditem">namedItem</a></code>(<var>name</var>)
 <dt><var title="">element</var> = <var title="">collection</var>[<var>name</var>]
 <dd>
  <p>Returns the first <a title="concept-element" href="#concept-element">element</a> with <a title="concept-id" href="#concept-id">ID</a> or name <var>name</var>
  from the collection.
</dl>

<div class="impl">

<p>The object's <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-indices">supported property indices</a>
are the numbers in the range zero to one less than the number of nodes
<a href="#represented-by-the-collection">represented by the collection</a>. If there are no such elements, then
there are no <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-indices">supported property indices</a>.

<p>The <dfn title="dom-HTMLCollection-length" id="dom-htmlcollection-length"><code>length</code></dfn> attribute
must return the number of nodes <a href="#represented-by-the-collection">represented by the collection</a>.

<p>The
<dfn title="dom-HTMLCollection-item" id="dom-htmlcollection-item"><code>item(<var title="">index</var>)</code></dfn>
method must return the <var title="">index</var>th
<a title="concept-element" href="#concept-element">element</a> in the <a title="concept-collection" href="#concept-collection">collection</a>. If there is no
<var title="">index</var>th <a title="concept-element" href="#concept-element">element</a> in the <a title="concept-collection" href="#concept-collection">collection</a>, then the method must return null.

<p>The <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-names">supported property names</a>, all
<a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-unenumerable">unenumerable</a>, are the values from the list returned
by these steps:

<ol>
 <li><p>Let <var title="">result</var> be an empty list.
 <li>
  <p>For each <var title="">element</var>
  <a href="#represented-by-the-collection">represented by the collection</a>, in
  <a title="concept-tree-order" href="#concept-tree-order">tree order</a>, run these substeps:
  <ol>
   <li><p>If <var title="">element</var> has an
   <a title="concept-id" href="#concept-id">ID</a> which is neither the empty string nor is
   in <var title="">result</var>, append <var title="">element</var>'s
   <a title="concept-id" href="#concept-id">ID</a> to <var title="">result</var>.

   <li><p>If <var title="">element</var> is in the <a href="#html-namespace">HTML namespace</a>
   and <a title="concept-element-attribute-has" href="#concept-element-attribute-has">has</a> a
   <a title="concept-named-attribute" href="#concept-named-attribute"><code title="">name</code> attribute</a>
   whose <a title="concept-attribute-value" href="#concept-attribute-value">value</a> is neither the
   empty string nor is in <var title="">result</var>, append
   <var title="">element</var>'s
   <a title="concept-named-attribute" href="#concept-named-attribute"><code title="">name</code> attribute</a>
   <a title="concept-attribute-value" href="#concept-attribute-value">value</a> to <var title="">result</var>.
  </ol>
 <li><p>Return <var title="">result</var>.
</ol>

<p>The
<dfn title="dom-HTMLCollection-namedItem" id="dom-htmlcollection-nameditem"><code>namedItem(<var title="">key</var>)</code></dfn>
method must run these steps:
<ol>
 <li>If <var title="">key</var> is the empty string, return null.</li>
 <li>
  <p>Return the first <a title="concept-element" href="#concept-element">element</a> in the
  <a title="concept-collection" href="#concept-collection">collection</a> for which at least one of
  the following is true:
  <ul>
   <li>it has an <a title="concept-id" href="#concept-id">ID</a> which is <var title="">key</var>.
   <li>it <a title="concept-element-attribute-has" href="#concept-element-attribute-has">has</a> a
   <a title="concept-named-attribute" href="#concept-named-attribute"><code title="">name</code> attribute</a>
   whose <a title="concept-attribute-value" href="#concept-attribute-value">value</a> is
   <var title="">key</var>;
  </ul>
  <p>or null if there is no such <a title="concept-element" href="#concept-element">element</a>.
</ol>

</div>



<h3 id="mutation-observers"><span class="secno">4.3 </span>Mutation observers</h3>

<p>Each
<a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a> has a
<dfn id="mutation-observer-compound-microtask-queued-flag">mutation observer compound microtask queued flag</dfn> and an associated list of
<code><a href="#mutationobserver">MutationObserver</a></code> objects which is initially empty.
<a href="#refsHTML">[HTML]</a>

<p>To <dfn id="queue-a-mutation-observer-compound-microtask">queue a mutation observer compound microtask</dfn>, run these steps:

<ol>
 <li><p>If <a href="#mutation-observer-compound-microtask-queued-flag">mutation observer compound microtask queued flag</a> is set, terminate
 these steps.

 <li><p>Set <a href="#mutation-observer-compound-microtask-queued-flag">mutation observer compound microtask queued flag</a>.

 <li><p><a title="queue a microtask" data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask">Queue</a> a
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#compound-microtask">compound microtask</a> to
 <a href="#notify-mutation-observers">notify mutation observers</a>.
</ol>

<p>To <dfn id="notify-mutation-observers">notify mutation observers</dfn>, run these steps:

<ol>
 <li><p>Unset <a href="#mutation-observer-compound-microtask-queued-flag">mutation observer compound microtask queued flag</a>.

 <li><p>Let <var title="">notify list</var> be a copy of
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a>'s
 list of <code><a href="#mutationobserver">MutationObserver</a></code> objects.

 <li>
  <p>For each <code><a href="#mutationobserver">MutationObserver</a></code> object <var title="">mo</var>
  in <var title="">notify list</var>,
  <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#execute-a-compound-microtask-subtask">execute a compound microtask subtask</a> to run these
  steps:
  <a href="#refsHTML">[HTML]</a>

  <ol>
   <li><p>Let <var title="">queue</var> be a copy of <var title="">mo</var>'s
   <a title="concept-MO-queue" href="#concept-mo-queue">record queue</a>.

   <li><p>Empty <var title="">mo</var>'s
   <a title="concept-MO-queue" href="#concept-mo-queue">record queue</a>.

   <li><p>Remove all
   <a title="transient registered observer" href="#transient-registered-observer">transient registered observers</a>
   whose <b>observer</b> is <var title="">mo</var>.

   <li><p>If <var title="">queue</var> is non-empty, call
   <var title="">mo</var>'s <a title="concept-MO-callback" href="#concept-mo-callback">callback</a>
   with <var title="">queue</var> as first argument, and
   <var title="">mo</var> (itself) as second argument and
   <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-callback-this-value">callback this value</a>. If this throws an exception,
   <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#report-the-exception">report the exception</a>.
  </ol>
</ol>

<hr>

<p>Each <a title="concept-node" href="#concept-node">node</a> has an associated list of
<a title="registered observer" href="#registered-observer">registered observers</a>.
<!-- XXX also mention this in the <code>Node</code> section non-normatively? -->

<p>A <dfn id="registered-observer">registered observer</dfn> consists of an <b>observer</b> (a
<code><a href="#mutationobserver">MutationObserver</a></code> object) and <b>options</b> (a
<code><a href="#mutationobserverinit">MutationObserverInit</a></code> dictionary). A
<dfn id="transient-registered-observer">transient registered observer</dfn> is a specific type of
<a href="#registered-observer">registered observer</a> that has a <b>source</b> which is a
<a href="#registered-observer">registered observer</a>.


<h4 id="interface-mutationobserver"><span class="secno">4.3.1 </span>Interface <code><a href="#mutationobserver">MutationObserver</a></code></h4>

<pre class="idl">[<a title="dom-MutationObserver" href="#dom-mutationobserver">Constructor</a>(<a href="#mutationcallback">MutationCallback</a> <var>callback</var>)]
interface <dfn id="mutationobserver">MutationObserver</dfn> {
  void <a title="dom-MutationObserver-observe" href="#dom-mutationobserver-observe">observe</a>(<a href="#node">Node</a> <var>target</var>, <a href="#mutationobserverinit">MutationObserverInit</a> <var>options</var>);
  void <a title="dom-MutationObserver-disconnect" href="#dom-mutationobserver-disconnect">disconnect</a>();
  sequence&lt;<a href="#mutationrecord">MutationRecord</a>&gt; <a title="dom-MutationObserver-takeRecords" href="#dom-mutationobserver-takerecords">takeRecords</a>();
};

callback <dfn id="mutationcallback">MutationCallback</dfn> = void (sequence&lt;<a href="#mutationrecord">MutationRecord</a>&gt; <var>mutations</var>, <a href="#mutationobserver">MutationObserver</a> <var>observer</var>);

dictionary <dfn id="mutationobserverinit">MutationObserverInit</dfn> {
  boolean <span title="dom-MutationObserverInit-childList">childList</span> = false;
  boolean <span title="dom-MutationObserverInit-attributes">attributes</span>;
  boolean <span title="dom-MutationObserverInit-characterData">characterData</span>;
  boolean <span title="dom-MutationObserverInit-subtree">subtree</span> = false;
  boolean <span title="dom-MutationObserverInit-attributeOldValue">attributeOldValue</span>;
  boolean <span title="dom-MutationObserverInit-characterDataOldValue">characterDataOldValue</span>;
  sequence&lt;DOMString&gt; <span title="dom-MutationObserverInit-attributeFilter">attributeFilter</span>;
};</pre>

<p>A <code><a href="#mutationobserver">MutationObserver</a></code> object can be used to observe mutations
to the <a title="concept-tree" href="#concept-tree">tree</a> of
<a title="concept-node" href="#concept-node">nodes</a>.

<p>Each <code><a href="#mutationobserver">MutationObserver</a></code> object has these associated concepts:
<ul>
 <li><p>A <dfn title="concept-MO-callback" id="concept-mo-callback">callback</dfn> set on creation.
 <li><p>A list of <a title="concept-node" href="#concept-node">nodes</a> on which it is a <a href="#registered-observer">registered observer</a>'s <b>observer</b> that is initially empty.
 <li><p>A list of <code><a href="#mutationrecord">MutationRecord</a></code> objects called the
 <dfn title="concept-MO-queue" id="concept-mo-queue">record queue</dfn> that is initially empty.
</ul>

<dl class="domintro">
 <dt><code><var title="">observer</var> = new <a title="dom-MutationObserver" href="#dom-mutationobserver">MutationObserver</a>(<var title="">callback</var>)</code>
 <dd><p>Constructs a <code><a href="#mutationobserver">MutationObserver</a></code> object and sets its
 <a title="concept-MO-callback" href="#concept-mo-callback">callback</a> to
 <var title="">callback</var>. The <var title="">callback</var> is invoked with a
 list of <code><a href="#mutationrecord">MutationRecord</a></code> objects as first argument and the
 constructed <code><a href="#mutationobserver">MutationObserver</a></code> object as second argument. It is
 invoked after <a title="concept-node" href="#concept-node">nodes</a> registered with the
 <code title="dom-MutationObserver-observe"><a href="#dom-mutationobserver-observe">observe()</a></code> method, are
 mutated.

 <dt><code><var title="">observer</var> . <a title="dom-MutationObserver-observe" href="#dom-mutationobserver-observe">observe</a>(<var title="">target</var>, <var title="">options</var>)</code>
 <dd>
  <p>Instructs the user agent to observe a given <var title="">target</var>
  (a <a title="concept-node" href="#concept-node">node</a>) and report any mutations based on
  the criteria given by <var title="">options</var> (an object).

  <p>The <var title="">options</var> argument allows for setting mutation
  observation options via object members. These are the object members that
  can be used:

  <dl>
   <dt><code title="dom-MutationObserverInit-childList">childList</code>
   <dd><p>Set to true if mutations to <var title="">target</var>'s
   <a title="concept-tree-child" href="#concept-tree-child">children</a> are to be observed.

   <dt><code title="dom-MutationObserverInit-attributes">attributes</code>
   <dd><p>Set to true if mutations to <var title="">target</var>'s
   <a title="concept-attribute" href="#concept-attribute">attributes</a> are to be observed. Can be omitted if
   <code title="dom-MutationObserverInit-attributeOldValue">attributeOldValue</code> and/or
   <code title="dom-MutationObserverInit-attributeFilter">attributeFilter</code> is
   specified.

   <dt><code title="dom-MutationObserverInit-characterData">characterData</code>
   <dd><p>Set to true if mutations to <var title="">target</var>'s
   <a title="concept-CD-data" href="#concept-cd-data">data</a> are to be observed. Can be omitted if
   <code title="dom-MutationObserverInit-characterDataOldValue">characterDataOldValue</code>
   is specified.

   <dt><code title="dom-MutationObserverInit-subtree">subtree</code>
   <dd><p>Set to true if mutations to not just <var title="">target</var>, but
   also <var title="">target</var>'s
   <a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a> are to be
   observed.

   <dt><code title="dom-MutationObserverInit-attributeOldValue">attributeOldValue</code>
   <dd><p>Set to true if
   <code title="dom-MutationObserverInit-attributes">attributes</code> is true or omitted
   and <var title="">target</var>'s
   <a title="concept-attribute" href="#concept-attribute">attribute</a>
   <a title="concept-attribute-value" href="#concept-attribute-value">value</a> before the mutation
   needs to be recorded.

   <dt><code title="dom-MutationObserverInit-characterDataOldValue">characterDataOldValue</code>
   <dd><p>Set to true if
   <code title="dom-MutationObserverInit-characterData">characterData</code>
   is set to true or omitted and <var title="">target</var>'s
   <a title="concept-CD-data" href="#concept-cd-data">data</a> before the mutation
   needs to be recorded.

   <dt><code title="dom-MutationObserverInit-attributeFilter">attributeFilter</code>
   <dd><p>Set to a list of <a title="concept-attribute" href="#concept-attribute">attribute</a>
   <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local names</a> (without
   <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a>) if not all
   <a title="concept-attribute" href="#concept-attribute">attribute</a> mutations need to be
   observed and <code title="dom-MutationObserverInit-attributes">attributes</code> is true
   or omitted.
  </dl>

 <dt><code><var title="">observer</var> . <a title="dom-MutationObserver-disconnect" href="#dom-mutationobserver-disconnect">disconnect</a>()</code>
 <dd><p>Stops <var title="">observer</var> from observing any mutations.
 Until the <code title="dom-MutationObserver-observe"><a href="#dom-mutationobserver-observe">observe()</a></code> method
 is used again, <var title="">observer</var>'s
 <a title="concept-MO-callback" href="#concept-mo-callback">callback</a> will not be invoked.

 <dt><code><var title="">observer</var> . <a title="dom-MutationObserver-takeRecords" href="#dom-mutationobserver-takerecords">takeRecords</a>()</code>
 <dd><p>Empties the <a title="concept-MO-queue" href="#concept-mo-queue">record queue</a> and
 returns what was in there.
</dl>

<p>The
<dfn title="dom-MutationObserver" id="dom-mutationobserver"><code>MutationObserver(<var>callback</var>)</code></dfn>
constructor must create a new <code><a href="#mutationobserver">MutationObserver</a></code> object with
<a title="concept-MO-callback" href="#concept-mo-callback">callback</a> set to <var>callback</var>,
append it to the
<a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a>'s list
of <code><a href="#mutationobserver">MutationObserver</a></code> objects, and then return it.

<p>The
<dfn title="dom-MutationObserver-observe" id="dom-mutationobserver-observe"><code>observe(<var title="">target</var>, <var title="">options</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>If either <var title="">options</var>'
 <code title="dom-MutationObserverInit-attributeOldValue">attributeOldValue</code> or
 <code title="dom-MutationObserverInit-attributeFilter">attributeFilter</code> is present
 and <var title="">options</var>'
 <code title="dom-MutationObserverInit-attributes">attributes</code> is omitted, set
 <var title="">options</var>'
 <code title="dom-MutationObserverInit-attributes">attributes</code> to true.

 <li><p>If <var title="">options</var>'
 <code title="dom-MutationObserverInit-characterDataOldValue">characterDataOldValue</code>
 is present and <var title="">options</var>'
 <code title="dom-MutationObserverInit-characterData">characterData</code> is omitted, set
 <var title="">options</var>'
 <code title="dom-MutationObserverInit-characterData">characterData</code> to true.

 <li><p>If none of <var title="">options</var>'
 <code title="dom-MutationObserverInit-childList">childList</code>
 <code title="dom-MutationObserverInit-attributes">attributes</code>, and
 <code title="dom-MutationObserverInit-characterData">characterData</code> is true,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>If <var title="">options</var>'
 <code title="dom-MutationObserverInit-attributeOldValue">attributeOldValue</code> is true
 and <var title="">options</var>'
 <code title="dom-MutationObserverInit-attributes">attributes</code> is false,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>If <var title="">options</var>'
 <code title="dom-MutationObserverInit-attributeFilter">attributeFilter</code> is present
 and <var title="">options</var>'
 <code title="dom-MutationObserverInit-attributes">attributes</code> is false,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>If <var title="">options</var>'
 <code title="dom-MutationObserverInit-characterDataOldValue">characterDataOldValue</code>
 is true and <var title="">options</var>'
 <code title="dom-MutationObserverInit-characterData">characterData</code> is false,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li>
  <p>For each <a href="#registered-observer">registered observer</a> <var title="">registered</var> in
  <var title="">target</var>'s list of
  <a title="registered observer" href="#registered-observer">registered observers</a> whose <b>observer</b> is
  the <a href="#context-object">context object</a>:

  <ol>
   <li><p>Remove all
   <a title="transient registered observer" href="#transient-registered-observer">transient registered observers</a> whose
   <b>source</b> is <var title="">registered</var>.

   <li><p>Replace <var title="">registered</var>'s <b>options</b> with
   <var title="">options</var>.
  </ol>

 <li><p>Otherwise, add a new <a href="#registered-observer">registered observer</a> to
 <var title="">target</var>'s list of
 <a title="registered observer" href="#registered-observer">registered observers</a> with the
 <a href="#context-object">context object</a> as the <b>observer</b> and <var title="">options</var> as the <b>options</b>,
 and add <var title="">target</var> to <a href="#context-object">context object</a>'s list of <a title="concept-node" href="#concept-node">nodes</a> on which it is registered.
</ol>

<p>The
<dfn title="dom-MutationObserver-disconnect" id="dom-mutationobserver-disconnect"><code>disconnect()</code></dfn>
method must, for each <a title="concept-node" href="#concept-node">node</a>
<var title="">node</var> in the <a href="#context-object">context object</a>'s list of
<a title="concept-node" href="#concept-node">nodes</a>, remove any
<a href="#registered-observer">registered observer</a> on <var title="">node</var>
for which the <a href="#context-object">context object</a> is the <b>observer</b>, and also
empty <a href="#context-object">context object</a>'s
<a title="concept-MO-queue" href="#concept-mo-queue">record queue</a>.

<p>The
<dfn title="dom-MutationObserver-takeRecords" id="dom-mutationobserver-takerecords"><code>takeRecords()</code></dfn>
method must return a copy of the
<a title="concept-MO-queue" href="#concept-mo-queue">record queue</a> and then empty the
<a title="concept-MO-queue" href="#concept-mo-queue">record queue</a>.


<h4 id="queuing-a-mutation-record"><span class="secno">4.3.2 </span>Queuing a mutation record</h4>

<p>To <dfn id="queue-a-mutation-record">queue a mutation record</dfn> of <var title="">type</var> for
<var title="">target</var> with one or more of (depends on
<var title="">type</var>) name <var>name</var>, namespace
<var>namespace</var>, oldValue <var title="">oldValue</var>, addedNodes
<var title="">addedNodes</var>, removedNodes <var title="">removedNodes</var>,
previousSibling <var title="">previousSibling</var>, and nextSibling
<var title="">nextSibling</var>, run these steps:

<ol>
 <li><p>Let <var title="">interested observers</var> be an initially empty set
 of <code><a href="#mutationobserver">MutationObserver</a></code> objects optionally paired with a string.

 <li><p>Let <var title="">nodes</var> be the
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestors</a> of
 <var title="">target</var>.

 <li>
  <p>Then, for each <var title="">node</var> in <var title="">nodes</var>, and
  then for each <var title="">registered observer</var> (with
  <var title="">registered observer</var>'s <b title="">options</b> as
  <var title="">options</var>) in <var title="">node</var>'s list of
  <a title="registered observer" href="#registered-observer">registered observers</a>:

  <ol>
   <li><p>If <var title="">node</var> is not <var title="">target</var> and
   <var title="">options</var>'s <code title="">subtree</code> is false, continue.

   <li><p>If <var title="">type</var> is "<code title="">attributes</code>" and
   <var title="">options</var>'s <code title="">attributes</code> is not true, continue.
   <!--not true==false||omitted-->

   <li><p>If <var title="">type</var> is "<code title="">attributes</code>",
   <var title="">options</var>'s <code title="">attributeFilter</code> is present, and either
   <var title="">options</var>'s <code title="">attributeFilter</code> does not contain
   <var>name</var> or <var>namespace</var> is non-null, continue.

   <li><p>If <var title="">type</var> is "<code title="">characterData</code>" and
   <var title="">options</var>'s <code title="">characterData</code> is not true, continue.
   <!--not true==false||omitted-->

   <li><p>If <var title="">type</var> is "<code title="">childList</code>" and
   <var title="">options</var>'s <code title="">childList</code> is false, continue.

   <li><p>If <var title="">registered observer</var>'s <b title="">observer</b> is
   not in <var title="">interested observers</var>, append
   <var title="">registered observer</var>'s <b title="">observer</b> to
   <var title="">interested observers</var>.

   <li><p>If either <var title="">type</var> is "<code title="">attributes</code>"
   and <var title="">options</var>'s <code>attributeOldValue</code> is true, or
   <var title="">type</var> is "<code title="">characterData</code>" and
   <var title="">options</var>'s <code>characterDataOldValue</code> is true,
   set the paired string of
   <var title="">registered observer</var>'s <b title="">observer</b> in
   <var title="">interested observers</var> to <var title="">oldValue</var>.
  </ol>

 <li>
  <p>Then, for each <var title="">observer</var> in
  <var title="">interested observers</var>:

  <ol>
   <li><p>Let <var title="">record</var> be a new <code><a href="#mutationrecord">MutationRecord</a></code>
   object with its <code title="dom-MutationRecord-type"><a href="#dom-mutationrecord-type">type</a></code> set to
   <var title="">type</var> and
   <code title="dom-MutationRecord-target"><a href="#dom-mutationrecord-target">target</a></code> set to
   <var title="">target</var>.

   <li><p>If <var>name</var> and <var>namespace</var> are given,
   set <var title="">record</var>'s
   <code title="dom-MutationRecord-attributeName"><a href="#dom-mutationrecord-attributename">attributeName</a></code> to
   <var>name</var>, and <var title="">record</var>'s
   <code title="dom-MutationRecord-attributeNamespace"><a href="#dom-mutationrecord-attributenamespace">attributeNamespace</a></code>
   to <var>namespace</var>.

   <li><p>If <var title="">addedNodes</var> is given, set <var title="">record</var>'s
   <code title="dom-MutationRecord-addedNodes"><a href="#dom-mutationrecord-addednodes">addedNodes</a></code> to
   <var title="">addedNodes</var>.

   <li><p>If <var title="">removedNodes</var> is given, set <var title="">record</var>'s
   <code title="dom-MutationRecord-removedNodes"><a href="#dom-mutationrecord-removednodes">removedNodes</a></code> to
   <var title="">removedNodes</var>,

   <li><p>If <var title="">previousSibling</var> is given, set <var title="">record</var>'s
   <code title="dom-MutationRecord-previousSibling"><a href="#dom-mutationrecord-previoussibling">previousSibling</a></code> to
   <var title="">previousSibling</var>.

   <li><p>If <var title="">nextSibling</var> is given, set <var title="">record</var>'s
   <code title="dom-MutationRecord-nextSibling"><a href="#dom-mutationrecord-nextsibling">nextSibling</a></code> to
   <var title="">nextSibling</var>.

   <li><p>If <var title="">observer</var> has a paired string,
   set <var title="">record</var>'s <code title="dom-MutationRecord-oldValue"><a href="#dom-mutationrecord-oldvalue">oldValue</a></code>
   to <var title="">observer</var>'s paired string.

   <li><p>Append <var title="">record</var> to <var title="">observer</var>'s
   <a title="concept-MO-queue" href="#concept-mo-queue">record queue</a>.
  </ol>

 <li><p><a href="#queue-a-mutation-observer-compound-microtask">Queue a mutation observer compound microtask</a>.
</ol>


<h4 id="interface-mutationrecord"><span class="secno">4.3.3 </span>Interface <code><a href="#mutationrecord">MutationRecord</a></code></h4>

<pre class="idl">interface <dfn id="mutationrecord">MutationRecord</dfn> {
  readonly attribute DOMString <a title="dom-MutationRecord-type" href="#dom-mutationrecord-type">type</a>;
  readonly attribute <a href="#node">Node</a> <a title="dom-MutationRecord-target" href="#dom-mutationrecord-target">target</a>;
  [SameObject] readonly attribute <a href="#nodelist">NodeList</a> <a title="dom-MutationRecord-addedNodes" href="#dom-mutationrecord-addednodes">addedNodes</a>;
  [SameObject] readonly attribute <a href="#nodelist">NodeList</a> <a title="dom-MutationRecord-removedNodes" href="#dom-mutationrecord-removednodes">removedNodes</a>;
  readonly attribute <a href="#node">Node</a>? <a title="dom-MutationRecord-previousSibling" href="#dom-mutationrecord-previoussibling">previousSibling</a>;
  readonly attribute <a href="#node">Node</a>? <a title="dom-MutationRecord-nextSibling" href="#dom-mutationrecord-nextsibling">nextSibling</a>;
  readonly attribute DOMString? <a title="dom-MutationRecord-attributeName" href="#dom-mutationrecord-attributename">attributeName</a>;
  readonly attribute DOMString? <a title="dom-MutationRecord-attributeNamespace" href="#dom-mutationrecord-attributenamespace">attributeNamespace</a>;
  readonly attribute DOMString? <a title="dom-MutationRecord-oldValue" href="#dom-mutationrecord-oldvalue">oldValue</a>;
};</pre>

<dl class="domintro">
 <dt><code><var title="">record</var> . <a title="dom-MutationRecord-type" href="#dom-mutationrecord-type">type</a></code>
 <dd><p>Returns "<code title="">attributes</code>" if it was an
 <a title="concept-attribute" href="#concept-attribute">attribute</a> mutation.
 "<code title="">characterData</code>" if it was a mutation to a
 <code><a href="#characterdata">CharacterData</a></code> <a title="concept-node" href="#concept-node">node</a>. And
 "<code title="">childList</code>" if it was a mutation to the
 <a title="concept-tree" href="#concept-tree">tree</a> of
 <a title="concept-node" href="#concept-node">nodes</a>.

 <dt><code><var title="">record</var> . <a title="dom-MutationRecord-target" href="#dom-mutationrecord-target">target</a></code>
 <dd><p>Returns the <a title="concept-node" href="#concept-node">node</a> the mutation
 affected, depending on the <code title="dom-MutationRecord-type"><a href="#dom-mutationrecord-type">type</a></code>.
 For "<code title="">attributes</code>", it is the
 <a title="concept-element" href="#concept-element">element</a> whose
 <a title="concept-attribute" href="#concept-attribute">attribute</a> changed. For
 "<code title="">characterData</code>", it is the <code><a href="#characterdata">CharacterData</a></code>
 <a title="concept-node" href="#concept-node">node</a>. For "<code title="">childList</code>",
 it is the  <a title="concept-node" href="#concept-node">node</a> whose
 <a title="concept-tree-child" href="#concept-tree-child">children</a> changed.

 <dt><code><var title="">record</var> . <a title="dom-MutationRecord-addedNodes" href="#dom-mutationrecord-addednodes">addedNodes</a></code>
 <dt><code><var title="">record</var> . <a title="dom-MutationRecord-removedNodes" href="#dom-mutationrecord-removednodes">removedNodes</a></code>
 <dd><p>Return the <a title="concept-node" href="#concept-node">nodes</a> added and removed
 respectively.

 <dt><code><var title="">record</var> . <a title="dom-MutationRecord-previousSibling" href="#dom-mutationrecord-previoussibling">previousSibling</a></code>
 <dt><code><var title="">record</var> . <a title="dom-MutationRecord-nextSibling" href="#dom-mutationrecord-nextsibling">nextSibling</a></code>
 <dd><p>Return the <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous</a>
 and <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a> respectively
 of the added or removed <a title="concept-node" href="#concept-node">nodes</a>, and null
 otherwise.

 <dt><code><var title="">record</var> . <a title="dom-MutationRecord-attributeName" href="#dom-mutationrecord-attributename">attributeName</a></code>
 <dd><p>Returns the
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> of the
 changed <a title="concept-attribute" href="#concept-attribute">attribute</a>, and null otherwise.

 <dt><code><var title="">record</var> . <a title="dom-MutationRecord-attributeNamespace" href="#dom-mutationrecord-attributenamespace">attributeNamespace</a></code>
 <dd><p>Returns the <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a> of the
 changed <a title="concept-attribute" href="#concept-attribute">attribute</a>, and null otherwise.

 <dt><code><var title="">record</var> . <a title="dom-MutationRecord-oldValue" href="#dom-mutationrecord-oldvalue">oldValue</a></code>
 <dd><p>The return value depends on
 <code title="dom-MutationRecord-type"><a href="#dom-mutationrecord-type">type</a></code>. For
 "<code title="">attributes</code>", it is the
 <a title="concept-attribute-value" href="#concept-attribute-value">value</a> of the
 changed <a title="concept-attribute" href="#concept-attribute">attribute</a> before the change.
 For "<code title="">characterData</code>", it is the
 <a title="concept-CD-data" href="#concept-cd-data">data</a> of the changed
 <a title="concept-node" href="#concept-node">node</a> before the change. For
 "<code title="">childList</code>", it is null.
</dl>

<p>The <dfn title="dom-MutationRecord-type" id="dom-mutationrecord-type"><code>type</code></dfn> and
<dfn title="dom-MutationRecord-target" id="dom-mutationrecord-target"><code>target</code></dfn>
attributes must return the values they were initialized to.

<p>The
<dfn title="dom-MutationRecord-addedNodes" id="dom-mutationrecord-addednodes"><code>addedNodes</code></dfn> and
<dfn title="dom-MutationRecord-removedNodes" id="dom-mutationrecord-removednodes"><code>removedNodes</code></dfn>
attributes must return the values they were initialized to. Unless stated
otherwise, when a <code><a href="#mutationrecord">MutationRecord</a></code> object is created, they must
both be initialized to an empty <code><a href="#nodelist">NodeList</a></code>.

<p>The
<dfn title="dom-MutationRecord-previousSibling" id="dom-mutationrecord-previoussibling"><code>previousSibling</code></dfn>,
<dfn title="dom-MutationRecord-nextSibling" id="dom-mutationrecord-nextsibling"><code>nextSibling</code></dfn>,
<dfn title="dom-MutationRecord-attributeName" id="dom-mutationrecord-attributename"><code>attributeName</code></dfn>,
<dfn title="dom-MutationRecord-attributeNamespace" id="dom-mutationrecord-attributenamespace"><code>attributeNamespace</code></dfn>, and
<dfn title="dom-MutationRecord-oldValue" id="dom-mutationrecord-oldvalue"><code>oldValue</code></dfn>
attributes must return the values they were initialized to. Unless stated
otherwise, when a <code><a href="#mutationrecord">MutationRecord</a></code> object is created, they must
be initialized to null.

<h4 id="garbage-collection"><span class="secno">4.3.4 </span>Garbage collection</h4>

<p><a title="concept-node" href="#concept-node">Nodes</a> have a strong reference to
<a title="registered observer" href="#registered-observer">registered observers</a> in their
list of <a title="registered observer" href="#registered-observer">registered observers</a>.

<p><a title="registered observer" href="#registered-observer">Registered observers</a> in a
<a title="concept-node" href="#concept-node">node</a>'s list of
<a title="registered observer" href="#registered-observer">registered observers</a> have a weak
reference to the <a title="concept-node" href="#concept-node">node</a>.


<h3 id="interface-node"><span class="secno">4.4 </span>Interface <code><a href="#node">Node</a></code></h3>
<pre class="idl">interface <dfn id="node">Node</dfn> : <a href="#eventtarget">EventTarget</a> {
  const unsigned short <a title="dom-Node-ELEMENT_NODE" href="#dom-node-element_node">ELEMENT_NODE</a> = 1;
  const unsigned short <span title="dom-Node-ATTRIBUTE_NODE">ATTRIBUTE_NODE</span> = 2; // historical
  const unsigned short <a title="dom-Node-TEXT_NODE" href="#dom-node-text_node">TEXT_NODE</a> = 3;
  const unsigned short <span title="dom-Node-CDATA_SECTION_NODE">CDATA_SECTION_NODE</span> = 4; // historical
  const unsigned short <span title="dom-Node-ENTITY_REFERENCE_NODE">ENTITY_REFERENCE_NODE</span> = 5; // historical
  const unsigned short <span title="dom-Node-ENTITY_NODE">ENTITY_NODE</span> = 6; // historical
  const unsigned short <a title="dom-Node-PROCESSING_INSTRUCTION_NODE" href="#dom-node-processing_instruction_node">PROCESSING_INSTRUCTION_NODE</a> = 7;
  const unsigned short <a title="dom-Node-COMMENT_NODE" href="#dom-node-comment_node">COMMENT_NODE</a> = 8;
  const unsigned short <a title="dom-Node-DOCUMENT_NODE" href="#dom-node-document_node">DOCUMENT_NODE</a> = 9;
  const unsigned short <a title="dom-Node-DOCUMENT_TYPE_NODE" href="#dom-node-document_type_node">DOCUMENT_TYPE_NODE</a> = 10;
  const unsigned short <a title="dom-Node-DOCUMENT_FRAGMENT_NODE" href="#dom-node-document_fragment_node">DOCUMENT_FRAGMENT_NODE</a> = 11;
  const unsigned short <span title="dom-Node-NOTATION_NODE">NOTATION_NODE</span> = 12; // historical
  readonly attribute unsigned short <a title="dom-Node-nodeType" href="#dom-node-nodetype">nodeType</a>;<!-- NodeExodus

  readonly attribute DOMString <span title=dom-Node-namespaceURI>namespaceURI</span>;
  readonly attribute DOMString <span title=dom-Node-prefix>prefix</span>;
  readonly attribute DOMString <span title=dom-Node-localName>localName</span>;-->
  readonly attribute DOMString <a title="dom-Node-nodeName" href="#dom-node-nodename">nodeName</a>;

  readonly attribute DOMString? <a title="dom-Node-baseURI" href="#dom-node-baseuri">baseURI</a>;

  readonly attribute <a href="#document">Document</a>? <a title="dom-Node-ownerDocument" href="#dom-node-ownerdocument">ownerDocument</a>;
  readonly attribute <a href="#node">Node</a>? <a title="dom-Node-parentNode" href="#dom-node-parentnode">parentNode</a>;
  readonly attribute <a href="#element">Element</a>? <a title="dom-Node-parentElement" href="#dom-node-parentelement">parentElement</a>;
  boolean <a title="dom-Node-hasChildNodes" href="#dom-node-haschildnodes">hasChildNodes</a>();
  [SameObject] readonly attribute <a href="#nodelist">NodeList</a> <a title="dom-Node-childNodes" href="#dom-node-childnodes">childNodes</a>;
  readonly attribute <a href="#node">Node</a>? <a title="dom-Node-firstChild" href="#dom-node-firstchild">firstChild</a>;
  readonly attribute <a href="#node">Node</a>? <a title="dom-Node-lastChild" href="#dom-node-lastchild">lastChild</a>;
  readonly attribute <a href="#node">Node</a>? <a title="dom-Node-previousSibling" href="#dom-node-previoussibling">previousSibling</a>;
  readonly attribute <a href="#node">Node</a>? <a title="dom-Node-nextSibling" href="#dom-node-nextsibling">nextSibling</a>;

           attribute DOMString? <a title="dom-Node-nodeValue" href="#dom-node-nodevalue">nodeValue</a>;
           attribute DOMString? <a title="dom-Node-textContent" href="#dom-node-textcontent">textContent</a>;
  void <a title="dom-Node-normalize" href="#dom-node-normalize">normalize</a>();

  [NewObject] <a href="#node">Node</a> <a title="dom-Node-cloneNode" href="#dom-node-clonenode">cloneNode</a>(optional boolean <var title="">deep</var> = false);
  boolean <a title="dom-Node-isEqualNode" href="#dom-node-isequalnode">isEqualNode</a>(<a href="#node">Node</a>? <var title="">node</var>);

  const unsigned short <a title="dom-Node-DOCUMENT_POSITION_DISCONNECTED" href="#dom-node-document_position_disconnected">DOCUMENT_POSITION_DISCONNECTED</a> = 0x01;
  const unsigned short <a title="dom-Node-DOCUMENT_POSITION_PRECEDING" href="#dom-node-document_position_preceding">DOCUMENT_POSITION_PRECEDING</a> = 0x02;
  const unsigned short <a title="dom-Node-DOCUMENT_POSITION_FOLLOWING" href="#dom-node-document_position_following">DOCUMENT_POSITION_FOLLOWING</a> = 0x04;
  const unsigned short <a title="dom-Node-DOCUMENT_POSITION_CONTAINS" href="#dom-node-document_position_contains">DOCUMENT_POSITION_CONTAINS</a> = 0x08;
  const unsigned short <a title="dom-Node-DOCUMENT_POSITION_CONTAINED_BY" href="#dom-node-document_position_contained_by">DOCUMENT_POSITION_CONTAINED_BY</a> = 0x10;
  const unsigned short <a title="dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC" href="#dom-node-document_position_implementation_specific">DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</a> = 0x20;
  unsigned short <a title="dom-Node-compareDocumentPosition" href="#dom-node-comparedocumentposition">compareDocumentPosition</a>(<a href="#node">Node</a> <var title="">other</var>);
  boolean <a title="dom-Node-contains" href="#dom-node-contains">contains</a>(<a href="#node">Node</a>? <var title="">other</var>);

  DOMString? <a title="dom-Node-lookupPrefix" href="#dom-node-lookupprefix">lookupPrefix</a>(DOMString? <var>namespace</var>);
  DOMString? <a title="dom-Node-lookupNamespaceURI" href="#dom-node-lookupnamespaceuri">lookupNamespaceURI</a>(DOMString? <var title="">prefix</var>);
  boolean <a title="dom-Node-isDefaultNamespace" href="#dom-node-isdefaultnamespace">isDefaultNamespace</a>(DOMString? <var>namespace</var>);

  <a href="#node">Node</a> <a title="dom-Node-insertBefore" href="#dom-node-insertbefore">insertBefore</a>(<a href="#node">Node</a> <var title="">node</var>, <a href="#node">Node</a>? <var title="">child</var>);
  <a href="#node">Node</a> <a title="dom-Node-appendChild" href="#dom-node-appendchild">appendChild</a>(<a href="#node">Node</a> <var title="">node</var>);
  <a href="#node">Node</a> <a title="dom-Node-replaceChild" href="#dom-node-replacechild">replaceChild</a>(<a href="#node">Node</a> <var title="">node</var>, <a href="#node">Node</a> <var title="">child</var>);
  <a href="#node">Node</a> <a title="dom-Node-removeChild" href="#dom-node-removechild">removeChild</a>(<a href="#node">Node</a> <var title="">child</var>);
};</pre>

<p class="note"><code><a href="#node">Node</a></code> is an abstract interface and does not exist
as <a title="concept-node" href="#concept-node">node</a>. It is used by all
<a title="concept-node" href="#concept-node">nodes</a> (<code><a href="#document">Document</a></code>,
<code><a href="#documentfragment">DocumentFragment</a></code>, <code><a href="#documenttype">DocumentType</a></code>,
<code><a href="#element">Element</a></code>, <code><a href="#text">Text</a></code>, <code><a href="#processinginstruction">ProcessingInstruction</a></code>,
and <code><a href="#comment">Comment</a></code>).

<p>Each <a title="concept-node" href="#concept-node">node</a> has an associated
<dfn title="concept-node-document" id="concept-node-document">node document</dfn>, set upon creation,
that is a <a title="concept-document" href="#concept-document">document</a>.

<p class="note">A <a title="concept-node" href="#concept-node">node</a>'s
<a title="concept-node-document" href="#concept-node-document">node document</a> can be changed by
the <a title="concept-node-adopt" href="#concept-node-adopt">adopt</a> algorithm.

<p>Each <a title="concept-node" href="#concept-node">node</a> also has an associated
<dfn title="concept-node-base-url" id="concept-node-base-url">base URL</dfn>.

<p class="note">Other specifications define the value of the
<a title="concept-node-base-url" href="#concept-node-base-url">base URL</a> and its observable
behavior. This specification solely defines the concept and the
<code title="dom-Node-baseURI"><a href="#dom-node-baseuri">baseURI</a></code> attribute.

<hr>

<dl class="domintro">
 <dt><code><var title="">node</var> . <a title="dom-Node-nodeType" href="#dom-node-nodetype">nodeType</a></code>
 <dd>
  <p>Returns the type of <var title="">node</var>, represented by a number from the following list:</p>

  <dl>
   <dt><code><a href="#node">Node</a> . <a title="dom-Node-ELEMENT_NODE" href="#dom-node-element_node">ELEMENT_NODE</a></code> (1)
   <dd><var title="">node</var> is an
   <a title="concept-element" href="#concept-element">element</a>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-TEXT_NODE" href="#dom-node-text_node">TEXT_NODE</a></code> (3)
   <dd><var title="">node</var> is a <code><a href="#text">Text</a></code>
   <a title="concept-node" href="#concept-node">node</a>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-PROCESSING_INSTRUCTION_NODE" href="#dom-node-processing_instruction_node">PROCESSING_INSTRUCTION_NODE</a></code> (7)
   <dd><var title="">node</var> is a <code><a href="#processinginstruction">ProcessingInstruction</a></code>
   <a title="concept-node" href="#concept-node">node</a>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-COMMENT_NODE" href="#dom-node-comment_node">COMMENT_NODE</a></code> (8)
   <dd><var title="">node</var> is a <code><a href="#comment">Comment</a></code>
   <a title="concept-node" href="#concept-node">node</a>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-DOCUMENT_NODE" href="#dom-node-document_node">DOCUMENT_NODE</a></code> (9)
   <dd><var title="">node</var> is a
   <a title="concept-document" href="#concept-document">document</a>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-DOCUMENT_TYPE_NODE" href="#dom-node-document_type_node">DOCUMENT_TYPE_NODE</a></code> (10)
   <dd><var title="">node</var> is a
   <a title="concept-doctype" href="#concept-doctype">doctype</a>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-DOCUMENT_FRAGMENT_NODE" href="#dom-node-document_fragment_node">DOCUMENT_FRAGMENT_NODE</a></code> (11)
   <dd><var title="">node</var> is a <code><a href="#documentfragment">DocumentFragment</a></code>
   <a title="concept-node" href="#concept-node">node</a>.
  </dl>

 <dt><code><var title="">node</var> . <a title="dom-Node-nodeName" href="#dom-node-nodename">nodeName</a></code>
 <dd>
  <p>Returns a string appropriate for the type of <var title="">node</var>, as
  follows:

  <dl>
   <dt><code><a href="#element">Element</a></code>
   <dd>Its <code title="dom-Element-tagName"><a href="#dom-element-tagname">tagName</a></code> attribute value.

   <dt><code><a href="#text">Text</a></code>
   <dd>"<code title="">#text</code>".

   <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
   <dd>Its <a title="concept-PI-target" href="#concept-pi-target">target</a>.

   <dt><code><a href="#comment">Comment</a></code>
   <dd>"<code title="">#comment</code>".

   <dt><code><a href="#document">Document</a></code>
   <dd>"<code title="">#document</code>".

   <dt><code><a href="#documenttype">DocumentType</a></code>
   <dd>Its <a title="concept-doctype-name" href="#concept-doctype-name">name</a>.

   <dt><code><a href="#documentfragment">DocumentFragment</a></code>
   <dd>"<code title="">#document-fragment</code>".
  </dl>
</dl>

<p>The <dfn title="dom-Node-nodeType" id="dom-node-nodetype"><code>nodeType</code></dfn> attribute
must return the type of the node, which must be one of the following:

<ul>
 <li><dfn title="dom-Node-ELEMENT_NODE" id="dom-node-element_node"><code>ELEMENT_NODE</code></dfn> (1);

 <!--AttrExodus
 <li><dfn title=dom-Node-ATTRIBUTE_NODE><code>ATTRIBUTE_NODE</code></dfn> (2, historical);
 -->

 <li><dfn title="dom-Node-TEXT_NODE" id="dom-node-text_node"><code>TEXT_NODE</code></dfn> (3);

 <!-- XXX still questionable
 <li><dfn title=dom-Node-CDATA_SECTION_NODE><code>CDATA_SECTION_NODE</code></dfn> (4, historical);
 -->

 <li><dfn title="dom-Node-PROCESSING_INSTRUCTION_NODE" id="dom-node-processing_instruction_node"><code>PROCESSING_INSTRUCTION_NODE</code></dfn> (7);

 <li><dfn title="dom-Node-COMMENT_NODE" id="dom-node-comment_node"><code>COMMENT_NODE</code></dfn> (8);

 <li><dfn title="dom-Node-DOCUMENT_NODE" id="dom-node-document_node"><code>DOCUMENT_NODE</code></dfn> (9);

 <li><dfn title="dom-Node-DOCUMENT_TYPE_NODE" id="dom-node-document_type_node"><code>DOCUMENT_TYPE_NODE</code></dfn> (10);

 <li><dfn title="dom-Node-DOCUMENT_FRAGMENT_NODE" id="dom-node-document_fragment_node"><code>DOCUMENT_FRAGMENT_NODE</code></dfn> (11).
</ul>


<!-- NodeExodus
<hr>

<p>The <dfn title=dom-Node-namespaceURI><code>namespaceURI</code></dfn> attribute must return the namespace that is associated with the node, if there is one and it's not the empty string, and null otherwise.

<p>The <dfn title=dom-Node-prefix><code>prefix</code></dfn> attribute must return the prefix that is associated with the node, if there is one and it's not the empty string, and null otherwise.
<!- - support setting? - - On setting, it must run these steps:

<ol>
 <li><p>Let <var title>prefix</var> be the value being assigned.
 <li>
  <p>If <var title>prefix</var> is not null, run these substeps:
  <ol>
   <li><p>If <var title>prefix</var> does not match the
   <code data-anolis-spec=xml>Name</code> production in XML,
   <span data-anolis-spec=webidl>throw</span> an
   <code title>InvalidCharacterError</code> exception.
   <li><p>If <var title>prefix</var> does not match the <code
   data-anolis-spec=xmlns>NCName</code> production in Namespaces in XML, <span data-anolis-spec=webidl>throw</span> a
   <code title>NamespaceError</code> exception.
  </ol>
 <li><p>Actually this does not match any browser. Let's try to drop it instead.
</ol>- ->

<p>The <dfn title=dom-Node-localName><code>localName</code></dfn> attribute
must return the local name that is associated with the node, if it has one,
and null otherwise.-->

<p>The <dfn title="dom-Node-nodeName" id="dom-node-nodename"><code>nodeName</code></dfn> attribute
must return the following, depending on the <a href="#context-object">context object</a>:

<dl class="switch">
 <dt><code><a href="#element">Element</a></code>
 <dd><p>Its <code title="dom-Element-tagName"><a href="#dom-element-tagname">tagName</a></code> attribute value.

 <!--AttrExodus
 <dt><code>Attr</code>
 <dd><p>The <span>context object</span>'s
 <code title=dom-Attr-name>name</code> attribute.
 -->

 <dt><code><a href="#text">Text</a></code>
 <dd><p>"<code title="">#text</code>".

 <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
 <dd><p>Its <a title="concept-PI-target" href="#concept-pi-target">target</a>.

 <dt><code><a href="#comment">Comment</a></code>
 <dd><p>"<code title="">#comment</code>".

 <dt><code><a href="#document">Document</a></code>
 <dd><p>"<code title="">#document</code>".

 <dt><code><a href="#documenttype">DocumentType</a></code>
 <dd><p>Its <a title="concept-doctype-name" href="#concept-doctype-name">name</a>.

 <dt><code><a href="#documentfragment">DocumentFragment</a></code>
 <dd><p>"<code title="">#document-fragment</code>".
</dl>

<hr>

<dl class="domintro">
 <dt><code><var title="">node</var> . <a title="dom-Node-baseURI" href="#dom-node-baseuri">baseURI</a></code>
 <dd><p>Returns the <a title="concept-node-base-url" href="#concept-node-base-url">base URL</a>.
</dl>

<p>The <dfn title="dom-Node-baseURI" id="dom-node-baseuri"><code>baseURI</code></dfn> attribute must return the associated <a title="concept-node-base-url" href="#concept-node-base-url">base URL</a>.

<hr>

<dl class="domintro">
 <dt><code><var title="">node</var> . <a title="dom-Node-ownerDocument" href="#dom-node-ownerdocument">ownerDocument</a></code>
 <dd>
  <p>Returns the <a title="concept-node-document" href="#concept-node-document">node document</a>.
  <p>Returns null for <a title="concept-document" href="#concept-document">documents</a>.

 <dt><code><var title="">node</var> . <a title="dom-Node-parentNode" href="#dom-node-parentnode">parentNode</a></code>
 <dd><p>Returns the <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <dt><code><var title="">node</var> . <a title="dom-Node-parentElement" href="#dom-node-parentelement">parentElement</a></code>
 <dd><p>Returns the <a href="#parent-element">parent element</a>.

 <dt><code><var title="">node</var> . <a title="dom-Node-hasChildNodes" href="#dom-node-haschildnodes">hasChildNodes()</a></code>
 <dd><p>Returns whether <var title="">node</var> has
 <a title="concept-tree-child" href="#concept-tree-child">children</a>.

 <dt><code><var title="">node</var> . <a title="dom-Node-childNodes" href="#dom-node-childnodes">childNodes</a></code>
 <dd><p>Returns the <a title="concept-tree-child" href="#concept-tree-child">children</a>.

 <dt><code><var title="">node</var> . <a title="dom-Node-firstChild" href="#dom-node-firstchild">firstChild</a></code>
 <dd><p>Returns the <a title="concept-tree-first-child" href="#concept-tree-first-child">first child</a>.

 <dt><code><var title="">node</var> . <a title="dom-Node-lastChild" href="#dom-node-lastchild">lastChild</a></code>
 <dd><p>Returns the <a title="concept-tree-last-child" href="#concept-tree-last-child">last child</a>.

 <dt><code><var title="">node</var> . <a title="dom-Node-previousSibling" href="#dom-node-previoussibling">previousSibling</a></code>
 <dd><p>Returns the
 <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a>.

 <dt><code><var title="">node</var> . <a title="dom-Node-nextSibling" href="#dom-node-nextsibling">nextSibling</a></code>
 <dd><p>Returns the
 <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>.
</dl>

<div class="impl">

<p>The <dfn title="dom-Node-ownerDocument" id="dom-node-ownerdocument"><code>ownerDocument</code></dfn>
attribute must run these steps:
<ol>
 <li>If the <a href="#context-object">context object</a> is a
 <a title="concept-document" href="#concept-document">document</a>, return null.

 <li>Return the <a title="concept-node-document" href="#concept-node-document">node document</a>.
</ol>

<div class="note">
<p>The <a title="concept-node-document" href="#concept-node-document">node document</a> of a
<a title="concept-document" href="#concept-document">document</a> is that
<a title="concept-document" href="#concept-document">document</a> itself.
<p>All <a title="concept-node" href="#concept-node">nodes</a> have a
<a title="concept-document" href="#concept-document">document</a> at all times.
</div>

<p>The <dfn title="dom-Node-parentNode" id="dom-node-parentnode"><code>parentNode</code></dfn>
attribute must return the <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.
<!-- AttrExodus
<li><p>If the <span>context object</span> is an <code>Attr</code> node,
return null.
-->

<p>The <dfn title="dom-Node-parentElement" id="dom-node-parentelement"><code>parentElement</code></dfn>
attribute must return the <a href="#parent-element">parent element</a>.

<p>The <dfn title="dom-Node-hasChildNodes" id="dom-node-haschildnodes"><code>hasChildNodes()</code></dfn>
method must return true if the <a href="#context-object">context object</a> has
<a title="concept-tree-child" href="#concept-tree-child">children</a>, and false otherwise.

<p>The <dfn title="dom-Node-childNodes" id="dom-node-childnodes"><code>childNodes</code></dfn>
attribute must return a <code><a href="#nodelist">NodeList</a></code> rooted at the
<a href="#context-object">context object</a> matching only
<a title="concept-tree-child" href="#concept-tree-child">children</a>.

<p>The <dfn title="dom-Node-firstChild" id="dom-node-firstchild"><code>firstChild</code></dfn>
attribute must return the
<a title="concept-tree-first-child" href="#concept-tree-first-child">first child</a>.

<p>The <dfn title="dom-Node-lastChild" id="dom-node-lastchild"><code>lastChild</code></dfn> attribute must return the <a title="concept-tree-last-child" href="#concept-tree-last-child">last child</a>.

<p>The
<dfn title="dom-Node-previousSibling" id="dom-node-previoussibling"><code>previousSibling</code></dfn>
attribute must return the
<a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a>.
<!-- AttrExodus
 <li><p>If the <span>context object</span> is an <code>Attr</code> node,
 return null.
-->

<p>The <dfn title="dom-Node-nextSibling" id="dom-node-nextsibling"><code>nextSibling</code></dfn>
attribute must return the
<a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>.
<!-- AttrExodus
 <li><p>If the <span>context object</span> is an <code>Attr</code> node,
 return null.
-->

</div>

<hr>

<!-- TODO: domintro -->

<p>The <dfn title="dom-Node-nodeValue" id="dom-node-nodevalue"><code>nodeValue</code></dfn> attribute
must return the following, depending on the <a href="#context-object">context object</a>:

<dl class="switch">
 <!--AttrExodus <dt><code>Attr</code> -->
 <dt><code><a href="#text">Text</a></code>
 <dt><code><a href="#comment">Comment</a></code>
 <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
 <dd><p>The <a href="#context-object">context object</a>'s
 <a title="concept-CD-data" href="#concept-cd-data">data</a>.

 <dt>Any other node
 <dd><p>Null.
</dl>

<p>The <code title="dom-Node-nodeValue"><a href="#dom-node-nodevalue">nodeValue</a></code> attribute must,
on setting, if the new value is null, act as if it was the empty string
instead, and then do as described below, depending on the <a href="#context-object">context object</a>:

<dl class="switch">
 <!--AttrExodus <dt><code>Attr</code> -->
 <dt><code><a href="#text">Text</a></code>
 <dt><code><a href="#comment">Comment</a></code>
 <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
 <dd><p><a title="concept-CD-replace" href="#concept-cd-replace">Replace data</a> with node
 <a href="#context-object">context object</a>, offset 0, count
 <code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute value, and
 data new value.

 <dt>Any other node
 <dd><p>Do nothing.
</dl>

<p>The <dfn title="dom-Node-textContent" id="dom-node-textcontent"><code>textContent</code></dfn>
attribute must return the following, depending on the
<a href="#context-object">context object</a>:

<dl class="switch">
 <dt><code><a href="#documentfragment">DocumentFragment</a></code>
 <dt><code><a href="#element">Element</a></code>
 <!--AttrExodus <dt><code>Attr</code> -->
 <dd><p>The concatenation of <a title="concept-CD-data" href="#concept-cd-data">data</a> of all
 the <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>
 <a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a> of the
 <a href="#context-object">context object</a>, in
 <a title="concept-tree-order" href="#concept-tree-order">tree order</a>.

 <dt><code><a href="#text">Text</a></code>
 <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
 <dt><code><a href="#comment">Comment</a></code>
 <dd><p>The <a href="#context-object">context object</a>'s
 <a title="concept-CD-data" href="#concept-cd-data">data</a>.

 <dt>Any other node
 <dd><p>Null.
</dl>

<p>The <code title="dom-Node-textContent"><a href="#dom-node-textcontent">textContent</a></code> attribute must,
on setting, if the new value is null, act as if it was the empty string
instead, and then do as described below, depending on the <a href="#context-object">context object</a>:

<dl class="switch">
 <dt><code><a href="#documentfragment">DocumentFragment</a></code>
 <dt><code><a href="#element">Element</a></code>
 <!--AttrExodus <dt><code>Attr</code> -->
 <dd>
  <ol>
   <li><p>Let <var title="">node</var> be null.

   <li><p>If new value is not the empty string, set <var title="">node</var> to
   a new <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a> whose
   <a title="concept-CD-data" href="#concept-cd-data">data</a> is new value.

   <li><p><a title="concept-node-replace-all" href="#concept-node-replace-all">Replace all</a> with
   <var title="">node</var> within the <a href="#context-object">context object</a>.
  </ol>

 <dt><code><a href="#text">Text</a></code>
 <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
 <dt><code><a href="#comment">Comment</a></code>
 <dd><p><a title="concept-CD-replace" href="#concept-cd-replace">Replace data</a> with node
 <a href="#context-object">context object</a>, offset 0, count
 <code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute value, and
 data new value.

 <dt>Any other node
 <dd><p>Do nothing.
</dl>

<hr>

<dl class="domintro">
 <dt><code><var title="">node</var> . <a title="dom-Node-normalize" href="#dom-node-normalize">normalize</a>()</code>
 <dd><p>Removes <a title="concept-node-empty" href="#concept-node-empty">empty</a>
 <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">nodes</a> and concatenates
 the <a title="concept-CD-data" href="#concept-cd-data">data</a> of remaining
 <a href="#contiguous-text-nodes">contiguous <code>Text</code> nodes</a> into the first of their
 <a title="concept-node" href="#concept-node">nodes</a>.
</dl>

<p>The <dfn title="dom-Node-normalize" id="dom-node-normalize"><code>normalize()</code></dfn> method
must run these steps:</p>

<p>For each <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>
<a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a> of the
<a href="#context-object">context object</a>:

<ol>
 <li><p>Let <var title="">node</var> be the <code><a href="#text">Text</a></code>
 <a title="concept-node" href="#concept-node">node</a>
 <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>.

 <li><p>Let <var title="">length</var> be <var title="">node</var>'s
 <code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute value.

 <li><p>If <var title="">length</var> is zero,
 <a title="concept-node-remove" href="#concept-node-remove">remove</a> <var title="">node</var> and
 continue with the next <code><a href="#text">Text</a></code>
 <a title="concept-node" href="#concept-node">node</a>, if any.

 <li><p>Let <var title="">data</var> be the concatenation of the
 <a title="concept-CD-data" href="#concept-cd-data">data</a> of <var title="">node</var>'s
 <a href="#contiguous-text-nodes">contiguous <code>Text</code> nodes</a> (excluding itself), in
 <a title="concept-tree-order" href="#concept-tree-order">tree order</a>.

 <li><p><a title="concept-CD-replace" href="#concept-cd-replace">Replace data</a> with node
 <var title="">node</var>, offset <var title="">length</var>,
 count 0, and data <var title="">data</var>.

 <li><p>Let <var title="">current node</var> be <var title="">node</var>'s
 <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>.

 <li><p>While <var title="">current node</var> is a <code><a href="#text">Text</a></code> node:

 <ol>
  <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
  <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
  <var title="">current node</var>, add <var title="">length</var> to its
  <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> and set its
  <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> to
  <var title="">node</var>.

  <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is
  <var title="">current node</var>, add <var title="">length</var> to its
  <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> and set its
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> to
  <var title="">node</var>.

  <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
  <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
  <var title="">current node</var>'s
  <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> and
  <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> is
  <var title="">current node</var>'s
  <a title="concept-tree-index" href="#concept-tree-index">index</a>, set its
  <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> to
  <var title="">node</var> and its
  <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> to
  <var title="">length</var>.

  <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is
  <var title="">current node</var>'s
  <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> and
  <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> is
  <var title="">current node</var>'s
  <a title="concept-tree-index" href="#concept-tree-index">index</a>, set its
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> to
  <var title="">node</var> and its
  <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> to
  <var title="">length</var>.

  <li><p>Add <var title="">current node</var>'s
  <code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute value to
  <var title="">length</var>.

  <li><p>Set <var title="">current node</var> to its
  <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>.
 </ol>

 <li><p><a title="concept-node-remove" href="#concept-node-remove">Remove</a>
 <var title="">node</var>'s
 <a href="#contiguous-text-nodes">contiguous <code>Text</code> nodes</a> (excluding itself), in
 <a title="concept-tree-order" href="#concept-tree-order">tree order</a>.
</ol>

<hr>

<dl class="domintro">
 <dt><code><var title="">node</var> . <a title="dom-Node-cloneNode" href="#dom-node-clonenode">cloneNode</a>([<var title="">deep</var> = false])</code>
 <dd><p>Returns a copy of <var title="">node</var>. If
 <var title="">deep</var> is true, the copy also includes the
 <var title="">node</var>'s <a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a>.

 <dt><code><var title="">node</var> . <a title="dom-Node-isEqualNode" href="#dom-node-isequalnode">isEqualNode</a>(<var title="">other</var>)</code>
 <dd><p>Returns whether <var title="">node</var> and <var title="">other</var>
 have the same properties.
</dl>

<div class="impl">

<p><a title="Other applicable specifications" href="#other-applicable-specifications">Specifications</a> may define
<dfn title="concept-node-clone-ext" id="concept-node-clone-ext">cloning steps</dfn> for all or some
<a title="concept-node" href="#concept-node">nodes</a>. The algorithm is passed <var title="">copy</var>,
<var title="">node</var>, <var title="">document</var>, and optionally a
<i title="">clone children flag</i>, as indicated in the
<a title="concept-node-clone" href="#concept-node-clone">clone</a> algorithm.

<p class="note no-backref">HTML defines
<a title="concept-node-clone-ext" href="#concept-node-clone-ext">cloning steps</a> for
<code data-anolis-spec="html" class="external"><a href="https://html.spec.whatwg.org/multipage/scripting.html#the-script-element">script</a></code> and
<code data-anolis-spec="html" class="external"><a href="https://html.spec.whatwg.org/multipage/forms.html#the-input-element">input</a></code> elements. SVG ought to do the same
for its <code title="">script</code> elements, but does not call this out at
the moment.

<p>To <dfn title="concept-node-clone" id="concept-node-clone">clone</dfn> a <var title="">node</var>,
optionally with a <var title="">document</var> and a <i title="">clone children flag</i>, run
these steps:
<!-- This algorithm is used by dom-Node-cloneNode, dom-Document-importNode,
dom-Range-extractContents, dom-Range-cloneContents -->

<ol>
 <li><p>If <var title="">document</var> is not given, let <var title="">document</var> be
 <var title="">node</var>'s <a title="concept-node-document" href="#concept-node-document">node document</a>.

 <li><p>Let <var title="">copy</var> be a <a title="concept-node" href="#concept-node">node</a>
 that implements the same interfaces as <var title="">node</var>.

 <li>
  <p>If <var title="">copy</var> is a
  <a title="concept-document" href="#concept-document">document</a>, set its
  <a title="concept-node-document" href="#concept-node-document">node document</a> and
  <var title="">document</var> to <var title="">copy</var>.
  <p>Otherwise, set <var title="">copy</var>'s
  <a title="concept-node-document" href="#concept-node-document">node document</a> to
  <var title="">document</var>.

 <li>
  <p>Copy the following from <var title="">node</var> to <var title="">copy</var>, depending on
  the type of <var title="">node</var>:
  <dl class="switch">
   <dt><code><a href="#document">Document</a></code>
   <dd><p>Its <a title="concept-document-encoding" href="#concept-document-encoding">encoding</a>,
   <a title="concept-document-content-type" href="#concept-document-content-type">content type</a>,
   <a title="concept-document-url" href="#concept-document-url">URL</a>, its mode
   (<a title="concept-document-quirks" href="#concept-document-quirks">quirks mode</a>,
   <a title="concept-document-limited-quirks" href="#concept-document-limited-quirks">limited quirks mode</a>, or
   <a title="concept-document-no-quirks" href="#concept-document-no-quirks">no-quirks mode</a>), and its type
   (<a href="#xml-document">XML document</a> or <a href="#html-document">HTML document</a>).

   <dt><code><a href="#documenttype">DocumentType</a></code>
   <dd><p>Its <a title="concept-doctype-name" href="#concept-doctype-name">name</a>,
   <a title="concept-doctype-publicid" href="#concept-doctype-publicid">public ID</a>, and
   <a title="concept-doctype-systemid" href="#concept-doctype-systemid">system ID</a>.

   <dt><code><a href="#element">Element</a></code>
   <dd><p>Its <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a>,
   <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a>,
   <a title="concept-element-local-name" href="#concept-element-local-name">local name</a>, and its
   <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>.

   <!--AttrExodus
   <dt><code>Attr</code>
   <dd><p><code title=dom-Attr-value>value</code>
   -->

   <dt><code><a href="#text">Text</a></code>
   <dt><code><a href="#comment">Comment</a></code>
   <dd><p>Its <a title="concept-CD-data" href="#concept-cd-data">data</a>.

   <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
   <dd><p>Its <a title="concept-PI-target" href="#concept-pi-target">target</a> and
   <a title="concept-CD-data" href="#concept-cd-data">data</a>.

   <dt>Any other node
   <dd><p>—
  </dl>

 <li><p>Run any <a title="concept-node-clone-ext" href="#concept-node-clone-ext">cloning steps</a>
 defined for <var title="">node</var> in <a href="#other-applicable-specifications">other applicable specifications</a> and
 pass <var title="">copy</var>, <var title="">node</var>, <var title="">document</var> and the
 <i title="">clone children flag</i> if set, as parameters.

 <li><p>If the <i title="">clone children flag</i> is set,
 <a title="concept-node-clone" href="#concept-node-clone">clone</a> all the
 <a title="concept-tree-child" href="#concept-tree-child">children</a> of <var title="">node</var> and
 append them to <var title="">copy</var>, with <var title="">document</var>
 as specified and the <i title="">clone children flag</i> being set.

 <li><p>Return <var title="">copy</var>.
</ol>

<p>The
<dfn title="dom-Node-cloneNode" id="dom-node-clonenode"><code>cloneNode(<var title="">deep</var>)</code></dfn>
method must return a <a title="concept-node-clone" href="#concept-node-clone">clone</a> of the
<a href="#context-object">context object</a>, with the <i title="">clone children flag</i> set
if <var title="">deep</var> is true.

<p>A <a title="concept-node" href="#concept-node">node</a> <var title="">A</var>
<dfn title="concept-node-equals" id="concept-node-equals">equals</dfn> a <a title="concept-node" href="#concept-node">node</a>
<var title="">B</var> if all of the following conditions are true:

<ul>
 <li><p><var title="">A</var> and <var title="">B</var>'s
 <code title="dom-Node-nodeType"><a href="#dom-node-nodetype">nodeType</a></code> attribute value is identical.
 <li>
  <p>The following are also equal, depending on <var title="">A</var>:
  <dl class="switch">
   <dt><code><a href="#documenttype">DocumentType</a></code>
   <dd><p>Its <a title="concept-doctype-name" href="#concept-doctype-name">name</a>,
   <a title="concept-doctype-publicid" href="#concept-doctype-publicid">public ID</a>, and
   <a title="concept-doctype-systemid" href="#concept-doctype-systemid">system ID</a>.

   <dt><code><a href="#element">Element</a></code>
   <dd>
    <p>Its <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a>,
    <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a>,
    <a title="concept-element-local-name" href="#concept-element-local-name">local name</a>, and its
    number of <a title="concept-attribute" href="#concept-attribute">attributes</a> in its
    <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>.

   <!--AttrExodus
   <dt><code>Attr</code>
   <dd><p><code title=dom-Attr-value>value</code>
   -->

   <dt><code><a href="#processinginstruction">ProcessingInstruction</a></code>
   <dd><p>Its <a title="concept-PI-target" href="#concept-pi-target">target</a> and
   <a title="concept-CD-data" href="#concept-cd-data">data</a>.

   <dt><code><a href="#text">Text</a></code>
   <dt><code><a href="#comment">Comment</a></code>
   <dd><p>Its <a title="concept-CD-data" href="#concept-cd-data">data</a>.

   <dt>Any other node
   <dd><p>—
  </dl>
 <li><p>If <var title="">A</var> is an <a title="concept-element" href="#concept-element">element</a>, each
 <a title="concept-attribute" href="#concept-attribute">attribute</a> in its
 <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a> has an
 <a title="concept-attribute" href="#concept-attribute">attribute</a> with the same
 <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a>,
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>, and
 <a title="concept-attribute-value" href="#concept-attribute-value">value</a> in <var title="">B</var>'s
 <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>.
 <li><p><var title="">A</var> and <var title="">B</var> have the same number of
 <a title="concept-tree-child" href="#concept-tree-child">children</a>.
 <li><p>Each <a title="concept-tree-child" href="#concept-tree-child">child</a> of <var title="">A</var>
 <a title="concept-node-equals" href="#concept-node-equals">equals</a> the
 <a title="concept-tree-child" href="#concept-tree-child">child</a> of <var title="">B</var> at the identical
 <a title="concept-tree-index" href="#concept-tree-index">index</a>.
</ul>

<p>The
<dfn title="dom-Node-isEqualNode" id="dom-node-isequalnode"><code>isEqualNode(<var title="">node</var>)</code></dfn>
method must return true if <var title="">node</var> is not null and
<a href="#context-object">context object</a> <a title="concept-node-equals" href="#concept-node-equals">equals</a>
<var title="">node</var>, and false otherwise.

</div>

<hr>

<dl class="domintro">
 <dt><code><var title="">node</var> . <a title="dom-Node-compareDocumentPosition" href="#dom-node-comparedocumentposition">compareDocumentPosition</a>(<var title="">other</var>)</code>
 <dd>
  <p>Returns a bitmask indicating the position of <var title="">other</var>
  relative to <var title="">node</var>. These are the bits that can be set:

  <dl>
   <dt><code><a href="#node">Node</a> . <a title="dom-Node-DOCUMENT_POSITION_DISCONNECTED" href="#dom-node-document_position_disconnected">DOCUMENT_POSITION_DISCONNECTED</a></code> (1)
   <dd>Set when <var title="">node</var> and <var>other</var> are not in the
   same <a title="concept-tree" href="#concept-tree">tree</a>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-DOCUMENT_POSITION_PRECEDING" href="#dom-node-document_position_preceding">DOCUMENT_POSITION_PRECEDING</a></code> (2)
   <dd>Set when <var title="">other</var> is
   <a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a>
   <var title="">node</var>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-DOCUMENT_POSITION_FOLLOWING" href="#dom-node-document_position_following">DOCUMENT_POSITION_FOLLOWING</a></code> (4)
   <dd>Set when <var title="">other</var> is
   <a title="concept-tree-following" href="#concept-tree-following">following</a>
   <var title="">node</var>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-DOCUMENT_POSITION_CONTAINS" href="#dom-node-document_position_contains">DOCUMENT_POSITION_CONTAINS</a></code> (8)
   <dd>Set when <var title="">other</var> is an
   <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestor</a> of
   <var title="">node</var>.

   <dt><code><a href="#node">Node</a> . <a title="dom-Node-DOCUMENT_POSITION_CONTAINED_BY" href="#dom-node-document_position_contained_by">DOCUMENT_POSITION_CONTAINED_BY</a></code> (16, 10 in hexadecimal)
   <dd>Set when <var title="">other</var> is a
   <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a> of
   <var title="">node</var>.
  </dl>

 <dt><code><var title="">node</var> . <a title="dom-Node-contains" href="#dom-node-contains">contains</a>(<var title="">other</var>)</code>
 <dd><p>Returns true if <var title="">other</var> is an
 <a title="concept-tree-inclusive-descendant" href="#concept-tree-inclusive-descendant">inclusive descendant</a>
 of <var title="">node</var>, and false otherwise.
</dl>

<p>These are the constants
<code title="dom-Node-compareDocumentPosition"><a href="#dom-node-comparedocumentposition">compareDocumentPosition()</a></code>
returns as mask:

<ul class="brief">
 <li><dfn title="dom-Node-DOCUMENT_POSITION_DISCONNECTED" id="dom-node-document_position_disconnected"><code>DOCUMENT_POSITION_DISCONNECTED</code></dfn> (1);
 <li><dfn title="dom-Node-DOCUMENT_POSITION_PRECEDING" id="dom-node-document_position_preceding"><code>DOCUMENT_POSITION_PRECEDING</code></dfn> (2);
 <li><dfn title="dom-Node-DOCUMENT_POSITION_FOLLOWING" id="dom-node-document_position_following"><code>DOCUMENT_POSITION_FOLLOWING</code></dfn> (4);
 <li><dfn title="dom-Node-DOCUMENT_POSITION_CONTAINS" id="dom-node-document_position_contains"><code>DOCUMENT_POSITION_CONTAINS</code></dfn> (8);
 <li><dfn title="dom-Node-DOCUMENT_POSITION_CONTAINED_BY" id="dom-node-document_position_contained_by"><code>DOCUMENT_POSITION_CONTAINED_BY</code></dfn> (16, 10 in hexadecimal);
 <li><dfn title="dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC" id="dom-node-document_position_implementation_specific"><code>DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</code></dfn> (32, 20 in hexadecimal).
</ul>

<p>The <dfn title="dom-Node-compareDocumentPosition" id="dom-node-comparedocumentposition"><code>compareDocumentPosition(<var>other</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">reference</var> be the <a href="#context-object">context object</a>.
 <li><p>If <var title="">other</var> and <var title="">reference</var> are the
 same object, return zero.

 <li>
  <p>If <var title="">other</var> and <var title="">reference</var> are not
  in the same <a title="concept-tree" href="#concept-tree">tree</a>, return the result of
  adding
  <code title="dom-Node-DOCUMENT_POSITION_DISCONNECTED"><a href="#dom-node-document_position_disconnected">DOCUMENT_POSITION_DISCONNECTED</a></code>,
  <code title="dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC"><a href="#dom-node-document_position_implementation_specific">DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</a></code>,
  and either
  <code title="dom-Node-DOCUMENT_POSITION_PRECEDING"><a href="#dom-node-document_position_preceding">DOCUMENT_POSITION_PRECEDING</a></code> or
  <code title="dom-Node-DOCUMENT_POSITION_FOLLOWING"><a href="#dom-node-document_position_following">DOCUMENT_POSITION_FOLLOWING</a></code>,
  with the constraint that this is to be consistent, together.

  <p class="note">Whether to return
  <code title="dom-Node-DOCUMENT_POSITION_PRECEDING"><a href="#dom-node-document_position_preceding">DOCUMENT_POSITION_PRECEDING</a></code> or
  <code title="dom-Node-DOCUMENT_POSITION_FOLLOWING"><a href="#dom-node-document_position_following">DOCUMENT_POSITION_FOLLOWING</a></code>
  is typically implemented via pointer comparison. In JavaScript
  implementations <code title="">Math.random()</code> can be used.

 <li><p>If <var title="">other</var> is an
 <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestor</a> of
 <var title="">reference</var>, return the result of adding
 <code title="dom-Node-DOCUMENT_POSITION_CONTAINS"><a href="#dom-node-document_position_contains">DOCUMENT_POSITION_CONTAINS</a></code>
 to
 <code title="dom-Node-DOCUMENT_POSITION_PRECEDING"><a href="#dom-node-document_position_preceding">DOCUMENT_POSITION_PRECEDING</a></code>.

 <li><p>If <var title="">other</var> is a
 <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a> of
 <var title="">reference</var>, return the result of adding
 <code title="dom-Node-DOCUMENT_POSITION_CONTAINED_BY"><a href="#dom-node-document_position_contained_by">DOCUMENT_POSITION_CONTAINED_BY</a></code>
 to
 <code title="dom-Node-DOCUMENT_POSITION_FOLLOWING"><a href="#dom-node-document_position_following">DOCUMENT_POSITION_FOLLOWING</a></code>.

 <li><p>If <var title="">other</var> is
 <a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a>
 <var title="">reference</var> return
 <code title="dom-Node-DOCUMENT_POSITION_PRECEDING"><a href="#dom-node-document_position_preceding">DOCUMENT_POSITION_PRECEDING</a></code>.

 <li><p>Return
 <code title="dom-Node-DOCUMENT_POSITION_FOLLOWING"><a href="#dom-node-document_position_following">DOCUMENT_POSITION_FOLLOWING</a></code>.
</ol>

<!-- AttrExodus compareDocumentPosition() works differently if Attr inherits
     from Node -->

<p>The
<dfn title="dom-Node-contains" id="dom-node-contains"><code>contains(<var title="">other</var>)</code></dfn>
method must return true if <var title="">other</var> is an
<a title="concept-tree-inclusive-descendant" href="#concept-tree-inclusive-descendant">inclusive descendant</a> of
the <a href="#context-object">context object</a>, and false otherwise (including when
<var title="">other</var> is null).

<hr>

<!-- TODO: domintro -->

<!--
 XXX apparently these algorithms might not be quite correct
 https://bugzilla.mozilla.org/show_bug.cgi?id=312019
 https://bugzilla.mozilla.org/show_bug.cgi?id=505178
-->

<p>To <dfn id="locate-a-namespace-prefix">locate a namespace prefix</dfn> for an <var title="">element</var> using
<var>namespace</var> run these steps:

<ol>
 <li><p>If <var title="">element</var>'s
 <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> is
 <var>namespace</var> and its
 <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a> is not
 null, return its
 <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a>.

 <li><p>If, <var title="">element</var>
 <a title="concept-element-attribute-has" href="#concept-element-attribute-has">has</a> an
 <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
 <a title="concept-attribute-namespace-prefix" href="#concept-attribute-namespace-prefix">namespace prefix</a> is
 "<code title="">xmlns</code>" and
 <a title="concept-attribute-value" href="#concept-attribute-value">value</a> is
 <var>namespace</var>, then return <var title="">element</var>'s first
 such <a title="concept-attribute" href="#concept-attribute">attribute</a>'s
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>.

 <li><p>If <var title="">element</var>'s <a href="#parent-element">parent element</a> is not null,
 return the result of running <a href="#locate-a-namespace-prefix">locate a namespace prefix</a> on that
 <a title="concept-element" href="#concept-element">element</a> using <var>namespace</var>.
 Otherwise, return null.
</ol>

<p>To <dfn id="locate-a-namespace">locate a namespace</dfn> for a <var title="">node</var> using
<var title="">prefix</var> depends on <var title="">node</var>:

<dl class="switch">
 <dt><code><a href="#element">Element</a></code>
 <dd>
  <ol>
   <li><p>If its <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> is
   not null and its
   <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a> is
   <var title="">prefix</var>, return
   <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a>.

   <li>
    <p>If it <a title="concept-element-attribute-has" href="#concept-element-attribute-has">has</a> an
    <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
    <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a> is the
    <a href="#xmlns-namespace">XMLNS namespace</a>,
    <a title="concept-attribute-namespace-prefix" href="#concept-attribute-namespace-prefix">namespace prefix</a>
    is "<code title="">xmlns</code>" and
    <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is
    <var title="">prefix</var>, or if <var title="">prefix</var> is null and it
    <a title="concept-element-attribute-has" href="#concept-element-attribute-has">has</a> an
    <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
    <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a> is the
    <a href="#xmlns-namespace">XMLNS namespace</a>,
    <a title="concept-attribute-namespace-prefix" href="#concept-attribute-namespace-prefix">namespace prefix</a>
    is null and <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>
    is "<code title="">xmlns</code>":

    <ol>
     <li><p>Let <var title="">value</var> be its
     <a title="concept-attribute-value" href="#concept-attribute-value">value</a> if it is not the empty
     string, and null otherwise.

     <li><p>Return <var title="">value</var>.
    </ol>

   <li><p>If its <a href="#parent-element">parent element</a> is null, return null.

   <li><p>Return the result of running <a href="#locate-a-namespace">locate a namespace</a> on
   its <a href="#parent-element">parent element</a> using <var title="">prefix</var>.
  </ol>

 <!--AttrExodus <code>Attr</code> -->
 <dt><code><a href="#document">Document</a></code>
 <dd>
  <ol>
   <li><p>If its <a href="#document-element">document element</a> is null, return null.

   <li><p>Return the result of running <a href="#locate-a-namespace">locate a namespace</a> on
   its <a href="#document-element">document element</a> using <var title="">prefix</var>.
  </ol>

 <dt><code><a href="#documenttype">DocumentType</a></code>
 <dt><code><a href="#documentfragment">DocumentFragment</a></code>
 <dd><p>Return null.

 <dt>Any other node
 <dd>
  <ol>
   <li><p>If its <a href="#parent-element">parent element</a> is null, return null.

   <li><p>Return the result of running <a href="#locate-a-namespace">locate a namespace</a> on
   its <a href="#parent-element">parent element</a> using <var title="">prefix</var>.
  </ol>
</dl>

<p>The
<dfn title="dom-Node-lookupPrefix" id="dom-node-lookupprefix"><code>lookupPrefix(<var>namespace</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var>namespace</var> is null or the empty string, return null.

 <li>
  <p>Otherwise it depends on the <a href="#context-object">context object</a>:

  <dl class="switch">
   <dt><code><a href="#element">Element</a></code>
   <dd><p>Return the result of
   <a title="locate a namespace prefix" href="#locate-a-namespace-prefix">locating a namespace prefix</a>
   for the node using <var>namespace</var>.

   <!--AttrExodus <code>Attr</code> -->
   <dt><code><a href="#document">Document</a></code>
   <dd><p>Return the result of
   <a title="locate a namespace prefix" href="#locate-a-namespace-prefix">locating a namespace prefix</a>
   for its <a href="#document-element">document element</a>, if that is not null, and null
   otherwise.

   <dt><code><a href="#documenttype">DocumentType</a></code>
   <dt><code><a href="#documentfragment">DocumentFragment</a></code>
   <dd><p>Return null.

   <dt>Any other node
   <dd><p>Return the result of
   <a title="locate a namespace prefix" href="#locate-a-namespace-prefix">locating a namespace prefix</a>
   for its <a href="#parent-element">parent element</a>, or if that is null, null.
  </dl>
</ol>

<p>The
<dfn title="dom-Node-lookupNamespaceURI" id="dom-node-lookupnamespaceuri"><code>lookupNamespaceURI(<var title="">prefix</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var title="">prefix</var> is the empty string, set it to null.

 <li><p>Return the result of running <a href="#locate-a-namespace">locate a namespace</a> for the
 <a href="#context-object">context object</a> using <var title="">prefix</var>.
</ol>

<p>The
<dfn title="dom-Node-isDefaultNamespace" id="dom-node-isdefaultnamespace"><code>isDefaultNamespace(<var>namespace</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var>namespace</var> is the empty string, set it to null.

 <li><p>Let <var title="">defaultNamespace</var> be the result of running
 <a href="#locate-a-namespace">locate a namespace</a> for the <a href="#context-object">context object</a> using
 null.

 <li><p>Return true if <var title="">defaultNamespace</var> is the same as
 <var>namespace</var>, and false otherwise.
</ol>

<hr>

<p>The
<dfn title="dom-Node-insertBefore" id="dom-node-insertbefore"><code>insertBefore(<var>node</var>, <var>child</var>)</code></dfn>
method must return the result of
<a title="concept-node-pre-insert" href="#concept-node-pre-insert">pre-inserting</a>
<var title="">node</var> into the <a href="#context-object">context object</a> before
<var title="">child</var>.

<p>The
<dfn title="dom-Node-appendChild" id="dom-node-appendchild"><code>appendChild(<var>node</var>)</code></dfn>
method must return the result of
<a title="concept-node-append" href="#concept-node-append">appending</a> <var title="">node</var> to
the <a href="#context-object">context object</a>.

<p>The
<dfn title="dom-Node-replaceChild" id="dom-node-replacechild"><code>replaceChild(<var>node</var>, <var>child</var>)</code></dfn>
method must return the result of
<a title="concept-node-replace" href="#concept-node-replace">replacing</a> <var title="">child</var>
with <var title="">node</var> within the <a href="#context-object">context object</a>.

<p>The
<dfn title="dom-Node-removeChild" id="dom-node-removechild"><code>removeChild(<var>child</var>)</code></dfn>
method must return the result of
<a title="concept-node-pre-remove" href="#concept-node-pre-remove">pre-removing</a>
<var title="">child</var> from the <a href="#context-object">context object</a>.

<hr><!-- Collections -->

<p>The
<dfn title="concept-getElementsByTagName" id="concept-getelementsbytagname">list of elements with local name <var>localName</var></dfn>
for a <a title="concept-node" href="#concept-node">node</a> <var title="">root</var> is the
<code><a href="#htmlcollection">HTMLCollection</a></code> returned by the following algorithm:
<ol>
 <li><p>If <var>localName</var> is "<code>*</code>" (U+002A),
 return a <code><a href="#htmlcollection">HTMLCollection</a></code> rooted at <var title="">root</var>,
 whose filter matches only <a title="concept-element" href="#concept-element">elements</a>.

 <li>
  <p>Otherwise, if <var title="">root</var>'s
  <a title="concept-node-document" href="#concept-node-document">node document</a> is an
  <a href="#html-document">HTML document</a>, return a <code><a href="#htmlcollection">HTMLCollection</a></code> rooted at
  <var title="">root</var>, whose filter matches the following
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
  <a title="concept-element" href="#concept-element">elements</a>:

  <ul>
   <li>Whose <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> is the
   <a href="#html-namespace">HTML namespace</a> and whose
   <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is
   <var>localName</var> <a href="#converted-to-ascii-lowercase">converted to ASCII lowercase</a>.

   <li>Whose <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> is
   <em>not</em> the <a href="#html-namespace">HTML namespace</a> and whose
   <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is
   <var>localName</var>.
  </ul>

 <li><p>Otherwise, return a <code><a href="#htmlcollection">HTMLCollection</a></code> rooted at
 <var title="">root</var>, whose filter matches
 <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
 <a title="concept-element" href="#concept-element">elements</a> whose
 <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is
 <var>localName</var>.
</ol>

<p>When invoked with the same argument, the same <code><a href="#htmlcollection">HTMLCollection</a></code>
object may be returned as returned by an earlier call.


<p>The
<dfn title="concept-getElementsByTagNameNS" id="concept-getelementsbytagnamens">list of elements with namespace
<var>namespace</var> and local name <var>localName</var></dfn>
for a <a title="concept-node" href="#concept-node">node</a> <var title="">root</var> is the
<code><a href="#htmlcollection">HTMLCollection</a></code> returned by the following algorithm:

<ol>
 <li><p>If <var>namespace</var> is the empty string, set it to null.

 <li><p>If both <var>namespace</var> and <var>localName</var>
 are "<code>*</code>" (U+002A), return a <code><a href="#htmlcollection">HTMLCollection</a></code> rooted at
 <var title="">root</var>, whose filter matches
 <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
 <a title="concept-element" href="#concept-element">elements</a>.

 <li><p>Otherwise, if <var>namespace</var> is "<code>*</code>"
 (U+002A), return a <code><a href="#htmlcollection">HTMLCollection</a></code> rooted at
 <var title="">root</var>, whose filter matches
 <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
 <a title="concept-element" href="#concept-element">elements</a> whose
 <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is
 <var>localName</var>.

 <li><p>Otherwise, if <var>localName</var> is "<code>*</code>"
 (U+002A), return a <code><a href="#htmlcollection">HTMLCollection</a></code> rooted at
 <var title="">root</var>, whose filter matches
 <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
 <a title="concept-element" href="#concept-element">elements</a> whose
 <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> is
 <var>namespace</var>.

 <li><p>Otherwise, return a <code><a href="#htmlcollection">HTMLCollection</a></code> rooted at
 <var title="">root</var>, whose filter matches
 <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
 <a title="concept-element" href="#concept-element">elements</a> whose
 <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> is
 <var>namespace</var> and
 <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is
 <var>localName</var>.
</ol>

<p>When invoked with the same arguments, the same <code><a href="#htmlcollection">HTMLCollection</a></code>
object may be returned as returned by an earlier call.


<p>The
<dfn title="concept-getElementsByClassName" id="concept-getelementsbyclassname">list of elements with class names <var title="">classNames</var></dfn>
for a <a title="concept-node" href="#concept-node">node</a> <var title="">root</var> is the
<code><a href="#htmlcollection">HTMLCollection</a></code> returned by the following algorithm:
<ol>
 <li>
  <p>Let <var title="">classes</var> be the result of running the
  <a title="concept-ordered-set-parser" href="#concept-ordered-set-parser">ordered set parser</a> on
  <var title="">classNames</var>.

 <li>
  <p>If <var title="">classes</var> is the empty set, return an empty
  <code><a href="#htmlcollection">HTMLCollection</a></code>.

 <li>
  <p>Return a <code><a href="#htmlcollection">HTMLCollection</a></code> rooted at <var title="">root</var>,
  whose filter matches <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
  <a title="concept-element" href="#concept-element">elements</a> that have all their
  <a title="concept-class" href="#concept-class">classes</a> in <var title="">classes</var>.

  <p>The comparisons for the <a title="concept-class" href="#concept-class">classes</a> must be done
  in an <a href="#ascii-case-insensitive">ASCII case-insensitive</a> manner if <var title="">root</var>'s
  <a title="concept-node-document" href="#concept-node-document">node document</a> is in
  <a title="concept-document-quirks" href="#concept-document-quirks">quirks mode</a>, and in a
  <a href="#case-sensitive">case-sensitive</a> manner otherwise.
</ol>

<p>When invoked with the same argument, the same <code><a href="#htmlcollection">HTMLCollection</a></code>
object may be returned as returned by an earlier call.


<h3 id="interface-document"><span class="secno">4.5 </span>Interface <code><a href="#document">Document</a></code></h3>
<pre class="idl">[<a title="dom-Document" href="#dom-document">Constructor</a>]
interface <dfn id="document">Document</dfn> : <a href="#node">Node</a> {
  [SameObject] readonly attribute <a href="#domimplementation">DOMImplementation</a> <a title="dom-Document-implementation" href="#dom-document-implementation">implementation</a>;
  readonly attribute DOMString <a title="dom-Document-URL" href="#dom-document-url">URL</a>;
  readonly attribute DOMString <a title="dom-Document-documentURI" href="#dom-document-documenturi">documentURI</a>;
  readonly attribute DOMString <a title="dom-Document-origin" href="#dom-document-origin">origin</a>;
  readonly attribute DOMString <a title="dom-Document-compatMode" href="#dom-document-compatmode">compatMode</a>;
  readonly attribute DOMString <a title="dom-Document-characterSet" href="#dom-document-characterset">characterSet</a>;
  readonly attribute DOMString <a title="dom-Document-inputEncoding" href="#dom-document-inputencoding">inputEncoding</a>; // legacy alias of .characterSet
  readonly attribute DOMString <a title="dom-Document-contentType" href="#dom-document-contenttype">contentType</a>;

  readonly attribute <a href="#documenttype">DocumentType</a>? <a title="dom-Document-doctype" href="#dom-document-doctype">doctype</a>;
  readonly attribute <a href="#element">Element</a>? <a title="dom-Document-documentElement" href="#dom-document-documentelement">documentElement</a>;
  <a href="#htmlcollection">HTMLCollection</a> <a title="dom-Document-getElementsByTagName" href="#dom-document-getelementsbytagname">getElementsByTagName</a>(DOMString <var>localName</var>);
  <a href="#htmlcollection">HTMLCollection</a> <a title="dom-Document-getElementsByTagNameNS" href="#dom-document-getelementsbytagnamens">getElementsByTagNameNS</a>(DOMString? <var>namespace</var>, DOMString <var>localName</var>);
  <a href="#htmlcollection">HTMLCollection</a> <a title="dom-Document-getElementsByClassName" href="#dom-document-getelementsbyclassname">getElementsByClassName</a>(DOMString <var title="">classNames</var>);

  [NewObject] <a href="#element">Element</a> <a title="dom-Document-createElement" href="#dom-document-createelement">createElement</a>(DOMString <var>localName</var>);
  [NewObject] <a href="#element">Element</a> <a title="dom-Document-createElementNS" href="#dom-document-createelementns">createElementNS</a>(DOMString? <var>namespace</var>, DOMString <var>qualifiedName</var>);
  [NewObject] <a href="#documentfragment">DocumentFragment</a> <a title="dom-Document-createDocumentFragment" href="#dom-document-createdocumentfragment">createDocumentFragment</a>();
  [NewObject] <a href="#text">Text</a> <a title="dom-Document-createTextNode" href="#dom-document-createtextnode">createTextNode</a>(DOMString <var title="">data</var>);
  [NewObject] <a href="#comment">Comment</a> <a title="dom-Document-createComment" href="#dom-document-createcomment">createComment</a>(DOMString <var title="">data</var>);
  [NewObject] <a href="#processinginstruction">ProcessingInstruction</a> <a title="dom-Document-createProcessingInstruction" href="#dom-document-createprocessinginstruction">createProcessingInstruction</a>(DOMString <var title="">target</var>, DOMString <var title="">data</var>);<!--
  CDATASection createCDATASection(DOMString data);-->

  [NewObject] <a href="#node">Node</a> <a title="dom-Document-importNode" href="#dom-document-importnode">importNode</a>(<a href="#node">Node</a> <var title="">node</var>, optional boolean <var title="">deep</var> = false);
  <a href="#node">Node</a> <a title="dom-Document-adoptNode" href="#dom-document-adoptnode">adoptNode</a>(<a href="#node">Node</a> <var title="">node</var>);

  [NewObject] <a href="#attr">Attr</a> <a title="dom-Document-createAttribute" href="#dom-document-createattribute">createAttribute</a>(DOMString <var>localName</var>);
  [NewObject] <a href="#attr">Attr</a> <a title="dom-Document-createAttributeNS" href="#dom-document-createattributens">createAttributeNS</a>(DOMString? <var>namespace</var>, DOMString <var>name</var>);

  [NewObject] <a href="#event">Event</a> <a title="dom-Document-createEvent" href="#dom-document-createevent">createEvent</a>(DOMString <var title="">interface</var>);

  [NewObject] <a href="#range">Range</a> <a title="dom-Document-createRange" href="#dom-document-createrange">createRange</a>();

  // <a href="#nodefilter">NodeFilter</a>.<a title="dom-NodeFilter-SHOW_ALL" href="#dom-nodefilter-show_all">SHOW_ALL</a> = 0xFFFFFFFF
  [NewObject] <a href="#nodeiterator">NodeIterator</a> <a title="dom-Document-createNodeIterator" href="#dom-document-createnodeiterator">createNodeIterator</a>(<!--
  --><a href="#node">Node</a> <var title="">root</var>, <!--
  -->optional unsigned long <var title="">whatToShow</var> = 0xFFFFFFFF, <!--
  -->optional <a href="#nodefilter">NodeFilter</a>? <var title="">filter</var> = null);
  [NewObject] <a href="#treewalker">TreeWalker</a> <a title="dom-Document-createTreeWalker" href="#dom-document-createtreewalker">createTreeWalker</a>(<!--
  --><a href="#node">Node</a> <var title="">root</var>, <!--
  -->optional unsigned long <var title="">whatToShow</var> = 0xFFFFFFFF, <!--
  -->optional <a href="#nodefilter">NodeFilter</a>? <var title="">filter</var> = null);
};

interface <dfn id="xmldocument">XMLDocument</dfn> : <a href="#document">Document</a> {};</pre>

<p><code><a href="#document">Document</a></code> <a title="concept-node" href="#concept-node">nodes</a> are simply
known as <dfn title="concept-document" id="concept-document">documents</dfn>.

<p>Each <a title="concept-document" href="#concept-document">document</a> has an associated
<dfn title="concept-document-encoding" id="concept-document-encoding">encoding</dfn>,
<dfn title="concept-document-content-type" id="concept-document-content-type">content type</dfn>, and
<dfn title="concept-document-url" id="concept-document-url">URL</dfn>.
<a href="#refsENCODING">[ENCODING]</a>
<a href="#refsURL">[URL]</a>

<p>Unless stated otherwise, a <a title="concept-document" href="#concept-document">document</a>'s
<a title="concept-document-encoding" href="#concept-document-encoding">encoding</a> is the
<code data-anolis-spec="encoding" class="external"><a href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a></code>
<a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#encoding">encoding</a>, its
<a title="concept-document-content-type" href="#concept-document-content-type">content type</a> is
"<code title="">application/xml</code>", and its
<a title="concept-document-url" href="#concept-document-url">URL</a> is
"<code title="">about:blank</code>".

<p>Unless stated otherwise, a <a title="concept-document" href="#concept-document">document</a>'s
<a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> is a globally unique identifier
and its <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#effective-script-origin">effective script origin</a> is an
<a title="concept-origin-alias" data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-alias">alias</a> of that
<a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>.
<a href="#refsHTML">[HTML]</a>

<p>A <a title="concept-document" href="#concept-document">document</a> is assumed to be an
<dfn id="xml-document">XML document</dfn> unless it is flagged as being an
<dfn id="html-document">HTML document</dfn>. Whether a
<a title="concept-document" href="#concept-document">document</a> is an
<a href="#html-document">HTML document</a> or an <a href="#xml-document">XML document</a> affects the
behavior of certain APIs.

<p>A <a title="concept-document" href="#concept-document">document</a> is always set to one of
three modes: <dfn title="concept-document-no-quirks" id="concept-document-no-quirks">no-quirks mode</dfn>, the
default; <dfn title="concept-document-quirks" id="concept-document-quirks">quirks mode</dfn>, used
typically for legacy documents; and
<dfn title="concept-document-limited-quirks" id="concept-document-limited-quirks">limited-quirks mode</dfn>. Unless stated
otherwise, a <a title="concept-document" href="#concept-document">document</a> must be in
<a title="concept-document-no-quirks" href="#concept-document-no-quirks">no-quirks mode</a>.

<p class="note">The mode is only ever changed from the default if the
<a title="concept-document" href="#concept-document">document</a> is created by the
<a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/syntax.html#html-parser">HTML parser</a>, based on the presence,
absence, or value of the DOCTYPE string.
<a href="#refsHTML">[HTML]</a>

<p class="note"><a title="concept-document-no-quirks" href="#concept-document-no-quirks">No-quirks mode</a>
was originally known as "standards mode" and
<a title="concept-document-limited-quirks" href="#concept-document-limited-quirks">limited-quirks mode</a> was
once known as "almost standards mode". They have been renamed because their
details are now defined by standards. (And because Ian Hickson vetoed their
original names on the basis that they are nonsensical.)

<hr>

<dl class="domintro">
 <dt><code><var title="">document</var> = new <a title="dom-Document" href="#dom-document">Document</a>()</code>
 <dd><p>Returns a new <a title="concept-document" href="#concept-document">document</a>.

 <dt><code><var title="">document</var> . <a title="dom-Document-implementation" href="#dom-document-implementation">implementation</a></code>
 <dd><p>Returns <var title="">document</var>'s <code><a href="#domimplementation">DOMImplementation</a></code> object.

 <dt><code><var title="">document</var> . <a title="dom-Document-URL" href="#dom-document-url">URL</a></code>
 <dt><code><var title="">document</var> . <a title="dom-Document-documentURI" href="#dom-document-documenturi">documentURI</a></code>
 <dd><p>Returns <var title="">document</var>'s <a title="concept-document-url" href="#concept-document-url">URL</a>.

 <dt><code><var title="">document</var> . <a title="dom-Document-origin" href="#dom-document-origin">origin</a></code>
 <dd><p>Returns <var title="">document</var>'s <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>.

 <dt><code><var title="">document</var> . <a title="dom-Document-compatMode" href="#dom-document-compatmode">compatMode</a></code>
 <dd>
  <p>Returns the string "<code title="">CSS1Compat</code>" if
  <var title="">document</var> is in
  <a title="concept-document-no-quirks" href="#concept-document-no-quirks">no-quirks mode</a> or
  <a title="concept-document-limited-quirks" href="#concept-document-limited-quirks">limited-quirks mode</a>, and
  "<code title="">BackCompat</code>", if <var title="">document</var> is in
  <a title="concept-document-quirks" href="#concept-document-quirks">quirks mode</a>.

 <dt><code><var title="">document</var> . <a title="dom-Document-characterSet" href="#dom-document-characterset">characterSet</a></code>
 <dd><p>Returns <var title="">document</var>'s
 <a title="concept-document-encoding" href="#concept-document-encoding">encoding</a>.

 <dt><code><var title="">document</var> . <a title="dom-Document-contentType" href="#dom-document-contenttype">contentType</a></code>
 <dd><p>Returns <var title="">document</var>'s
 <a title="concept-document-content-type" href="#concept-document-content-type">content type</a>.
</dl>

<p>The <dfn title="dom-Document" id="dom-document"><code>Document()</code></dfn> constructor
must return a new <a title="concept-document" href="#concept-document">document</a> whose
<a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> is an
<a title="concept-origin-alias" data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-alias">alias</a> to the
<a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> of the global object's associated
<a title="concept-document" href="#concept-document">document</a>, and
<a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#effective-script-origin">effective script origin</a> is an
<a title="concept-origin-alias" data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-alias">alias</a> to the
<a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#effective-script-origin">effective script origin</a> of the
global object's associated <a title="concept-document" href="#concept-document">document</a>.
<a href="#refsHTML">[HTML]</a>

<p class="note">Unlike
<code title="dom-DOMImplementation-createDocument"><a href="#dom-domimplementation-createdocument">createDocument()</a></code>
this constructor does not return an <code><a href="#xmldocument">XMLDocument</a></code> object, but a
<a title="concept-document" href="#concept-document">document</a> (<code><a href="#document">Document</a></code> object).

<p>The
<dfn title="dom-Document-implementation" id="dom-document-implementation"><code>implementation</code></dfn>
attribute must return the <code><a href="#domimplementation">DOMImplementation</a></code> object that is
associated with the <a title="concept-document" href="#concept-document">document</a>.

<p>The <dfn title="dom-Document-URL" id="dom-document-url"><code>URL</code></dfn> and
<dfn title="dom-Document-documentURI" id="dom-document-documenturi"><code>documentURI</code></dfn>
attributes must return the <a title="concept-document-url" href="#concept-document-url">URL</a>.

<p>The <dfn title="dom-Document-origin" id="dom-document-origin"><code>origin</code></dfn>
attribute must return the
<a title="Unicode serialization of an origin" data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#unicode-serialisation-of-an-origin">Unicode serialization</a>
of <a href="#context-object">context object</a>'s <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>.

<p>The <dfn title="dom-Document-compatMode" id="dom-document-compatmode"><code>compatMode</code></dfn>
attribute must return "<code title="">BackCompat</code>" if the
<a href="#context-object">context object</a> is in
<a title="concept-document-quirks" href="#concept-document-quirks">quirks mode</a>, and
"<code title="">CSS1Compat</code>" otherwise.

<p>The <dfn title="dom-Document-characterSet" id="dom-document-characterset"><code>characterSet</code></dfn> attribute's
getter and <dfn title="dom-Document-inputEncoding" id="dom-document-inputencoding"><code>inputEncoding</code></dfn>
attribute's getter must run these steps:

<ol>
 <li><p>Let <var title="">name</var> be
 <a title="concept-document-encoding" href="#concept-document-encoding">encoding</a>'s
 <a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#name">name</a>.

 <li>
  <p>If <var title="">name</var> is in the first column in the table below, set
  <var title="">name</var> to the value of the second column on the same row:

  <!-- The order matches the Encoding Standard -->
  <table>
   <tr>
    <th>Name
    <th>Compatibility name
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a>
    <td>"<code title="">UTF-8</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ibm866">ibm866</a>
    <td>"<code title="">IBM866</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-2">iso-8859-2</a>
    <td>"<code title="">ISO-8859-2</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-3">iso-8859-3</a>
    <td>"<code title="">ISO-8859-3</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-4">iso-8859-4</a>
    <td>"<code title="">ISO-8859-4</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-5">iso-8859-5</a>
    <td>"<code title="">ISO-8859-5</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-6">iso-8859-6</a>
    <td>"<code title="">ISO-8859-6</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-7">iso-8859-7</a>
    <td>"<code title="">ISO-8859-7</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-8">iso-8859-8</a>
    <td>"<code title="">ISO-8859-8</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-8-i">iso-8859-8-i</a>
    <td>"<code title="">ISO-8859-8-I</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-10">iso-8859-10</a>
    <td>"<code title="">ISO-8859-10</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-13">iso-8859-13</a>
    <td>"<code title="">ISO-8859-13</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-14">iso-8859-14</a>
    <td>"<code title="">ISO-8859-14</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-15">iso-8859-15</a>
    <td>"<code title="">ISO-8859-15</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-8859-16">iso-8859-16</a>
    <td>"<code title="">ISO-8859-16</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#koi8-r">koi8-r</a>
    <td>"<code title="">KOI8-R</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#koi8-u">koi8-u</a>
    <td>"<code title="">KOI8-U</code>"
   <!-- macintosh, windows-*, x-mac-cyrillic -->
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#gbk">gbk</a>
    <td>"<code title="">GBK</code>"
   <!-- gb18030 -->
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#big5">big5</a>
    <td>"<code title="">Big5</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#euc-jp">euc-jp</a>
    <td>"<code title="">EUC-JP</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#iso-2022-jp">iso-2022-jp</a>
    <td>"<code title="">ISO-2022-JP</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#shift_jis">shift_jis</a>
    <td>"<code title="">Shift_JIS</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#euc-kr">euc-kr</a>
    <td>"<code title="">EUC-KR</code>"
   <!-- replacement -->
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#utf-16be">utf-16be</a>
    <td>"<code title="">UTF-16BE</code>"
   <tr>
    <td><a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#utf-16le">utf-16le</a>
    <td>"<code title="">UTF-16LE</code>"
   <!-- x-user-defined -->
  </table>

 <li><p>Return <var title="">name</var>.
</ol>

<p>The <dfn title="dom-Document-contentType" id="dom-document-contenttype"><code>contentType</code></dfn>
attribute must return the
<a title="concept-document-content-type" href="#concept-document-content-type">content type</a>.

<hr>

<dl class="domintro">
 <dt><var title="">document</var> . <code title="dom-Document-doctype"><a href="#dom-document-doctype">doctype</a></code>
 <dd><p>Returns the <a title="concept-doctype" href="#concept-doctype">doctype</a> or null if
 there is none.

 <dt><var title="">document</var> . <code title="dom-Document-documentElement"><a href="#dom-document-documentelement">documentElement</a></code>
 <dd><p>Returns the <a href="#document-element">document element</a>.

 <dt><var title="">collection</var> = <var title="">document</var> . <code title="dom-Document-getElementsByTagName"><a href="#dom-document-getelementsbytagname">getElementsByTagName(<var>localName</var>)</a></code>

 <dd>
  <p>If <var>localName</var> is "<code title="">*</code>" returns a
  <code><a href="#htmlcollection">HTMLCollection</a></code> of all
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
  <a title="concept-element" href="#concept-element">elements</a>.

  <p>Otherwise, returns a <code><a href="#htmlcollection">HTMLCollection</a></code> of all
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
  <a title="concept-element" href="#concept-element">elements</a> whose
  <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is
  <var>localName</var>. (Matches case-insensitively against
  <a title="concept-element" href="#concept-element">elements</a> in the
  <a href="#html-namespace">HTML namespace</a> within an <a href="#html-document">HTML document</a>.)

 <dt><var title="">collection</var> = <var title="">document</var> . <code title="dom-Document-getElementsByTagName"><a href="#dom-document-getelementsbytagname">getElementsByTagNameNS(<var>namespace</var>, <var>localName</var>)</a></code>

 <dd>
  <p>If <var>namespace</var> and <var>localName</var> are
  "<code title="">*</code>" returns a <code><a href="#htmlcollection">HTMLCollection</a></code> of all
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
  <a title="concept-element" href="#concept-element">elements</a>.

  <p>If only <var>namespace</var> is "<code title="">*</code>" returns a
  <code><a href="#htmlcollection">HTMLCollection</a></code> of all
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
  <a title="concept-element" href="#concept-element">elements</a> whose
  <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is
  <var>localName</var>.

  <p>If only <var>localName</var> is "<code title="">*</code>" returns a
  <code><a href="#htmlcollection">HTMLCollection</a></code> of all
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
  <a title="concept-element" href="#concept-element">elements</a> whose
  <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> is
  <var>namespace</var>.

  <p>Otherwise, returns a <code><a href="#htmlcollection">HTMLCollection</a></code> of all
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>
  <a title="concept-element" href="#concept-element">elements</a> whose
  <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> is
  <var>namespace</var> and
  <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is
  <var>localName</var>.

 <dt><var title="">collection</var> = <var title="">document</var> . <code title="dom-Document-getElementsByClassName"><a href="#dom-document-getelementsbyclassname">getElementsByClassName(<var>classes</var>)</a></code>
 <dt><var title="">collection</var> = <var title="">element</var> . <code title="dom-Element-getElementsByClassName"><a href="#dom-element-getelementsbyclassname">getElementsByClassName(<var>classes</var>)</a></code>
 <dd>
  <p>Returns a <code><a href="#htmlcollection">HTMLCollection</a></code> of the
  <a title="concept-element" href="#concept-element">elements</a> in the object on which
  the method was invoked (a <a title="concept-document" href="#concept-document">document</a> or
  an <a title="concept-element" href="#concept-element">element</a>) that have all the classes
  given by <var title="">classes</var>.
  <p>The <var title="">classes</var> argument is interpreted as a
  space-separated list of classes.
</dl>

<p>The <dfn title="dom-Document-doctype" id="dom-document-doctype"><code>doctype</code></dfn> attribute
must return the <a title="concept-tree-child" href="#concept-tree-child">child</a> of the
<a title="concept-document" href="#concept-document">document</a> that is a
<a title="concept-doctype" href="#concept-doctype">doctype</a>, and null otherwise.

<p>The
<dfn title="dom-Document-documentElement" id="dom-document-documentelement"><code>documentElement</code></dfn>
attribute must return the <a href="#document-element">document element</a>.

<p>The
<dfn title="dom-Document-getElementsByTagName" id="dom-document-getelementsbytagname"><code>getElementsByTagName(<var>localName</var>)</code></dfn>
method must return the
<a title="concept-getElementsByTagName" href="#concept-getelementsbytagname">list of elements with local name <var>localName</var></a>
for the <a href="#context-object">context object</a>.

<p class="note">Thus, in an <a href="#html-document">HTML document</a>,
<code title="">document.getElementsByTagName("FOO")</code> will match
<code title="">FOO</code> elements that are not in the
<a href="#html-namespace">HTML namespace</a>, and <code title="">foo</code> elements that are in
the <a href="#html-namespace">HTML namespace</a>, but not <code title="">FOO</code> elements
that are in the <a href="#html-namespace">HTML namespace</a>.


<p>The
<dfn title="dom-Document-getElementsByTagNameNS" id="dom-document-getelementsbytagnamens"><code>getElementsByTagNameNS(<var>namespace</var>, <var>localName</var>)</code></dfn>
method must return the
<a title="concept-getElementsByTagNameNS" href="#concept-getelementsbytagnamens">list of elements with namespace <var>namespace</var> and local name <var>localName</var></a>
for the <a href="#context-object">context object</a>.


<p>The
<dfn title="dom-Document-getElementsByClassName" id="dom-document-getelementsbyclassname"><code>getElementsByClassName(<var>classNames</var>)</code></dfn>
method must return the
<a title="concept-getElementsByClassName" href="#concept-getelementsbyclassname">list of elements with class names <var title="">classNames</var></a>
for the <a href="#context-object">context object</a>.

<div class="example">
 <p>Given the following XHTML fragment:

 <pre>&lt;div id="example"&gt;
  &lt;p id="p1" class="aaa bbb"/&gt;
  &lt;p id="p2" class="aaa ccc"/&gt;
  &lt;p id="p3" class="bbb ccc"/&gt;
&lt;/div&gt;</pre>

 <p>A call to
 <code title="">document.getElementById('example').getElementsByClassName('aaa')</code>
 would return a <code><a href="#htmlcollection">HTMLCollection</a></code> with the two paragraphs
 <code title="">p1</code> and <code title="">p2</code> in it.

 <p>A call to
 <code title="">getElementsByClassName('ccc bbb')</code>
 would only return one node, however, namely <code title="">p3</code>. A call to
 <code title="">document.getElementById('example').getElementsByClassName('bbb  ccc ')</code>
 would return the same thing.

 <p>A call to
 <code title="">getElementsByClassName('aaa,bbb')</code>
 would return no nodes; none of the elements above are in the
 <code title="">aaa,bbb</code> class.
</div>

<hr>

<dl class="domintro">
 <dt><var title="">element</var> = <var title="">document</var> . <code title="dom-Document-createElement"><a href="#dom-document-createelement">createElement(<var>localName</var>)</a></code>
 <dd>
  <p>Returns an <a title="concept-element" href="#concept-element">element</a> in the
  <a href="#html-namespace">HTML namespace</a> with <var>localName</var> as
  <a title="concept-element-local-name" href="#concept-element-local-name">local name</a>. (In an
  <a href="#html-document">HTML document</a> <var>localName</var> is lowercased.)

  <p>If <var>localName</var> does not match the
  <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Name">Name</a></code> production an
  <code title="">InvalidCharacterError</code>
  exception will be thrown.

 <dt><var title="">element</var> = <var title="">document</var> . <code title="dom-Document-createElement"><a href="#dom-document-createelement">createElementNS(<var>namespace</var>, <var>qualifiedName</var>)</a></code>

 <dd>
  <p>Returns an <a title="concept-element" href="#concept-element">element</a> with
  <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a>
  <var>namespace</var>. Its
  <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a> will
  be everything before "<code title="">:</code>" (U+003E) in
  <var title="">qualifiedName</var> or null. Its
  <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> will be
  everything after "<code title="">:</code>" (U+003E) in
  <var title="">qualifiedName</var> or <var title="">qualifiedName</var>.

  <p>If <var>localName</var> does not match the
  <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Name">Name</a></code> production an
  <code title="">InvalidCharacterError</code>
  exception will be thrown.

  <p>If one of the following conditions is true a
  <code title="">NamespaceError</code> exception
  will be thrown:

  <ul>
   <li><var>localName</var> does not match the
   <code data-anolis-spec="xmlns" class="external"><a href="http://www.w3.org/TR/xml-names/#NT-QName">QName</a></code> production.
   <li><a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">Namespace prefix</a>
   is not null and <var>namespace</var> is the empty string.
   <li><a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">Namespace prefix</a>
   is "<code title="">xml</code>" and <var>namespace</var> is not the
   <a href="#xml-namespace">XML namespace</a>.
   <li><var title="">qualifiedName</var> or
   <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a>
   is "<code title="">xmlns</code>" and <var>namespace</var> is not the
   <a href="#xmlns-namespace">XMLNS namespace</a>.
   <li><var>namespace</var> is the <a href="#xmlns-namespace">XMLNS namespace</a> and
   neither <var title="">qualifiedName</var> nor
   <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a>
   is "<code title="">xmlns</code>".
  </ul>

 <dt><var title="">documentFragment</var> = <var title="">document</var> . <code title="dom-Document-createDocumentFragment"><a href="#dom-document-createdocumentfragment">createDocumentFragment()</a></code>
 <dd><p>Returns a <code><a href="#documentfragment">DocumentFragment</a></code>
 <a title="concept-node" href="#concept-node">node</a>.

 <dt><var title="">text</var> = <var title="">document</var> . <code title="dom-Document-createTextNode"><a href="#dom-document-createtextnode">createTextNode(<var>data</var>)</a></code>
 <dd><p>Returns a <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>
 whose <a title="concept-CD-data" href="#concept-cd-data">data</a> is <var title="">data</var>.

 <dt><var title="">comment</var> = <var title="">document</var> . <code title="dom-Document-createComment"><a href="#dom-document-createcomment">createComment(<var>data</var>)</a></code>
 <dd><p>Returns a <code><a href="#comment">Comment</a></code> <a title="concept-node" href="#concept-node">node</a>
 whose <a title="concept-CD-data" href="#concept-cd-data">data</a> is <var title="">data</var>.

 <dt><var title="">processingInstruction</var> = <var title="">document</var> . <code title="dom-Document-createProcessingInstruction"><a href="#dom-document-createprocessinginstruction">createProcessingInstruction(<var>target</var>, <var>data</var>)</a></code>
 <dd>
  <p>Returns a <code><a href="#processinginstruction">ProcessingInstruction</a></code>
  <a title="concept-node" href="#concept-node">node</a> whose
  <a title="concept-PI-target" href="#concept-pi-target">target</a> is <var title="">target</var> and
  <a title="concept-CD-data" href="#concept-cd-data">data</a> is <var title="">data</var>.
  <p>If <var title="">target</var> does not match the
  <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Name">Name</a></code> production an
  <code title="">InvalidCharacterError</code>
  exception will be thrown.
  <p>If <var title="">data</var> contains "<code title="">?&gt;</code>" an
  <code title="">InvalidCharacterError</code>
  exception will be thrown.
</dl>

<p>The <dfn title="concept-element-interface" id="concept-element-interface">element interface</dfn> for any
<var>name</var> and <var>namespace</var> is <code><a href="#element">Element</a></code>, unless
stated otherwise.

<p class="note">The HTML Standard will e.g. define that for <code title="">html</code> and the
<a href="#html-namespace">HTML namespace</a>, the <code title="">HTMLHtmlElement</code> interface is used.
<a href="#refsHTML">[HTML]</a>

<p>The <dfn title="dom-Document-createElement" id="dom-document-createelement"><code>createElement(<var>localName</var>)</code></dfn> method must run the these steps:

<ol>
 <li><p>If <var>localName</var> does not match the
 <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Name">Name</a></code> production,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidCharacterError</code> exception.

 <li><p>If the <a href="#context-object">context object</a> is an <a href="#html-document">HTML document</a>,
 let <var>localName</var> be
 <a href="#converted-to-ascii-lowercase">converted to ASCII lowercase</a>.
 <!-- XXX why restrict this to HTML documents? -->

 <li><p>Let <var title="">interface</var> be the
 <a title="concept-element-interface" href="#concept-element-interface">element interface</a> for
 <var>localName</var> and the <a href="#html-namespace">HTML namespace</a>.

 <li><p>Return a new <a title="concept-element" href="#concept-element">element</a> that implements <var title="">interface</var>,
 with no attributes,
 <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> set to the <a href="#html-namespace">HTML namespace</a>,
 <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> set to <var>localName</var>, and
 <a title="concept-node-document" href="#concept-node-document">node document</a> set to the <a href="#context-object">context object</a>.
</ol>

<p>The
<dfn title="dom-Document-createElementNS" id="dom-document-createelementns"><code>createElementNS(<var>namespace</var>, <var title="">qualifiedName</var>)</code></dfn>
method must run these steps:
<ol>
 <li><p>Let <var>namespace</var>, <var>prefix</var>, <var>localName</var>, and
 <var>qualifiedName</var> be the result of passing <var>namespace</var> and
 <var>qualifiedName</var> to <a href="#validate-and-extract">validate and extract</a>. Rethrow any exceptions.

 <li><p>Let <var title="">interface</var> be the
 <a title="concept-element-interface" href="#concept-element-interface">element interface</a> for
 <var>localName</var> and <var>namespace</var>.

 <li><p>Return a new <a title="concept-element" href="#concept-element">element</a> that implements <var title="">interface</var>,
 with no attributes,
 <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> set to <var>namespace</var>,
 <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a> set to <var title="">prefix</var>,
 <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> set to <var>localName</var>, and
 <a title="concept-node-document" href="#concept-node-document">node document</a> set to the <a href="#context-object">context object</a>.
</ol>

<p>The
<dfn title="dom-Document-createDocumentFragment" id="dom-document-createdocumentfragment"><code>createDocumentFragment()</code></dfn>
method must return a new <code><a href="#documentfragment">DocumentFragment</a></code>
<a title="concept-node" href="#concept-node">node</a> with its
<a title="concept-node-document" href="#concept-node-document">node document</a> set to the
<a href="#context-object">context object</a>.

<p>The
<dfn title="dom-Document-createTextNode" id="dom-document-createtextnode"><code>createTextNode(<var title="">data</var>)</code></dfn>
method must return a new <code><a href="#text">Text</a></code>
<a title="concept-node" href="#concept-node">node</a> with its
<a title="concept-CD-data" href="#concept-cd-data">data</a> set to <var title="">data</var> and
<a title="concept-node-document" href="#concept-node-document">node document</a> set to the
<a href="#context-object">context object</a>.
<p class="note">No check is performed that <var title="">data</var> consists of
characters that match the <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Char">Char</a></code> production.

<p>The
<dfn title="dom-Document-createComment" id="dom-document-createcomment"><code>createComment(<var title="">data</var>)</code></dfn>
method must return a new <code><a href="#comment">Comment</a></code>
<a title="concept-node" href="#concept-node">node</a> with its
<a title="concept-CD-data" href="#concept-cd-data">data</a> set to <var title="">data</var> and
<a title="concept-node-document" href="#concept-node-document">node document</a> set to the
<a href="#context-object">context object</a>.
<p class="note">No check is performed that <var title="">data</var> consists of
characters that match the <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Char">Char</a></code> production
or that it contains two adjacent hyphens or ends with a hyphen.

<p>The <dfn title="dom-Document-createProcessingInstruction" id="dom-document-createprocessinginstruction"><code>createProcessingInstruction(<var title="">target</var>, <var title="">data</var>)</code></dfn> method must run these steps:

<ol>
 <li><p>If <var title="">target</var> does not match the
 <!--<code data-anolis-spec=xml>PITarget</code>-->
 <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Name">Name</a></code> production,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidCharacterError</code> exception. <!-- DOM3 does not check for "xml" -->

 <li><p>If <var title="">data</var> contains the string
 "<code title="">?&gt;</code>", <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidCharacterError</code> exception. <!-- Gecko does this. -->

 <!--<li><p>If <var title>target</var> contains a U+003A COLON (":")
 character, <span data-anolis-spec=webidl>throw</span> a
 <code title>NamespaceError</code> exception.-->
 <!-- DOM3 didn't check this -->

 <li><p>Return a new <code><a href="#processinginstruction">ProcessingInstruction</a></code>
 <a title="concept-node" href="#concept-node">node</a>, with
 <a title="concept-PI-target" href="#concept-pi-target">target</a> set to <var title="">target</var>,
 <a title="concept-CD-data" href="#concept-cd-data">data</a> set to <var title="">data</var>, and
 <a title="concept-node-document" href="#concept-node-document">node document</a> set to the
 <a href="#context-object">context object</a>.
</ol>

<p class="note">No check is performed that <var title="">target</var> contains
"<code title="">xml</code>" or "<code title="">:</code>", or that
<var title="">data</var> contains characters that match the
<code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Char">Char</a></code> production.

<hr>

<dl class="domintro">
 <dt><var title="">clone</var> = <var title="">document</var> . <code title="dom-Document-importNode"><a href="#dom-document-importnode">importNode(<var>node</var> [, <var>deep</var> = false])</a></code>
 <dd>
 <dd>
  <p>Returns a copy of <var title="">node</var>. If
  <var title="">deep</var> is true, the copy also includes the
  <var title="">node</var>'s <a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a>.

  <p>If <var title="">node</var> is a
  <a title="concept-document" href="#concept-document">document</a> throws a
  <code title="">NotSupportedError</code>
  exception.

 <dt><var title="">node</var> = <var title="">document</var> . <code title="dom-Document-adoptNode"><a href="#dom-document-adoptnode">adoptNode(<var>node</var>)</a></code>

 <dd>
  <p>Moves <var title="">node</var> from another
  <a title="concept-document" href="#concept-document">document</a> and returns it.

  <p>If <var title="">node</var> is a
  <a title="concept-document" href="#concept-document">document</a> throws a
  <code title="">NotSupportedError</code>
  exception.
</dl>

<p>The
<dfn title="dom-Document-importNode" id="dom-document-importnode"><code>importNode(<var title="">node</var>, <var title="">deep</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var title="">node</var> is a
 <a title="concept-document" href="#concept-document">document</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NotSupportedError</code> exception.

 <li><p>Return a <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
 <var title="">node</var>, with <a href="#context-object">context object</a> and the
 <i title="">clone children flag</i> set if <var title="">deep</var> is true.
</ol>

<p><a title="Other applicable specifications" href="#other-applicable-specifications">Specifications</a> may define
<dfn title="concept-node-adopt-ext" id="concept-node-adopt-ext">adopting steps</dfn> for all or some
<a title="concept-node" href="#concept-node">nodes</a>. The algorithm is passed <var title="">node</var> and
<var title="">oldDocument</var>, as indicated in the
<a title="concept-node-adopt" class="no-backref" href="#concept-node-adopt">adopt</a> algorithm.

<p>To <dfn title="concept-node-adopt" id="concept-node-adopt">adopt</dfn> a <var title="">node</var> into
a <var title="">document</var>, run these steps:

<ol>
 <li><p>Let <var title="">oldDocument</var> be <var title="">node</var>'s
 <a title="concept-node-document" href="#concept-node-document">node document</a>.

 <li><p>If <var title="">node</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is not null,
 <a title="concept-node-remove" href="#concept-node-remove">remove</a> <var title="">node</var> from
 its <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>Set <var title="">node</var>'s
 <a title="concept-tree-inclusive-descendant" href="#concept-tree-inclusive-descendant">inclusive descendants</a>'s
 <a title="concept-node-document" href="#concept-node-document">node document</a> to <var title="">document</var>.
 <!--AttrExodus as well as any associated <code>Attr</code> nodes-->

 <li><p>Run any <a title="concept-node-adopt-ext" href="#concept-node-adopt-ext">adopting steps</a> defined for
 <var title="">node</var> in <a href="#other-applicable-specifications">other applicable specifications</a> and pass
 <var title="">node</var> and <var title="">oldDocument</var> as parameters.
</ol>

<p>The
<dfn title="dom-Document-adoptNode" id="dom-document-adoptnode"><code>adoptNode(<var title="">node</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var title="">node</var> is a
 <a title="concept-document" href="#concept-document">document</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NotSupportedError</code> exception.

 <li><p><a title="concept-node-adopt" href="#concept-node-adopt">Adopt</a> <var title="">node</var>
 into the <a href="#context-object">context object</a>.

 <li><p>Return <var title="">node</var>.
</ol>

<hr>

<p>The
<dfn title="dom-Document-createAttribute" id="dom-document-createattribute"><code>createAttribute(<var>localName</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>If <var>localName</var> does not match the <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Name">Name</a></code>
 production in XML, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidCharacterError</code> exception.

 <li><p>Return a new <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is <var>localName</var>.
</ol>

<p class="note">This method does not have its input
<a href="#converted-to-ascii-lowercase">converted to ASCII lowercase</a>.

<p>The
<dfn title="dom-Document-createAttributeNS" id="dom-document-createattributens"><code>createAttributeNS(<var>namespace</var>, <var>name</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>Let <var>namespace</var>, <var>prefix</var>, <var>localName</var>, and
 <var>name</var> be the result of passing <var>namespace</var> and <var>name</var> to
 <a href="#validate-and-extract">validate and extract</a>. Rethrow any exceptions.

 <li><p>Return a new <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
 <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a> is <var>namespace</var>,
 <a title="concept-attribute-namespace-prefix" href="#concept-attribute-namespace-prefix">namespace prefix</a> is
 <var title="">prefix</var>, <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is
 <var>localName</var>, and <a title="concept-attribute-name" href="#concept-attribute-name">name</a> is
 <var>name</var>.
</ol>

<hr>

<p>The
<dfn title="dom-Document-createEvent" id="dom-document-createevent"><code>createEvent(<var title="">interface</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">constructor</var> be null.

 <li>
  <p>If <var title="">interface</var> is an
  <a href="#ascii-case-insensitive">ASCII case-insensitive</a> match for any of the strings in the
  first column in the following table, set <var title="">constructor</var> to the
  interface in the second column on the same row as the matching string:

  <table>
   <thead>
    <tr><th>String<th>Interface<td>Notes
   <tbody>
    <tr><td>"<code title="">customevent</code>"<td><code><a href="#customevent">CustomEvent</a></code><td rowspan="4">
    <tr><td>"<code title="">event</code>"<td rowspan="3"><code><a href="#event">Event</a></code>
    <tr><td>"<code title="">events</code>"
    <tr><td>"<code title="">htmlevents</code>"
    <tr><td>"<code title="">keyboardevent</code>"<td rowspan="2"><code>KeyboardEvent</code><td rowspan="2"><a href="#refsUIEVENTS">[UIEVENTS]</a>
    <tr><td>"<code title="">keyevents</code>"
    <tr><td>"<code title="">messageevent</code>"<td><code>MessageEvent</code><td><a href="#refsHTML">[HTML]</a>
    <tr><td>"<code title="">mouseevent</code>"<td rowspan="2"><code>MouseEvent</code><td rowspan="2"><a href="#refsUIEVENTS">[UIEVENTS]</a>
    <tr><td>"<code title="">mouseevents</code>"
    <tr><td>"<code title="">touchevent</code>"<td><code>TouchEvent</code><td class="XXX">
    <tr><td>"<code title="">uievent</code>"<td rowspan="2"><code>UIEvent</code><td rowspan="2"><a href="#refsUIEVENTS">[UIEVENTS]</a>
    <tr><td>"<code title="">uievents</code>"
  </table>
  <!-- XXX WebKit's architecture is broken here and both browsers support more than DOM.
       http://trac.webkit.org/browser/trunk/Source/WebCore/dom/EventNames.in
       http://mxr.mozilla.org/mozilla-central/source/content/events/src/nsEventDispatcher.cpp#819 -->

 <li><p>If <var title="">constructor</var> is null, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NotSupportedError</code>.

 <li><p>Let <var title="">event</var> be the result of
 <a title="concept-event-constructor" href="#concept-event-constructor">invoking</a> the initial value of
 <var title="">constructor</var> with the empty string as argument.
 <!-- "initial value" as in before script could get to it -->

 <li><p>Unset <var title="">event</var>'s <a href="#initialized-flag">initialized flag</a>.

 <li><p>Return <var title="">event</var>.
</ol>

<p class="note"><a title="concept-event" href="#concept-event">Event</a> constructors can be used instead.

<hr>

<p>The <dfn title="dom-Document-createRange" id="dom-document-createrange"><code>createRange()</code></dfn>
method must return a new <a title="concept-range" href="#concept-range">range</a> with
(<a href="#context-object">context object</a>, 0) as its
<a title="concept-range-start" href="#concept-range-start">start</a> and
<a title="concept-range-end" href="#concept-range-end">end</a>.

<p class="note">The <code title="dom-Range"><a href="#dom-range">Range()</a></code> constructor can be used instead.

<hr>

<p>The
<dfn title="dom-Document-createNodeIterator" id="dom-document-createnodeiterator"><code>createNodeIterator(<var>root</var>, <var>whatToShow</var>, <var>filter</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Create a <code><a href="#nodeiterator">NodeIterator</a></code> object.
 <li><p>Set <a title="concept-traversal-root" href="#concept-traversal-root">root</a> and initialize
 the <code title="dom-NodeIterator-referenceNode"><a href="#dom-nodeiterator-referencenode">referenceNode</a></code>
 attribute to the <var title="">root</var> argument.
 <li><p>Initialize the
 <code title="dom-NodeIterator-pointerBeforeReferenceNode"><a href="#dom-nodeiterator-pointerbeforereferencenode">pointerBeforeReferenceNode</a></code>
 attribute to true.
 <li><p>Set <a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a> to
 the <var title="">whatToShow</var> argument.
 <li><p>Set <a title="concept-traversal-filter" href="#concept-traversal-filter">filter</a> to
 <var title="">filter</var>.
 <li><p>Return the newly created <code><a href="#nodeiterator">NodeIterator</a></code> object.
</ol>

<p>The
<dfn title="dom-Document-createTreeWalker" id="dom-document-createtreewalker"><code>createTreeWalker(<var>root</var>, <var>whatToShow</var>, <var>filter</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Create a <code><a href="#treewalker">TreeWalker</a></code> object.
 <li><p>Set <a title="concept-traversal-root" href="#concept-traversal-root">root</a> and initialize
 the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute to
 the <var title="">root</var> argument.
 <li><p>Set <a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a> to
 the <var title="">whatToShow</var> argument.
 <li><p>Set <a title="concept-traversal-filter" href="#concept-traversal-filter">filter</a> to
 <var title="">filter</var>.
 <li><p>Return the newly created <code><a href="#treewalker">TreeWalker</a></code> object.
</ol>



<h4 id="interface-domimplementation"><span class="secno">4.5.1 </span>Interface <code><a href="#domimplementation">DOMImplementation</a></code></h4>
<p>User agents must create a <code><a href="#domimplementation">DOMImplementation</a></code> object whenever
a <a title="concept-document" href="#concept-document">document</a> is created and associate it
with that <a title="concept-document" href="#concept-document">document</a>.

<pre class="idl">interface <dfn id="domimplementation">DOMImplementation</dfn> {
  [NewObject] <a href="#documenttype">DocumentType</a> <a title="dom-DOMImplementation-createDocumentType" href="#dom-domimplementation-createdocumenttype">createDocumentType</a>(DOMString qualifiedName, DOMString publicId, DOMString systemId);
  [NewObject] <a href="#xmldocument">XMLDocument</a> <a title="dom-DOMImplementation-createDocument" href="#dom-domimplementation-createdocument">createDocument</a>(DOMString? <var>namespace</var>, [TreatNullAs=EmptyString] DOMString <var title="">qualifiedName</var>, optional <a href="#documenttype">DocumentType</a>? <var title="">doctype</var> = null);
  [NewObject] <a href="#document">Document</a> <a title="dom-DOMImplementation-createHTMLDocument" href="#dom-domimplementation-createhtmldocument">createHTMLDocument</a>(optional DOMString <var title="">title</var>);

  boolean <a title="dom-DOMImplementation-hasFeature" href="#dom-domimplementation-hasfeature">hasFeature</a>(); // useless; always returns true
};</pre>

<dl class="domintro">
 <dt><code><var title="">doctype</var> = <var title="">document</var> . <a title="dom-Document-implementation" href="#dom-document-implementation">implementation</a> . <a title="dom-DOMImplementation-createDocumentType" href="#dom-domimplementation-createdocumenttype">createDocumentType</a>(<var title="">qualifiedName</var>, <var title="">publicId</var>, <var title="">systemId</var>)</code>

 <dd>
  <p>Returns a <a title="concept-doctype" href="#concept-doctype">doctype</a>, with the given
  <var title="">qualifiedName</var>, <var title="">publicId</var>, and
  <var title="">systemId</var>. If <var title="">qualifiedName</var> does not
  match the <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Name">Name</a></code> production, an
  <code title="">InvalidCharacterError</code>
  exception is thrown, and if it does not match the
  <code data-anolis-spec="xmlns" class="external"><a href="http://www.w3.org/TR/xml-names/#NT-QName">QName</a></code> production, a
  <code title="">NamespaceError</code> exception
  is thrown.

 <dt><code><var title="">doc</var> = <var title="">document</var> . <a title="dom-Document-implementation" href="#dom-document-implementation">implementation</a> . <a title="dom-DOMImplementation-createDocument" href="#dom-domimplementation-createdocument">createDocument</a>(<var>namespace</var>, <var title="">qualifiedName</var> [, <var title="">doctype</var> = null])</code>

 <dd>
  <p>Returns an <code><a href="#xmldocument">XMLDocument</a></code>, with a
  <a href="#document-element">document element</a> whose
  <a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is
  <var title="">qualifiedName</var> and whose
  <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> is
  <var>namespace</var> (unless <var title="">qualifiedName</var> is the
  empty string), and with <var title="">doctype</var>, if it is given, as its
  <a title="concept-doctype" href="#concept-doctype">doctype</a>.

  <p>This method throws the same exceptions as the <code title="dom-Document-createElementNS"><a href="#dom-document-createelementns">createElementNS</a></code> method, when
  invoked with the same arguments.

 <dt><code><var title="">doc</var> = <var title="">document</var> . <a title="dom-Document-implementation" href="#dom-document-implementation">implementation</a> . <a title="dom-DOMImplementation-createHTMLDocument" href="#dom-domimplementation-createhtmldocument">createHTMLDocument</a>([<var title="">title</var>])</code>

 <dd>
  <p>Returns a <a title="concept-document" href="#concept-document">document</a>, with a basic
  <a title="concept-tree" href="#concept-tree">tree</a> already constructed including a
  <code title="">title</code> element, unless the <var title="">title</var>
  argument is omitted.
</dl>

<div class="impl">

<p>The
<dfn title="dom-DOMImplementation-createDocumentType" id="dom-domimplementation-createdocumenttype"><code>createDocumentType(<var>qualifiedName</var>, <var>publicId</var>, <var>systemId</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p><a href="#validate">Validate</a> <var title="">qualifiedName</var>. Rethrow any exceptions.
 <!-- <li><p>If <var title>publicId</var> contains a character that does not
 match the <code data-anolis-spec=xml>PubidChar</code> production in XML,
 <span data-anolis-spec=webidl>throw</span> an
 <code title>InvalidCharacterError</code>
 exception. --> <!-- DOM3 didn't check this -->
 <!--<li><p>If <var title>systemId</var> contains both a U+0022 QUOTATION MARK ('"') and a U+0027 APOSTROPHE ("'") character,
 <span data-anolis-spec=webidl>throw</span> an
 <code title>InvalidCharacterError</code>
 exception.--> <!-- DOM3 didn't check this -->
 <li><p>Return a new <a title="concept-doctype" href="#concept-doctype">doctype</a>, with
 <var title="">qualifiedName</var> as its
 <a title="concept-doctype-name" href="#concept-doctype-name">name</a>, <var title="">publicId</var> as
 its <a title="concept-doctype-publicid" href="#concept-doctype-publicid">public ID</a>, and
 <var title="">systemId</var> as its
 <a title="concept-doctype-systemid" href="#concept-doctype-systemid">system ID</a>, and with its
 <a title="concept-node-document" href="#concept-node-document">node document</a> set to the
 associated <a title="concept-document" href="#concept-document">document</a> of the
 <a href="#context-object">context object</a>.
</ol>
<p class="note">No check is performed that <var title="">publicId</var>
matches the <code title="">PublicChar</code> production or that
<var title="">systemId</var> does not contain both a '<code title="">"</code>' and
"<code title="">'</code>".

<p>The
<dfn title="dom-DOMImplementation-createDocument" id="dom-domimplementation-createdocument"><code>createDocument(<var>namespace</var>, <var>qualifiedName</var>, <var>doctype</var>)</code></dfn>
method must run these steps:

<ol>
 <li>
  <p>Let <var title="">document</var> be a new <code><a href="#xmldocument">XMLDocument</a></code>.

  <p class="note">This method creates an <code><a href="#xmldocument">XMLDocument</a></code> rather than
  a normal <a title="concept-document" href="#concept-document">document</a>. They are identical
  except for the addition of the
  <code title="dom-XMLDocument-load" data-anolis-spec="html" class="external"><a href="https://html.spec.whatwg.org/multipage/dom.html#dom-xmldocument-load">load()</a></code>
  method deployed content relies upon.
  <a href="#refsHTML">[HTML]</a>

 <li><p>Let <var title="">element</var> be null.

 <li><p>If <var title="">qualifiedName</var> is not the empty string, set
 <var title="">element</var> to the result of invoking the
 <code title="dom-Document-createElementNS"><a href="#dom-document-createelementns">createElementNS()</a></code> method
 with the arguments <var>namespace</var> and
 <var title="">qualifiedName</var> on <var title="">document</var>. Rethrow any exceptions.
 <!-- XXX needs cleanup -->

 <li><p>If <var title="">doctype</var> is not null,
 <a title="concept-node-append" href="#concept-node-append">append</a>
 <var title="">doctype</var> to <var title="">document</var>.

 <li><p>If <var title="">element</var> is not null,
 <a title="concept-node-append" href="#concept-node-append">append</a>
 <var title="">element</var> to <var title="">document</var>.

 <li><p><var title="">document</var>'s
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> is an
 <a title="concept-origin-alias" data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-alias">alias</a> to the
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> of the
 <a href="#context-object">context object</a>'s associated
 <a title="concept-document" href="#concept-document">document</a>, and
 <var title="">document</var>'s
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#effective-script-origin">effective script origin</a> is an
 <a title="concept-origin-alias" data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-alias">alias</a> to the
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#effective-script-origin">effective script origin</a> of the
 <a href="#context-object">context object</a>'s associated
 <a title="concept-document" href="#concept-document">document</a>.
 <a href="#refsHTML">[HTML]</a>

 <li><p>Return <var title="">document</var>.
</ol>

<p>The
<dfn title="dom-DOMImplementation-createHTMLDocument" id="dom-domimplementation-createhtmldocument"><code>createHTMLDocument(<var>title</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">doc</var> be a new
 <a title="concept-document" href="#concept-document">document</a> that is an
 <a href="#html-document">HTML document</a>.

 <li><p>Set <var title="">doc</var>'s
 <a title="concept-document-content-type" href="#concept-document-content-type">content type</a> to
 "<code title="">text/html</code>".

 <li><p>Create a <a title="concept-doctype" href="#concept-doctype">doctype</a>, with
 "<code title="">html</code>"
 as its <a title="concept-doctype-name" href="#concept-doctype-name">name</a> and with its
 <a title="concept-node-document" href="#concept-node-document">node document</a> set to
 <var title="">doc</var>. <a title="concept-node-append" href="#concept-node-append">Append</a>
 the newly created node to <var title="">doc</var>.

 <li><p>Create an <code title="">html</code> element in the <a href="#html-namespace">HTML
 namespace</a>, and <a title="concept-node-append" href="#concept-node-append">append</a>
 it to <var title="">doc</var>.

 <li><p>Create a <code title="">head</code> element in the <a href="#html-namespace">HTML
 namespace</a>, and  <a title="concept-node-append" href="#concept-node-append">append</a>
 it to the <code title="">html</code> element created in the previous step.

 <li>
  <p>If the <var title="">title</var> argument is not omitted:

  <ol>
   <li><p>Create a <code title="">title</code> element in the
   <a href="#html-namespace">HTML namespace</a>, and
   <a title="concept-node-append" href="#concept-node-append">append</a> it to the
   <code title="">head</code> element created in the previous step.

   <li><p>Create a <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>,
   set its <a title="concept-CD-data" href="#concept-cd-data">data</a> to <var title="">title</var>
   (which could be the empty string), and
   <a title="concept-node-append" href="#concept-node-append">append</a> it to the
   <code title="">title</code> element created in the previous step.
  </ol>

 <li><p>Create a <code title="">body</code> element in the
 <a href="#html-namespace">HTML namespace</a>, and
 <a title="concept-node-append" href="#concept-node-append">append</a> it to the
 <code title="">html</code> element created in the earlier step.

 <li><p><var title="">doc</var>'s
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> is an
 <a title="concept-origin-alias" data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-alias">alias</a> to the
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> of the
 <a href="#context-object">context object</a>'s associated
 <a title="concept-document" href="#concept-document">document</a>, and
 <var title="">doc</var>'s
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#effective-script-origin">effective script origin</a> is an
 <a title="concept-origin-alias" data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-alias">alias</a> to the
 <a data-anolis-spec="html" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#effective-script-origin">effective script origin</a> of the
 <a href="#context-object">context object</a>'s associated
 <a title="concept-document" href="#concept-document">document</a>.
 <a href="#refsHTML">[HTML]</a>

 <li><p>Return <var title="">doc</var>.
</ol>

<p>The <dfn title="dom-DOMImplementation-hasFeature" id="dom-domimplementation-hasfeature"><code>hasFeature()</code></dfn> method
must return true.

<p class="note"><code title="dom-DOMImplementation-hasFeature"><a href="#dom-domimplementation-hasfeature">hasFeature()</a></code>
originally would report whether the user agent claimed to support a given DOM
feature, but experience proved it was not nearly as reliable or granular as
simply checking whether the desired objects, attributes, or methods existed.
As such, it should no longer be used, but continues to exist (and simply
returns true) so that old pages don't stop working.

</div>


<h3 id="interface-documentfragment"><span class="secno">4.6 </span>Interface <code><a href="#documentfragment">DocumentFragment</a></code></h3>
<pre class="idl">[<a title="dom-DocumentFragment" href="#dom-documentfragment">Constructor</a>]
interface <dfn id="documentfragment">DocumentFragment</dfn> : <a href="#node">Node</a> {
};</pre>

<p>A <code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a> can have an
associated <a title="concept-element" href="#concept-element">element</a> named
<dfn title="concept-DocumentFragment-host" id="concept-documentfragment-host">host</dfn>.

<p>An object <var title="">A</var> is a
<dfn title="concept-tree-host-including-inclusive-ancestor" id="concept-tree-host-including-inclusive-ancestor">host-including inclusive ancestor</dfn>
of an object <var title="">B</var>, if either <var title="">A</var> is an
<a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
<var title="">B</var>, or if <var title="">B</var>'s <a title="concept-tree-root" href="#concept-tree-root">root</a>
has an associated <a title="concept-DocumentFragment-host" href="#concept-documentfragment-host">host</a> and
<var title="">A</var> is a
<a title="concept-tree-host-including-inclusive-ancestor" href="#concept-tree-host-including-inclusive-ancestor">host-including inclusive ancestor</a>
of <var title="">B</var>'s <a title="concept-tree-root" href="#concept-tree-root">root</a>'s
<a title="concept-DocumentFragment-host" href="#concept-documentfragment-host">host</a>.

<p class="note">The <code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a>'s
<a title="concept-DocumentFragment-host" href="#concept-documentfragment-host">host</a> concept is useful for HTML's
<code>template</code> element and the <code>ShadowRoot</code> object and impacts the
<a title="concept-node-pre-insert" href="#concept-node-pre-insert">pre-insert</a> and
<a title="concept-node-replace" href="#concept-node-replace">replace</a> algorithms.

<!-- XXX xref
     XXX ShadowRoot is a Node technically -->

<dl class="domintro">
 <dt><code><var title="">tree</var> = new <a title="dom-DocumentFragment" href="#dom-documentfragment">DocumentFragment</a>()</code>
 <dd><p>Returns a new <code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a>.
</dl>

<p>The <dfn title="dom-DocumentFragment" id="dom-documentfragment"><code>DocumentFragment()</code></dfn> constructor
must return a new <code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a> whose
<a title="concept-node-document" href="#concept-node-document">node document</a> is the global object's associated
<a title="concept-document" href="#concept-document">document</a>.


<h3 id="interface-documenttype"><span class="secno">4.7 </span>Interface <code><a href="#documenttype">DocumentType</a></code></h3>
<pre class="idl">interface <dfn id="documenttype">DocumentType</dfn> : <a href="#node">Node</a> {
  readonly attribute DOMString <a title="dom-DocumentType-name" href="#dom-documenttype-name">name</a>;
  readonly attribute DOMString <a title="dom-DocumentType-publicId" href="#dom-documenttype-publicid">publicId</a>;
  readonly attribute DOMString <a title="dom-DocumentType-systemId" href="#dom-documenttype-systemid">systemId</a>;<!--
  readonly attribute DOMString internalSubset;-->
};</pre>

<p><code><a href="#documenttype">DocumentType</a></code> <a title="concept-node" href="#concept-node">nodes</a> are
simply known as <dfn title="concept-doctype" id="concept-doctype">doctypes</dfn>.

<p><a title="concept-doctype" href="#concept-doctype">Doctypes</a> have an associated
<dfn title="concept-doctype-name" id="concept-doctype-name">name</dfn>,
<dfn title="concept-doctype-publicid" id="concept-doctype-publicid">public ID</dfn>, and
<dfn title="concept-doctype-systemid" id="concept-doctype-systemid">system ID</dfn>.

<p>When a <a title="concept-doctype" href="#concept-doctype">doctype</a> is created, its
<a title="concept-doctype-name" href="#concept-doctype-name">name</a> is always given. Unless
explicitly given when a <a title="concept-doctype" href="#concept-doctype">doctype</a> is
created, its <a title="concept-doctype-publicid" href="#concept-doctype-publicid">public ID</a> and
<a title="concept-doctype-systemid" href="#concept-doctype-systemid">system ID</a> are the empty string.

<p>The <dfn title="dom-DocumentType-name" id="dom-documenttype-name"><code>name</code></dfn> attribute
must return the <a title="concept-doctype-name" href="#concept-doctype-name">name</a>.

<p>The <dfn title="dom-DocumentType-publicId" id="dom-documenttype-publicid"><code>publicId</code></dfn>
attribute must return the
<a title="concept-doctype-publicid" href="#concept-doctype-publicid">public ID</a>.

<p>The <dfn title="dom-DocumentType-systemId" id="dom-documenttype-systemid"><code>systemId</code></dfn>
attribute must return the
<a title="concept-doctype-systemid" href="#concept-doctype-systemid">system ID</a>.



<h3 id="interface-element"><span class="secno">4.8 </span>Interface <code><a href="#element">Element</a></code></h3>
<pre class="idl">interface <dfn id="element">Element</dfn> : <a href="#node">Node</a> {
  readonly attribute DOMString? <a title="dom-Element-namespaceURI" href="#dom-element-namespaceuri">namespaceURI</a>;
  readonly attribute DOMString? <a title="dom-Element-prefix" href="#dom-element-prefix">prefix</a>;
  readonly attribute DOMString <a title="dom-Element-localName" href="#dom-element-localname">localName</a>;
  readonly attribute DOMString <a title="dom-Element-tagName" href="#dom-element-tagname">tagName</a>;

           attribute DOMString <a title="dom-Element-id" href="#dom-element-id">id</a>;
           attribute DOMString <a title="dom-Element-className" href="#dom-element-classname">className</a>;
  [SameObject] readonly attribute <a href="#domtokenlist">DOMTokenList</a> <a title="dom-Element-classList" href="#dom-element-classlist">classList</a>;

  boolean <a title="dom-Element-hasAttributes" href="#dom-element-hasattributes">hasAttributes</a>();
  [SameObject] readonly attribute <a href="#namednodemap">NamedNodeMap</a> <a title="dom-Element-attributes" href="#dom-element-attributes">attributes</a>;
  DOMString? <a title="dom-Element-getAttribute" href="#dom-element-getattribute">getAttribute</a>(DOMString <var>name</var>);
  DOMString? <a title="dom-Element-getAttributeNS" href="#dom-element-getattributens">getAttributeNS</a>(DOMString? <var>namespace</var>, DOMString <var>localName</var>);
  void <a title="dom-Element-setAttribute" href="#dom-element-setattribute">setAttribute</a>(DOMString <var>name</var>, DOMString <var title="">value</var>);
  void <a title="dom-Element-setAttributeNS" href="#dom-element-setattributens">setAttributeNS</a>(DOMString? <var>namespace</var>, DOMString <var>name</var>, DOMString <var title="">value</var>);
  void <a title="dom-Element-removeAttribute" href="#dom-element-removeattribute">removeAttribute</a>(DOMString <var>name</var>);
  void <a title="dom-Element-removeAttributeNS" href="#dom-element-removeattributens">removeAttributeNS</a>(DOMString? <var>namespace</var>, DOMString <var>localName</var>);
  boolean <a title="dom-Element-hasAttribute" href="#dom-element-hasattribute">hasAttribute</a>(DOMString <var>name</var>);
  boolean <a title="dom-Element-hasAttributeNS" href="#dom-element-hasattributens">hasAttributeNS</a>(DOMString? <var>namespace</var>, DOMString <var>localName</var>);

  <a href="#attr">Attr</a>? <a title="dom-Element-getAttributeNode" href="#dom-element-getattributenode">getAttributeNode</a>(DOMString <var>name</var>);
  <a href="#attr">Attr</a>? <a title="dom-Element-getAttributeNodeNS" href="#dom-element-getattributenodens">getAttributeNodeNS</a>(DOMString? <var>namespace</var>, DOMString <var>localName</var>);
  <a href="#attr">Attr</a>? <a title="dom-Element-setAttributeNode" href="#dom-element-setattributenode">setAttributeNode</a>(<a href="#attr">Attr</a> <var title="">attr</var>);
  <a href="#attr">Attr</a>? <a title="dom-Element-setAttributeNodeNS" href="#dom-element-setattributenodens">setAttributeNodeNS</a>(<a href="#attr">Attr</a> <var title="">attr</var>);
  <a href="#attr">Attr</a> <a title="dom-Element-removeAttributeNode" href="#dom-element-removeattributenode">removeAttributeNode</a>(<a href="#attr">Attr</a> <var title="">attr</var>);

  <a href="#element">Element</a>? <a title="dom-Element-closest" href="#dom-element-closest">closest</a>(DOMString <var>selectors</var>);
  boolean <a title="dom-Element-matches" href="#dom-element-matches">matches</a>(DOMString <var>selectors</var>);

  <a href="#htmlcollection">HTMLCollection</a> <a title="dom-Element-getElementsByTagName" href="#dom-element-getelementsbytagname">getElementsByTagName</a>(DOMString <var>localName</var>);
  <a href="#htmlcollection">HTMLCollection</a> <a title="dom-Element-getElementsByTagNameNS" href="#dom-element-getelementsbytagnamens">getElementsByTagNameNS</a>(DOMString? <var>namespace</var>, DOMString <var>localName</var>);
  <a href="#htmlcollection">HTMLCollection</a> <a title="dom-Element-getElementsByClassName" href="#dom-element-getelementsbyclassname">getElementsByClassName</a>(DOMString <var title="">classNames</var>);
};</pre>

<p><code><a href="#element">Element</a></code> <a title="concept-node" href="#concept-node">nodes</a> are simply
known as <dfn title="concept-element" id="concept-element">elements</dfn>.</p>

<p><a title="concept-element" href="#concept-element">Elements</a> have an associated
<dfn title="concept-element-namespace" id="concept-element-namespace">namespace</dfn>,
<dfn title="concept-element-namespace-prefix" id="concept-element-namespace-prefix">namespace prefix</dfn>, and
<dfn title="concept-element-local-name" id="concept-element-local-name">local name</dfn>. When an
<a title="concept-element" href="#concept-element">element</a> is created, its
<a title="concept-element-local-name" href="#concept-element-local-name">local name</a> is always given.
Unless explicitly given when an <a title="concept-element" href="#concept-element">element</a>
is created, its <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a> and
<a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a> are
null.

<p><a title="concept-element" href="#concept-element">Elements</a> also have an ordered
<dfn title="concept-element-attribute" id="concept-element-attribute">attribute list</dfn> exposed through a
<code><a href="#namednodemap">NamedNodeMap</a></code>. Unless explicitly given when an
<a title="concept-element" href="#concept-element">element</a> is created, its
<a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a> is empty. An
<a title="concept-element" href="#concept-element">element</a>
<dfn title="concept-element-attribute-has" id="concept-element-attribute-has">has</dfn> an
<a title="concept-attribute" href="#concept-attribute">attribute</a> <var title="">A</var> if
<var title="">A</var> is in its
<a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>.

<p><a title="Other applicable specifications" href="#other-applicable-specifications">Applicable specifications</a>
and this specification (can) use the hooks an <dfn id="attribute-is-set">attribute is set</dfn>,
an <dfn id="attribute-is-changed">attribute is changed</dfn>, an <dfn id="attribute-is-added">attribute is added</dfn>, and
an <dfn id="attribute-is-removed">attribute is removed</dfn>, for further processing of the
<a title="concept-attribute" href="#concept-attribute">attribute</a>'s
<a title="concept-attribute-value" href="#concept-attribute-value">value</a>.

<p>To <dfn title="concept-element-attributes-change" id="concept-element-attributes-change">change</dfn> an
<a title="concept-attribute" href="#concept-attribute">attribute</a> <var title="">attribute</var>
from an <a title="concept-element" href="#concept-element">element</a> <var title="">element</var>
to <var title="">value</var>, run these steps:

<ol>
 <li><p><a href="#queue-a-mutation-record">Queue a mutation record</a> of "<code>attributes</code>"
 for <var title="">element</var> with name <var title="">attribute</var>'s
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>, namespace
 <var title="">attribute</var>'s
 <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a>, and oldValue
 <var title="">attribute</var>'s
 <a title="concept-attribute-value" href="#concept-attribute-value">value</a>.

 <li><p>Set <var title="">attribute</var>'s
 <a title="concept-attribute-value" href="#concept-attribute-value">value</a> to <var title="">value</var>.

 <li><p>An <a href="#attribute-is-set">attribute is set</a> and an
 <a href="#attribute-is-changed">attribute is changed</a>.
</ol>

<p>To <dfn title="concept-element-attributes-append" id="concept-element-attributes-append">append</dfn> an
<a title="concept-attribute" href="#concept-attribute">attribute</a> <var title="">attribute</var> to
an <a title="concept-element" href="#concept-element">element</a> <var title="">element</var>,
run these steps:

<ol>
 <li><p><a href="#queue-a-mutation-record">Queue a mutation record</a> of "<code>attributes</code>"
 for <var title="">element</var> with name <var title="">attribute</var>'s
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>, namespace
 <var title="">attribute</var>'s
 <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a>, and oldValue
 null.

 <li><p>Append the <var title="">attribute</var> to the <var title="">element</var>'s
 <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>.

 <li><p>Set <var title="">attribute</var>'s
 <a title="concept-attribute-element" href="#concept-attribute-element">element</a> to <var title="">element</var>.

 <li><p>An <a href="#attribute-is-set">attribute is set</a> and an
 <a href="#attribute-is-added">attribute is added</a>.
</ol>

<p>To <dfn title="concept-element-attributes-remove" id="concept-element-attributes-remove">remove</dfn> an
<a title="concept-attribute" href="#concept-attribute">attribute</a> <var title="">attribute</var>
from an <a title="concept-element" href="#concept-element">element</a> <var title="">element</var>,
run these steps:

<ol>
 <li><p><a href="#queue-a-mutation-record">Queue a mutation record</a> of "<code>attributes</code>"
 for <var title="">element</var> with name <var title="">attribute</var>'s
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>, namespace
 <var title="">attribute</var>'s
 <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a>, and oldValue
 <var title="">attribute</var>'s
 <a title="concept-attribute-value" href="#concept-attribute-value">value</a>.

 <li><p>Remove <var title="">attribute</var> from the
 <var title="">element</var>'s
 <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>.

 <li><p>Set <var title="">attribute</var>'s
 <a title="concept-attribute-element" href="#concept-attribute-element">element</a> to null.

 <li><p>An <a href="#attribute-is-removed">attribute is removed</a>.
</ol>

<hr>

<p>To <dfn title="concept-element-attributes-get-by-name" id="concept-element-attributes-get-by-name">get an attribute by name</dfn>
given a <var>name</var> and <a title="concept-element" href="#concept-element">element</a>
<var title="">element</var>, run these steps:

<ol>
 <li><p>If <var title="">element</var> is in the <a href="#html-namespace">HTML namespace</a> and its
 <a title="concept-node-document" href="#concept-node-document">node document</a> is an
 <a href="#html-document">HTML document</a>, let <var>name</var> be
 <a href="#converted-to-ascii-lowercase">converted to ASCII lowercase</a>.

 <li><p>Return the first <a title="concept-attribute" href="#concept-attribute">attribute</a> in
 <var title="">element</var>'s <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>
 whose <a title="concept-attribute-name" href="#concept-attribute-name">name</a> is <var>name</var>, and null
 otherwise.
</ol>

<p>To
<dfn title="concept-element-attributes-get-by-namespace" id="concept-element-attributes-get-by-namespace">get an attribute by namespace and local name</dfn>
given a <var>namespace</var>, <var>localName</var>, and
<a title="concept-element" href="#concept-element">element</a> <var title="">element</var>, run these steps:

<ol>
 <li><p>If <var>namespace</var> is the empty string, set it to null.

 <li><p>Return the <a title="concept-attribute" href="#concept-attribute">attribute</a> in
 <var title="">element</var>'s <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>
 whose <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a> is
 <var>namespace</var> and
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is
 <var>localName</var>, if any, and null otherwise.
</ol>

<p>To <dfn title="concept-element-attributes-set" id="concept-element-attributes-set">set an attribute</dfn> given an
<a title="concept-attribute" href="#concept-attribute">attribute</a> <var title="">attr</var>,
<a title="concept-element" href="#concept-element">element</a> <var title="">element</var>, and optionally a
<i title="">namespace and local name flag</i>, run these steps:

<ol>
 <li><p>If <var title="">attr</var>'s <a title="concept-attribute-element" href="#concept-attribute-element">element</a> is
 neither null nor <var title="">element</var>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InUseAttributeError</code>.

 <li><p>Let <var>oldAttr</var> be null.

 <li><p>If the <i title="">namespace and local name flag</i> is set, set <var>oldAttr</var>
 to the result of
 <a title="concept-element-attributes-get-by-namespace" href="#concept-element-attributes-get-by-namespace">getting an attribute</a>
 given <var title="">attr</var>'s <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a>,
 <var title="">attr</var>'s <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>, and
 <var title="">element</var>.

 <li>
  <p>Otherwise, set <var>oldAttr</var> to the result of
  <a title="concept-element-attributes-get-by-name" href="#concept-element-attributes-get-by-name">getting an attribute</a> given
  <var title="">attr</var>'s <a title="concept-attribute-name" href="#concept-attribute-name">name</a> and
  <var title="">element</var>.

  <p class="note no-backref">The result of this is that an
  <a title="concept-attribute" href="#concept-attribute">attribute</a> on an
  <a title="concept-element" href="#concept-element">element</a> with an <a href="#html-namespace">HTML namespace</a> in an
  <a href="#html-document">HTML document</a> can be replaced with another
  <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
  <a title="concept-attribute-name" href="#concept-attribute-name">name</a> is only an
  <a href="#ascii-case-insensitive">ASCII case-insensitive</a> match. We do not care, because nobody ought to be
  working with <a title="concept-attribute" href="#concept-attribute">attributes</a> in this way.

 <li><p>If <var>oldAttr</var> is <var title="">attr</var>, return <var title="">attr</var>.

 <li><p>If <var>oldAttr</var> is non-null,
 <a title="concept-element-attributes-remove" href="#concept-element-attributes-remove">remove</a> it from
 <var title="">element</var>.

 <li><p><a title="concept-element-attributes-append" href="#concept-element-attributes-append">Append</a> <var title="">attr</var>
 to <var title="">element</var>.

 <li><p>Return <var>oldAttr</var>.
</ol>

<p>To <dfn title="concept-element-attributes-set-value" id="concept-element-attributes-set-value">set an attribute value</dfn> for
an <a title="concept-element" href="#concept-element">element</a> <var title="">element</var>
using a <var>localName</var> and <var title="">value</var>, and
optionally a <var>name</var>, <var title="">prefix</var>, and
<var>namespace</var>, run these steps:

<ol>
 <li><p>If <var>name</var> is not given, set it to <var>localName</var>.

 <li><p>If <var title="">prefix</var> is not given, set it to null.

 <li><p>If <var>namespace</var> is not given, set it to null.

 <li><p>Let <var title="">attribute</var> be the result of
 <a title="concept-element-attributes-get-by-namespace" href="#concept-element-attributes-get-by-namespace">getting an attribute</a> given
 <var>namespace</var>, <var>localName</var>, and <var title="">element</var>.

 <li><p>If <var title="">attribute</var> is null, create an
 <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
 <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a> is <var>namespace</var>,
 <a title="concept-attribute-namespace-prefix" href="#concept-attribute-namespace-prefix">namespace prefix</a> is
 <var title="">prefix</var>, <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is
 <var>localName</var>, <a title="concept-attribute-name" href="#concept-attribute-name">name</a> is <var>name</var>,
 and <a title="concept-attribute-value" href="#concept-attribute-value">value</a> is <var title="">value</var>, and then
 <a title="concept-element-attributes-append" href="#concept-element-attributes-append">append</a> this
 <a title="concept-attribute" href="#concept-attribute">attribute</a> to <var title="">element</var>
 and terminate these steps.

 <li><p><a title="concept-element-attributes-change" href="#concept-element-attributes-change">Change</a>
 <var title="">attribute</var> from <var title="">element</var> to
 <var title="">value</var>.
</ol>

<p>To
<dfn title="concept-element-attributes-remove-by-name" id="concept-element-attributes-remove-by-name">remove an attribute by name</dfn>
given a <var>name</var> and <a title="concept-element" href="#concept-element">element</a>
<var title="">element</var>, run these steps:

<ol>
 <li><p>Let <var title="">attr</var> be the result of
 <a title="concept-element-attributes-get-by-name" href="#concept-element-attributes-get-by-name">getting an attribute</a> given
 <var>name</var> and <var title="">element</var>.

 <li><p>If <var title="">attr</var> is non-null,
 <a title="concept-element-attributes-remove" href="#concept-element-attributes-remove">remove</a> it from
 <var title="">element</var>.

 <li><p>Return <var title="">attr</var>.
</ol>

<p>To
<dfn title="concept-element-attributes-remove-by-namespace" id="concept-element-attributes-remove-by-namespace">remove an attribute by namespace and local name</dfn>
given a <var>namespace</var>, <var>localName</var>, and
<a title="concept-element" href="#concept-element">element</a> <var title="">element</var>, run these steps:

<ol>
 <li><p>Let <var title="">attr</var> be the result of
 <a title="concept-element-attributes-get-by-namespace" href="#concept-element-attributes-get-by-namespace">getting an attribute</a> given
 <var>namespace</var>, <var>localName</var>, and <var title="">element</var>.

 <li><p>If <var title="">attr</var> is non-null,
 <a title="concept-element-attributes-remove" href="#concept-element-attributes-remove">remove</a> it from
 <var title="">element</var>.

 <li><p>Return <var title="">attr</var>.
</ol>

<hr>

<p><a title="concept-element" href="#concept-element">Elements</a> can have an associated
<dfn title="concept-id" id="concept-id">unique identifier (ID)</dfn> and have an associated
<code><a href="#domtokenlist">DOMTokenList</a></code> object. The <code><a href="#domtokenlist">DOMTokenList</a></code> object's
associated <a title="concept-attribute" href="#concept-attribute">attribute</a>'s
<a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is
<code title="">class</code> and its associated ordered set of tokens is called
the <a title="concept-element" href="#concept-element">element</a>'s
<dfn title="concept-class" id="concept-class">classes</dfn>.

<p class="note">Historically <a title="concept-element" href="#concept-element">elements</a> could
have multiple identifiers e.g. by using the HTML <code title="">id</code>
<a title="concept-attribute" href="#concept-attribute">attribute</a> and a DTD. This specification
makes <a title="concept-id" href="#concept-id">ID</a> a concept of the DOM and allows for
only one per <a title="concept-element" href="#concept-element">element</a>, given by an
<a title="concept-named-attribute" href="#concept-named-attribute"><code>id</code> attribute</a>.

<p>Either when an <a title="concept-element" href="#concept-element">element</a> is created that
<a title="concept-element-attribute-has" href="#concept-element-attribute-has">has</a> an
<a title="concept-named-attribute" href="#concept-named-attribute"><code>id</code> attribute</a> whose
<a title="concept-attribute-value" href="#concept-attribute-value">value</a> is not the empty string or
when an <a title="concept-element" href="#concept-element">element</a>'s
<a title="concept-named-attribute" href="#concept-named-attribute"><code>id</code> attribute</a> is
<a title="attribute is set" href="#attribute-is-set">set</a> to a
<a title="concept-attribute-value" href="#concept-attribute-value">value</a> other than the empty
string, set the <a title="concept-element" href="#concept-element">element</a>'s
<a title="concept-id" href="#concept-id">ID</a> to the new
<a title="concept-attribute-value" href="#concept-attribute-value">value</a>.

<p>When an <a title="concept-element" href="#concept-element">element</a>'s
<a title="concept-named-attribute" href="#concept-named-attribute"><code>id</code> attribute</a> is
<a title="attribute is removed" href="#attribute-is-removed">removed</a> or
<a title="attribute is set" href="#attribute-is-set">set</a> to the empty string, unset the
<a title="concept-element" href="#concept-element">element</a>'s
<a title="concept-id" href="#concept-id">ID</a>.

<p>Either when an <a title="concept-element" href="#concept-element">element</a> is created that
<a title="concept-element-attribute-has" href="#concept-element-attribute-has">has</a> a
<a title="concept-named-attribute" href="#concept-named-attribute"><code>class</code> attribute</a> or
when an <a title="concept-element" href="#concept-element">element</a>'s
<a title="concept-named-attribute" href="#concept-named-attribute"><code>class</code> attribute</a> is
<a title="attribute is set" href="#attribute-is-set">set</a>, set the
<a title="concept-element" href="#concept-element">element</a>'s
<a title="concept-class" href="#concept-class">classes</a> to the new
<a title="concept-attribute-value" href="#concept-attribute-value">value</a>,
<a title="concept-ordered-set-parser" href="#concept-ordered-set-parser">parsed</a>.

<p>When an <a title="concept-element" href="#concept-element">element</a>'s
<a title="concept-named-attribute" href="#concept-named-attribute"><code>class</code> attribute</a> is
<a title="attribute is removed" href="#attribute-is-removed">removed</a>, set the
<a title="concept-element" href="#concept-element">element</a>'s
<a title="concept-class" href="#concept-class">classes</a> to the empty set.

<p class="note">While this specification defines user agent processing
requirements for <code title="">id</code> and <code title="">class</code>
<a title="concept-attribute" href="#concept-attribute">attributes</a> on any
<a title="concept-element" href="#concept-element">element</a>, it makes no claims as to whether
using them is conforming or not.

<hr>

<p>A <a title="concept-node" href="#concept-node">node</a>'s
<a title="concept-tree-parent" href="#concept-tree-parent">parent</a> of type
<code><a href="#element">Element</a></code> is known as a <dfn id="parent-element">parent element</dfn>. If the
<a title="concept-node" href="#concept-node">node</a> has a
<a title="concept-tree-parent" href="#concept-tree-parent">parent</a> of a different type, its
<a href="#parent-element">parent element</a> is null.</p>

<p>The <dfn id="document-element">document element</dfn> of a
<a title="concept-document" href="#concept-document">document</a> is the
<a title="concept-element" href="#concept-element">element</a> whose
<a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is that
<a title="concept-document" href="#concept-document">document</a>, if it exists, and null otherwise.

<p class="note">Per the <a title="concept-node-tree" href="#concept-node-tree">node tree</a>
constraints, there can only be one such
<a title="concept-element" href="#concept-element">element</a>.

<p>When an <a title="concept-element" href="#concept-element">element</a> or one of its
<a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestors</a> is the
<a href="#document-element">document element</a>, it is <dfn id="in-a-document">in a document</dfn>.

<hr>

<dl class="domintro">
 <dt><var>namespace</var> = <var title="">element</var> . <code title="dom-Element-namespaceURI"><a href="#dom-element-namespaceuri">namespaceURI</a></code>
 <dd><p>Returns the <a title="concept-element-namespace" href="#concept-element-namespace">namespace</a>.

 <dt><var title="">prefix</var> = <var title="">element</var> . <code title="dom-Element-prefix"><a href="#dom-element-prefix">prefix</a></code>
 <dd><p>Returns the
 <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a>.

 <dt><var>localName</var> = <var title="">element</var> . <code title="dom-Element-localName"><a href="#dom-element-localname">localName</a></code>
 <dd><p>Returns the
 <a title="concept-element-local-name" href="#concept-element-local-name">local name</a>.

 <dt><var title="">qualifiedName</var> = <var title="">element</var> . <code title="dom-Element-tagName"><a href="#dom-element-tagname">tagName</a></code>
 <dd><p>If
 <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a> is not
 null, returns the concatenation of
 <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a>,
 "<code title="">:</code>", and
 <a title="concept-element-local-name" href="#concept-element-local-name">local name</a>. Otherwise it
 returns the <a title="concept-element-local-name" href="#concept-element-local-name">local name</a>.
 (The return value is uppercased in an <a href="#html-document">HTML document</a>.)
</dl>

<p>The <dfn title="dom-Element-namespaceURI" id="dom-element-namespaceuri"><code>namespaceURI</code></dfn>
attribute must return the <a href="#context-object">context object</a>'s
<a title="concept-element-namespace" href="#concept-element-namespace">namespace</a>.

<p>The <dfn title="dom-Element-prefix" id="dom-element-prefix"><code>prefix</code></dfn> attribute must return the <a href="#context-object">context object</a>'s
<a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a>.

<p>The <dfn title="dom-Element-localName" id="dom-element-localname"><code>localName</code></dfn>
attribute must return the <a href="#context-object">context object</a>'s
<a title="concept-element-local-name" href="#concept-element-local-name">local name</a>.

<p>The <dfn title="dom-Element-tagName" id="dom-element-tagname"><code>tagName</code></dfn> attribute
must run these steps:
<ol>
 <li><p>If <a href="#context-object">context object</a>'s
 <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a> is not
 null, let <var title="">qualified name</var> be its
 <a title="concept-element-namespace-prefix" href="#concept-element-namespace-prefix">namespace prefix</a>, followed
 by a "<code>:</code>" (U+003A), followed by its
 <a title="concept-element-local-name" href="#concept-element-local-name">local name</a>. Otherwise, let
 <var title="">qualified name</var> be its
 <a title="concept-element-local-name" href="#concept-element-local-name">local name</a>.

 <li><p>If the <a href="#context-object">context object</a> is in the <a href="#html-namespace">HTML namespace</a> and
 its <a title="concept-node-document" href="#concept-node-document">node document</a> is an
 <a href="#html-document">HTML document</a>, let <var title="">qualified name</var> be
 <a href="#converted-to-ascii-uppercase">converted to ASCII uppercase</a>.

 <li><p>Return <var title="">qualified name</var>.
</ol>

<hr>

<p>Some IDL attributes are defined to <dfn title="concept-reflect" id="concept-reflect">reflect</dfn> a content
<a title="concept-attribute" href="#concept-attribute">attribute</a> of a given <var title="">name</var>. This
means that on getting, these steps must be run:

<ol>
 <li><p>Let <var title="">attr</var> be the result of
 <a title="concept-element-attributes-get-by-namespace" href="#concept-element-attributes-get-by-namespace">getting an attribute</a>
 given null, <var title="">name</var>, and the <a href="#context-object">context object</a>.

 <li><p>If <var title="">attr</var> is null, return the empty string.

 <li><p>Return <var title="">attr</var>'s <a title="concept-attribute-value" href="#concept-attribute-value">value</a>.
</ol>

<p>On setting,
<a title="concept-element-attributes-set-value" href="#concept-element-attributes-set-value">set an attribute value</a> for the
<a href="#context-object">context object</a> using <var title="">name</var> and the given value.

<p>The <dfn title="dom-Element-id" id="dom-element-id"><code>id</code></dfn> attribute must
<a title="concept-reflect" href="#concept-reflect">reflect</a> the "<code title="">id</code>"
content attribute.

<p>The <dfn title="dom-Element-className" id="dom-element-classname"><code>className</code></dfn>
attribute must <a title="concept-reflect" href="#concept-reflect">reflect</a> the
"<code title="">class</code>" content attribute.

<p>The <dfn title="dom-Element-classList" id="dom-element-classlist"><code>classList</code></dfn>
attribute must return the associated <code><a href="#domtokenlist">DOMTokenList</a></code> object
representing the <a href="#context-object">context object</a>'s
<a title="concept-class" href="#concept-class">classes</a>.

<hr>

<!-- all members in this subsection are affected by AttrExodus -->

<p>The <dfn title="dom-Element-hasAttributes" id="dom-element-hasattributes"><code>hasAttributes()</code></dfn> method,
when invoked, must return false if <a href="#context-object">context object</a>'s
<a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a> is empty, and true
otherwise.

<p>The <dfn title="dom-Element-attributes" id="dom-element-attributes"><code>attributes</code></dfn>
attribute must return the associated <code><a href="#namednodemap">NamedNodeMap</a></code>.

<p>The <dfn title="dom-Element-getAttribute" id="dom-element-getattribute"><code>getAttribute(<var>name</var>)</code></dfn> method must run these steps:
<ol>
 <li><p>Let <var title="">attr</var> be the result of
 <a title="concept-element-attributes-get-by-name" href="#concept-element-attributes-get-by-name">getting an attribute</a> given
 <var>name</var> and the <a href="#context-object">context object</a>.

 <li><p>If <var title="">attr</var> is null, return null.

 <li><p>Return <var title="">attr</var>'s <a title="concept-attribute-value" href="#concept-attribute-value">value</a>.
</ol>

<p>The
<dfn title="dom-Element-getAttributeNS" id="dom-element-getattributens"><code>getAttributeNS(<var>namespace</var>, <var>localName</var>)</code></dfn>
method must run the following steps:

<ol>
  <li><p>Let <var title="">attr</var> be the result of
  <a title="concept-element-attributes-get-by-namespace" href="#concept-element-attributes-get-by-namespace">getting an attribute</a>
  given <var>namespace</var>, <var>localName</var>, and the
  <a href="#context-object">context object</a>.

  <li><p>If <var title="">attr</var> is null, return null.

  <li><p>Return <var title="">attr</var>'s <a title="concept-attribute-value" href="#concept-attribute-value">value</a>.
</ol>

<p>The
<dfn title="dom-Element-setAttribute" id="dom-element-setattribute"><code>setAttribute(<var>name</var>, <var title="">value</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var>name</var> does not match the
 <code data-anolis-spec="xml" class="external"><a href="http://www.w3.org/TR/xml/#NT-Name">Name</a></code> production in XML,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidCharacterError</code> exception.

 <li><p>Let <var title="">attribute</var> be the result of
 <a title="concept-element-attributes-get-by-name" href="#concept-element-attributes-get-by-name">getting an attribute</a> given
 <var>name</var> and the <a href="#context-object">context object</a>.

 <li><p>If <var title="">attribute</var> is null, create an
 <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is <var>name</var> and
 <a title="concept-attribute-value" href="#concept-attribute-value">value</a> is <var title="">value</var>,
 <a title="concept-element-attributes-append" href="#concept-element-attributes-append">append</a> this
 <a title="concept-attribute" href="#concept-attribute">attribute</a> to the <a href="#context-object">context object</a>'s
 <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>, and then terminate these
 steps.

 <li><p><a title="concept-element-attributes-change" href="#concept-element-attributes-change">Change</a>
 <var title="">attribute</var> from <a href="#context-object">context object</a> to
 <var title="">value</var>.
</ol>

<p>The
<dfn title="dom-Element-setAttributeNS" id="dom-element-setattributens"><code>setAttributeNS(<var>namespace</var>, <var>name</var>, <var>value</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var>namespace</var>, <var>prefix</var>, <var>localName</var>, and
 <var>name</var> be the result of passing <var>namespace</var> and <var>name</var> to
 <a href="#validate-and-extract">validate and extract</a>. Rethrow any exceptions.

 <li><p><a title="concept-element-attributes-set-value" href="#concept-element-attributes-set-value">Set an attribute value</a>
 for the <a href="#context-object">context object</a> using
 <var>localName</var>, <var title="">value</var>, and also
 <var>name</var>, <var title="">prefix</var>, and
 <var>namespace</var>.
</ol>

<p>The
<dfn title="dom-Element-removeAttribute" id="dom-element-removeattribute"><code>removeAttribute(<var>name</var>)</code></dfn>
method must
<a title="concept-element-attributes-remove-by-name" href="#concept-element-attributes-remove-by-name">remove an attribute</a> given
<var>name</var> and the <a href="#context-object">context object</a>, and then return undefined.

<p>The
<dfn title="dom-Element-removeAttributeNS" id="dom-element-removeattributens"><code>removeAttributeNS(<var>namespace</var>, <var>localName</var>)</code></dfn>
method must
<a title="concept-element-attributes-remove-by-namespace" href="#concept-element-attributes-remove-by-namespace">remove an attribute</a>
given <var>namespace</var>, <var>localName</var>, and the
<a href="#context-object">context object</a>, and then return undefined.

<p>The
<dfn title="dom-Element-hasAttribute" id="dom-element-hasattribute"><code>hasAttribute(<var>name</var>)</code></dfn>
method must run these steps:
<ol>
 <li><p>If the <a href="#context-object">context object</a> is in the
 <a href="#html-namespace">HTML namespace</a> and its
 <a title="concept-node-document" href="#concept-node-document">node document</a> is an
 <a href="#html-document">HTML document</a>, let <var>name</var> be
 <a href="#converted-to-ascii-lowercase">converted to ASCII lowercase</a>.

 <li><p>Return true if the <a href="#context-object">context object</a>
 <a title="concept-element-attribute-has" href="#concept-element-attribute-has">has</a> an
 <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
 <a title="concept-attribute-name" href="#concept-attribute-name">name</a> is
 <var>name</var>, and false otherwise.
</ol>

<p>The
<dfn title="dom-Element-hasAttributeNS" id="dom-element-hasattributens"><code>hasAttributeNS(<var>namespace</var>, <var>localName</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var>namespace</var> is the empty string, set it to null.

 <li><p>Return true if the <a href="#context-object">context object</a>
 <a title="concept-element-attribute-has" href="#concept-element-attribute-has">has</a> an
 <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
 <a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a> is <var>namespace</var>
 and <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is
 <var>localName</var>, and false otherwise.
</ol>

<hr>

<p>The
<dfn title="dom-Element-getAttributeNode" id="dom-element-getattributenode"><code>getAttributeNode(<var>name</var>)</code></dfn>
method, when invoked, must return the result of
<a title="concept-element-attributes-get-by-name" href="#concept-element-attributes-get-by-name">getting an attribute</a> given
<var>name</var> and the <a href="#context-object">context object</a>.

<p>The
<dfn title="dom-Element-getAttributeNodeNS" id="dom-element-getattributenodens"><code>getAttributeNodeNS(<var>namespace</var>, <var>localName</var>)</code></dfn>
method, when invoked, must return the result of
<a title="concept-element-attributes-get-by-namespace" href="#concept-element-attributes-get-by-namespace">getting an attribute</a> given
<var>namespace</var>, <var>localName</var>, and the <a href="#context-object">context object</a>.

<p>The
<dfn title="dom-Element-setAttributeNode" id="dom-element-setattributenode"><code>setAttributeNode(<var>attr</var>)</code></dfn>
method, when invoked, must return the result of
<a title="concept-element-attributes-set" href="#concept-element-attributes-set">setting an attribute</a> given
<var title="">attr</var> and the <a href="#context-object">context object</a>. Rethrow any exceptions.

<p>The
<dfn title="dom-Element-setAttributeNodeNS" id="dom-element-setattributenodens"><code>setAttributeNodeNS(<var>attr</var>)</code></dfn>
method, when invoked, must return the result of
<a title="concept-element-attributes-set" href="#concept-element-attributes-set">setting an attribute</a> given
<var title="">attr</var>, the <a href="#context-object">context object</a>, and
<i title="">namespace and local name flag</i> set. Rethrow any exceptions.

<p>The
<dfn title="dom-Element-removeAttributeNode" id="dom-element-removeattributenode"><code>removeAttributeNode(<var>attr</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>If <var title="">attr</var> is not in <a href="#context-object">context object</a>'s
 <a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">NotFoundError</code> exception.

 <li><p><a title="concept-element-attributes-remove" href="#concept-element-attributes-remove">Remove</a> <var title="">attr</var>
 from <a href="#context-object">context object</a>.

 <li><p>Return <var title="">attr</var>.
</ol>

<hr>

<dl class="domintro">
 <dt><code><var title="">element</var> . <a title="dom-Element-closest" href="#dom-element-closest">closest</a>(<var>selectors</var>)</code>
 <dd><p>Returns the first (starting at <var title="">element</var>)
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> that matches
 <var title="">selectors</var>, and null otherwise.

 <dt><code><var title="">element</var> . <a title="dom-Element-matches" href="#dom-element-matches">matches</a>(<var>selectors</var>)</code>
 <dd><p>Returns true if matching <var>selectors</var> against
 <var title="">element</var>'s <a title="concept-tree-root" href="#concept-tree-root">root</a> yields
 <var title="">element</var>, and false otherwise.
</dl>

<p>The <dfn title="dom-Element-closest" id="dom-element-closest"><code>closest(<var>selectors</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>Let <var title="">s</var> be the result of
 <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#parse-a-selector">parse a selector</a> from <var>selectors</var>.
 <a href="#refsSELECTORS">[SELECTORS]</a>

 <li><p>If <var title="">s</var> is failure, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">SyntaxError</code>.

 <li><p>Let <var title="">elements</var> be <a href="#context-object">context object</a>'s
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestors</a> that are
 <a title="concept-element" href="#concept-element">elements</a>, in reverse
 <a title="concept-tree-order" href="#concept-tree-order">tree order</a>.

 <li><p>For each <var title="">element</var> in <var title="">elements</var>, if
 <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#match-a-selector-against-an-element">match a selector against an element</a>, using
 <var>s</var>, <var title="">element</var>, and
 <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#scope-element">:scope element</a> <a href="#context-object">context object</a>,
 returns success, return <var title="">element</var>. <a href="#refsSELECTORS">[SELECTORS]</a>

 <li><p>Return null.
</ol>

<p>The <dfn title="dom-Element-matches" id="dom-element-matches"><code>matches(<var>selectors</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>Let <var title="">s</var> be the result of
 <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#parse-a-selector">parse a selector</a> from <var>selectors</var>.
 <a href="#refsSELECTORS">[SELECTORS]</a>

 <li><p>If <var title="">s</var> is failure, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">SyntaxError</code>.

 <li><p>Return true if the result of
 <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#match-a-selector-against-an-element">match a selector against an element</a>, using
 <var title="">s</var>, <var title="">element</var>, and
 <a data-anolis-spec="selectors" class="external" href="http://dev.w3.org/csswg/selectors/#scope-element">:scope element</a> <a href="#context-object">context object</a>,
 returns success, and false otherwise. <a href="#refsSELECTORS">[SELECTORS]</a>
</ol>

<hr>

<p>The
<dfn title="dom-Element-getElementsByTagName" id="dom-element-getelementsbytagname"><code>getElementsByTagName(<var>localName</var>)</code></dfn>
method must return the
<a title="concept-getElementsByTagName" href="#concept-getelementsbytagname">list of elements with local name <var>localName</var></a>
for the <a href="#context-object">context object</a>.

<p>The
<dfn title="dom-Element-getElementsByTagNameNS" id="dom-element-getelementsbytagnamens"><code>getElementsByTagNameNS(<var>namespace</var>, <var>localName</var>)</code></dfn>
method must return the
<a title="concept-getElementsByTagNameNS" href="#concept-getelementsbytagnamens">list of elements with namespace <var>namespace</var> and local name <var>localName</var></a>
for the <a href="#context-object">context object</a>.

<p>The
<dfn title="dom-Element-getElementsByClassName" id="dom-element-getelementsbyclassname"><code>getElementsByClassName(<var title="">classNames</var>)</code></dfn>
method must return the
<a title="concept-getElementsByClassName" href="#concept-getelementsbyclassname">list of elements with class names <var title="">classNames</var></a>
for the <a href="#context-object">context object</a>.


<h4 id="interface-namednodemap"><span class="secno">4.8.1 </span>Interface <code><a href="#namednodemap">NamedNodeMap</a></code></h4>

<pre class="idl">interface <dfn id="namednodemap">NamedNodeMap</dfn> {
  readonly attribute unsigned long <a title="dom-NamedNodeMap-length" href="#dom-namednodemap-length">length</a>;
  getter <a href="#attr">Attr</a>? <a title="dom-NamedNodeMap-item" href="#dom-namednodemap-item">item</a>(unsigned long <var title="">index</var>);
  getter <a href="#attr">Attr</a>? <a title="dom-NamedNodeMap-getNamedItem" href="#dom-namednodemap-getnameditem">getNamedItem</a>(DOMString <var>name</var>);
  <a href="#attr">Attr</a>? <a title="dom-NamedNodeMap-getNamedItemNS" href="#dom-namednodemap-getnameditemns">getNamedItemNS</a>(DOMString? <var>namespace</var>, DOMString <var>localName</var>);
  <a href="#attr">Attr</a>? <a title="dom-NamedNodeMap-setNamedItem" href="#dom-namednodemap-setnameditem">setNamedItem</a>(<a href="#attr">Attr</a> <var title="">attr</var>);
  <a href="#attr">Attr</a>? <a title="dom-NamedNodeMap-setNamedItemNS" href="#dom-namednodemap-setnameditemns">setNamedItemNS</a>(<a href="#attr">Attr</a> <var title="">attr</var>);
  <a href="#attr">Attr</a> <a title="dom-NamedNodeMap-removeNamedItem" href="#dom-namednodemap-removenameditem">removeNamedItem</a>(DOMString <var>name</var>);
  <a href="#attr">Attr</a> <a title="dom-NamedNodeMap-removeNamedItemNS" href="#dom-namednodemap-removenameditemns">removeNamedItemNS</a>(DOMString? <var>namespace</var>, DOMString <var>localName</var>);
};</pre>

<p>A <code><a href="#namednodemap">NamedNodeMap</a></code> has an associated
<dfn title="concept-NamedNodeMap-element" id="concept-namednodemap-element">element</dfn> (an
<a title="concept-element" href="#concept-element">element</a>).

<p>A <code><a href="#namednodemap">NamedNodeMap</a></code> object's
<dfn title="concept-NamedNodeMap-attribute" id="concept-namednodemap-attribute">attribute list</dfn> is its
<a title="concept-NamedNodeMap-element" href="#concept-namednodemap-element">element</a>'s
<a title="concept-element-attribute" href="#concept-element-attribute">attribute list</a>.

<hr>

<p>A <code><a href="#namednodemap">NamedNodeMap</a></code> object's
<a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-indices">supported property indices</a> are the numbers in the
range zero to the number of <a title="concept-attribute" href="#concept-attribute">attributes</a> in its
<a title="concept-NamedNodeMap-attribute" href="#concept-namednodemap-attribute">attribute list</a> map minus one, unless the
<a title="concept-NamedNodeMap-attribute" href="#concept-namednodemap-attribute">attribute list</a> is empty, in which case
there are no <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-indices">supported property indices</a>.

<p>The <dfn title="dom-NamedNodeMap-length" id="dom-namednodemap-length"><code>length</code></dfn> attribute's getter
must return the number of <a title="concept-attribute" href="#concept-attribute">attributes</a> in the
<a title="concept-NamedNodeMap-attribute" href="#concept-namednodemap-attribute">attribute list</a>.

<p>The
<dfn title="dom-NamedNodeMap-item" id="dom-namednodemap-item"><code>item(<var title="">index</var>)</code></dfn> method,
when invoked, must run these steps:

<ol>
 <li><p>If <var title="">index</var> is equal to or greater than the number of
 <a title="concept-attribute" href="#concept-attribute">attributes</a> in the
 <a title="concept-NamedNodeMap-attribute" href="#concept-namednodemap-attribute">attribute list</a>, return null.

 <li><p>Otherwise, return the <var title="">index</var>th
 <a title="concept-attribute" href="#concept-attribute">attribute</a> in the
 <a title="concept-NamedNodeMap-attribute" href="#concept-namednodemap-attribute">attribute list</a>.
</ol>

<p>A <code><a href="#namednodemap">NamedNodeMap</a></code> object's
<a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-names">supported property names</a>, all
<a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-unenumerable">unenumerable</a>, are the
<a title="concept-attribute-name" href="#concept-attribute-name">names</a> of the
<a title="concept-attribute" href="#concept-attribute">attributes</a> in the
<a title="concept-NamedNodeMap-attribute" href="#concept-namednodemap-attribute">attribute list</a>, in order.

<p>The
<dfn title="dom-NamedNodeMap-getNamedItem" id="dom-namednodemap-getnameditem"><code>getNamedItem(<var>name</var>)</code></dfn>
method, when invoked, must return the result of
<a title="concept-element-attributes-get-by-name" href="#concept-element-attributes-get-by-name">getting an attribute</a> given
<var>name</var> and <a title="concept-NamedNodeMap-element" href="#concept-namednodemap-element">element</a>.

<p>The
<dfn title="dom-NamedNodeMap-getNamedItemNS" id="dom-namednodemap-getnameditemns"><code>getNamedItemNS(<var>namespace</var>, <var>localName</var>)</code></dfn>
method, when invoked, must return the result of
<a title="concept-element-attributes-get-by-namespace" href="#concept-element-attributes-get-by-namespace">getting an attribute</a> given
<var>namespace</var>, <var>localName</var>, and
<a title="concept-NamedNodeMap-element" href="#concept-namednodemap-element">element</a>.

<p>The
<dfn title="dom-NamedNodeMap-setNamedItem" id="dom-namednodemap-setnameditem"><code>setNamedItem(<var>attr</var>)</code></dfn>
method, when invoked, must return the result of
<a title="concept-element-attributes-set" href="#concept-element-attributes-set">setting an attribute</a> given
<var title="">attr</var> and <a title="concept-NamedNodeMap-element" href="#concept-namednodemap-element">element</a>. Rethrow
any exceptions.

<p>The
<dfn title="dom-NamedNodeMap-setNamedItemNS" id="dom-namednodemap-setnameditemns"><code>setNamedItemNS(<var>attr</var>)</code></dfn>
method, when invoked, must return the result of
<a title="concept-element-attributes-set" href="#concept-element-attributes-set">setting an attribute</a> given
<var title="">attr</var>, <a title="concept-NamedNodeMap-element" href="#concept-namednodemap-element">element</a>, and
<i title="">namespace and local name flag</i> set. Rethrow any exceptions.

<p>The
<dfn title="dom-NamedNodeMap-removeNamedItem" id="dom-namednodemap-removenameditem"><code>removeNamedItem(<var>name</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>Let <var title="">attr</var> be the result of
 <a title="concept-element-attributes-remove-by-name" href="#concept-element-attributes-remove-by-name">removing an attribute</a> given
 <var>name</var> and <a title="concept-NamedNodeMap-element" href="#concept-namednodemap-element">element</a>.

 <li><p>If <var title="">attr</var> is null, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NotFoundError</code> exception.

 <li><p>Return <var title="">attr</var>.
</ol>

<p>The
<dfn title="dom-NamedNodeMap-removeNamedItemNS" id="dom-namednodemap-removenameditemns"><code>removeNamedItemNS(<var>namespace</var>, <var>localName</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>Let <var title="">attr</var> be the result of
 <a title="concept-element-attributes-remove-by-namespace" href="#concept-element-attributes-remove-by-namespace">removing an attribute</a>
 given <var>namespace</var>, <var>localName</var>, and
 <a title="concept-NamedNodeMap-element" href="#concept-namednodemap-element">element</a>.

 <li><p>If <var title="">attr</var> is null, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">NotFoundError</code> exception.

 <li><p>Return <var title="">attr</var>.
</ol>


<h4 id="interface-attr"><span class="secno">4.8.2 </span>Interface <code><a href="#attr">Attr</a></code></h4>

<pre class="idl">interface <dfn id="attr">Attr</dfn> {
  readonly attribute DOMString? <a title="dom-Attr-namespaceURI" href="#dom-attr-namespaceuri">namespaceURI</a>;
  readonly attribute DOMString? <a title="dom-Attr-prefix" href="#dom-attr-prefix">prefix</a>;
  readonly attribute DOMString <a title="dom-Attr-localName" href="#dom-attr-localname">localName</a>;
  readonly attribute DOMString <a title="dom-Attr-name" href="#dom-attr-name">name</a>;
           attribute DOMString <a title="dom-Attr-value" href="#dom-attr-value">value</a>;
           attribute DOMString <a title="dom-Attr-nodeValue" href="#dom-attr-nodevalue">nodeValue</a>; // legacy alias of .value
           attribute DOMString <a title="dom-Attr-textContent" href="#dom-attr-textcontent">textContent</a>; // legacy alias of .value

  readonly attribute <a href="#element">Element</a>? <a title="dom-Attr-ownerElement" href="#dom-attr-ownerelement">ownerElement</a>;

  readonly attribute boolean <a title="dom-Attr-specified" href="#dom-attr-specified">specified</a>; // useless; always returns true
};</pre>

<p><code><a href="#attr">Attr</a></code> objects are simply known as
<dfn title="concept-attribute" id="concept-attribute">attributes</dfn>. They are sometimes referred
to as <em>content attributes</em> to avoid confusion with IDL attributes.

<p><a title="concept-attribute" href="#concept-attribute">Attributes</a> have a
<dfn title="concept-attribute-namespace" id="concept-attribute-namespace">namespace</dfn> (null or a non-empty string),
<dfn title="concept-attribute-namespace-prefix" id="concept-attribute-namespace-prefix">namespace prefix</dfn> (null or a non-empty string),
<dfn title="concept-attribute-local-name" id="concept-attribute-local-name">local name</dfn> (a non-empty string),
<dfn title="concept-attribute-name" id="concept-attribute-name">name</dfn> (a non-empty string),
<dfn title="concept-attribute-value" id="concept-attribute-value">value</dfn> (a string), and
<dfn title="concept-attribute-element" id="concept-attribute-element">element</dfn> (null or an
<a title="concept-element" href="#concept-element">element</a>).

<p class="note">If designed today they would just have a name and value. ☹

<p>When an <a title="concept-attribute" href="#concept-attribute">attribute</a> is created, its
<a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is given. Unless explicitly
given when an <a title="concept-attribute" href="#concept-attribute">attribute</a> is created, its
<a title="concept-attribute-name" href="#concept-attribute-name">name</a> is set to its
<a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>, its
<a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a>,
<a title="concept-attribute-namespace-prefix" href="#concept-attribute-namespace-prefix">namespace prefix</a>, and
<a title="concept-attribute-element" href="#concept-attribute-element">element</a> are set to null, and its
<a title="concept-attribute-value" href="#concept-attribute-value">value</a> is set to the empty string.

<p>An
<dfn title="concept-named-attribute" id="concept-named-attribute"><code><var title="">A</var></code> attribute</dfn>
is an <a title="concept-attribute" href="#concept-attribute">attribute</a> whose
<a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> is
<code><var title="">A</var></code> and whose
<a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a> and
<a title="concept-attribute-namespace-prefix" href="#concept-attribute-namespace-prefix">namespace prefix</a> are
null.

<hr>

<p>The <dfn title="dom-Attr-namespaceURI" id="dom-attr-namespaceuri"><code>namespaceURI</code></dfn>
attribute's getter must return the
<a title="concept-attribute-namespace" href="#concept-attribute-namespace">namespace</a>.

<p>The <dfn title="dom-Attr-prefix" id="dom-attr-prefix"><code>prefix</code></dfn> attribute's getter must return
the <a title="concept-attribute-namespace-prefix" href="#concept-attribute-namespace-prefix">namespace prefix</a>.

<p>The <dfn title="dom-Attr-localName" id="dom-attr-localname"><code>localName</code></dfn> attribute's getter must
return the <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>.

<p>The <dfn title="dom-Attr-name" id="dom-attr-name"><code>name</code></dfn> attribute's getter must return the
<a title="concept-attribute-name" href="#concept-attribute-name">name</a>.

<p>The <dfn title="dom-Attr-value" id="dom-attr-value"><code>value</code></dfn> attribute's getter,
<dfn title="dom-Attr-nodeValue" id="dom-attr-nodevalue"><code>nodeValue</code></dfn> attribute's getter, and
<dfn title="dom-Attr-textContent" id="dom-attr-textcontent"><code>textContent</code></dfn> attribute's getter, must
return the <a title="concept-attribute-value" href="#concept-attribute-value">value</a>.

<p>The <code title="dom-Attr-value"><a href="#dom-attr-value">value</a></code> attribute's setter,
<code title="dom-Attr-nodeValue"><a href="#dom-attr-nodevalue">nodeValue</a></code> attribute's setter, and
<code title="dom-Attr-textContent"><a href="#dom-attr-textcontent">textContent</a></code> attribute's setter, must run these
steps:

<ol>
 <li><p>If <a href="#context-object">context object</a>'s
 <a title="concept-attribute-element" href="#concept-attribute-element">element</a> is null, set
 <a href="#context-object">context object</a>'s <a title="concept-attribute-value" href="#concept-attribute-value">value</a> to the
 given value.

 <li><p>Otherwise, <a title="concept-element-attributes-change" href="#concept-element-attributes-change">change</a> the
 <a href="#context-object">context object</a> from <a href="#context-object">context object</a>'s
 <a title="concept-attribute-element" href="#concept-attribute-element">element</a> to the given value.
</ol>

<p class="note">Unlike with <a title="concept-node" href="#concept-node">node</a>'s
<code title="dom-Node-textContent"><a href="#dom-node-textcontent">textContent</a></code>, no special null handling is required
here.

<hr>

<p>The <dfn title="dom-Attr-ownerElement" id="dom-attr-ownerelement"><code>ownerElement</code></dfn> attribute's getter
must return the <a title="concept-attribute-element" href="#concept-attribute-element">element</a>.

<hr>

<p>The <dfn title="dom-Attr-specified" id="dom-attr-specified"><code>specified</code></dfn> attribute's getter must
return true.


<h3 id="interface-characterdata"><span class="secno">4.9 </span>Interface <code><a href="#characterdata">CharacterData</a></code></h3>
<pre class="idl">interface <dfn id="characterdata">CharacterData</dfn> : <a href="#node">Node</a> {
  [TreatNullAs=EmptyString] attribute DOMString <a title="dom-CharacterData-data" href="#dom-characterdata-data">data</a>;
  readonly attribute unsigned long <a title="dom-CharacterData-length" href="#dom-characterdata-length">length</a>;
  DOMString <a title="dom-CharacterData-substringData" href="#dom-characterdata-substringdata">substringData</a>(unsigned long <var title="">offset</var>, unsigned long <var title="">count</var>);
  void <a title="dom-CharacterData-appendData" href="#dom-characterdata-appenddata">appendData</a>(DOMString <var title="">data</var>);
  void <a title="dom-CharacterData-insertData" href="#dom-characterdata-insertdata">insertData</a>(unsigned long <var title="">offset</var>, DOMString <var title="">data</var>);
  void <a title="dom-CharacterData-deleteData" href="#dom-characterdata-deletedata">deleteData</a>(unsigned long <var title="">offset</var>, unsigned long <var title="">count</var>);
  void <a title="dom-CharacterData-replaceData" href="#dom-characterdata-replacedata">replaceData</a>(unsigned long <var title="">offset</var>, unsigned long <var title="">count</var>, DOMString <var title="">data</var>);
};</pre>

<p class="note"><code><a href="#characterdata">CharacterData</a></code> is an abstract interface and does
not exist as <a title="concept-node" href="#concept-node">node</a>. It is used by
<code><a href="#text">Text</a></code>, <code><a href="#comment">Comment</a></code>, and
<code><a href="#processinginstruction">ProcessingInstruction</a></code> <a title="concept-node" href="#concept-node">nodes</a>.

<p>Each <a title="concept-node" href="#concept-node">node</a> inheriting from the
<code><a href="#characterdata">CharacterData</a></code> interface has an associated mutable string
called <dfn title="concept-CD-data" id="concept-cd-data">data</dfn>.

<p>To <dfn title="concept-CD-replace" id="concept-cd-replace">replace data</dfn> of node
<var title="">node</var> with offset <var title="">offset</var>, count
<var title="">count</var>, and data <var title="">data</var>, run these steps:</p>

<ol>
 <li><p>Let <var title="">length</var> be <var title="">node</var>'s
 <code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute value.

 <li><p>If <var title="">offset</var> is greater than <var title="">length</var>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">IndexSizeError</code> exception.

 <li><p>If <var title="">offset</var> plus <var title="">count</var> is greater
 than <var title="">length</var> let <var title="">count</var> be
 <var title="">length</var> minus <var title="">offset</var>.

 <li><p><a href="#queue-a-mutation-record">Queue a mutation record</a> of "<code><a href="#characterdata">characterData</a></code>"
 for <var title="">node</var> with oldValue <var title="">node</var>'s
 <a title="concept-CD-data" href="#concept-cd-data">data</a>.

 <li><p>Insert <var title="">data</var> into <var title="">node</var>'s
 <a title="concept-CD-data" href="#concept-cd-data">data</a> after <var title="">offset</var>
 <a title="code unit" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code units</a>.

 <li><p>Let <var title="">delete offset</var> be <var title="">offset</var> plus
 the number of
 <a title="code unit" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code units</a> in
 <var title="">data</var>.

 <li><p>Starting from <var title="">delete offset</var>
 <a title="code unit" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code units</a>, remove
 <var title="">count</var>
 <a title="code unit" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code units</a> from
 <var title="">node</var>'s <a title="concept-CD-data" href="#concept-cd-data">data</a>.

 <!-- ranges -->
 <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
 <var title="">node</var> and
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> is greater than
 <var title="">offset</var> but less than or equal to <var title="">offset</var>
 plus <var title="">count</var>, set its
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> to
 <var title="">offset</var>.

 <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is
 <var title="">node</var> and
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> is greater than
 <var title="">offset</var> but less than or equal to <var title="">offset</var>
 plus <var title="">count</var>, set its
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> to
 <var title="">offset</var>.

 <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
 <var title="">node</var> and
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> is greater than
 <var title="">offset</var> plus <var title="">count</var>, increase its
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> by the number of
 <a title="code unit" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code units</a> in
 <var title="">data</var>, then decrease it by <var title="">count</var>.

 <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is
 <var title="">node</var> and
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> is greater than
 <var title="">offset</var> plus <var title="">count</var>, increase its
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> by the number of
 <a title="code unit" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code units</a> in
 <var title="">data</var>, then decrease it by <var title="">count</var>.
</ol>
<!-- delete happens after insert for better cursor positioning with editing
https://www.w3.org/Bugs/Public/show_bug.cgi?id=13153 -->

<!-- If you set a node's data to a new value (e.g., using the data
attribute):

IE 9: Acts like the node was deleted and recreated, moves the boundary
points up to the parent
Firefox 4: Resets the offset to 0, always
Chrome 11 dev: Resets the offset to 0, except it does nothing if the new
data is the same as the old data
Opera 11: Sets a start offset to 0 and an end offset to the end of the
data, always

The spec originally followed WebKit, since it seemed to make the most sense.
Opera's approach of setting end offsets to the length of the new data
arguably makes more sense, but that's debatable, and it's greatly
outnumbered. However, after some feedback by bzbarsky that checking for
equality is expensive, I removed the special case and matched Firefox:

https://www.w3.org/Bugs/Public/show_bug.cgi?id=13250

Authors who want WebKit-like behavior can always use replaceData() instead.

XXX replaceData is the same as setting data these days -->


<p>To <dfn title="concept-CD-substring" id="concept-cd-substring">substring data</dfn> with node
<var title="">node</var>, offset <var title="">offset</var>, and count
<var title="">count</var>, run these steps:

<ol>
 <li><p>Let <var title="">length</var> be <var title="">node</var>'s
 <code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute value.

 <li><p>If <var title="">offset</var> is greater than <var title="">length</var>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">IndexSizeError</code> exception.

 <li><p>If <var title="">offset</var> plus <var title="">count</var> is
 greater than <var title="">length</var>, return a string whose value is the
 <a title="code unit" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code units</a> from the
 <var title="">offset</var><sup>th</sup>
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code unit</a> to the end of
 <var title="">node</var>'s <a title="concept-CD-data" href="#concept-cd-data">data</a>, and then
 terminate these steps.

 <li><p>Return a string whose value is the
 <a title="code unit" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code units</a> from the
 <var title="">offset</var><sup>th</sup>
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code unit</a> to the
 <var title="">offset</var>+<var title="">count</var><sup>th</sup>
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code unit</a> in <var title="">node</var>'s
 <a title="concept-CD-data" href="#concept-cd-data">data</a>.
</ol>

<p>The <dfn title="dom-CharacterData-data" id="dom-characterdata-data"><code>data</code></dfn> attribute
must return <a title="concept-CD-data" href="#concept-cd-data">data</a>, and on setting, must
<a title="concept-CD-replace" href="#concept-cd-replace">replace data</a> with node
<a href="#context-object">context object</a> offset 0, count
<code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute value, and data
new value.

<p>The <dfn title="dom-CharacterData-length" id="dom-characterdata-length"><code>length</code></dfn>
attribute must return the number of
<a title="code unit" data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-code-unit">code units</a> in
<a title="concept-CD-data" href="#concept-cd-data">data</a>.

<p>The
<dfn title="dom-CharacterData-substringData" id="dom-characterdata-substringdata"><code>substringData(<var title="">offset</var>, <var title="">count</var>)</code></dfn>
method must <a title="concept-CD-substring" href="#concept-cd-substring">substring data</a> with node
<a href="#context-object">context object</a>, offset <var title="">offset</var>, and count
<var title="">count</var>.

<p>The
<dfn title="dom-CharacterData-appendData" id="dom-characterdata-appenddata"><code>appendData(<var title="">data</var>)</code></dfn>
method must <a title="concept-CD-replace" href="#concept-cd-replace">replace data</a> with node
<a href="#context-object">context object</a>, offset
<code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute value, count 0,
and data <var title="">data</var>.

<p>The
<dfn title="dom-CharacterData-insertData" id="dom-characterdata-insertdata"><code>insertData(<var title="">offset</var>, <var title="">data</var>)</code></dfn>
method must <a title="concept-CD-replace" href="#concept-cd-replace">replace data</a> with node
<a href="#context-object">context object</a>, offset <var title="">offset</var>, count 0, and
data <var title="">data</var>.

<p>The
<dfn title="dom-CharacterData-deleteData" id="dom-characterdata-deletedata"><code>deleteData(<var title="">offset</var>, <var title="">count</var>)</code></dfn>
method must <a title="concept-CD-replace" href="#concept-cd-replace">replace data</a> with node
<a href="#context-object">context object</a>, offset <var title="">offset</var>, count
<var title="">count</var>, and data the empty string.

<p>The
<dfn title="dom-CharacterData-replaceData" id="dom-characterdata-replacedata"><code>replaceData(<var title="">offset</var>, <var title="">count</var>, <var title="">data</var>)</code></dfn>
method must <a title="concept-CD-replace" href="#concept-cd-replace">replace data</a> with node
<a href="#context-object">context object</a>, offset <var title="">offset</var>, count
<var title="">count</var>, and data <var title="">data</var>.


<h3 id="interface-text"><span class="secno">4.10 </span>Interface <code><a href="#text">Text</a></code></h3>
<pre class="idl">[<a title="dom-Text" href="#dom-text">Constructor</a>(optional DOMString <var title="">data</var> = "")]
interface <dfn id="text">Text</dfn> : <a href="#characterdata">CharacterData</a> {
  [NewObject] <a href="#text">Text</a> <a title="dom-Text-splitText" href="#dom-text-splittext">splitText</a>(unsigned long <var title="">offset</var>);
  readonly attribute DOMString <a title="dom-Text-wholeText" href="#dom-text-wholetext">wholeText</a>;
};</pre>

<dl class="domintro">
 <dt><code><var title="">text</var> = new <a title="dom-DocumentFragment" href="#dom-documentfragment">Text</a>([<var title="">data</var> = ""])</code>
 <dd><p>Returns a new <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a> whose
 <a title="concept-CD-data" href="#concept-cd-data">data</a> is <var title="">data</var>.

 <dt><code><var title="">text</var> . <a title="dom-Text-splitText" href="#dom-text-splittext">splitText</a>(<var title="">offset</var>)</code>
 <dd><p>Splits <a title="concept-CD-data" href="#concept-cd-data">data</a> at the given
 <var title="">offset</var> and returns the remainder as <code><a href="#text">Text</a></code>
 <a title="concept-node" href="#concept-node">node</a>.

 <dt><code><var title="">text</var> . <a title="dom-Text-wholeText" href="#dom-text-wholetext">wholeText</a></code>
 <dd><p>Returns the combined <a title="concept-CD-data" href="#concept-cd-data">data</a> of all direct
 <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>
 <a title="concept-tree-sibling" href="#concept-tree-sibling">siblings</a>.
</dl>

<p>The <dfn title="dom-Text" id="dom-text"><code>Text(<var title="">data</var>)</code></dfn> constructor
must return a new <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a> whose
<a title="concept-CD-data" href="#concept-cd-data">data</a> is <var title="">data</var> and
<a title="concept-node-document" href="#concept-node-document">node document</a> is the global object's associated
<a title="concept-document" href="#concept-document">document</a>.

<p>To <dfn title="concept-Text-split" id="concept-text-split">split</dfn> a <code><a href="#text">Text</a></code>
<a title="concept-node" href="#concept-node">node</a> <var title="">node</var> with offset
<var title="">offset</var>, run these steps:

<ol>
 <li><p>Let <var title="">length</var> be <var title="">node</var>'s
 <code title="dom-CharacterData-length"><a href="#dom-characterdata-length">length</a></code> attribute value.

 <li><p>If <var title="">offset</var> is greater than <var title="">length</var>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">IndexSizeError</code> exception.

 <li><p>Let <var title="">count</var> be <var title="">length</var> minus
 <var title="">offset</var>.

 <li><p>Let <var title="">new data</var> be the result of
 <a title="concept-CD-substring" href="#concept-cd-substring">substringing data</a> with node
 <var title="">node</var>, offset <var title="">offset</var>, and count
 <var title="">count</var>.

 <li><p>Let <var title="">new node</var> be a new <code><a href="#text">Text</a></code>
 <a title="concept-node" href="#concept-node">node</a>, with the same
 <a title="concept-node-document" href="#concept-node-document">node document</a> as
 <var title="">node</var>. Set <var title="">new node</var>'s
 <a title="concept-CD-data" href="#concept-cd-data">data</a> to <var title="">new data</var>.

 <li><p>Let <var title="">parent</var> be <var title="">node</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li>
  <p>If <var title="">parent</var> is not null, run these substeps:

  <ol>
   <li><p><a title="concept-node-insert" href="#concept-node-insert">Insert</a>
   <var title="">new node</var> into <var title="">parent</var> before
   <var title="">node</var>'s
   <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>.
   <!-- Do this before we replace data, so that the data replacement won't
   mutate ranges prematurely:
   https://www.w3.org/Bugs/Public/show_bug.cgi?id=15325 -->

   <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
   <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
   <var title="">node</var> and
   <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> is greater than
   <var title="">offset</var>, set its
   <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> to
   <var title="">new node</var> and decrease its
   <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> by
   <var title="">offset</var>.

   <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
   <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is
   <var title="">node</var> and
   <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> is greater than
   <var title="">offset</var>, set its
   <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> to
   <var title="">new node</var> and decrease its
   <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> by
   <var title="">offset</var>.

   <!-- This shit is complicated:
        https://www.w3.org/Bugs/Public/show_bug.cgi?id=19968 -->
   <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
   <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
   <var title="">parent</var> and
   <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> is equal to
   the <a title="concept-tree-index" href="#concept-tree-index">index</a> of
   <var title="">node</var> + 1, increase its
   <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> by one.

   <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
   <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is
   <var title="">parent</var> and
   <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> is equal to
   the <a title="concept-tree-index" href="#concept-tree-index">index</a> of
   <var title="">node</var> + 1, increase its
   <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> by one.
  </ol>

 <li><p><a title="concept-CD-replace" href="#concept-cd-replace">Replace data</a> with node
 <var title="">node</var>, offset <var title="">offset</var>, count
 <var title="">count</var>, and data the empty string.

 <li>
  <p>If <var title="">parent</var> is null, run these substeps:</p>

  <ol>
   <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
   <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
   <var title="">node</var> and
   <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> is greater
   than <var title="">offset</var>, set its
   <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> to
   <var title="">offset</var>.

   <li><p>For each <a title="concept-range" href="#concept-range">range</a> whose
   <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is
   <var title="">node</var> and
   <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> is greater than
   <var title="">offset</var>, set its
   <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a> to
   <var title="">offset</var>.
  </ol>

 <li><p>Return <var title="">new node</var>.
</ol>

<p>The
<dfn title="dom-Text-splitText" id="dom-text-splittext"><code>splitText(<var>offset</var>)</code></dfn>
method must <a title="concept-Text-split" href="#concept-text-split">split</a> the
<a href="#context-object">context object</a> with offset <var title="">offset</var>.


<p>The <dfn id="contiguous-text-nodes">contiguous <code>Text</code> nodes</dfn> of a node are the node
itself, the
<a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a>
<code><a href="#text">Text</a></code> node (if any) and its
<a href="#contiguous-text-nodes">contiguous <code>Text</code> nodes</a>, and the
<a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a> <code><a href="#text">Text</a></code>
node (if any) and its <a href="#contiguous-text-nodes">contiguous <code>Text</code> nodes</a>,
avoiding any duplicates.

<p>The <dfn title="dom-Text-wholeText" id="dom-text-wholetext"><code>wholeText</code></dfn>
attribute must return a concatenation of the
<a title="concept-CD-data" href="#concept-cd-data">data</a> of the
<a href="#contiguous-text-nodes">contiguous <code>Text</code> nodes</a> of the
<a href="#context-object">context object</a>, in
<a title="concept-tree-order" href="#concept-tree-order">tree order</a>.



<h3 id="interface-processinginstruction"><span class="secno">4.11 </span>Interface <code><a href="#processinginstruction">ProcessingInstruction</a></code></h3>
<pre class="idl">interface <dfn id="processinginstruction">ProcessingInstruction</dfn> : <a href="#characterdata">CharacterData</a> {
  readonly attribute DOMString <a title="dom-ProcessingInstruction-target" href="#dom-processinginstruction-target">target</a>;
};</pre>

<p><code><a href="#processinginstruction">ProcessingInstruction</a></code> <a title="concept-node" href="#concept-node">nodes</a>
have an associated <dfn title="concept-PI-target" id="concept-pi-target">target</dfn>.

<p>The <dfn title="dom-ProcessingInstruction-target" id="dom-processinginstruction-target"><code>target</code></dfn>
attribute must return the <a title="concept-PI-target" href="#concept-pi-target">target</a>.



<h3 id="interface-comment"><span class="secno">4.12 </span>Interface <code><a href="#comment">Comment</a></code></h3>
<pre class="idl">[<a title="dom-Comment" href="#dom-comment">Constructor</a>(optional DOMString <var title="">data</var> = "")]
interface <dfn id="comment">Comment</dfn> : <a href="#characterdata">CharacterData</a> {
};</pre>

<dl class="domintro">
 <dt><code><var title="">comment</var> = new <a title="dom-Comment" href="#dom-comment">Comment</a>([<var title="">data</var> = ""])</code>
 <dd><p>Returns a new <code><a href="#comment">Comment</a></code> <a title="concept-node" href="#concept-node">node</a> whose
 <a title="concept-CD-data" href="#concept-cd-data">data</a> is <var title="">data</var>.
</dl>

<p>The <dfn title="dom-Comment" id="dom-comment"><code>Comment(<var title="">data</var>)</code></dfn>
constructor must return a new <code><a href="#comment">Comment</a></code> <a title="concept-node" href="#concept-node">node</a>
whose <a title="concept-CD-data" href="#concept-cd-data">data</a> is <var title="">data</var> and
<a title="concept-node-document" href="#concept-node-document">node document</a> is the global object's associated
<a title="concept-document" href="#concept-document">document</a>.




<h2 id="ranges"><span class="secno">5 </span>Ranges</h2>

<h3 id="introduction-to-dom-ranges"><span class="secno">5.1 </span>Introduction to "DOM Ranges"</h3>

<p>A <code><a href="#range">Range</a></code> object (<a title="concept-range" href="#concept-range">range</a>)
represents a sequence of content within a
<a title="concept-node-tree" href="#concept-node-tree">node tree</a>. Each
<a title="concept-range" href="#concept-range">range</a> has a
<a title="concept-range-start" href="#concept-range-start">start</a> and an
<a title="concept-range-end" href="#concept-range-end">end</a> which are
<a title="concept-range-bp" href="#concept-range-bp">boundary points</a>. A
<a title="concept-range-bp" href="#concept-range-bp">boundary point</a> is a tuple consisting of
a <a title="concept-node" href="#concept-node">node</a> and a non-negative numeric
<a title="concept-range-bp-offset" href="#concept-range-bp-offset">offset</a>. So in other words, a
<a title="concept-range" href="#concept-range">range</a> represents a piece of content within
a <a title="concept-node-tree" href="#concept-node-tree">node tree</a> between two
<a title="concept-range-bp" href="#concept-range-bp">boundary points</a>.

<p><a title="concept-range" href="#concept-range">Ranges</a> are frequently used in editing
for selecting and copying content.

<ul class="domTree">
 <li class="t1"><a title="concept-element" href="#concept-element">Element</a>: <code>p</code>
  <ul>
   <li class="t1"><a title="concept-element" href="#concept-element">Element</a>: <code>img</code> <span title="" class="t2"><code class="attribute name">src</code>="<code class="attribute value">insanity-wolf</code>"</span> <span title="" class="t2"><code class="attribute name">alt</code>="<code class="attribute value">Little-endian BOM; decode as big-endian!</code>"</span>
   <li class="t3"><code><a href="#text">Text</a></code>: <span title=""> CSS 2.1 syndata is </span>
   <li class="t1"><a title="concept-element" href="#concept-element">Element</a>: <code>em</code>
    <ul>
     <li class="t3"><code><a href="#text">Text</a></code>: <span title="">awesome</span>
    </ul>
   <li class="t3"><code><a href="#text">Text</a></code>: <span title="">!</span>
  </ul>
</ul>
<!-- http://w3cmemes.tumblr.com/post/35332222321/css-2-1-syndata-is-awesome -->

<p>In the <a title="concept-node-tree" href="#concept-node-tree">node tree</a> above, a
<a title="concept-range" href="#concept-range">range</a> can be used to represent the sequence
“syndata is awes”. Assuming <var title="">p</var> is assigned to the
<code>p</code> <a title="concept-element" href="#concept-element">element</a>, and
<var title="">em</var> to the <code>em</code>
<a title="concept-element" href="#concept-element">element</a>, this would be done as follows:

<pre><code>var range = new Range(),
    firstText = p.childNodes[1],
    secondText = em.firstChild
range.setStart(firstText, 9) // do not forget the leading space
range.setEnd(secondText, 4)
// range now stringifies to the aforementioned quote</code></pre>

<p class="note"><a title="concept-attribute" href="#concept-attribute">Attributes</a> such as
<code>src</code> and <code>alt</code> in the
<a title="concept-node-tree" href="#concept-node-tree">node tree</a> above cannot be represented
by a <a title="concept-range" href="#concept-range">range</a>. The
<a title="concept-range" href="#concept-range">ranges</a> concept is only useful for
<a title="concept-node" href="#concept-node">nodes</a>.

<p><a title="concept-range" href="#concept-range">Ranges</a> are affected by mutations to the
<a title="concept-node-tree" href="#concept-node-tree">node tree</a>. Such mutations will not
invalidate a <a title="concept-range" href="#concept-range">range</a> and will try to ensure
that the <a title="concept-range" href="#concept-range">range</a> still represents the same
piece of content. Necessarily, a <a title="concept-range" href="#concept-range">range</a>
might itself be modified as part of the mutation to the
<a title="concept-node-tree" href="#concept-node-tree">node tree</a> when e.g. part of the content
it represents is mutated.

<p class="note">See the <a title="concept-node-insert" href="#concept-node-insert">insert</a> and
<a title="concept-node-remove" href="#concept-node-remove">remove</a> algorithms, the
<code title="dom-Node-normalize"><a href="#dom-node-normalize">normalize()</a></code> method, and the
<a title="concept-CD-replace" href="#concept-cd-replace">replace data</a> and
<a title="concept-Text-split" href="#concept-text-split">split</a> algorithms for the hairy
details.


<h3 id="interface-range"><span class="secno">5.2 </span>Interface <code><a href="#range">Range</a></code></h3>
<pre class="idl">[<a title="dom-Range" href="#dom-range">Constructor</a>]
interface <dfn id="range">Range</dfn> {
  readonly attribute <a href="#node">Node</a> <a title="dom-Range-startContainer" href="#dom-range-startcontainer">startContainer</a>;
  readonly attribute unsigned long <a title="dom-Range-startOffset" href="#dom-range-startoffset">startOffset</a>;
  readonly attribute <a href="#node">Node</a> <a title="dom-Range-endContainer" href="#dom-range-endcontainer">endContainer</a>;
  readonly attribute unsigned long <a title="dom-Range-endOffset" href="#dom-range-endoffset">endOffset</a>;
  readonly attribute boolean <a title="dom-Range-collapsed" href="#dom-range-collapsed">collapsed</a>;
  readonly attribute <a href="#node">Node</a> <a title="dom-Range-commonAncestorContainer" href="#dom-range-commonancestorcontainer">commonAncestorContainer</a>;

  void <a title="dom-Range-setStart" href="#dom-range-setstart">setStart</a>(<a href="#node">Node</a> <var title="">node</var>, unsigned long <var title="">offset</var>);
  void <a title="dom-Range-setEnd" href="#dom-range-setend">setEnd</a>(<a href="#node">Node</a> <var title="">node</var>, unsigned long <var title="">offset</var>);
  void <a title="dom-Range-setStartBefore" href="#dom-range-setstartbefore">setStartBefore</a>(<a href="#node">Node</a> <var title="">node</var>);
  void <a title="dom-Range-setStartAfter" href="#dom-range-setstartafter">setStartAfter</a>(<a href="#node">Node</a> <var title="">node</var>);
  void <a title="dom-Range-setEndBefore" href="#dom-range-setendbefore">setEndBefore</a>(<a href="#node">Node</a> <var title="">node</var>);
  void <a title="dom-Range-setEndAfter" href="#dom-range-setendafter">setEndAfter</a>(<a href="#node">Node</a> <var title="">node</var>);
  void <a title="dom-Range-collapse" href="#dom-range-collapse">collapse</a>(optional boolean <var title="">toStart</var> = false);
  void <a title="dom-Range-selectNode" href="#dom-range-selectnode">selectNode</a>(<a href="#node">Node</a> <var title="">node</var>);
  void <a title="dom-Range-selectNodeContents" href="#dom-range-selectnodecontents">selectNodeContents</a>(<a href="#node">Node</a> <var title="">node</var>);

  const unsigned short <dfn title="dom-CompareHow-START_TO_START" id="dom-comparehow-start_to_start">START_TO_START</dfn> = 0;
  const unsigned short <dfn title="dom-CompareHow-START_TO_END" id="dom-comparehow-start_to_end">START_TO_END</dfn> = 1;
  const unsigned short <dfn title="dom-CompareHow-END_TO_END" id="dom-comparehow-end_to_end">END_TO_END</dfn> = 2;
  const unsigned short <dfn title="dom-CompareHow-END_TO_START" id="dom-comparehow-end_to_start">END_TO_START</dfn> = 3;
  short <a title="dom-Range-compareBoundaryPoints" href="#dom-range-compareboundarypoints">compareBoundaryPoints</a>(unsigned short <var title="">how</var>, <a href="#range">Range</a> <var title="">sourceRange</var>);

  void <a title="dom-Range-deleteContents" href="#dom-range-deletecontents">deleteContents</a>();
  [NewObject] <a href="#documentfragment">DocumentFragment</a> <a title="dom-Range-extractContents" href="#dom-range-extractcontents">extractContents</a>();
  [NewObject] <a href="#documentfragment">DocumentFragment</a> <a title="dom-Range-cloneContents" href="#dom-range-clonecontents">cloneContents</a>();
  void <a title="dom-Range-insertNode" href="#dom-range-insertnode">insertNode</a>(<a href="#node">Node</a> <var title="">node</var>);
  void <a title="dom-Range-surroundContents" href="#dom-range-surroundcontents">surroundContents</a>(<a href="#node">Node</a> <var title="">newParent</var>);

  [NewObject] <a href="#range">Range</a> <a title="dom-Range-cloneRange" href="#dom-range-clonerange">cloneRange</a>();
  void <a title="dom-Range-detach" href="#dom-range-detach">detach</a>();

  boolean <a title="dom-Range-isPointInRange" href="#dom-range-ispointinrange">isPointInRange</a>(<a href="#node">Node</a> <var title="">node</var>, unsigned long <var title="">offset</var>);
  short <a title="dom-Range-comparePoint" href="#dom-range-comparepoint">comparePoint</a>(<a href="#node">Node</a> <var title="">node</var>, unsigned long <var title="">offset</var>);

  boolean <a title="dom-Range-intersectsNode" href="#dom-range-intersectsnode">intersectsNode</a>(<a href="#node">Node</a> <var title="">node</var>);

  <a title="dom-Range-stringifier" href="#dom-range-stringifier">stringifier</a>;
};</pre>

<p><code><a href="#range">Range</a></code> objects are simply known as
<dfn title="concept-range" id="concept-range">ranges</dfn>.

<p>A <dfn title="concept-range-bp" id="concept-range-bp">boundary point</dfn> is a
(<a title="concept-node" href="#concept-node">node</a>,
<dfn title="concept-range-bp-offset" id="concept-range-bp-offset">offset</dfn>) tuple, where
<a title="concept-range-bp-offset" href="#concept-range-bp-offset">offset</a> is a non-negative
integer.

<p class="note">Generally speaking, a
<a title="concept-range-bp" href="#concept-range-bp">boundary point</a>'s
<a title="concept-range-bp-offset" href="#concept-range-bp-offset">offset</a> will be between zero and
the <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>'s
<a title="concept-node" href="#concept-node">node</a>
<a title="concept-node-length" href="#concept-node-length">length</a>, inclusive. Algorithms that
modify a <a title="concept-tree" href="#concept-tree">tree</a> (in particular the
<a title="concept-node-insert" href="#concept-node-insert">insert</a>,
<a title="concept-node-remove" href="#concept-node-remove">remove</a>,
<a title="concept-CD-replace" href="#concept-cd-replace">replace data</a>, and
<a title="concept-Text-split" href="#concept-text-split">split</a> algorithms) also modify
<a title="concept-range" href="#concept-range">ranges</a> associated with that
<a title="concept-tree" href="#concept-tree">tree</a>.

<p>If the two <a title="concept-node" href="#concept-node">nodes</a> of
<a title="concept-range-bp" href="#concept-range-bp">boundary points</a>
(<var title="">node A</var>, <var title="">offset A</var>) and
(<var title="">node B</var>, <var title="">offset B</var>) have the same
<a title="concept-tree-root" href="#concept-tree-root">root</a>, the
<dfn title="concept-range-bp-position" id="concept-range-bp-position">position</dfn> of the first relative to
the second is either <dfn title="concept-range-bp-before" id="concept-range-bp-before">before</dfn>,
<dfn title="concept-range-bp-equal" id="concept-range-bp-equal">equal</dfn>, or
<dfn title="concept-range-bp-after" id="concept-range-bp-after">after</dfn>,
as returned by the following algorithm:

<ol>
 <li><p>If <var title="">node A</var> is the same as <var title="">node B</var>,
 return <a title="concept-range-bp-equal" href="#concept-range-bp-equal">equal</a> if
 <var title="">offset A</var> is the same as <var title="">offset B</var>,
 <a title="concept-range-bp-before" href="#concept-range-bp-before">before</a> if
 <var title="">offset A</var> is less than <var title="">offset B</var>, and
 <a title="concept-range-bp-after" href="#concept-range-bp-after">after</a> if
 <var title="">offset A</var> is greater than <var title="">offset B</var>.

 <li><p>If <var title="">node A</var> is
 <a title="concept-tree-following" href="#concept-tree-following">following</a>
 <var title="">node B</var>, compute the
 <a title="concept-range-bp-position" href="#concept-range-bp-position">position</a> of
 (<var title="">node B</var>, <var title="">offset B</var>) relative to
 (<var title="">node A</var>, <var title="">offset A</var>). If it is
 <a title="concept-range-bp-before" href="#concept-range-bp-before">before</a>, return
 <a title="concept-range-bp-after" href="#concept-range-bp-after">after</a>. If it is
 <a title="concept-range-bp-after" href="#concept-range-bp-after">after</a>, return
 <a title="concept-range-bp-before" href="#concept-range-bp-before">before</a>.

 <li>
  <p>If <var title="">node A</var> is an
  <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestor</a> of
  <var title="">node B</var>:

  <ol>
   <li><p>Let <var title="">child</var> equal <var title="">node B</var>.

   <li><p>While <var title="">child</var> is not a
   <a title="concept-tree-child" href="#concept-tree-child">child</a> of <var title="">node A</var>,
   set <var title="">child</var> to its
   <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

   <li><p>If the <a title="concept-tree-index" href="#concept-tree-index">index</a> of
   <var title="">child</var> is less than <var title="">offset A</var>, return
   <a title="concept-range-bp-after" href="#concept-range-bp-after">after</a>.
  </ol>

 <li><p>Return <a title="concept-range-bp-before" href="#concept-range-bp-before">before</a>.
</ol>

<p>Each <a title="concept-range" href="#concept-range">range</a> has two associated
<a title="concept-range-bp" href="#concept-range-bp">boundary points</a> — a
<dfn title="concept-range-start" id="concept-range-start">start</dfn> and
<dfn title="concept-range-end" id="concept-range-end">end</dfn>.

<p>For convenience, <dfn title="concept-range-start-node" id="concept-range-start-node">start node</dfn> is
<a title="concept-range-start" href="#concept-range-start">start</a>'s
<a title="concept-node" href="#concept-node">node</a>,
<dfn title="concept-range-start-offset" id="concept-range-start-offset">start offset</dfn> is
<a title="concept-range-start" href="#concept-range-start">start</a>'s
<a title="concept-range-bp-offset" href="#concept-range-bp-offset">offset</a>,
<dfn title="concept-range-end-node" id="concept-range-end-node">end node</dfn> is
<a title="concept-range-end" href="#concept-range-end">end</a>'s
<a title="concept-node" href="#concept-node">node</a>,  and
<dfn title="concept-range-end-offset" id="concept-range-end-offset">end offset</dfn> is
<a title="concept-range-end" href="#concept-range-end">end</a>'s
<a title="concept-range-bp-offset" href="#concept-range-bp-offset">offset</a>.

<p>The <dfn title="concept-range-root" id="concept-range-root">root</dfn> of a
<a title="concept-range" href="#concept-range">range</a> is the
<a title="concept-tree-root" href="#concept-tree-root">root</a> of its
<a title="concept-range-start-node" href="#concept-range-start-node">start node</a>.
<!-- start and end have an identical root -->

<p>A <a title="concept-node" href="#concept-node">node</a> <var title="">node</var> is
<dfn id="contained">contained</dfn> in a <a title="concept-range" href="#concept-range">range</a>
<var title="">range</var> if <var title="">node</var>'s
<a title="concept-tree-root" href="#concept-tree-root">root</a> is
the same as <var title="">range</var>'s
<a title="concept-range-root" href="#concept-range-root">root</a>, and (<var title="">node</var>, 0)
is <a title="concept-range-bp-after" href="#concept-range-bp-after">after</a> <var title="">range</var>'s
<a title="concept-range-start" href="#concept-range-start">start</a>, and (<var title="">node</var>,
<a title="concept-node-length" href="#concept-node-length">length</a> of <var title="">node</var>) is
<a title="concept-range-bp-before" href="#concept-range-bp-before">before</a> <var title="">range</var>'s
<a title="concept-range-end" href="#concept-range-end">end</a>.

<p>A <a title="concept-node" href="#concept-node">node</a> is <dfn id="partially-contained">partially contained</dfn>
in a <a title="concept-range" href="#concept-range">range</a> if it is an
<a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of the
<a title="concept-range" href="#concept-range">range</a>'s
<a title="concept-range-start-node" href="#concept-range-start-node">start node</a> but not its
<a title="concept-range-end-node" href="#concept-range-end-node">end node</a>, or vice versa.

<div class="note">
 <p>Some facts to better understand these definitions:

 <ul>
  <li><p>The content that one would think of as being within the
  <a title="concept-range" href="#concept-range">range</a> consists of all
  <a href="#contained">contained</a> <a title="concept-node" href="#concept-node">nodes</a>, plus
  possibly some of the contents of the
  <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> and
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> if those are
  <code><a href="#text">Text</a></code>, <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or
  <code><a href="#comment">Comment</a></code> <a title="concept-node" href="#concept-node">nodes</a>.

  <li><p>The <a title="concept-node" href="#concept-node">nodes</a> that are contained in a
  <a title="concept-range" href="#concept-range">range</a> will generally not be contiguous,
  because the <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> of a
  <a href="#contained">contained</a> <a title="concept-node" href="#concept-node">node</a> will not
  always be <a href="#contained">contained</a>.

  <li><p>However, the <a title="concept-tree-descendant" href="#concept-tree-descendant">descendants</a>
  of a <a href="#contained">contained</a> <a title="concept-node" href="#concept-node">node</a> are
  <a href="#contained">contained</a>, and if two
  <a title="concept-tree-sibling" href="#concept-tree-sibling">siblings</a> are
  <a href="#contained">contained</a>, so are any
  <a title="concept-tree-sibling" href="#concept-tree-sibling">siblings</a> that lie between them.

  <li><p>The first <a href="#contained">contained</a>
  <a title="concept-node" href="#concept-node">node</a> (if there are any) will always be
  after the <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>, and the
  last <a href="#contained">contained</a> <a title="concept-node" href="#concept-node">node</a> will
  always be equal to or before the
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>'s last
  <a title="concept-tree-descendant" href="#concept-tree-descendant">descendant</a>.

  <li><p>The <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> and
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> of a
  <a title="concept-range" href="#concept-range">range</a> are never <a href="#contained">contained</a>
  within it.

  <li><p>There exists some partially contained
  <a title="concept-node" href="#concept-node">node</a> if and only if the
  <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> and
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> are different.

  <li><p>The
  <code title="dom-Range-commonAncestorContainer"><a href="#dom-range-commonancestorcontainer">commonAncestorContainer</a></code>
  attribute value is never <a href="#contained">contained</a> or
  <a href="#partially-contained">partially contained</a>.

  <li>If the <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is an
  <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestor</a> of the
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>, the common
  <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> will
  be the <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>. Exactly one
  of its <a title="concept-tree-child" href="#concept-tree-child">children</a> will be
  <a href="#partially-contained">partially contained</a>, and a
  <a title="concept-tree-child" href="#concept-tree-child">child</a> will be <a href="#contained">contained</a>
  if and only if it <a title="concept-tree-preceding" href="#concept-tree-preceding">precedes</a> the
  <a href="#partially-contained">partially contained</a>
  <a title="concept-tree-child" href="#concept-tree-child">child</a>. If the
  <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is an
  <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestor</a> of the
  <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>, the opposite
  holds.

  <li><p>If the <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is
  not an
  <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
  the <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>, nor vice versa,
  the common
  <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> will
  be distinct from both of them. Exactly two of its
  <a title="concept-tree-child" href="#concept-tree-child">children</a> will be
  <a href="#partially-contained">partially contained</a>, and a
  <a title="concept-tree-child" href="#concept-tree-child">child</a> will be contained if and only
  if it lies between those two.
 </ul>
</div>

<hr>

<dl class="domintro">
 <dt><code><var title="">range</var> = new <a title="dom-Range" href="#dom-range">Range</a>()</code>
 <dd><p>Returns a new <a title="concept-range" href="#concept-range">range</a>.
</dl>

<p>The <dfn title="dom-Range" id="dom-range"><code>Range()</code></dfn> constructor must return a new
<a title="concept-range" href="#concept-range">range</a> with
(global object's associated <a title="concept-document" href="#concept-document">document</a>, 0) as its
<a title="concept-range-start" href="#concept-range-start">start</a> and
<a title="concept-range-end" href="#concept-range-end">end</a>.

<hr>

<dl class="domintro">
 <dt><var title="">node</var> = <var title="">range</var> . <code title="dom-Range-startContainer"><a href="#dom-range-startcontainer">startContainer</a></code>
 <dd><p>Returns <var title="">range</var>'s
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>.

 <dt><var title="">offset</var> = <var title="">range</var> . <code title="dom-Range-startOffset"><a href="#dom-range-startoffset">startOffset</a></code>
 <dd><p>Returns <var title="">range</var>'s
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a>.

 <dt><var title="">node</var> = <var title="">range</var> . <code title="dom-Range-endContainer"><a href="#dom-range-endcontainer">endContainer</a></code>
 <dd><p>Returns <var title="">range</var>'s
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>.

 <dt><var title="">offset</var> = <var title="">range</var> . <code title="dom-Range-endOffset"><a href="#dom-range-endoffset">endOffset</a></code>
 <dd><p>Returns <var title="">range</var>'s
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a>.

 <dt><var title="">collapsed</var> = <var title="">range</var> . <code title="dom-Range-collapsed"><a href="#dom-range-collapsed">collapsed</a></code>
 <dd><p>Returns true if <var title="">range</var>'s
 <a title="concept-range-start" href="#concept-range-start">start</a> and
 <a title="concept-range-end" href="#concept-range-end">end</a> are the same, and false otherwise.

 <dt><var title="">container</var> = <var title="">range</var> . <code title="dom-Range-commonAncestorContainer"><a href="#dom-range-commonancestorcontainer">commonAncestorContainer</a></code>
 <dd><p>Returns the <a title="concept-node" href="#concept-node">node</a>, furthest away from
 the <a title="concept-document" href="#concept-document">document</a>, that is an
 <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestor</a> of both
 <var title="">range</var>'s
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> and
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>.
</dl>

<p>The <dfn title="dom-Range-startContainer" id="dom-range-startcontainer"><code>startContainer</code></dfn>
attribute must return the
<a title="concept-range-start-node" href="#concept-range-start-node">start node</a>.

<p>The <dfn title="dom-Range-startOffset" id="dom-range-startoffset"><code>startOffset</code></dfn>
attribute must return the
<a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a>.

<p>The <dfn title="dom-Range-endContainer" id="dom-range-endcontainer"><code>endContainer</code></dfn>
attribute must return the
<a title="concept-range-end-node" href="#concept-range-end-node">end node</a>.

<p>The <dfn title="dom-Range-endOffset" id="dom-range-endoffset"><code>endOffset</code></dfn>
attribute must return the
<a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a>.

<p>The <dfn title="dom-Range-collapsed" id="dom-range-collapsed"><code>collapsed</code></dfn> attribute
must return true if <a title="concept-range-start" href="#concept-range-start">start</a> is the same
as <a title="concept-range-end" href="#concept-range-end">end</a>, and false otherwise.

<p>The
<dfn title="dom-Range-commonAncestorContainer" id="dom-range-commonancestorcontainer"><code>commonAncestorContainer</code></dfn>
attribute must run these steps:

<ol>
 <li><p>Let <var title="">container</var> be
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>.

 <li><p>While <var title="">container</var> is not an
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>, let
 <var title="">container</var> be <var title="">container</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>Return <var title="">container</var>.
</ol>

<hr>

<p>To <dfn title="concept-range-bp-set" id="concept-range-bp-set">set the start or end</dfn> of a
<var title="">range</var> to a
<a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
(<var title="">node</var>, <var title="">offset</var>), run these steps:

<ol>
 <li><p>If <var title="">node</var> is a
 <a title="concept-doctype" href="#concept-doctype">doctype</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code> exception.

 <li><p>If <var title="">offset</var> is greater than
 <var title="">node</var>'s <a title="concept-node-length" href="#concept-node-length">length</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">IndexSizeError</code> exception.

 <li><p>Let <var title="">bp</var> be the
 <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
 (<var title="">node</var>, <var title="">offset</var>).

 <li>
  <dl class="switch">
   <dt>If these steps were invoked as "set the start"
   <dd>
    <ol>
     <li><p>If <var title="">bp</var> is
     <a title="concept-range-bp-after" href="#concept-range-bp-after">after</a> the
     <var title="">range</var>'s <a title="concept-range-end" href="#concept-range-end">end</a>, or
     if <var title="">range</var>'s
     <a title="concept-range-root" href="#concept-range-root">root</a> is not equal to
     <var title="">node</var>'s <a title="concept-tree-root" href="#concept-tree-root">root</a>, set
     <var title="">range</var>'s <a title="concept-range-end" href="#concept-range-end">end</a> to
     <var title="">bp</var>.

     <li><p>Set <var title="">range</var>'s
     <a title="concept-range-start" href="#concept-range-start">start</a> to <var title="">bp</var>.
    </ol>
   <dt>If these steps were invoked as "set the end"
   <dd>
    <ol>
     <li><p>If <var title="">bp</var> is
     <a title="concept-range-bp-before" href="#concept-range-bp-before">before</a> the
     <var title="">range</var>'s <a title="concept-range-start" href="#concept-range-start">start</a>,
     or if <var title="">range</var>'s
     <a title="concept-range-root" href="#concept-range-root">root</a> is not equal to
     <var title="">node</var>'s <a title="concept-tree-root" href="#concept-tree-root">root</a>, set
     <var title="">range</var>'s <a title="concept-range-start" href="#concept-range-start">start</a>
     to <var title="">bp</var>.

     <li><p>Set <var title="">range</var>'s
     <a title="concept-range-end" href="#concept-range-end">end</a> to <var title="">bp</var>.
    </ol>
  </dl>
</ol>

<p>The
<dfn title="dom-Range-setStart" id="dom-range-setstart"><code>setStart(<var>node</var>, <var>offset</var>)</code></dfn>
method must <a title="concept-range-bp-set" href="#concept-range-bp-set">set the start</a> of the
<a href="#context-object">context object</a> to
<a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
(<var title="">node</var>, <var title="">offset</var>).

<p>The
<dfn title="dom-Range-setEnd" id="dom-range-setend"><code>setEnd(<var>node</var>, <var>offset</var>)</code></dfn>
method must <a title="concept-range-bp-set" href="#concept-range-bp-set">set the end</a> of the
<a href="#context-object">context object</a> to
<a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
(<var title="">node</var>, <var title="">offset</var>).

<p>The
<dfn title="dom-Range-setStartBefore" id="dom-range-setstartbefore"><code>setStartBefore(<var>node</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">parent</var> be <var title="">node</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>If <var title="">parent</var> is null,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code> exception.

 <li><p><a title="concept-range-bp-set" href="#concept-range-bp-set">Set the start</a> of the
 <a href="#context-object">context object</a> to
 <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
 (<var title="">parent</var>, <var title="">node</var>'s
 <a title="concept-tree-index" href="#concept-tree-index">index</a>).
</ol>

<p>The
<dfn title="dom-Range-setStartAfter" id="dom-range-setstartafter"><code>setStartAfter(<var>node</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">parent</var> be <var title="">node</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>If <var title="">parent</var> is null,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code> exception.

 <li><p><a title="concept-range-bp-set" href="#concept-range-bp-set">Set the start</a> of the
 <a href="#context-object">context object</a> to
 <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
 (<var title="">parent</var>, <var title="">node</var>'s
 <a title="concept-tree-index" href="#concept-tree-index">index</a> plus one).
</ol>

<p>The
<dfn title="dom-Range-setEndBefore" id="dom-range-setendbefore"><code>setEndBefore(<var>node</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">parent</var> be <var title="">node</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>If <var title="">parent</var> is null,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code> exception.

 <li><p><a title="concept-range-bp-set" href="#concept-range-bp-set">Set the end</a> of the
 <a href="#context-object">context object</a> to
 <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
 (<var title="">parent</var>, <var title="">node</var>'s
 <a title="concept-tree-index" href="#concept-tree-index">index</a>).
</ol>

<p>The
<dfn title="dom-Range-setEndAfter" id="dom-range-setendafter"><code>setEndAfter(<var>node</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">parent</var> be <var title="">node</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>If <var title="">parent</var> is null,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code> exception.

 <li><p><a title="concept-range-bp-set" href="#concept-range-bp-set">Set the end</a> of the
 <a href="#context-object">context object</a> to
 <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
 (<var title="">parent</var>, <var title="">node</var>'s
 <a title="concept-tree-index" href="#concept-tree-index">index</a> plus one).
</ol>


<p>The
<dfn title="dom-Range-collapse" id="dom-range-collapse"><code>collapse(<var>toStart</var>)</code></dfn>
method must if <var title="">toStart</var> is true, set
<a title="concept-range-end" href="#concept-range-end">end</a> to
<a title="concept-range-start" href="#concept-range-start">start</a>, and set
<a title="concept-range-start" href="#concept-range-start">start</a> to
<a title="concept-range-end" href="#concept-range-end">end</a> otherwise.

<p>To <dfn title="concept-range-select" id="concept-range-select">select</dfn> a <a title="concept-node" href="#concept-node">node</a>
<var title="">node</var> within a <a title="concept-range" href="#concept-range">range</a>
<var title="">range</var>, run these steps:

<ol>
 <li><p>Let <var title="">parent</var> be <var title="">node</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>If <var title="">parent</var> is null, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code>.

 <li><p>Let <var title="">index</var> be <var title="">node</var>'s
 <a title="concept-tree-index" href="#concept-tree-index">index</a>.

 <li><p>Set <var title="">range</var>'s <a title="concept-range-start" href="#concept-range-start">start</a> to
 <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
 (<var title="">parent</var>, <var title="">index</var>).

 <li><p>Set <var title="">range</var>'s <a title="concept-range-end" href="#concept-range-end">end</a> to
 <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
 (<var title="">parent</var>, <var title="">index</var> plus one).
</ol>

<p>The
<dfn title="dom-Range-selectNode" id="dom-range-selectnode"><code>selectNode(<var>node</var>)</code></dfn>
method must <a title="concept-range-select" href="#concept-range-select">select</a> <var title="">node</var> within
<a href="#context-object">context object</a>.

<p>The
<dfn title="dom-Range-selectNodeContents" id="dom-range-selectnodecontents"><code>selectNodeContents(<var>node</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var title="">node</var> is a
 <a title="concept-doctype" href="#concept-doctype">doctype</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code>.

 <li><p>Let <var title="">length</var> be the
 <a title="concept-node-length" href="#concept-node-length">length</a> of <var title="">node</var>.

 <li><p>Set <a title="concept-range-start" href="#concept-range-start">start</a> to the
 <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
 (<var title="">node</var>, 0).

 <li><p>Set <a title="concept-range-end" href="#concept-range-end">end</a> to the
 <a title="concept-range-bp" href="#concept-range-bp">boundary point</a>
 (<var title="">node</var>, <var title="">length</var>).
</ol>

<hr>

<p>The
<dfn title="dom-Range-compareBoundaryPoints" id="dom-range-compareboundarypoints"><code>compareBoundaryPoints(<var>how</var>, <var>sourceRange</var>)</code></dfn>
method must run these steps:

<ol>
 <li>
  <p>If <var>how</var> is not one of
  <ul>
   <li><code title="dom-CompareHow-START_TO_START"><a href="#dom-comparehow-start_to_start">START_TO_START</a></code>,
   <li><code title="dom-CompareHow-START_TO_END"><a href="#dom-comparehow-start_to_end">START_TO_END</a></code>,
   <li><code title="dom-CompareHow-END_TO_END"><a href="#dom-comparehow-end_to_end">END_TO_END</a></code>, and
   <li><code title="dom-CompareHow-END_TO_START"><a href="#dom-comparehow-end_to_start">END_TO_START</a></code>,
  </ul>
  <p><a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
  <code title="">NotSupportedError</code> exception.
 <!--
 Apparent behaviors from black-box testing:

 IE9: Converts to unsigned short per WebIDL, then throws "Error: Invalid
 argument." if it's not 0-3.

 Firefox 12.0a1: Converts to unsigned short per WebIDL, then throws
 NS_ERROR_ILLEGAL_VALUE if it's not 0-3.

 Chrome 17 dev: Converts to unsigned *long* per WebIDL, and treats bad values
 as 0.  Never throws.

 Opera Next 12.00 alpha: Throws NotSupportedError unless the value is -0, 0, 1,
 2, 3, or an integer equal to one of these modulo 2^32.  (In particular, it
 throws on NaN, Infinity, and -Infinity instead of treating them as 0 per
 WebIDL.)

 The spec follows IE9/Gecko, except that we throw NotSupportedError (like
 Opera) instead of a nonstandard exception type.
 -->

 <li><p>If <a href="#context-object">context object</a>'s
 <a title="concept-range-root" href="#concept-range-root">root</a> is not the same as
 <var title="">sourceRange</var>'s <a title="concept-range-root" href="#concept-range-root">root</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
 <code title="">WrongDocumentError</code> exception.

 <li>
  <p>If <var title="">how</var> is:
  <dl class="switch">
   <dt><code title="dom-CompareHow-START_TO_START"><a href="#dom-comparehow-start_to_start">START_TO_START</a></code>:
   <dd>
    <p>Let <var title="">this point</var> be the <a href="#context-object">context object</a>'s
    <a title="concept-range-start" href="#concept-range-start">start</a>.
    <p>Let <var title="">other point</var> be <var title="">sourceRange</var>'s
    <a title="concept-range-start" href="#concept-range-start">start</a>.

   <dt><code title="dom-CompareHow-START_TO_END"><a href="#dom-comparehow-start_to_end">START_TO_END</a></code>:
   <dd>
    <p>Let <var title="">this point</var> be the <a href="#context-object">context object</a>'s
    <a title="concept-range-end" href="#concept-range-end">end</a>.
    <p>Let <var title="">other point</var> be <var title="">sourceRange</var>'s
    <a title="concept-range-start" href="#concept-range-start">start</a>.

    <dt><code title="dom-CompareHow-END_TO_END"><a href="#dom-comparehow-end_to_end">END_TO_END</a></code>:
    <dd>
     <p>Let <var title="">this point</var> be the <a href="#context-object">context object</a>'s
     <a title="concept-range-end" href="#concept-range-end">end</a>.
     <p>Let <var title="">other point</var> be <var title="">sourceRange</var>'s
     <a title="concept-range-end" href="#concept-range-end">end</a>.

    <dt><code title="dom-CompareHow-END_TO_START"><a href="#dom-comparehow-end_to_start">END_TO_START</a></code>:
    <dd>
     <p>Let <var title="">this point</var> be the <a href="#context-object">context object</a>'s
     <a title="concept-range-start" href="#concept-range-start">start</a>.
     <p>Let <var title="">other point</var> be <var title="">sourceRange</var>'s
     <a title="concept-range-end" href="#concept-range-end">end</a>.
   </dl>

  <li>
   <p>If the <a title="concept-range-bp-position" href="#concept-range-bp-position">position</a> of
   <var title="">this point</var> relative to <var title="">other point</var> is

   <dl class="switch">
    <dt><a title="concept-range-bp-before" href="#concept-range-bp-before">before</a>
    <dd>Return −1.

    <dt><a title="concept-range-bp-equal" href="#concept-range-bp-equal">equal</a>
    <dd>Return 0.

    <dt><a title="concept-range-bp-after" href="#concept-range-bp-after">after</a>
    <dd>Return 1.
   </dl>
</ol>

<p>The <dfn title="dom-Range-deleteContents" id="dom-range-deletecontents"><code>deleteContents()</code></dfn>
method must run these steps:

<ol>
 <li><p>If <a title="concept-range-start" href="#concept-range-start">start</a> equals
 <a title="concept-range-end" href="#concept-range-end">end</a>, terminate these steps.
 <!-- This might actually make no difference, but it's not immediately
 obvious what would happen otherwise if the start/end were text/comment:
 are all the substeps of the next step actually no-ops, or could some have
 side effects? -->

 <li><p>Let <var title="">original start node</var>,
 <var title="">original start offset</var>, <var title="">original end node</var>,
 and <var title="">original end offset</var> be the
 <a href="#context-object">context object</a>'s
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>,
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a>,
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>, and
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a>, respectively.

 <li><p>If <var title="">original start node</var> and
 <var title="">original end node</var> are the same, and they are a
 <code><a href="#text">Text</a></code>, <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or
 <code><a href="#comment">Comment</a></code> <a title="concept-node" href="#concept-node">node</a>,
 <a title="concept-CD-replace" href="#concept-cd-replace">replace data</a> with node
 <var title="">original start node</var>, offset
 <var title="">original start offset</var>, count
 <var title="">original end offset</var> minus
 <var title="">original start offset</var>, and data the empty string, and then
 terminate these steps.

 <li><p>Let <var title="">nodes to remove</var> be a list of all the
 <a title="concept-node" href="#concept-node">nodes</a> that are <a href="#contained">contained</a> in
 the <a href="#context-object">context object</a>, in
 <a title="concept-tree-order" href="#concept-tree-order">tree order</a>, omitting any
 <a title="concept-node" href="#concept-node">node</a> whose
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is also
 <a href="#contained">contained</a> in the <a href="#context-object">context object</a>.

 <li><p>If <var title="">original start node</var> is an
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
 <var title="">original end node</var>, set
 <var title="">new node</var> to <var title="">original start node</var> and
 <var title="">new offset</var> to <var title="">original start offset</var>.

 <li>
  <p>Otherwise:
  <ol>
   <li><p>Let <var title="">reference node</var> equal
   <var title="">original start node</var>.

   <li><p>While <var title="">reference node</var>'s
   <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is not null and is not an
   <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
   <var title="">original end node</var>, set <var title="">reference node</var>
   to its <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

   <li>
    <p>Set <var title="">new node</var> to the
    <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> of
    <var title="">reference node</var>, and <var title="">new offset</var> to one
    plus the <a title="concept-tree-index" href="#concept-tree-index">index</a> of
    <var title="">reference node</var>.

    <p class="note">If <var title="">reference node</var>'s
    <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> were null, it would be the
    <a title="concept-range-root" href="#concept-range-root">root</a> of the
    <a href="#context-object">context object</a>, so would be an
    <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
    <var title="">original end node</var>, and we could not reach this point.
  </ol>

 <li><p>If <var title="">original start node</var> is a <code><a href="#text">Text</a></code>,
 <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or <code><a href="#comment">Comment</a></code>
 <a title="concept-node" href="#concept-node">node</a>,
 <a title="concept-CD-replace" href="#concept-cd-replace">replace data</a> with node
 <var title="">original start node</var>, offset
 <var title="">original start offset</var>, count
 <var title="">original start node</var>'s
 <a title="concept-node-length" href="#concept-node-length">length</a> minus
 <var title="">original start offset</var>, data the empty string.

 <li><p>For each <var title="">node</var> in <var title="">nodes to remove</var>,
 in <a title="concept-tree-order" href="#concept-tree-order">tree order</a>,
 <a title="concept-node-remove" href="#concept-node-remove">remove</a> <var title="">node</var> from
 its <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>If <var title="">original end node</var> is a <code><a href="#text">Text</a></code>,
 <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or <code><a href="#comment">Comment</a></code>
 <a title="concept-node" href="#concept-node">node</a>,
 <a title="concept-CD-replace" href="#concept-cd-replace">replace data</a> with node
 <var title="">original end node</var>, offset 0, count
 <var title="">original end offset</var> and data the empty string.

 <li><p>Set <a title="concept-range-start" href="#concept-range-start">start</a> and
 <a title="concept-range-end" href="#concept-range-end">end</a> to
 (<var title="">new node</var>, <var title="">new offset</var>).
</ol>

<p>To <dfn title="concept-range-extract" id="concept-range-extract">extract</dfn> a
<a title="concept-range" href="#concept-range">range</a> <var title="">range</var>, run these steps:

<ol>
 <li><p>Let <var title="">fragment</var> be a new <code><a href="#documentfragment">DocumentFragment</a></code>
 <a title="concept-node" href="#concept-node">node</a> whose
 <a title="concept-node-document" href="#concept-node-document">node document</a> is <var title="">range</var>'s
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>'s
 <a title="concept-node-document" href="#concept-node-document">node document</a>.

 <li><p>If <var title="">range</var>'s <a title="concept-range-start" href="#concept-range-start">start</a> equals
 its <a title="concept-range-end" href="#concept-range-end">end</a>, return <var title="">fragment</var>.
 <!-- This is only really needed when the start and end nodes are
 text/comment, to avoid creating an empty clone as the child of the
 fragment. (Opera 11 actually does include such an empty clone, it seems,
 but Gecko and WebKit do not as of March 2011, so we follow them.)
 Otherwise, the following steps are all no-ops. But it's simplest to include
 this step anyway. -->

 <li><p>Let <var title="">original start node</var>, <var title="">original start offset</var>,
 <var title="">original end node</var>, and <var title="">original end offset</var> be
 <var title="">range</var>'s <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>,
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a>,
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>, and
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a>, respectively.

 <li>
  <p>If <var title="">original start node</var> equals
  <var title="">original end node</var>, and they are a <code><a href="#text">Text</a></code>,
  <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or <code><a href="#comment">Comment</a></code>
  <a title="concept-node" href="#concept-node">node</a>:

  <ol>
   <li><p>Let <var title="">clone</var> be a
   <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">original start node</var>.

   <li><p>Set the <a title="concept-CD-data" href="#concept-cd-data">data</a> of
   <var title="">clone</var> to the result of
   <a title="concept-CD-substring" href="#concept-cd-substring">substringing data</a> with node
   <var title="">original start node</var>, offset
   <var title="">original start offset</var>, and count
   <var title="">original end offset</var> minus
   <var title="">original start offset</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var>
   to <var title="">fragment</var>.

   <li><p><a title="concept-CD-replace" href="#concept-cd-replace">Replace data</a> with node
   <var title="">original start node</var>, offset
   <var title="">original start offset</var>, count
   <var title="">original end offset</var> minus
   <var title="">original start offset</var>, and data the empty string.

   <li><p>Return <var title="">fragment</var>.
  </ol>

 <li><p>Let <var title="">common ancestor</var> be
 <var title="">original start node</var>.

 <li><p>While <var title="">common ancestor</var> is not an
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
 <var title="">original end node</var>, set <var title="">common ancestor</var> to
 its own <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>Let <var title="">first partially contained child</var> be null.

 <li><p>If <var title="">original start node</var> is <em>not</em> an
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
 <var title="">original end node</var>, set <var title="">first partially contained child</var>
 to the first <a title="concept-tree-child" href="#concept-tree-child">child</a> of
 <var title="">common ancestor</var> that is <a href="#partially-contained">partially contained</a> in
 <var title="">range</var>.

 <li><p>Let <var title="">last partially contained child</var> be null.

 <li>
  <p>If <var title="">original end node</var> is <em>not</em> an
  <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
  <var title="">original start node</var>, set
  <var title="">last partially contained child</var> to the last
  <a title="concept-tree-child" href="#concept-tree-child">child</a> of <var title="">common ancestor</var> that is
  <a href="#partially-contained">partially contained</a> in <var title="">range</var>.

  <p class="note no-backref">These variable assignments do actually always make sense.
  For instance, if <var title="">original start node</var> is not an
  <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
  <var title="">original end node</var>, <var title="">original start node</var> is itself
  <a href="#partially-contained">partially contained</a> in <var title="">range</var>, and so are all its
  <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestors</a> up until a
  <a title="concept-tree-child" href="#concept-tree-child">child</a> of <var title="">common ancestor</var>.
  <var title="">common ancestor</var> cannot be <var title="">original start node</var>, because
  it has to be an <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
  <var title="">original end node</var>. The other case is similar. Also, notice that the two
  <a title="concept-tree-child" href="#concept-tree-child">children</a> will never be equal if both are defined.

 <li><p>Let <var title="">contained children</var> be a list of all
 <a title="concept-tree-child" href="#concept-tree-child">children</a> of
 <var title="">common ancestor</var> that are <a href="#contained">contained</a> in
 <var title="">range</var>, in <a title="concept-tree-order" href="#concept-tree-order">tree order</a>.

 <li>
  <p>If any member of <var title="">contained children</var> is a
  <a title="concept-doctype" href="#concept-doctype">doctype</a>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
  <code title="">HierarchyRequestError</code> exception.
  <!-- Firefox 4.0 actually removes the non-DocumentType nodes before
  throwing the exception. Opera 11.00 removes the DocumentType too, and
  doesn't throw. I go with IE9 and Chrome 12 dev, which don't remove any
  nodes. DOM 2 Range doesn't specify what exactly happens here, except that
  an exception should be thrown. -->

  <p class="note no-backref">We do not have to worry about the first or last partially
  contained node, because a <a title="concept-doctype" href="#concept-doctype">doctype</a> can never be
  partially contained. It cannot be a boundary point of a range, and it
  cannot be the ancestor of anything.

 <li><p>If <var title="">original start node</var> is an
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
 <var title="">original end node</var>, set <var title="">new node</var> to
 <var title="">original start node</var> and <var title="">new offset</var> to
 <var title="">original start offset</var>.

 <li>
  <p>Otherwise:
  <ol>
   <li><p>Let <var title="">reference node</var> equal <var title="">original start node</var>.

   <li><p>While <var title="">reference node</var>'s
   <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is not null and is not an
   <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
   <var title="">original end node</var>, set <var title="">reference node</var> to its
   <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

   <li>
    <p>Set <var title="">new node</var> to the
    <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> of <var title="">reference node</var>, and
    <var title="">new offset</var> to one plus <var title="">reference node</var>'s
    <a title="concept-tree-index" href="#concept-tree-index">index</a>.

    <p class="note">If <var title="">reference node</var>'s
    <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is null, it would be the
    <a title="concept-range-root" href="#concept-range-root">root</a> of <var title="">range</var>, so would be an
    <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
    <var title="">original end node</var>, and we could not reach this point.
  </ol>

  <!-- Now we start with mutations, so we can't refer to the context object
  anymore unless we carefully consider how it will have mutated. -->

 <li>
  <p>If <var title="">first partially contained child</var> is a
  <code><a href="#text">Text</a></code>, <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or
  <code><a href="#comment">Comment</a></code> <a title="concept-node" href="#concept-node">node</a>:

  <p class="note">In this case, <var title="">first partially contained child</var> is
  <var title="">original start node</var>.

  <ol>
   <li><p>Let <var title="">clone</var> be a
   <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">original start node</var>.

   <li><p>Set the <a title="concept-CD-data" href="#concept-cd-data">data</a> of
   <var title="">clone</var> to the result of
   <a title="concept-CD-substring" href="#concept-cd-substring">substringing data</a> with node
   <var title="">original start node</var>, offset
   <var title="">original start offset</var>, and count
   <var title="">original start node</var>'s
   <a title="concept-node-length" href="#concept-node-length">length</a> minus
   <var title="">original start offset</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var>
   to <var title="">fragment</var>.

   <li><p><a title="concept-CD-replace" href="#concept-cd-replace">Replace data</a> with node
   <var title="">original start node</var>, offset
   <var title="">original start offset</var>, count
   <var title="">original start node</var>'s
   <a title="concept-node-length" href="#concept-node-length">length</a> minus
   <var title="">original start offset</var>, and data the empty string.
  </ol>

 <li>
  <p>Otherwise, if <var title="">first partially contained child</var> is not
  null:

  <ol>
   <li><p>Let <var title="">clone</var> be a
   <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">first partially contained child</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var>
   to <var title="">fragment</var>.

   <li><p>Let <var title="">subrange</var> be a new <a title="concept-range" href="#concept-range">range</a>
   whose <a title="concept-range-start" href="#concept-range-start">start</a> is
   (<var title="">original start node</var>, <var title="">original start offset</var>) and
   whose <a title="concept-range-end" href="#concept-range-end">end</a> is
   (<var title="">first partially contained child</var>, <var title="">first partially contained child</var>'s <a title="concept-node-length" href="#concept-node-length">length</a>).

   <li><p>Let <var title="">subfragment</var> be the result of
   <a title="concept-range-extract" href="#concept-range-extract">extracting</a> <var title="">subrange</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">subfragment</var> to
   <var title="">clone</var>.
  </ol>

 <li><p>For each <var title="">contained child</var> in <var title="">contained children</var>,
 <a title="concept-node-append" href="#concept-node-append">append</a> <var title="">contained child</var> to
 <var title="">fragment</var>.

 <li>
  <p>If <var title="">last partially contained child</var> is a
  <code><a href="#text">Text</a></code>, <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or
  <code><a href="#comment">Comment</a></code> <a title="concept-node" href="#concept-node">node</a>:

  <p class="note">In this case, <var title="">last partially contained child</var> is
  <var title="">original end node</var>.

  <ol>
   <li><p>Let <var title="">clone</var> be a <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">original end node</var>.

   <li><p>Set the <a title="concept-CD-data" href="#concept-cd-data">data</a> of
   <var title="">clone</var> to the result of
   <a title="concept-CD-substring" href="#concept-cd-substring">substringing data</a> with node
   <var title="">original end node</var>, offset 0, and count
   <var title="">original end offset</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var>
   to <var title="">fragment</var>.

   <li><p><a title="concept-CD-replace" href="#concept-cd-replace">Replace data</a> with node
   <var title="">original end node</var>, offset 0, count
   <var title="">original end offset</var>, and data the empty string.
  </ol>

 <li>
  <p>Otherwise, if <var title="">last partially contained child</var> is not
  null:

  <ol>
   <li><p>Let <var title="">clone</var> be a
   <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">last partially contained child</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var>
   to <var title="">fragment</var>.

   <li><p>Let <var title="">subrange</var> be a new <a title="concept-range" href="#concept-range">range</a>
   whose <a title="concept-range-start" href="#concept-range-start">start</a> is
   (<var title="">last partially contained child</var>, 0) and whose
   <a title="concept-range-end" href="#concept-range-end">end</a> is
   (<var title="">original end node</var>, <var title="">original end offset</var>).

   <li><p>Let <var title="">subfragment</var> be the result of
   <a title="concept-range-extract" href="#concept-range-extract">extracting</a> <var title="">subrange</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">subfragment</var> to
   <var title="">clone</var>.
  </ol>

 <li><p>Set <var title="">range</var>'s <a title="concept-range-start" href="#concept-range-start">start</a> and
 <a title="concept-range-end" href="#concept-range-end">end</a> to
 (<var title="">new node</var>, <var title="">new offset</var>).

 <li><p>Return <var title="">fragment</var>.
</ol>

<p>The <dfn title="dom-Range-extractContents" id="dom-range-extractcontents"><code>extractContents()</code></dfn> method
must return the result of <a title="concept-range-extract" href="#concept-range-extract">extracting</a>
<a href="#context-object">context object</a>.

<p>To <dfn title="concept-range-clone" id="concept-range-clone">clone</dfn> a <a title="concept-range" href="#concept-range">range</a>
<var title="">range</var>, run these steps:

<ol>
 <li><p>Let <var title="">fragment</var> be a new <code><a href="#documentfragment">DocumentFragment</a></code>
 <a title="concept-node" href="#concept-node">node</a> whose
 <a title="concept-node-document" href="#concept-node-document">node document</a> is <var title="">range</var>'s
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>'s
 <a title="concept-node-document" href="#concept-node-document">node document</a>.

 <li><p>If <var title="">range</var>'s <a title="concept-range-start" href="#concept-range-start">start</a> equals
 its <a title="concept-range-end" href="#concept-range-end">end</a>, return <var title="">fragment</var>.
 <!-- This is only really needed when the start and end nodes are
 text/comment, to avoid creating an empty clone as the child of the
 fragment. (Opera 11 actually does include such an empty clone, it seems,
 but Gecko and WebKit do not as of March 2011, so we follow them.)
 Otherwise, the following steps are all no-ops. But it's simplest to include
 this step anyway. -->

 <li><p>Let <var title="">original start node</var>, <var title="">original start offset</var>,
 <var title="">original end node</var>, and <var title="">original end offset</var> be
 <var title="">range</var>'s <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>,
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a>,
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>, and
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a>, respectively.

 <li>
  <p>If <var title="">original start node</var> equals
  <var title="">original end node</var>, and they are a <code><a href="#text">Text</a></code>,
  <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or <code><a href="#comment">Comment</a></code>
  <a title="concept-node" href="#concept-node">node</a>:

  <ol>
   <li><p>Let <var title="">clone</var> be a <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">original start node</var>.

   <li><p>Set the <a title="concept-CD-data" href="#concept-cd-data">data</a> of
   <var title="">clone</var> to the result of
   <a title="concept-CD-substring" href="#concept-cd-substring">substringing data</a> with node
   <var title="">original start node</var>, offset
   <var title="">original start offset</var>, and count
   <var title="">original end offset</var> minus
   <var title="">original start offset</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var>
   to <var title="">fragment</var>.

   <li><p>Return <var title="">fragment</var>.
  </ol>

 <li><p>Let <var title="">common ancestor</var> be
 <var title="">original start node</var>.

 <li><p>While <var title="">common ancestor</var> is not an
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
 <var title="">original end node</var>, set
 <var title="">common ancestor</var> to its own
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>Let <var title="">first partially contained child</var> be null.

 <li><p>If <var title="">original start node</var> is <em>not</em> an
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
 <var title="">original end node</var>, set <var title="">first partially contained child</var>
 to the first <a title="concept-tree-child" href="#concept-tree-child">child</a> of
 <var title="">common ancestor</var> that is <a href="#partially-contained">partially contained</a> in
 <var title="">range</var>.

 <li><p>Let <var title="">last partially contained child</var> be null.

 <li>
  <p>If <var title="">original end node</var> is <em>not</em> an
  <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
  <var title="">original start node</var>, set
  <var title="">last partially contained child</var> to the last
  <a title="concept-tree-child" href="#concept-tree-child">child</a> of <var title="">common ancestor</var> that is
  <a href="#partially-contained">partially contained</a> in <var title="">range</var>.

  <p class="note no-backref">These variable assignments do actually always make sense.
  For instance, if <var title="">original start node</var> is not an
  <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
  <var title="">original end node</var>, <var title="">original start node</var> is itself
  <a href="#partially-contained">partially contained</a> in <var title="">range</var>, and so are all its
  <a title="concept-tree-ancestor" href="#concept-tree-ancestor">ancestors</a> up until a
  <a title="concept-tree-child" href="#concept-tree-child">child</a> of <var title="">common ancestor</var>.
  <var title="">common ancestor</var> cannot be <var title="">original start node</var>, because
  it has to be an <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
  <var title="">original end node</var>. The other case is similar. Also, notice that the two
  <a title="concept-tree-child" href="#concept-tree-child">children</a> will never be equal if both are defined.

 <li><p>Let <var title="">contained children</var> be a list of all
 <a title="concept-tree-child" href="#concept-tree-child">children</a> of
 <var title="">common ancestor</var> that are <a href="#contained">contained</a> in
 <var title="">range</var>, in <a title="concept-tree-order" href="#concept-tree-order">tree order</a>.

 <li>
  <p>If any member of <var title="">contained children</var> is a
  <a title="concept-doctype" href="#concept-doctype">doctype</a>, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a
  <code title="">HierarchyRequestError</code> exception.

  <p class="note no-backref">We do not have to worry about the first or last partially
  contained node, because a <a title="concept-doctype" href="#concept-doctype">doctype</a> can never be
  partially contained. It cannot be a boundary point of a range, and it
  cannot be the ancestor of anything.

 <li>
  <p>If <var title="">first partially contained child</var> is a
  <code><a href="#text">Text</a></code>, <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or
  <code><a href="#comment">Comment</a></code> <a title="concept-node" href="#concept-node">node</a>:

  <p class="note">In this case, <var title="">first partially contained child</var> is
  <var title="">original start node</var>.

  <ol>
   <li><p>Let <var title="">clone</var> be a
   <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">original start node</var>.

   <li><p>Set the <a title="concept-CD-data" href="#concept-cd-data">data</a> of
   <var title="">clone</var> to the result of
   <a title="concept-CD-substring" href="#concept-cd-substring">substringing data</a> with node
   <var title="">original start node</var>, offset
   <var title="">original start offset</var>, and count
   <var title="">original start node</var>'s
   <a title="concept-node-length" href="#concept-node-length">length</a> minus
   <var title="">original start offset</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var>
   to <var title="">fragment</var>.
  </ol>

 <li>
  <p>Otherwise, if <var title="">first partially contained child</var> is not
  null:

  <ol>
   <li><p>Let <var title="">clone</var> be a
   <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">first partially contained child</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var>
   to <var title="">fragment</var>.

   <li><p>Let <var title="">subrange</var> be a new <a title="concept-range" href="#concept-range">range</a>
   whose <a title="concept-range-start" href="#concept-range-start">start</a> is
   (<var title="">original start node</var>, <var title="">original start offset</var>) and
   whose <a title="concept-range-end" href="#concept-range-end">end</a> is
   (<var title="">first partially contained child</var>, <var title="">first partially contained child</var>'s <a title="concept-node-length" href="#concept-node-length">length</a>).

   <li><p>Let <var title="">subfragment</var> be the result of
   <a title="concept-range-clone" href="#concept-range-clone">cloning</a> <var title="">subrange</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">subfragment</var> to
   <var title="">clone</var>.
  </ol>

 <li>
  <p>For each <var title="">contained child</var> in
  <var title="">contained children</var>:

  <ol>
   <li><p>Let <var title="">clone</var> be a <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">contained child</var> with the <i title="">clone children flag</i> set.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var> to
   <var title="">fragment</var>.
  </ol>

 <li>
  <p>If <var title="">last partially contained child</var> is a
  <code><a href="#text">Text</a></code>, <code><a href="#processinginstruction">ProcessingInstruction</a></code>, or
  <code><a href="#comment">Comment</a></code> <a title="concept-node" href="#concept-node">node</a>:

  <p class="note">In this case, <var title="">last partially contained child</var> is
  <var title="">original end node</var>.

  <ol>
   <li><p>Let <var title="">clone</var> be a <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">original end node</var>.

   <li><p>Set the <a title="concept-CD-data" href="#concept-cd-data">data</a> of
   <var title="">clone</var> to the result of
   <a title="concept-CD-substring" href="#concept-cd-substring">substringing data</a> with node
   <var title="">original end node</var>, offset 0, and count
   <var title="">original end offset</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var> to
   <var title="">fragment</var>.
  </ol>

 <li>
  <p>Otherwise, if <var title="">last partially contained child</var> is not
  null:

  <ol>
   <li><p>Let <var title="">clone</var> be a
   <a title="concept-node-clone" href="#concept-node-clone">clone</a> of
   <var title="">last partially contained child</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">clone</var>
   to <var title="">fragment</var>.

   <li><p>Let <var title="">subrange</var> be a new <a title="concept-range" href="#concept-range">range</a>
   whose <a title="concept-range-start" href="#concept-range-start">start</a> is
   (<var title="">last partially contained child</var>, 0) and whose
   <a title="concept-range-end" href="#concept-range-end">end</a> is
   (<var title="">original end node</var>, <var title="">original end offset</var>).

   <li><p>Let <var title="">subfragment</var> be the result of
   <a title="concept-range-clone" href="#concept-range-clone">cloning</a> <var title="">subrange</var>.

   <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">subfragment</var> to
   <var title="">clone</var>.
  </ol>

 <li><p>Return <var title="">fragment</var>.
</ol>

<p>The <dfn title="dom-Range-cloneContents" id="dom-range-clonecontents"><code>cloneContents()</code></dfn>
method must return the result of <a title="concept-range-clone" href="#concept-range-clone">cloning</a>
<a href="#context-object">context object</a>.

<p>To <dfn title="concept-range-insert" id="concept-range-insert">insert</dfn> a <a title="concept-node" href="#concept-node">node</a>
<var title="">node</var> into a <a title="concept-range" href="#concept-range">range</a>
<var title="">range</var>, run these steps:

<ol>
  <!-- Chrome 12 dev throws "HierarchyRequestError" if node is the same
  as the start node (at least for text nodes). This doesn't seem to make
  much sense, since insertBefore() works fine to move a node to its current
  position, and other browsers disagree, so the spec follows the majority.
  -->
 <li><p>If <var title="">range</var>'s <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>
 is either a <code><a href="#processinginstruction">ProcessingInstruction</a></code> or <code><a href="#comment">Comment</a></code>
 <a title="concept-node" href="#concept-node">node</a>, or a <code><a href="#text">Text</a></code>
 <a title="concept-node" href="#concept-node">node</a> whose <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>
 is null, <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an <code title="">HierarchyRequestError</code>
 exception.

 <!--
 Behavior for Text node with null parent:

 IE9: Allows it to go through, resulting in the text/comment node having a non-null previousSibling but a null parentNode. (?!)
 Firefox 4.0: Throws non-standard exception
 Chrome 12 dev: Throws "HierarchyRequestError"
 Opera 11.00: Doesn't come up, doesn't allow ranges on detached nodes

 IE is clearly crazy, and non-standard exceptions are no good, so we go with
 WebKit.

 For a Comment node, see https://www.w3.org/Bugs/Public/show_bug.cgi?id=15350.
 IE9, Firefox 12.0a1, and Chrome 17 dev all agree on throwing a
 HierarchyRequestError.  Opera Next 12.00 alpha splits the comment, same as a
 text node.
 -->
 <li><p>Let <var title="">referenceNode</var> be null.

 <li><p>If <var title="">range</var>'s <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>
 is a <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>,
 set <var title="">referenceNode</var> to that <code><a href="#text">Text</a></code>
 <a title="concept-node" href="#concept-node">node</a>. <!-- This will change when we split
 it. -->

 <li><p>Otherwise, set <var title="">referenceNode</var> to the
 <a title="concept-tree-child" href="#concept-tree-child">child</a> of
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> whose
 <a title="concept-tree-index" href="#concept-tree-index">index</a> is
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a>, and null if
 there is no such <a title="concept-tree-child" href="#concept-tree-child">child</a>.

 <li><p>Let <var title="">parent</var> be <var title="">range</var>'s
 <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> if <var title="">referenceNode</var>
 is null, and <var title="">referenceNode</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> otherwise.

 <!-- IE9 and Chrome 12 dev throw an exception before splitting the text
 node if the insertBefore() is going to throw an exception (at least if the
 new node is the parent of the start node, for instance). Firefox 4.0 and
 Opera 11.00 don't.  Now that we have "ensure pre-insertion validity," we go
 with the IE/Chrome behavior because it's more correct.

 IE9 doesn't call splitText() if the offset is 0. This makes sense, but I go
 with what all other browsers do. -->
 <li><p><a title="concept-node-ensure-pre-insertion-validity" href="#concept-node-ensure-pre-insertion-validity">Ensure pre-insertion validity</a>
 of <var title="">node</var> into <var title="">parent</var> before
 <var title="">referenceNode</var>.

 <li><p>If <var title="">range</var>'s <a title="concept-range-start-node" href="#concept-range-start-node">start node</a>
 is a <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>,
 <a title="concept-Text-split" href="#concept-text-split">split</a> it with offset
 <var title="">range</var>'s <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a>,
 set <var title="">referenceNode</var> to the result, and set
 <var title="">parent</var> to <var title="">referenceNode</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>If <var title="">node</var> equals <var title="">referenceNode</var>, set
 <var title="">referenceNode</var> to its
 <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>. <!-- Because we're
 about to remove node from its parent. -->

 <li><p>If <var title="">node</var>'s <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is not
 null, <a title="concept-node-remove" href="#concept-node-remove">remove</a> <var title="">node</var> from its
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <!-- Browsers disagree on how to handle the case where the range is
 collapsed: do you increment the end offset so the node is now included, or
 not?  DOM 2 Range says no, and Firefox 12.0a1 follows that, but IE9, Chrome
 17 dev, and Opera Next 12.00 alpha all do increment.  Apparently this
 traces back to Acid3 at one point requiring the non-standard behavior.
 Previously the spec matched DOM 2 Range, but it changed to match the
 majority of browsers.  See
 https://www.w3.org/Bugs/Public/show_bug.cgi?id=15297.

 We have to be careful here, because if node is a DocumentFragment, we might
 have inserted any number of nodes, including zero.  One corner case is if
 we insert an empty DocumentFragment and the range is collapsed in a text
 node.  In that case, the text node gets split, but browsers disagree on
 what to do with the range's end.  IE9 leaves it in place; Chrome 17 dev
 moves it to the parent element, before the reference node; Opera Next 12.00
 alpha moves it to the beginning of the new text node.  The spec follows
 WebKit just because it happens to be easier for me to spec.

 The logic for how much to increment the position by is copied from the
 "insert" algorithm.  Getting the new offset right was surprisingly tricky.
 -->
 <li><p>Let <var title="">newOffset</var> be <var title="">parent</var>'s
 <a title="concept-node-length" href="#concept-node-length">length</a> if <var title="">referenceNode</var> is null,
 and <var title="">referenceNode</var>'s <a title="concept-tree-index" href="#concept-tree-index">index</a>
 otherwise.

 <li><p>Increase <var title="">newOffset</var> by <var title="">node</var>'s
 <a title="concept-node-length" href="#concept-node-length">length</a> if <var title="">node</var> is a
 <code><a href="#documentfragment">DocumentFragment</a></code> <a title="concept-node" href="#concept-node">node</a>, and one otherwise.

 <li><p><a title="concept-node-pre-insert" href="#concept-node-pre-insert">Pre-insert</a>
 <var title="">node</var> into <var title="">parent</var> before <var title="">referenceNode</var>.

 <li><p>If <var title="">range</var>'s <a title="concept-range-start" href="#concept-range-start">start</a> and
 <a title="concept-range-end" href="#concept-range-end">end</a> are the same, set <var title="">range</var>'s
 <a title="concept-range-end" href="#concept-range-end">end</a> to
 (<var title="">parent</var>, <var title="">newOffset</var>).
</ol>

<p>The <dfn title="dom-Range-insertNode" id="dom-range-insertnode"><code>insertNode(<var>node</var>)</code></dfn>
method must <a title="concept-range-insert" href="#concept-range-insert">insert</a> <var title="">node</var> into
<a href="#context-object">context object</a>.

<p>The
<dfn title="dom-Range-surroundContents" id="dom-range-surroundcontents"><code>surroundContents(<var>newParent</var>)</code></dfn>
method must run these steps:

<!--
IE9 and Chrome 12 dev throw exceptions before doing any DOM mutations in at
least some cases, so they don't wind up modifying the DOM halfway. Like if you
try surrounding a selection with an ancestor. As with insertNode(), this is
slightly nicer, but Firefox 4.0 and Opera 11.00 don't do this, and their
behavior is slightly easier to spec, so I go with them for exceptions that are
thrown by things we call, like insertNode(). However, for
BAD_BOUNDARYPOINTS_ERR/INVALID_NODE_TYPE_ERR that we throw ourselves, I do the
check first thing, which matches everyone but Firefox.
-->

<ol>
 <li><p>If a non-<code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a> is
 <a href="#partially-contained">partially contained</a> in the <a href="#context-object">context object</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidStateError</code> exception.
 <!-- Makes some sense: otherwise we'd clone a bunch of containers, which is
 unexpected. -->
 <!-- XXX Could we rephrase this condition to be more algorithmic and less
 declarative?-->

 <li><p>If <var title="">newParent</var> is a <code><a href="#document">Document</a></code>,
 <code><a href="#documenttype">DocumentType</a></code>, or <code><a href="#documentfragment">DocumentFragment</a></code>
 <a title="concept-node" href="#concept-node">node</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code> exception.
 <!-- But for Comment, Text, and ProcessingInstruction, we just fall through
 and throw a HIERARCHY_REQUEST_ERR when we try appendChild(). This makes
 absolutely no sense, but it's what DOM 2 Range specifies, and it's what
 IE9, Chrome 12 dev, and Opera 11.00 implement. Firefox 4.0 only throws
 INVALID_NODE_TYPE_ERR on DocumentFragments, it falls through to
 HIERARCHY_REQUEST_ERR for Documents and DocumentTypes.

 Firefox 4.0 does this check later on, so it will do DOM mutations of some
 type if passed a DocumentFragment. We match IE9, Chrome 12 dev, and Opera
 11.00 in doing the check early.

 If newParent is a Document/DocumentType/DocumentFragment, and some node is
 also partially contained, DOM 2 Range doesn't say whether to throw
 BAD_BOUNDARYPOINTS_ERR or INVALID_NODE_TYPE_ERR. IE9 and Chrome 12 dev
 throw INVALID_NODE_TYPE_ERR, while Firefox 4.0 and Opera 11.00 throw
 BAD_BOUNDARYPOINTS_ERR. I chose the latter because it's the first thing I
 happened to write down and it makes no real difference, with the even
 split. -->

 <li><p>Let <var title="">fragment</var> be the result of
 <a title="concept-range-extract" href="#concept-range-extract">extracting</a> <a href="#context-object">context object</a>.
 <!-- If the range contains a DocumentType, Firefox 4.0 and Opera 11.00 don't
 immediately throw here. Firefox removes the non-DocumentType nodes and
 throws, Opera removes all nodes and doesn't throw. This applies to
 extractContents() proper, and also affects surroundContents(). I match DOM 2
 Range, IE9, and Chrome 12 dev. -->

 <li><p>If <var title="">newParent</var> has
 <a title="concept-tree-child" href="#concept-tree-child">children</a>,
 <a title="concept-node-replace-all" href="#concept-node-replace-all">replace all</a> with null within
 <var title="">newParent</var>.

 <li><p><a title="concept-range-insert" href="#concept-range-insert">Insert</a> <var title="">newParent</var> into
 <a href="#context-object">context object</a>.

 <li><p><a title="concept-node-append" href="#concept-node-append">Append</a> <var title="">fragment</var> to
 <var title="">newParent</var>.

 <li><p><a title="concept-range-select" href="#concept-range-select">Select</a> <var title="">newParent</var> within
 <a href="#context-object">context object</a>.
 <!-- Generally this isn't needed, because insertNode() will already do it,
 but it makes a difference in at least one corner case (when the original
 range lies in a single text node). -->
</ol>

<p>The <dfn title="dom-Range-cloneRange" id="dom-range-clonerange"><code>cloneRange()</code></dfn>
method must return a new <a title="concept-range" href="#concept-range">range</a> with the
same <a title="concept-range-start" href="#concept-range-start">start</a> and
<a title="concept-range-end" href="#concept-range-end">end</a> as the <a href="#context-object">context object</a>.

<p>The <dfn title="dom-Range-detach" id="dom-range-detach"><code>detach()</code></dfn> method must
do nothing. <span class="note">Its functionality (disabling a
<code><a href="#range">Range</a></code> object) was removed, but the method itself is preserved
for compatibility.</span>

<hr>

<dl class="domintro">
 <dt><var title="">position</var> = <var title="">range</var> . <code title="dom-Range-comparePoint"><a href="#dom-range-comparepoint">comparePoint</a></code>( <var title="">parent</var>, <var title="">offset</var> )
 <dd><p>Returns −1 if the point is before the range, 0 if the point is
 in the range, and 1 if the point is after the range.

 <dt><var title="">intersects</var> = <var title="">range</var> . <code title="dom-Range-intersectsNode"><a href="#dom-range-intersectsnode">intersectsNode</a></code>( <var title="">node</var> )
 <dd><p>Returns whether <var title="">range</var> intersects
 <var title="">node</var>.
</dl>

<div class="impl">

<p>The
<dfn title="dom-Range-isPointInRange" id="dom-range-ispointinrange"><code>isPointInRange(<var>node</var>, <var>offset</var>)</code></dfn>
must run these steps:
<!-- Tested October 2011 on Firefox 9.0a2 and Chrome 16 dev.  IE9 and Opera
11.50 don't support the method. -->

<ol>
 <li><p>If <var title="">node</var>'s <a title="concept-tree-root" href="#concept-tree-root">root</a> is
 different from the <a href="#context-object">context object</a>'s <a title="concept-range-root" href="#concept-range-root">root</a>, return false.
 <!-- This happens even if the offset is negative or too large, or if the node
 is a doctype, in both Firefox 9.0a2 and Chrome 16 dev. -->

 <li><p>If <var title="">node</var> is a
 <a title="concept-doctype" href="#concept-doctype">doctype</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code> exception.
 <!-- Firefox 9.0a2 doesn't throw.  It ignores the offset and returns true or
 false depending on whether the doctype itself is in the range.  This makes
 some sense, but it doesn't match how other Range APIs handle doctypes, and
 having the second argument mandatory but ignored is just weird.  Thus I go
 with Chrome 16 dev, although I can see the merit in how Gecko works here. -->

 <li><p>If <var title="">offset</var> is greater than
 <var title="">node</var>'s <a title="concept-node-length" href="#concept-node-length">length</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">IndexSizeError</code> exception.
 <!-- Firefox 9.0a2 doesn't throw.  It seems to return true if the node is
 completely contained in the range, like with selectNode(), and false otherwise
 - even if all boundary points in the node are contained in the range, like
 with selectNodeContents().  This is weird, and inconsistent with other Range
 APIs, so I go with Chrome 16 dev.  This is probably an authoring bug, so it's
 best to throw anyway. -->

 <li><p>If (<var title="">node</var>, <var title="">offset</var>) is
 <a title="concept-range-bp-before" href="#concept-range-bp-before">before</a>
 <a title="concept-range-start" href="#concept-range-start">start</a> or
 <a title="concept-range-bp-after" href="#concept-range-bp-after">after</a>
 <a title="concept-range-end" href="#concept-range-end">end</a>, return false.

 <li><p>Return true.
</ol>


<p>The
<dfn title="dom-Range-comparePoint" id="dom-range-comparepoint"><code>comparePoint(<var>node</var>, <var>offset</var>)</code></dfn>
method must run these steps:
<!-- IE9 doesn't support this method at all.  Firefox 12.0a1, Chrome 17 dev,
and Opera Next 12.00 alpha all do. -->

<ol>
 <li><p>If <var title="">node</var>'s <a title="concept-tree-root" href="#concept-tree-root">root</a> is
 different from the <a href="#context-object">context object</a>'s
 <a title="concept-range-root" href="#concept-range-root">root</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">WrongDocumentError</code>
 exception.
 <!-- Opera Next 12.00 alpha seems to return -1 in this case.  The spec matches
 Firefox 12.0a1 and Chrome 17 dev. -->

 <li><p>If <var title="">node</var> is a
 <a title="concept-doctype" href="#concept-doctype">doctype</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidNodeTypeError</code> exception.
 <!-- This matches Chrome 17 dev instead of Firefox 12.0a1 and Opera Next 12.00
 alpha, which don't throw and seem to just ignore the offset instead.  See
 comment for isPointInRange(). -->

 <li><p>If <var title="">offset</var> is greater than
 <var title="">node</var>'s <a title="concept-node-length" href="#concept-node-length">length</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">IndexSizeError</code> exception.
 <!-- This matches Chrome 17 dev instead of Firefox 12.0a1 and Opera Next 12.00
 alpha, which don't throw.  See comment for isPointInRange(). -->

 <li><p>If (<var title="">node</var>, <var title="">offset</var>) is
 <a title="concept-range-bp-before" href="#concept-range-bp-before">before</a>
 <a title="concept-range-start" href="#concept-range-start">start</a>, return −1.

 <li><p>If (<var title="">node</var>, <var title="">offset</var>) is
 <a title="concept-range-bp-after" href="#concept-range-bp-after">after</a>
 <a title="concept-range-end" href="#concept-range-end">end</a>, return 1.

 <li><p>Return 0.
</ol>

<hr>

<p>The
<dfn title="dom-Range-intersectsNode" id="dom-range-intersectsnode"><code>intersectsNode(<var>node</var>)</code></dfn>
method must run these steps:
<!-- Supported by Chrome 17 dev and Opera Next 12.00 alpha, but not IE9 or
Firefox 12.0a1. -->

<ol>
 <li><p>If <var title="">node</var>'s <a title="concept-tree-root" href="#concept-tree-root">root</a>
 is different from the <a href="#context-object">context object</a>'s
 <a title="concept-range-root" href="#concept-range-root">root</a>, return false.
 <!-- It seems like for doctypes, Opera Next 12.00 alpha throws
 InvalidNodeTypeError instead of returning false.  The spec follows Chrome
 17 dev. -->

 <li><p>Let <var title="">parent</var> be <var title="">node</var>'s
 <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

 <li><p>If <var title="">parent</var> is null, return true.
 <!-- browsers currently throw, but are willing to change
      https://www.w3.org/Bugs/Public/show_bug.cgi?id=16759 -->

 <li><p>Let <var title="">offset</var> be <var title="">node</var>'s
 <a title="concept-tree-index" href="#concept-tree-index">index</a>.

 <li><p>If (<var title="">parent</var>, <var title="">offset</var>) is
 <a title="concept-range-bp-before" href="#concept-range-bp-before">before</a>
 <a title="concept-range-end" href="#concept-range-end">end</a> and (<var title="">parent</var>,
 <var title="">offset</var> + 1) is
 <a title="concept-range-bp-after" href="#concept-range-bp-after">after</a>
 <a title="concept-range-start" href="#concept-range-start">start</a>, return true.

 <li><p>Return false.
</ol>

</div>

<hr>

<p>The <dfn title="dom-Range-stringifier" id="dom-range-stringifier">stringifier</dfn> must run these
steps:

<ol>
 <li><p>Let <var title="">s</var> be the empty string.

 <li><p>If <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> equals
 <a title="concept-range-end-node" href="#concept-range-end-node">end node</a>, and it is a
 <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>, return the
 substring of that <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>'s <a title="concept-CD-data" href="#concept-cd-data">data</a> beginning at
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> and ending at
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a>.

 <li><p>If <a title="concept-range-start-node" href="#concept-range-start-node">start node</a> is a
 <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>, append to
 <var title="">s</var> the substring of that
 <a title="concept-node" href="#concept-node">node</a>'s
 <a title="concept-CD-data" href="#concept-cd-data">data</a> from the
 <a title="concept-range-start-offset" href="#concept-range-start-offset">start offset</a> until the end.

 <li><p>Append to <var title="">s</var> the concatenation, in
 <a title="concept-tree-order" href="#concept-tree-order">tree order</a>, of the
 <a title="concept-CD-data" href="#concept-cd-data">data</a> of all <code><a href="#text">Text</a></code>
 <a title="concept-node" href="#concept-node">nodes</a> that are <a href="#contained">contained</a> in
 the <a href="#context-object">context object</a>.

 <li><p>If <a title="concept-range-end-node" href="#concept-range-end-node">end node</a> is a
 <code><a href="#text">Text</a></code> <a title="concept-node" href="#concept-node">node</a>, append to
 <var title="">s</var> the substring of that
 <a title="concept-node" href="#concept-node">node</a>'s
 <a title="concept-CD-data" href="#concept-cd-data">data</a> from its start until the
 <a title="concept-range-end-offset" href="#concept-range-end-offset">end offset</a>.

 <li><p>Return <var title="">s</var>.
</ol>

<hr>

<p class="note">The
<code data-anolis-spec="domps" title="createContextualFragment" class="external"><a href="https://dvcs.w3.org/hg/innerhtml/raw-file/tip/index.html#widl-Range-createContextualFragment-DocumentFragment-DOMString-fragment">createContextualFragment()</a></code>,
<code title="dom-Range-getClientRects" data-anolis-spec="cssom-view" class="external"><a href="http://dev.w3.org/csswg/cssom-view/#dom-range-getclientrects">getClientRects()</a></code>,
and
<code title="dom-Range-getBoundingClientRect" data-anolis-spec="cssom-view" class="external"><a href="http://dev.w3.org/csswg/cssom-view/#dom-range-getboundingclientrect">getBoundingClientRect()</a></code>
methods are defined in other specifications.
<a class="informative" href="#refsDOMPS">[DOMPS]</a>
<a class="informative" href="#refsCSSOMVIEW">[CSSOMVIEW]</a>



<h2 id="traversal"><span class="secno">6 </span>Traversal</h2>

<p><code><a href="#nodeiterator">NodeIterator</a></code> and <code><a href="#treewalker">TreeWalker</a></code> objects can be used
to filter and traverse <a title="concept-node" href="#concept-node">node</a>
<a title="concept-tree" href="#concept-tree">trees</a>.

<p>Each <code><a href="#nodeiterator">NodeIterator</a></code> and <code><a href="#treewalker">TreeWalker</a></code> object also
has an associated <dfn title="concept-traversal-root" id="concept-traversal-root">root</dfn>
<a title="concept-node" href="#concept-node">node</a>,
<dfn title="concept-traversal-whatToShow" id="concept-traversal-whattoshow">whatToShow</dfn> bitmask, and
<dfn title="concept-traversal-filter" id="concept-traversal-filter">filter</dfn> callback.

<p>To <dfn title="concept-node-filter" id="concept-node-filter">filter</dfn> <var title="">node</var> run
these steps:

<ol>
 <li><p>Let <var title="">n</var> be <var title="">node</var>'s
 <code title="dom-Node-nodeType"><a href="#dom-node-nodetype">nodeType</a></code> attribute value minus 1.
 <li><p>If the <var title="">n</var><sup>th</sup> bit (where 0 is the least
 significant bit) of
 <a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a> is not set,
 return <code title="dom-NodeFilter-FILTER_SKIP"><a href="#dom-nodefilter-filter_skip">FILTER_SKIP</a></code>.
 <!-- !((1 << (node.nodeType - 1)) & whatToShow) -->
 <li><p>If <a title="concept-traversal-filter" href="#concept-traversal-filter">filter</a> is null,
 return <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>.
 <li><p>Let <var title="">result</var> be the return value of calling
 <a title="concept-traversal-filter" href="#concept-traversal-filter">filter</a>'s
 <code title="dom-NodeFilter-acceptNode">acceptNode</code> with <var title="">node</var> as
 argument. Rethrow any exceptions.
 <!-- no need to pass callback this value; it's undefined which becomes the global object -->
 <li><p>Return <var title="">result</var>.
</ol>


<h3 id="interface-nodeiterator"><span class="secno">6.1 </span>Interface <code><a href="#nodeiterator">NodeIterator</a></code></h3>

<pre class="idl">interface <dfn id="nodeiterator">NodeIterator</dfn> {
  [SameObject] readonly attribute <a href="#node">Node</a> <a title="dom-NodeIterator-root" href="#dom-nodeiterator-root">root</a>;
  readonly attribute <a href="#node">Node</a> <a title="dom-NodeIterator-referenceNode" href="#dom-nodeiterator-referencenode">referenceNode</a>;
  readonly attribute boolean <a title="dom-NodeIterator-pointerBeforeReferenceNode" href="#dom-nodeiterator-pointerbeforereferencenode">pointerBeforeReferenceNode</a>;
  readonly attribute unsigned long <a title="dom-NodeIterator-whatToShow" href="#dom-nodeiterator-whattoshow">whatToShow</a>;
  readonly attribute <a href="#nodefilter">NodeFilter</a>? <a title="dom-NodeIterator-filter" href="#dom-nodeiterator-filter">filter</a>;

  <a href="#node">Node</a>? <a title="dom-NodeIterator-nextNode" href="#dom-nodeiterator-nextnode">nextNode</a>();
  <a href="#node">Node</a>? <a title="dom-NodeIterator-previousNode" href="#dom-nodeiterator-previousnode">previousNode</a>();

  void <a title="dom-NodeIterator-detach" href="#dom-nodeiterator-detach">detach</a>();
};</pre>

<p class="note"><code><a href="#nodeiterator">NodeIterator</a></code> objects can be created using the
<code title="dom-Document-createNodeIterator"><a href="#dom-document-createnodeiterator">createNodeIterator()</a></code>
method.

<p>Each <code><a href="#nodeiterator">NodeIterator</a></code> object has an associated
<dfn id="iterator-collection">iterator collection</dfn>, which is a
<a title="concept-collection" href="#concept-collection">collection</a> rooted at
<a title="concept-traversal-root" href="#concept-traversal-root">root</a>, whose filter matches any
<a title="concept-node" href="#concept-node">node</a>.

<p>Each <code><a href="#nodeiterator">NodeIterator</a></code> object has these
<a title="concept-node-remove-ext" href="#concept-node-remove-ext">removing steps</a> with <var>oldNode</var>,
<var>oldParent</var>, and <var>oldPreviousSibling</var>:

<ol>
 <li><p>If <var>oldNode</var> is not an
 <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of the
 <code title="dom-NodeIterator-referenceNode"><a href="#dom-nodeiterator-referencenode">referenceNode</a></code> attribute value,
 terminate these steps.

 <li>
  <p>If the
  <code title="dom-NodeIterator-pointerBeforeReferenceNode"><a href="#dom-nodeiterator-pointerbeforereferencenode">pointerBeforeReferenceNode</a></code>
  attribute value is true, run these substeps:

  <ol>
   <li><p>Let <var>nextSibling</var> be <var>oldPreviousSibling</var>'s
   <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a>, if
   <var>oldPreviousSibling</var> is non-null, and <var>oldParent</var>'s
   <a title="concept-tree-first-child" href="#concept-tree-first-child">first child</a> otherwise.

   <li><p>If <var>nextSibling</var> is non-null, set the
   <code title="dom-NodeIterator-referenceNode"><a href="#dom-nodeiterator-referencenode">referenceNode</a></code> attribute to
   <var>nextSibling</var> and terminate these steps.

   <li><p>Let <var>next</var> be the first <a title="concept-node" href="#concept-node">node</a>
   <a title="concept-tree-following" href="#concept-tree-following">following</a> <var>oldParent</var>.

   <li><p>If <var>next</var> is not an
   <a title="concept-tree-inclusive-ancestor" href="#concept-tree-inclusive-ancestor">inclusive ancestor</a> of
   <a title="concept-traversal-root" href="#concept-traversal-root">root</a>, set the
   <code title="dom-NodeIterator-referenceNode"><a href="#dom-nodeiterator-referencenode">referenceNode</a></code> attribute to
   <var>next</var> and terminate these steps.

   <li>
    <p>Otherwise, set the
    <code title="dom-NodeIterator-pointerBeforeReferenceNode"><a href="#dom-nodeiterator-pointerbeforereferencenode">pointerBeforeReferenceNode</a></code>
    attribute to false.

    <p class="note">Steps are not terminated here.
  </ol>

 <li><p>Set the <code title="dom-NodeIterator-referenceNode"><a href="#dom-nodeiterator-referencenode">referenceNode</a></code> attribute
 to first <a title="concept-node" href="#concept-node">node</a>
 <a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a> <var>oldPreviousSibling</var>, if
 <var>oldPreviousSibling</var> is non-null, and to <var>oldParent</var> otherwise.
</ol>

<p class="note">As mentioned earlier <code><a href="#nodeiterator">NodeIterator</a></code> objects have an
associated <a title="concept-traversal-root" href="#concept-traversal-root">root</a>
<a title="concept-node" href="#concept-node">node</a>,
<a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a> bitmask, and
<a title="concept-traversal-filter" href="#concept-traversal-filter">filter</a> callback as well.

<hr>

<p>The <dfn title="dom-NodeIterator-root" id="dom-nodeiterator-root"><code>root</code></dfn> attribute
must return <a title="concept-traversal-root" href="#concept-traversal-root">root</a>.</p>

<p>The
<dfn title="dom-NodeIterator-referenceNode" id="dom-nodeiterator-referencenode"><code>referenceNode</code></dfn>
and
<dfn title="dom-NodeIterator-pointerBeforeReferenceNode" id="dom-nodeiterator-pointerbeforereferencenode"><code>pointerBeforeReferenceNode</code></dfn>
attributes must return what they were initialized to.</p>

<p>The <dfn title="dom-NodeIterator-whatToShow" id="dom-nodeiterator-whattoshow"><code>whatToShow</code></dfn>
attribute must return
<a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a>.

<p>The <dfn title="dom-NodeIterator-filter" id="dom-nodeiterator-filter"><code>filter</code></dfn>
attribute must return <a title="concept-traversal-filter" href="#concept-traversal-filter">filter</a>.

<p>To <dfn title="concept-NodeIterator-traverse" id="concept-nodeiterator-traverse">traverse</dfn> in direction
<var title="">direction</var> run these steps:

<ol>
 <li><p>Let <var title="">node</var> be the value of the
 <code title="dom-NodeIterator-referenceNode"><a href="#dom-nodeiterator-referencenode">referenceNode</a></code> attribute.

 <li><p>Let <var title="">before node</var> be the value of the
 <code title="dom-NodeIterator-pointerBeforeReferenceNode"><a href="#dom-nodeiterator-pointerbeforereferencenode">pointerBeforeReferenceNode</a></code>
 attribute.

 <li>
  <p>Run these substeps:
  <ol>
   <li>
    <dl class="switch">
     <dt>If direction is next</dt>
     <dd>
      <p>If <var title="">before node</var> is false, let <var title="">node</var>
      be the first <a title="concept-node" href="#concept-node">node</a>
      <a title="concept-tree-following" href="#concept-tree-following">following</a>
      <var title="">node</var> in the <a href="#iterator-collection">iterator collection</a>. If
      there is no such <a title="concept-node" href="#concept-node">node</a> return null.
      <p>If <var title="">before node</var> is true, set it to false.
     <dt>If direction is previous</dt>
     <dd>
      <p>If <var title="">before node</var> is true, let <var title="">node</var>
      be the first <a title="concept-node" href="#concept-node">node</a>
      <a title="concept-tree-preceding" href="#concept-tree-preceding">preceding</a>
      <var title="">node</var> in the <a href="#iterator-collection">iterator collection</a>. If
      there is no such <a title="concept-node" href="#concept-node">node</a> return null.
      <p>If <var title="">before node</var> is false, set it to true.
    </dl>
   <li><p><a title="concept-node-filter" href="#concept-node-filter">Filter</a>
   <var title="">node</var> and let <var title="">result</var> be the return
   value.
   <li>
    <p>If <var title="">result</var> is
    <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>, go to the
    next step in the overall set of steps.
    <p>Otherwise, run these substeps again.
  </ol>
 <li><p>Set the
 <code title="dom-NodeIterator-referenceNode"><a href="#dom-nodeiterator-referencenode">referenceNode</a></code> attribute
 to <var title="">node</var>, set the
 <code title="dom-NodeIterator-pointerBeforeReferenceNode"><a href="#dom-nodeiterator-pointerbeforereferencenode">pointerBeforeReferenceNode</a></code>
 attribute to <var title="">before node</var>, and return
 <var title="">node</var>.
</ol>

<p>The <dfn title="dom-NodeIterator-nextNode" id="dom-nodeiterator-nextnode"><code>nextNode()</code></dfn>
method must <a title="concept-NodeIterator-traverse" href="#concept-nodeiterator-traverse">traverse</a> in
direction next.

<p>The
<dfn title="dom-NodeIterator-previousNode" id="dom-nodeiterator-previousnode"><code>previousNode()</code></dfn>
method must <a title="concept-NodeIterator-traverse" href="#concept-nodeiterator-traverse">traverse</a> in
direction previous.

<p>The <dfn title="dom-NodeIterator-detach" id="dom-nodeiterator-detach"><code>detach()</code></dfn>
method must do nothing. <span class="note">Its functionality (disabling a
<code><a href="#nodeiterator">NodeIterator</a></code> object) was removed, but the method itself is preserved
for compatibility.</span>


<h3 id="interface-treewalker"><span class="secno">6.2 </span>Interface <code><a href="#treewalker">TreeWalker</a></code></h3>

<pre class="idl">interface <dfn id="treewalker">TreeWalker</dfn> {
  [SameObject] readonly attribute <a href="#node">Node</a> <a title="dom-TreeWalker-root" href="#dom-treewalker-root">root</a>;
  readonly attribute unsigned long <a title="dom-TreeWalker-whatToShow" href="#dom-treewalker-whattoshow">whatToShow</a>;
  readonly attribute <a href="#nodefilter">NodeFilter</a>? <a title="dom-TreeWalker-filter" href="#dom-treewalker-filter">filter</a>;
           attribute <a href="#node">Node</a> <a title="dom-TreeWalker-currentNode" href="#dom-treewalker-currentnode">currentNode</a>;

  <a href="#node">Node</a>? <a title="dom-TreeWalker-parentNode" href="#dom-treewalker-parentnode">parentNode</a>();
  <a href="#node">Node</a>? <a title="dom-TreeWalker-firstChild" href="#dom-treewalker-firstchild">firstChild</a>();
  <a href="#node">Node</a>? <a title="dom-TreeWalker-lastChild" href="#dom-treewalker-lastchild">lastChild</a>();
  <a href="#node">Node</a>? <a title="dom-TreeWalker-previousSibling" href="#dom-treewalker-previoussibling">previousSibling</a>();
  <a href="#node">Node</a>? <a title="dom-TreeWalker-nextSibling" href="#dom-treewalker-nextsibling">nextSibling</a>();
  <a href="#node">Node</a>? <a title="dom-TreeWalker-previousNode" href="#dom-treewalker-previousnode">previousNode</a>();
  <a href="#node">Node</a>? <a title="dom-TreeWalker-nextNode" href="#dom-treewalker-nextnode">nextNode</a>();
};</pre>

<p class="note"><code><a href="#treewalker">TreeWalker</a></code> objects can be created using the
<code title="dom-Document-createTreeWalker"><a href="#dom-document-createtreewalker">createTreeWalker()</a></code> method.

<p class="note">As mentioned earlier <code><a href="#treewalker">TreeWalker</a></code> objects have an
associated <a title="concept-traversal-root" href="#concept-traversal-root">root</a>
<a title="concept-node" href="#concept-node">node</a>,
<a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a> bitmask, and
<a title="concept-traversal-filter" href="#concept-traversal-filter">filter</a> callback.

<p>The <dfn title="dom-TreeWalker-root" id="dom-treewalker-root"><code>root</code></dfn> attribute must
return <a title="concept-traversal-root" href="#concept-traversal-root">root</a>.</p>

<p>The <dfn title="dom-TreeWalker-whatToShow" id="dom-treewalker-whattoshow"><code>whatToShow</code></dfn>
attribute must return
<a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a>.

<p>The <dfn title="dom-TreeWalker-filter" id="dom-treewalker-filter"><code>filter</code></dfn> attribute
must return <a title="concept-traversal-filter" href="#concept-traversal-filter">filter</a>.

<p>The <dfn title="dom-TreeWalker-currentNode" id="dom-treewalker-currentnode"><code>currentNode</code></dfn>
attribute must return what it was initialized to.</p>

<p>Setting the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code>
attribute must set it to the new value.</p>


<p>The <dfn title="dom-TreeWalker-parentNode" id="dom-treewalker-parentnode"><code>parentNode()</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">node</var> be the value of the
 <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute.

 <li>
  <p>While <var title="">node</var> is not null and is not
  <a title="concept-traversal-root" href="#concept-traversal-root">root</a>, run these substeps:

  <ol>
   <li><p>Let <var title="">node</var> be <var title="">node</var>'s
   <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

   <li><p>If <var title="">node</var> is not null and
   <a title="concept-node-filter" href="#concept-node-filter">filtering</a> <var title="">node</var>
   returns <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>,
   then set the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code>
   attribute to <var title="">node</var>, return <var title="">node</var>.
  </ol>

 <li><p>Return null.
</ol>

<p>To <dfn title="concept-traverse-children" id="concept-traverse-children">traverse children</dfn> of type
<var title="">type</var>, run these steps:

<ol>
 <li><p>Let <var title="">node</var> be the value
 of the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute.

 <li><p>Set <var title="">node</var> to <var title="">node</var>'s
 <a title="concept-tree-first-child" href="#concept-tree-first-child">first child</a> if
 <var title="">type</var> is first, and <var title="">node</var>'s
 <a title="concept-tree-last-child" href="#concept-tree-last-child">last child</a> if
 <var title="">type</var> is last.

 <li>
  <p><dfn title="concept-traverse-children-main" id="concept-traverse-children-main">Main</dfn>:
  While <var title="">node</var> is not null, run these substeps:

  <ol>
   <li><p><a title="concept-node-filter" href="#concept-node-filter">Filter</a>
   <var title="">node</var> and let <var title="">result</var> be the return
   value.

   <li><p>If <var title="">result</var> is
   <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>, then set
   the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code>
   attribute to <var title="">node</var> and return <var title="">node</var>.

   <li>
    <p>If <var title="">result</var> is
    <code title="dom-NodeFilter-FILTER_SKIP"><a href="#dom-nodefilter-filter_skip">FILTER_SKIP</a></code>, run these
    subsubsteps:

    <ol>
     <li><p>Let <var title="">child</var> be <var title="">node</var>'s
     <a title="concept-tree-first-child" href="#concept-tree-first-child">first child</a> if
     <var title="">type</var> is first, and <var title="">node</var>'s
     <a title="concept-tree-last-child" href="#concept-tree-last-child">last child</a> if
     <var title="">type</var> is last.

     <li><p>If <var title="">child</var> is not null, set <var title="">node</var>
     to <var title="">child</var> and goto
     <a title="concept-traverse-children-main" href="#concept-traverse-children-main">Main</a>.
    </ol>

   <li>
    <p>While <var title="">node</var> is not null, run these subsubsteps:

    <ol>
     <li><p>Let <var title="">sibling</var> be <var title="">node</var>'s
     <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a> if
     <var title="">type</var> is first, and <var title="">node</var>'s
     <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a> if
     <var title="">type</var> is last.

     <li><p>If <var title="">sibling</var> is not null, set
     <var title="">node</var> to <var title="">sibling</var> and goto
     <a title="concept-traverse-children-main" href="#concept-traverse-children-main">Main</a>.

     <li><p>Let <var title="">parent</var> be <var title="">node</var>'s
     <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

     <li><p>If <var title="">parent</var> is null, <var title="">parent</var> is
     <a title="concept-traversal-root" href="#concept-traversal-root">root</a>, or
     <var title="">parent</var> is
     <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute's
     value, return null.

     <li><p>Otherwise, set <var title="">node</var> to <var title="">parent</var>.
    </ol>
  </ol>
 <li><p>Return null.
</ol>

<p>The <dfn title="dom-TreeWalker-firstChild" id="dom-treewalker-firstchild"><code>firstChild()</code></dfn>
method must <a title="concept-traverse-children" href="#concept-traverse-children">traverse children</a>
of type first.

<p>The <dfn title="dom-TreeWalker-lastChild" id="dom-treewalker-lastchild"><code>lastChild()</code></dfn>
method must <a title="concept-traverse-children" href="#concept-traverse-children">traverse children</a>
of type last.

<p>To <dfn title="concept-traverse-siblings" id="concept-traverse-siblings">traverse siblings</dfn> of type
<var title="">type</var> run these steps:

<ol>
 <li><p>Let <var title="">node</var> be the value of the
 <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute.

 <li><p>If <var title="">node</var> is
 <a title="concept-traversal-root" href="#concept-traversal-root">root</a>, return null.

 <li>
  <p>Run these substeps:

  <ol>
   <li><p>Let <var title="">sibling</var> be <var title="">node</var>'s
   <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a> if
   <var title="">type</var> is next, and <var title="">node</var>'s
   <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a> if
   <var title="">type</var> is previous.

   <li>
    <p>While <var title="">sibling</var> is not null, run these subsubsteps:

    <ol>
     <li><p>Set <var title="">node</var> to <var title="">sibling</var>.

     <li><p><a title="concept-node-filter" href="#concept-node-filter">Filter</a>
     <var title="">node</var> and let <var title="">result</var> be the return
     value.

     <li><p>If <var title="">result</var> is
     <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>, then set
     the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code>
     attribute to <var title="">node</var> and return <var title="">node</var>.

     <li><p>Set <var title="">sibling</var> to <var title="">node</var>'s
     <a title="concept-tree-first-child" href="#concept-tree-first-child">first child</a> if
     <var title="">type</var> is next, and <var title="">node</var>'s
     <a title="concept-tree-last-child" href="#concept-tree-last-child">last child</a> if
     <var title="">type</var> is previous.

     <li><p>If <var title="">result</var> is
     <code title="dom-NodeFilter-FILTER_REJECT"><a href="#dom-nodefilter-filter_reject">FILTER_REJECT</a></code> or
     <var title="">sibling</var> is null, then set <var title="">sibling</var> to
     <var title="">node</var>'s
     <a title="concept-tree-next-sibling" href="#concept-tree-next-sibling">next sibling</a> if
     <var title="">type</var> is next, and <var title="">node</var>'s
     <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a> if
     <var title="">type</var> is previous.
    </ol>

   <li><p>Set <var title="">node</var> to its
   <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

   <li><p>If <var title="">node</var> is null or is
   <a title="concept-traversal-root" href="#concept-traversal-root">root</a>, return null.

   <li><p><a title="concept-node-filter" href="#concept-node-filter">Filter</a>
   <var title="">node</var> and if the return value is
   <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>, then
   return null.
   <!-- XXX WTF? -->

   <li><p>Run these substeps again.
  </ol>
</ol>

<p>The
<dfn title="dom-TreeWalker-nextSibling" id="dom-treewalker-nextsibling"><code>nextSibling()</code></dfn>
method must <a title="concept-traverse-siblings" href="#concept-traverse-siblings">traverse siblings</a>
of type next.

<p>The
<dfn title="dom-TreeWalker-previousSibling" id="dom-treewalker-previoussibling"><code>previousSibling()</code></dfn>
method must <a title="concept-traverse-siblings" href="#concept-traverse-siblings">traverse siblings</a>
of type previous.

<p>The
<dfn title="dom-TreeWalker-previousNode" id="dom-treewalker-previousnode"><code>previousNode()</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">node</var> be the value of the
 <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute.

 <li>
  <p>While <var title="">node</var> is not
  <a title="concept-traversal-root" href="#concept-traversal-root">root</a>, run these substeps:

  <ol>
   <li><p>Let <var title="">sibling</var> be the
   <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a> of
   <var title="">node</var>.

   <li>
    <p>While <var title="">sibling</var> is not null, run these subsubsteps:

    <ol>
     <li><p>Set <var title="">node</var> to <var title="">sibling</var>.

     <li><p><a title="concept-node-filter" href="#concept-node-filter">Filter</a>
     <var title="">node</var> and let <var title="">result</var> be the return
     value.

     <li><p>While <var title="">result</var> is not
     <code title="dom-NodeFilter-FILTER_REJECT"><a href="#dom-nodefilter-filter_reject">FILTER_REJECT</a></code> and
     <var title="">node</var> has a
     <a title="concept-tree-child" href="#concept-tree-child">child</a>, set <var title="">node</var>
     to its <a title="concept-tree-last-child" href="#concept-tree-last-child">last child</a> and then
     <a title="concept-node-filter" href="#concept-node-filter">filter</a> <var title="">node</var> and
     set <var title="">result</var> to the return value.

     <li><p>If <var title="">result</var> is
     <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>, then set
     the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code>
     attribute to <var title="">node</var> and return <var title="">node</var>.

     <li><p>Set <var title="">sibling</var> to the
     <a title="concept-tree-previous-sibling" href="#concept-tree-previous-sibling">previous sibling</a> of
     <var title="">node</var>.
    </ol>

   <li><p>If <var title="">node</var> is
   <a title="concept-traversal-root" href="#concept-traversal-root">root</a> or <var title="">node</var>'s
   <a title="concept-tree-parent" href="#concept-tree-parent">parent</a> is null, return null.

   <li><p>Set <var title="">node</var> to its
   <a title="concept-tree-parent" href="#concept-tree-parent">parent</a>.

   <li><p><a title="concept-node-filter" href="#concept-node-filter">Filter</a>
   <var title="">node</var> and if the return value is
   <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>, then set
   the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute
   to <var title="">node</var> and return <var title="">node</var>.
  </ol>

 <li><p>Return null.
</ol>

<p>The <dfn title="dom-TreeWalker-nextNode" id="dom-treewalker-nextnode"><code>nextNode()</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title="">node</var> be the value of the
 <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute.

 <li><p>Let <var title="">result</var> be
 <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>.

 <li>
  <p>Run these substeps:

  <ol>
   <li>
    <p>While <var title="">result</var> is not
    <code title="dom-NodeFilter-FILTER_REJECT"><a href="#dom-nodefilter-filter_reject">FILTER_REJECT</a></code> and
    <var title="">node</var> has a <a title="concept-tree-child" href="#concept-tree-child">child</a>,
    run these subsubsteps:

    <ol>
     <li><p>Set <var title="">node</var> to its
     <a title="concept-tree-first-child" href="#concept-tree-first-child">first child</a>.

     <li><p><a title="concept-node-filter" href="#concept-node-filter">Filter</a>
     <var title="">node</var> and set <var title="">result</var> to the return
     value.

     <li><p>If <var title="">result</var> is
     <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>, then set
     the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute
     to <var title="">node</var> and return <var title="">node</var>.
    </ol>

   <li>
    <p>If a <a title="concept-node" href="#concept-node">node</a> is
    <a title="concept-tree-following" href="#concept-tree-following">following</a>
    <var title="">node</var> and is not
    <a title="concept-tree-following" href="#concept-tree-following">following</a>
    <a title="concept-traversal-root" href="#concept-traversal-root">root</a>, set
    <var title="">node</var> to the first such
    <a title="concept-node" href="#concept-node">node</a>.
    <p>Otherwise, return null.
    <!-- Implemented as iterating over parent/nextSibling -->

   <li><p><a title="concept-node-filter" href="#concept-node-filter">Filter</a>
   <var title="">node</var> and set <var title="">result</var> to the return
   value.

   <li><p>If <var title="">result</var> is
   <code title="dom-NodeFilter-FILTER_ACCEPT"><a href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a></code>, then set
   the <code title="dom-TreeWalker-currentNode"><a href="#dom-treewalker-currentnode">currentNode</a></code> attribute
   to <var title="">node</var> and return <var title="">node</var>.

   <li><p>Run these substeps again.
  </ol>
</ol>



<h3 id="interface-nodefilter"><span class="secno">6.3 </span>Interface <code><a href="#nodefilter">NodeFilter</a></code></h3>

<pre class="idl">callback interface <dfn id="nodefilter">NodeFilter</dfn> {
  // Constants for <span title="dom-NodeFilter-acceptNode">acceptNode()</span>
  const unsigned short <a title="dom-NodeFilter-FILTER_ACCEPT" href="#dom-nodefilter-filter_accept">FILTER_ACCEPT</a> = 1;
  const unsigned short <a title="dom-NodeFilter-FILTER_REJECT" href="#dom-nodefilter-filter_reject">FILTER_REJECT</a> = 2;
  const unsigned short <a title="dom-NodeFilter-FILTER_SKIP" href="#dom-nodefilter-filter_skip">FILTER_SKIP</a> = 3;

  // Constants for <a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a>
  const unsigned long <a title="dom-NodeFilter-SHOW_ALL" href="#dom-nodefilter-show_all">SHOW_ALL</a> = 0xFFFFFFFF;
  const unsigned long <a title="dom-NodeFilter-SHOW_ELEMENT" href="#dom-nodefilter-show_element">SHOW_ELEMENT</a> = 0x1;
  const unsigned long <span title="dom-NodeFilter-SHOW_ATTRIBUTE">SHOW_ATTRIBUTE</span> = 0x2; // historical
  const unsigned long <a title="dom-NodeFilter-SHOW_TEXT" href="#dom-nodefilter-show_text">SHOW_TEXT</a> = 0x4;
  const unsigned long <span title="dom-NodeFilter-SHOW_CDATA_SECTION">SHOW_CDATA_SECTION</span> = 0x8; // historical
  const unsigned long <span title="dom-NodeFilter-SHOW_ENTITY_REFERENCE">SHOW_ENTITY_REFERENCE</span> = 0x10; // historical
  const unsigned long <span title="dom-NodeFilter-SHOW_ENTITY">SHOW_ENTITY</span> = 0x20; // historical
  const unsigned long <a title="dom-NodeFilter-SHOW_PROCESSING_INSTRUCTION" href="#dom-nodefilter-show_processing_instruction">SHOW_PROCESSING_INSTRUCTION</a> = 0x40;
  const unsigned long <a title="dom-NodeFilter-SHOW_COMMENT" href="#dom-nodefilter-show_comment">SHOW_COMMENT</a> = 0x80;
  const unsigned long <a title="dom-NodeFilter-SHOW_DOCUMENT" href="#dom-nodefilter-show_document">SHOW_DOCUMENT</a> = 0x100;
  const unsigned long <a title="dom-NodeFilter-SHOW_DOCUMENT_TYPE" href="#dom-nodefilter-show_document_type">SHOW_DOCUMENT_TYPE</a> = 0x200;
  const unsigned long <a title="dom-NodeFilter-SHOW_DOCUMENT_FRAGMENT" href="#dom-nodefilter-show_document_fragment">SHOW_DOCUMENT_FRAGMENT</a> = 0x400;
  const unsigned long <span title="dom-NodeFilter-SHOW_NOTATION">SHOW_NOTATION</span> = 0x800; // historical

  unsigned short <span title="dom-NodeFilter-acceptNode">acceptNode</span>(<a href="#node">Node</a> <var title="">node</var>);
};</pre>

<p><code><a href="#nodefilter">NodeFilter</a></code> objects can be used as
<a title="concept-traversal-filter" href="#concept-traversal-filter">filter</a> callback and provide
constants for the <a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a>
bitmask.

<p class="note">It is typically implemented as a JavaScript function.

<p>These constants can be used as callback return value:

<ul class="brief">
 <li><dfn title="dom-NodeFilter-FILTER_ACCEPT" id="dom-nodefilter-filter_accept"><code>FILTER_ACCEPT</code></dfn> (1);
 <li><dfn title="dom-NodeFilter-FILTER_REJECT" id="dom-nodefilter-filter_reject"><code>FILTER_REJECT</code></dfn> (2);
 <li><dfn title="dom-NodeFilter-FILTER_SKIP" id="dom-nodefilter-filter_skip"><code>FILTER_SKIP</code></dfn> (3).
</ul>

<p>These constants can be used for the
<a title="concept-traversal-whatToShow" href="#concept-traversal-whattoshow">whatToShow</a> bitmask:

<ul class="brief">
 <li><dfn title="dom-NodeFilter-SHOW_ALL" id="dom-nodefilter-show_all"><code>SHOW_ALL</code></dfn> (4294967295, FFFFFFFF in hexadecimal);
 <li><dfn title="dom-NodeFilter-SHOW_ELEMENT" id="dom-nodefilter-show_element"><code>SHOW_ELEMENT</code></dfn> (1);
 <!-- AttrExodus
 <li><dfn title=dom-NodeFilter-SHOW_ATTRIBUTE><code>SHOW_ATTRIBUTE</code></dfn> (2, historical);
 -->
 <li><dfn title="dom-NodeFilter-SHOW_TEXT" id="dom-nodefilter-show_text"><code>SHOW_TEXT</code></dfn> (4);
 <!-- XXX still questionable
 <li><dfn title=dom-NodeFilter-SHOW_CDATA_SECTION><code>SHOW_CDATA_SECTION</code></dfn> (8; historical);
 -->
 <li><dfn title="dom-NodeFilter-SHOW_PROCESSING_INSTRUCTION" id="dom-nodefilter-show_processing_instruction"><code>SHOW_PROCESSING_INSTRUCTION</code></dfn> (64, 40 in hexadecimal);
 <li><dfn title="dom-NodeFilter-SHOW_COMMENT" id="dom-nodefilter-show_comment"><code>SHOW_COMMENT</code></dfn> (128, 80 in hexadecimal);
 <li><dfn title="dom-NodeFilter-SHOW_DOCUMENT" id="dom-nodefilter-show_document"><code>SHOW_DOCUMENT</code></dfn> (256, 100 in hexadecimal);
 <li><dfn title="dom-NodeFilter-SHOW_DOCUMENT_TYPE" id="dom-nodefilter-show_document_type"><code>SHOW_DOCUMENT_TYPE</code></dfn> (512, 200 in hexadecimal);
 <li><dfn title="dom-NodeFilter-SHOW_DOCUMENT_FRAGMENT" id="dom-nodefilter-show_document_fragment"><code>SHOW_DOCUMENT_FRAGMENT</code></dfn> (1024, 400 in hexadecimal).
</ul>



<h2 id="sets"><span class="secno">7 </span>Sets</h2>

<p class="note">Yes, the names <code><a href="#domtokenlist">DOMTokenList</a></code> and
<code><a href="#domsettabletokenlist">DOMSettableTokenList</a></code> are unfortunate legacy mishaps.

<h3 id="interface-domtokenlist"><span class="secno">7.1 </span>Interface <code><a href="#domtokenlist">DOMTokenList</a></code></h3>

<pre class="idl">interface <dfn id="domtokenlist">DOMTokenList</dfn> {
  readonly attribute unsigned long <a title="dom-DOMTokenList-length" href="#dom-domtokenlist-length">length</a>;
  getter DOMString? <a title="dom-DOMTokenList-item" href="#dom-domtokenlist-item">item</a>(unsigned long <var title="">index</var>);
  boolean <a title="dom-DOMTokenList-contains" href="#dom-domtokenlist-contains">contains</a>(DOMString <var title="">token</var>);
  void <a title="dom-DOMTokenList-add" href="#dom-domtokenlist-add">add</a>(DOMString... <var title="">tokens</var>);
  void <a title="dom-DOMTokenList-remove" href="#dom-domtokenlist-remove">remove</a>(DOMString... <var title="">tokens</var>);
  boolean <a title="dom-DOMTokenList-toggle" href="#dom-domtokenlist-toggle">toggle</a>(DOMString <var title="">token</var>, optional boolean <var title="">force</var>);
  <a title="dom-DOMTokenList-stringifier" href="#dom-domtokenlist-stringifier">stringifier</a>;
  iterable&lt;DOMString&gt;;
};</pre>

<p>A <code><a href="#domtokenlist">DOMTokenList</a></code> object has an associated ordered set of
<dfn title="concept-DTL-tokens" id="concept-dtl-tokens">tokens</dfn>, which is initially empty.

<p>A <code><a href="#domtokenlist">DOMTokenList</a></code> object also has an associated
<a title="concept-element" href="#concept-element">element</a> and an
<a title="concept-attribute" href="#concept-attribute">attribute</a>'s
<a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a>.

<p>A <code><a href="#domtokenlist">DOMTokenList</a></code> object's
<dfn title="concept-DTL-update" id="concept-dtl-update">update steps</dfn> are:

<ol>
 <li><p>If there is no associated
 <a title="concept-attribute" href="#concept-attribute">attribute</a> (when the object is a
 <code><a href="#domsettabletokenlist">DOMSettableTokenList</a></code>), terminate these steps.

 <li><p><a title="concept-element-attributes-set-value" href="#concept-element-attributes-set-value">Set an attribute value</a>
 for the associated <a title="concept-element" href="#concept-element">element</a> using
 associated <a title="concept-attribute" href="#concept-attribute">attribute</a>'s
 <a title="concept-attribute-local-name" href="#concept-attribute-local-name">local name</a> and the result
 of running the <a title="concept-ordered-set-serializer" href="#concept-ordered-set-serializer">ordered set serializer</a>
 for <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>.
</ol>

<dl class="domintro">
 <dt><code><var title="">tokenlist</var> . <a title="dom-DOMTokenList-length" href="#dom-domtokenlist-length">length</a></code>
 <dd><p>Returns the number of tokens.

 <dt><code><var title="">tokenlist</var> . <a title="dom-DOMTokenList-item" href="#dom-domtokenlist-item">item</a>(<var title="">index</var>)</code>
 <dt><code><var title="">tokenlist</var>[<var title="">index</var>]</code>
 <dd><p>Returns the token with index <var title="">index</var>.

 <dt><code><var title="">tokenlist</var> . <a title="dom-DOMTokenList-contains" href="#dom-domtokenlist-contains">contains</a>(<var title="">token</var>)</code>
 <dd>
  <p>Returns true if <var title="">token</var> is present, and false otherwise.
  <p>Throws a <code title="">SyntaxError</code> exception if <var title="">token</var>
  is the empty string.
  <p>Throws an <code title="">InvalidCharacterError</code> exception if
  <var title="">token</var> contains any
  <a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a>.

 <dt><code><var title="">tokenlist</var> . <a title="dom-DOMTokenList-add" href="#dom-domtokenlist-add">add</a>(<var title="">tokens</var>…)</code>
 <dd>
  <p>Adds all arguments passed, except those already present.
  <p>Throws a <code title="">SyntaxError</code> exception if one if the arguments
  is the empty string.
  <p>Throws an <code title="">InvalidCharacterError</code> exception if one of the
  arguments contains any
  <a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a>.

 <dt><code><var title="">tokenlist</var> . <a title="dom-DOMTokenList-remove" href="#dom-domtokenlist-remove">remove</a>(<var title="">tokens</var>…)</code>
 <dd>
  <p>Removes arguments passed, if they are present.
  <p>Throws a <code title="">SyntaxError</code> exception if one if the arguments
  is the empty string.
  <p>Throws an <code title="">InvalidCharacterError</code> exception if one of the
  arguments contains any
  <a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a>.

 <dt><code><var title="">tokenlist</var> . <a title="dom-DOMTokenList-toggle" href="#dom-domtokenlist-toggle">toggle</a>(<var title="">token</var> [, <var title="">force</var>])</code>
 <dd>
  <p>If <var title="">force</var> is not given, "toggles"
  <var title="">token</var>, removing it if it's present and adding it if it's
  not. If <var title="">force</var> is true, adds <var title="">token</var> (same
  as <code title="dom-DOMTokenList-add"><a href="#dom-domtokenlist-add">add()</a></code>).  If
  <var title="">force</var> is false, removes <var title="">token</var> (same as
  <code title="dom-DOMTokenList-remove"><a href="#dom-domtokenlist-remove">remove()</a></code>).
  <p>Returns true if <var title="">token</var> is now present, and false
  otherwise.
  <p>Throws a <code title="">SyntaxError</code> exception if <var title="">token</var> is empty.
  <p>Throws an <code title="">InvalidCharacterError</code> exception if <var title="">token</var> contains any spaces.
</dl>

<div class="impl">

<p>The <dfn title="dom-DOMTokenList-length" id="dom-domtokenlist-length"><code>length</code></dfn>
attribute must return the number of tokens in the
<a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>.

<p>The object's
<a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-indices">supported property indices</a> are the
numbers in the range zero to the number of tokens in
<a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a> minus one, unless
<a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a> is  empty, in which case there are no
<a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-supported-property-indices">supported property indices</a>.

<p>The
<dfn title="dom-DOMTokenList-item" id="dom-domtokenlist-item"><code>item(<var title="">index</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var title="">index</var> is equal to or greater than the number of
 tokens in <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>, return null.

 <li><p>Return the <var title="">index</var>th token in
 <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>.
</ol>

<p>The
<dfn title="dom-DOMTokenList-contains" id="dom-domtokenlist-contains"><code>contains(<var title="">token</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var title="">token</var> is the empty string, then
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">SyntaxError</code>
 exception.

 <li><p>If <var title="">token</var> contains any
 <a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a>, then
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a>
 an <code title="">InvalidCharacterError</code> exception.

 <li><p>Return true if <var title="">token</var> is in
 <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>, and false otherwise.
</ol>

<p>The
<dfn title="dom-DOMTokenList-add" id="dom-domtokenlist-add"><code>add(<var title="">tokens</var>…)</code></dfn>
method must run these steps:

<ol>
 <li><p>If one of <var title="">tokens</var> is the empty string,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">SyntaxError</code>
 exception.

 <li><p>If one of <var title="">tokens</var> contains any
 <a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a>, then
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidCharacterError</code> exception.

 <li><p>For each <var title="">token</var> in <var title="">tokens</var>, in given
 order, that is not in <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>, append
 <var title="">token</var> to <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>.

 <li><p>Run the <a title="concept-DTL-update" href="#concept-dtl-update">update steps</a>.
</ol>

<p>The
<dfn title="dom-DOMTokenList-remove" id="dom-domtokenlist-remove"><code>remove(<var title="">tokens</var>…)</code></dfn>
method must run these steps:

<ol>
 <li><p>If one of <var title="">tokens</var> is the empty string,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">SyntaxError</code>
 exception.

 <li><p>If one of <var title="">tokens</var> contains any
 <a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a>, then
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidCharacterError</code> exception.

 <li><p>For each <var title="">token</var> in <var title="">tokens</var>, remove
 <var title="">token</var> from <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>.

 <li><p>Run the <a title="concept-DTL-update" href="#concept-dtl-update">update steps</a>.
</ol>

<p>The
<dfn title="dom-DOMTokenList-toggle" id="dom-domtokenlist-toggle"><code>toggle(<var title="">token</var>, <var title="">force</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <var title="">token</var> is the empty string,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">SyntaxError</code>
 exception.

 <li><p>If <var title="">token</var> contains any
 <a data-anolis-spec="encoding" class="external" href="https://encoding.spec.whatwg.org/#ascii-whitespace">ASCII whitespace</a>,
 <a data-anolis-spec="webidl" class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> an
 <code title="">InvalidCharacterError</code> exception.

 <li>
  <p>If <var title="">token</var> is in <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>, run
  these substeps:

  <ol>
   <li><p>If <var title="">force</var> is either not passed or is false, then remove
   <var title="">token</var> from <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>, run the
   <a title="concept-DTL-update" href="#concept-dtl-update">update steps</a>, and return false.

   <li><p>Otherwise, return true.
  </ol>

 <li>
  <p>Otherwise, run these substeps:

  <ol>
   <li><p>If <var title="">force</var> is passed and is false, return false.

   <li><p>Otherwise, append <var title="">token</var> to
   <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>, run the
   <a title="concept-DTL-update" href="#concept-dtl-update">update steps</a>, and return true.
  </ol>
</ol>

<p>The <dfn title="dom-DOMTokenList-stringifier" id="dom-domtokenlist-stringifier">stringifier</dfn> must
return the result of the
<a title="concept-ordered-set-serializer" href="#concept-ordered-set-serializer">ordered set serializer</a> for
<a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>.

</div>


<h3 id="interface-domsettabletokenlist"><span class="secno">7.2 </span>Interface <code><a href="#domsettabletokenlist">DOMSettableTokenList</a></code></h3>

<pre class="idl">interface <dfn id="domsettabletokenlist">DOMSettableTokenList</dfn> : <a href="#domtokenlist">DOMTokenList</a> {
            attribute DOMString <a title="dom-DOMSettableTokenList-value" href="#dom-domsettabletokenlist-value">value</a>;
};</pre>

<p>A <code><a href="#domsettabletokenlist">DOMSettableTokenList</a></code> object is equivalent to a
<code><a href="#domtokenlist">DOMTokenList</a></code> object without an associated
<a title="concept-attribute" href="#concept-attribute">attribute</a>.

<dl class="domintro">
 <dt><code><var title="">tokenlist</var> . <a title="dom-DOMSettableTokenList-value" href="#dom-domsettabletokenlist-value">value</a></code>
 <dd>
  <p>Returns the associated set as string.
  <p>Can be set, to change the associated set via a string.
</dl>

<div class="impl">

<p>The <dfn title="dom-DOMSettableTokenList-value" id="dom-domsettabletokenlist-value"><code>value</code></dfn>
attribute must return the result of the
<a title="concept-ordered-set-serializer" href="#concept-ordered-set-serializer">ordered set serializer</a> for
<a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a>.

<p>Setting the <code title="dom-DOMSettableTokenList-value"><a href="#dom-domsettabletokenlist-value">value</a></code>
attribute must run the <a title="concept-ordered-set-parser" href="#concept-ordered-set-parser">ordered set parser</a>
for the given value and set <a title="concept-DTL-tokens" href="#concept-dtl-tokens">tokens</a> to the result.

</div>



<h2 id="historical"><span class="secno">8 </span>Historical</h2>

<p>As explained in <a href="#goals">goals</a> this specification is a
significant revision of various DOM specifications. This section attempts to
enumerate the changes.


<h3 id="dom-events"><span class="secno">8.1 </span>DOM Events</h3>

<p>These are the changes made to the features described in the
"DOM Event Architecture", "Basic Event Interfaces", "Mutation Events", and
"Mutation Name Event Types" chapters of <cite>DOM Level 3 Events</cite>. The
other chapters are defined by the <cite>UI Events</cite> specification.
<a class="informative" href="#refsDOM3EVENTS">[DOM3EVENTS]</a>
<a href="#refsUIEVENTS">[UIEVENTS]</a>

<ul class="brief">
 <li>Events have constructors now.
 <li>Removes <dfn id="mutationevent"><code>MutationEvent</code></dfn>, and
 <dfn id="mutationnameevent"><code>MutationNameEvent</code></dfn>.
 <li>Fire is no longer synonymous with dispatch, but includes initializing
 an event.</li>
 <li>The propagation and canceled flags are unset when invoking
 <code title="dom-Event-initEvent"><a href="#dom-event-initevent">initEvent()</a></code> rather than after
 dispatch.
</ul>


<h3 id="dom-core"><span class="secno">8.2 </span>DOM Core</h3>

<p>These are the changes made to the features described in
<cite>DOM Level 3 Core</cite>.

<p><dfn id="domstring"><code>DOMString</code></dfn>, <dfn id="domexception"><code>DOMException</code></dfn>, and
<dfn id="domtimestamp"><code>DOMTimeStamp</code></dfn> are now defined in Web IDL.

<p><code><a href="#node">Node</a></code> now inherits from <code><a href="#eventtarget">EventTarget</a></code>.</p>

<p><a title="concept-node" href="#concept-node">Nodes</a> are implicitly
<a title="concept-node-adopt" href="#concept-node-adopt">adopted</a> across
<a title="concept-document" href="#concept-document">document</a> boundaries.

<p><a title="concept-doctype" href="#concept-doctype">Doctypes</a> now always have a
<a title="concept-node-document" href="#concept-node-document">node document</a> and can be moved
across <a title="concept-document" href="#concept-document">document</a> boundaries.

<p><code><a href="#processinginstruction">ProcessingInstruction</a></code> now inherits from
<code><a href="#characterdata">CharacterData</a></code>.

<p><dfn title="dom-Node-hasAttributes" id="dom-node-hasattributes"><code>hasAttributes()</code></dfn> and
<dfn title="dom-Node-attributes" id="dom-node-attributes"><code>attributes</code></dfn> moved from <code><a href="#node">Node</a></code>
to <code><a href="#element">Element</a></code>.

<p><dfn title="dom-Node-namespaceURI" id="dom-node-namespaceuri"><code>namespaceURI</code></dfn>,
<dfn title="dom-Node-prefix" id="dom-node-prefix"><code>prefix</code></dfn>, and
<dfn title="dom-Node-localName" id="dom-node-localname"><code>localName</code></dfn> moved from <code><a href="#node">Node</a></code> to
<code><a href="#element">Element</a></code> and <code><a href="#attr">Attr</a></code>.

<p>The remainder of interfaces and interface members listed in this section
were removed to simplify the DOM platform. Implementations conforming to
this specification will not support them.

<p class="warning">It is not yet clear if it would be web-compatible to
remove all the following features. The editors welcome any data showing that
some of these features should be reintroduced.

<p>Interfaces:
<ul class="brief">
 <li><dfn id="cdatasection"><code>CDATASection</code></dfn>
 <li><dfn id="domconfiguration"><code>DOMConfiguration</code></dfn>
 <li><dfn id="domerror"><code>DOMError</code></dfn>
 <li><dfn id="domerrorhandler"><code>DOMErrorHandler</code></dfn>
 <li><dfn id="domimplementationlist"><code>DOMImplementationList</code></dfn>
 <li><dfn id="domimplementationsource"><code>DOMImplementationSource</code></dfn>
 <li><dfn id="domlocator"><code>DOMLocator</code></dfn>
 <li><dfn id="domobject"><code>DOMObject</code></dfn>
 <li><dfn id="domstringlist"><code>DOMStringList</code></dfn>
 <li><dfn id="domuserdata"><code>DOMUserData</code></dfn>
 <li><dfn id="entity"><code>Entity</code></dfn>
 <li><dfn id="entityreference"><code>EntityReference</code></dfn>
 <li><dfn id="namelist"><code>NameList</code></dfn>
 <li><dfn id="notation"><code>Notation</code></dfn>
 <li><dfn id="typeinfo"><code>TypeInfo</code></dfn>
 <li><dfn id="userdatahandler"><code>UserDataHandler</code></dfn>
</ul>

<p>Interface members:
<dl>
 <dt><code><a href="#node">Node</a></code>
 <dd>
  <ul class="brief">
   <li><dfn title="dom-Node-isSupported" id="dom-node-issupported"><code>isSupported</code></dfn>
   <li><dfn title="dom-Node-getFeature" id="dom-node-getfeature"><code>getFeature()</code></dfn>
   <li><dfn title="dom-Node-getUserData" id="dom-node-getuserdata"><code>getUserData()</code></dfn>
   <li><dfn title="dom-Node-setUserData" id="dom-node-setuserdata"><code>setUserData()</code></dfn>

   <li><dfn title="dom-Node-isSameNode" id="dom-node-issamenode"><code>isSameNode()</code></dfn>
  </ul>

 <dt><code><a href="#document">Document</a></code>
 <dd>
  <ul class="brief">
   <li><dfn title="dom-Document-createCDATASection" id="dom-document-createcdatasection"><code>createCDATASection()</code></dfn>
   <li><dfn title="dom-Document-createEntityReference" id="dom-document-createentityreference"><code>createEntityReference()</code></dfn>
   <li><dfn title="dom-Document-xmlEncoding" id="dom-document-xmlencoding"><code>xmlEncoding</code></dfn>
   <li><dfn title="dom-Document-xmlStandalone" id="dom-document-xmlstandalone"><code>xmlStandalone</code></dfn>
   <li><dfn title="dom-Document-xmlVersion" id="dom-document-xmlversion"><code>xmlVersion</code></dfn>
   <li><dfn title="dom-Document-strictErrorChecking" id="dom-document-stricterrorchecking"><code>strictErrorChecking</code></dfn>
   <li><dfn title="dom-Document-domConfig" id="dom-document-domconfig"><code>domConfig</code></dfn>
   <li><dfn title="dom-Document-normalizeDocument" id="dom-document-normalizedocument"><code>normalizeDocument()</code></dfn>
   <li><dfn title="dom-Document-renameNode" id="dom-document-renamenode"><code>renameNode()</code></dfn>
  </ul>

 <dt><code><a href="#domimplementation">DOMImplementation</a></code>
 <dd>
  <ul class="brief">
   <li><dfn title="dom-DOMImplementation-getFeature" id="dom-domimplementation-getfeature"><code>getFeature()</code></dfn>
  </ul>

 <dt><code><a href="#attr">Attr</a></code>
 <dd>
  <p>No longer inherits from <code><a href="#node">Node</a></code> and therefore completely
  changed.
  <!--AttrExodus
  <p><dfn title=dom-Attr-schemaTypeInfo><code>schemaTypeInfo</code></dfn>
  <p><dfn title=dom-Attr-isId><code>isId</code></dfn>
  -->

 <dt><code><a href="#element">Element</a></code>
 <dd>
  <ul class="brief">
   <li><dfn title="dom-Element-schemaTypeInfo" id="dom-element-schematypeinfo"><code>schemaTypeInfo</code></dfn>
   <li><dfn title="dom-Element-setIdAttribute" id="dom-element-setidattribute"><code>setIdAttribute()</code></dfn>
   <li><dfn title="dom-Element-setIdAttributeNS" id="dom-element-setidattributens"><code>setIdAttributeNS()</code></dfn>
   <li><dfn title="dom-Element-setIdAttributeNode" id="dom-element-setidattributenode"><code>setIdAttributeNode()</code></dfn>
  </ul>

 <dt><code><a href="#documenttype">DocumentType</a></code>
 <dd>
  <ul class="brief">
   <li><dfn title="dom-DocumentType-entities" id="dom-documenttype-entities"><code>entities</code></dfn>
   <li><dfn title="dom-DocumentType-notations" id="dom-documenttype-notations"><code>notations</code></dfn>
   <li><dfn title="dom-DocumentType-internalSubset" id="dom-documenttype-internalsubset"><code>internalSubset</code></dfn>
  </ul>

 <dt><code><a href="#text">Text</a></code>
 <dd>
  <ul class="brief">
   <li><dfn title="dom-Text-isElementContentWhitespace" id="dom-text-iselementcontentwhitespace"><code>isElementContentWhitespace</code></dfn>
   <li><dfn title="dom-Text-replaceWholeText" id="dom-text-replacewholetext"><code>replaceWholeText()</code></dfn>
  </ul>
</dl>

<h3 id="dom-ranges"><span class="secno">8.3 </span>DOM Ranges</h3>

<p>These are the changes made to the features described in the
"Document Object Model Range" chapter of
<cite>DOM Level 2 Traversal and Range</cite>.

<ul>
 <li><p><dfn id="rangeexception"><code>RangeException</code></dfn> has been removed.

 <li><p><code><a href="#range">Range</a></code> objects can now be moved between
 <a title="concept-document" href="#concept-document">documents</a> and used on
 <a title="concept-node" href="#concept-node">nodes</a> that are not <a href="#in-a-document">in a document</a>.

 <li><p>A wild <code title="dom-Range"><a href="#dom-range">Range()</a></code> constructor appeared.

 <li><p>New methods <code title="dom-Range-comparePoint"><a href="#dom-range-comparepoint">comparePoint()</a></code>,
 <code title="dom-Range-intersectsNode"><a href="#dom-range-intersectsnode">intersectsNode()</a></code>, and
 <code title="dom-Range-isPointInRange"><a href="#dom-range-ispointinrange">isPointInRange()</a></code> have been added.

 <li><p><code title="dom-Range-detach"><a href="#dom-range-detach">detach()</a></code> is now a no-op.

 <li><p><dfn title="dom-Range-toString" id="dom-range-tostring"><code>toString()</code></dfn> is now defined through
 IDL.
</ul>


<h3 id="dom-traversal"><span class="secno">8.4 </span>DOM Traversal</h3>

<p>These are the changes made to the features described in the
"Document Object Model Traversal" chapter of
<cite>DOM Level 2 Traversal and Range</cite>.

<ul>
 <li><p><code title="dom-Document-createNodeIterator"><a href="#dom-document-createnodeiterator">createNodeIterator()</a></code> and
 <code title="dom-Document-createTreeWalker"><a href="#dom-document-createtreewalker">createTreeWalker()</a></code> now have optional
 arguments and lack a fourth argument which is no longer relevant given entity references
 never made it into the DOM.

 <li><p>The <code title="">expandEntityReferences</code> attribute has been removed from the
 <code><a href="#nodeiterator">NodeIterator</a></code> and <code><a href="#treewalker">TreeWalker</a></code> interfaces for the aforementioned
 reason.

 <li><p>The <code title="dom-NodeIterator-referenceNode"><a href="#dom-nodeiterator-referencenode">referenceNode</a></code> and
 <code title="dom-NodeIterator-pointerBeforeReferenceNode"><a href="#dom-nodeiterator-pointerbeforereferencenode">pointerBeforeReferenceNode</a></code>
 attributes have been added to <code><a href="#nodeiterator">NodeIterator</a></code> objects to align with proprietary
 extensions of implementations.

 <li><p><code title="dom-NodeIterator-nextNode"><a href="#dom-nodeiterator-nextnode">nextNode()</a></code> and
 <code title="dom-NodeIterator-previousNode"><a href="#dom-nodeiterator-previousnode">previousNode()</a></code> now throw
 when invoked from a <code><a href="#nodefilter">NodeFilter</a></code> to align with user agents.

 <li><p><code title="dom-NodeIterator-detach"><a href="#dom-nodeiterator-detach">detach()</a></code> is now a no-op.
</ul>


<h2 class="no-num" id="references">References</h2>
<div id="anolis-references"><dl><dt id="refsCSSOMVIEW">[CSSOMVIEW]
<dd>(Non-normative) <cite><a href="http://dev.w3.org/csswg/cssom-view/">CSSOM View Module</a></cite>, Simon Pieters and Glenn Adams. W3C.

<dt id="refsDOM2TR">[DOM2TR]
<dd>(Non-normative) <cite><a href="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/">Document Object Model (DOM) Level 2 Traversal and Range Specification</a></cite>, Joe Kesselman, Jonathan Robie, Mike Champion et al.. W3C.

<dt id="refsDOM3CORE">[DOM3CORE]
<dd>(Non-normative) <cite><a href="http://www.w3.org/TR/DOM-Level-3-Core/">Document Object Model (DOM) Level 3 Core Specification</a></cite>, Arnaud Le Hors, Philippe Le Hégaret, Lauren Wood et al.. W3C.

<dt id="refsDOM3EVENTS">[DOM3EVENTS]
<dd>(Non-normative) <cite><a href="https://dvcs.w3.org/hg/dom3events/raw-file/tip/html/DOM3-Events.html">Document Object Model (DOM) Level 3 Events Specification</a></cite>, Gary Kacmarcik and Travis Leithead. W3C.

<dt id="refsDOMPS">[DOMPS]
<dd>(Non-normative) <cite><a href="https://dvcs.w3.org/hg/innerhtml/raw-file/tip/index.html">DOM Parsing and Serialization</a></cite>, Travis Leithead. W3C.

<dt id="refsELEMENTTRAVERSAL">[ELEMENTTRAVERSAL]
<dd>(Non-normative) <cite><a href="http://www.w3.org/TR/ElementTraversal/">Element Traversal Specification</a></cite>, Doug Schepers. W3C.

<dt id="refsENCODING">[ENCODING]
<dd><cite><a href="https://encoding.spec.whatwg.org/">Encoding</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsHTML">[HTML]
<dd><cite><a href="https://html.spec.whatwg.org/multipage/">HTML</a></cite>, Ian Hickson. WHATWG.

<dt id="refsRFC2119">[RFC2119]
<dd><cite><a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a></cite>, Scott Bradner. IETF.

<dt id="refsSELECTORS">[SELECTORS]
<dd><cite><a href="http://dev.w3.org/csswg/selectors/">Selectors</a></cite>, Elika J. Etemad and Tab Atkins Jr.. W3C.

<dt id="refsSELECTORSAPI">[SELECTORSAPI]
<dd>(Non-normative) <cite><a href="http://dev.w3.org/2006/webapi/selectors-api2/">Selectors API Level 2</a></cite>, Lachlan Hunt. W3C.

<dt id="refsUIEVENTS">[UIEVENTS]
<dd><cite><a href="https://dvcs.w3.org/hg/d4e/raw-file/tip/source_respec.htm">UI Events</a></cite>, Gary Kacmarcik and Travis Leithead. W3C.

<dt id="refsURL">[URL]
<dd><cite><a href="https://url.spec.whatwg.org/">URL</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsWEBIDL">[WEBIDL]
<dd><cite><a href="http://heycam.github.io/webidl/">Web IDL</a></cite>, Cameron McCormack. W3C.

<dt id="refsXML">[XML]
<dd><cite><a href="http://www.w3.org/TR/xml/">Extensible Markup Language</a></cite>, Tim Bray, Jean Paoli, C. M. Sperberg-McQueen et al.. W3C.

<dt id="refsXMLNS">[XMLNS]
<dd><cite><a href="http://www.w3.org/TR/xml-names/">Namespaces in XML</a></cite>, Tim Bray, Dave Hollander, Andrew Layman et al.. W3C.

</dl></div>



<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

<p>There have been a lot of people that have helped make DOM more interoperable over the
years and thereby furthered the goals of this standard. Likewise many people have helped
making this standard what it is today.

<p>With that, many thanks to
Adam Klein,
Adrian Bateman,
Alex Russell,
Arkadiusz Michalski,
Arnaud Le Hors,
Arun Ranganathan,
Björn Höhrmann,
Boris Zbarsky,
Brandon Slade,
Brandon Wallace,
Brian Kardell,
Cameron McCormack,
Christophe Dumez,
Daniel Glazman,
David Bruant,
David Flanagan,
David Håsäther,
Dethe Elza,
Dimitri Glazkov,
Domenic Denicola,
Dominic Cooney,
Dominique Hazaël-Massieux,
Don Jordan,
Doug Schepers,
Erik Arvidsson,
Gavin Nicol,
Geoffrey Sneddon,
Glen Huang,
Glenn Maynard,
Harald Alvestrand,
Henri Sivonen,
Ian Hickson,
Igor Bukanov,
Jacob Rossi,
Jake Archibald<!-- technically B.J. Archibald -->,
Jake Verbaten,
James Graham,
James Greene,
James Robinson,
Jens Lindström,
João Eiras,
Joe Kesselman,
Jonas Sicking,
Jonathan Robie,
Joshua Bell,
Justin Summerlin,
呂康豪 (Kang-Hao Lu),
Kevin Sweeney,
Lachlan Hunt,
Lauren Wood,
Manish Goregaokar,
Manish Tripathi,
Marcos Caceres,
Mark Miller,
Mats Palmgren,
Mounir Lamouri,
Michael™ Smith,
Mike Champion,
Ojan Vafai,
Olli Pettay,
Ondřej Žára,
Peter Sharpe,
Philip Jägenstedt,
Philippe Le Hégaret,
Rafael Weinstein,
Rick Waldron,
Robbert Broersma,
Robin Berjon,
Rune <span title="Fabulous">F.</span> Halvorsen,
Ryosuke Niwa,
Seo Sanghyeon,
Shiki Okasaka,
Simon Pieters,
Steve Byrne,
Stig Halvorsen,
Tab Atkins,
Timo Tijhof,
Tom Pixley,
Travis Leithead,
Vidur Apparao,
Warren He,
Yehuda Katz,
Yoichi Osato, and
Zack Weinberg
for being awesome!

<p>This standard is written by
<a lang="nl" href="//annevankesteren.nl/">Anne van Kesteren</a>
(<a href="//www.mozilla.org/">Mozilla</a>,
<a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>) with substantial contributions from
Aryeh Gregor (<a href="//www.mozilla.org/">Mozilla</a>,
<a href="mailto:ayg@aryeh.name">ayg@aryeh.name</a>)
and Ms2ger (<a href="//www.mozilla.org/">Mozilla</a>,
<a href="mailto:ms2ger@gmail.com">ms2ger@gmail.com</a>).

<p>Per <a rel="license" href="//creativecommons.org/publicdomain/zero/1.0/">CC0</a>, to
the extent possible under law, the editors have waived all copyright and related or
neighboring rights to this work.

<script id="head" src="//resources.whatwg.org/dfn.js"></script>
<!-- vim: set expandtab shiftwidth=1 tabstop=1 textwidth=76 -->
