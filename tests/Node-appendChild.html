<!DOCTYPE html>
<title>Node.appendChild</title>
<link rel="author" title="Ms2ger" href="mailto:ms2ger@gmail.com">
<link rel="help" href="../web-dom-core#dom-node-appendchild">
<link rel="help" href="http://dev.w3.org/2006/webapi/WebIDL/#es-interface">
<body>
<script src="support/test.js"></script>
<script>
function testHRE(aNode) {
  Test.ok(aNode, "No node?");
  try {
    aNode.appendChild(document.createTextNode("fail"));
    Test.fail("Exception should have been thrown.");
  } catch (e) {
    Test.is(e.code, DOMException.HIERARCHY_REQUEST_ERR);
  }
  try {
    aNode.appendChild(null);
    Test.fail("Exception should have been thrown.");
  } catch (e) {
    Test.is(e.code, DOMException.HIERARCHY_REQUEST_ERR);
  }
}
</script>
<script>
function testCrossDocument() {
  try {
    var s = this.contentDocument.createElement("a");
    Test.is(s.ownerDocument, this.contentDocument);
    document.body.appendChild(s);
    Test.is(s.ownerDocument, document);

    s = this.contentDocument.createElement("b");
    this.contentDocument.body.appendChild(s);
    Test.is(s.ownerDocument, this.contentDocument);
    document.body.appendChild(s);
    Test.is(s.ownerDocument, document);
  } catch (e) {
    Test.fail("Exception was thrown.");
  }
  Test.finish();
}

try {
  var len = document.body.childNodes.length;
  try {
    document.body.appendChild(null);
    Test.fail("Exception should have been thrown.");
  } catch (e) {
    Test.is(e.code, DOMException.NOT_SUPPORTED_ERR);
  }
  Test.is(document.body.childNodes.length, len);

  try {
    document.body.appendChild({'a':'b'});
    Test.fail("Exception should have been thrown.");
  } catch (e) {
    Test.ok(e instanceof TypeError, "Should have thrown TypeError.");
  }
  Test.is(document.body.childNodes.length, len);

  Test.separate();
  document.body.setAttribute("abc", "pass");
  var attr = document.body.attributes[0];
  Test.ok(attr, "No attribute node?");
  testHRE(attr);
  Test.is(attr.value, "pass");
  Test.is(attr.childNodes.length, 1);
  Test.is(attr.childNodes[0].nodeValue, "pass");

  Test.separate();
  testHRE(document.createTextNode("Foo"));

  Test.separate();
  var iframe = document.createElement("iframe");
  iframe.onload = testCrossDocument;
  iframe.src = "support/document";
  document.body.appendChild(iframe);
} catch (e) {
  Test.fail("Exception was thrown.");
}
</script>
